# OceanBaseデータベースに基づきWordPress Webサイトを構築する

本記事では、OceanBaseデータベースに基づきWordPress Webサイトを構築する方法について説明します。

## 背景情報

* WordPress：WordPressは、PHPとMySQLに基づくオープンソースのコンテンツ管理システム(Content Management System, CMS)です。詳細については、[WordPress公式Webサイト](https://www.hostinger.com/wordpress-hosting?ppc_campaign=google_search_generic_hosting_wordpress&bidkw=wordpress&gad_source=1&gclid=EAIaIQobChMIi9-WkdmIigMV8lsPAh2tpR84EAAYASAAEgIgo_D_BwE)を参照してください。WordPressは、そのユーザビリティ、拡張性、強力なコミュニティサポートから、多くのユーザーに支持されています。ここではOB Cloudに基づいてWebサイトを構築する方法についてWordPressを使って説明します。
* MAMP：MAMPは、macOSおよびWindows用のソフトウェアパッケージで、PHPとMySQLに基づいたWebアプリケーションの開発とテストを、開発者が自身のコンピューター上で簡単に行うことができる完全なローカル開発環境を提供します。WordPressの実行環境としても利用できます。詳細については、[MAMP公式Webサイト](https://www.mamp.info/)を参照してください。

## 前提条件

* OceanBase V4.3.3以降のバージョンのクラスタをデプロイし、MySQLモードのテナントを作成していること。OceanBaseクラスタのデプロイに関する詳細は、[デプロイの概要](../400.deploy/100.deploy-overview.md)を参照してください。

* 作成したMySQLモードのテナントに挿入とクエリを実行する権限が付与されていること。権限設定の詳細については、[直接権限の付与](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974757)を参照してください。

* データベースを作成済みであること。データベースの作成に関する詳細については、[データベースの作成](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971662)を参照してください。

* ApacheとPHPをインストールしていること。

  * 以下のコマンドを実行して、Apacheをインストールします

    ```shell
    brew install httpd
    ```

  * 以下のコマンドを実行して、PHPをインストールします

    ```shell
    brew install php
    ```

## 操作手順

1. WordPressをインストールします

    1. 以下のコマンドを実行して、WordPressをダウンロードします

        ```shell
        curl -O https://wordpress.org/latest.tar.gz
        ```

    2. 以下のコマンドを実行して、WordPressを解凍します。

        ```shell
        tar -xzvf latest.tar.gz
        ```

    3. 以下のコマンドを実行して、解凍したWordPressフォルダをご希望の名前(例：your-wordpress-site)に変更し、MAMPのhtdocsディレクトリに移動します。パスは通常 `/Applications/MAMP/htdocs/` です。

        ```shell
        mv wordpress /Applications/MAMP/htdocs/your-wordpress-site
        ```

2. WordPress設定ファイルを編集します。

    * WordPressインストールディレクトリにある `wp-config-sample.php` ファイルを編集し、データベース接続情報を設定します。

        ```php
            /** The name of the database for WordPress */
            define('DB_NAME', 'your_db_name');    ## 対応するデータベース名の設定
            /** MySQL database username */
            define('DB_USER', 'your_db_user');    ## 対応するテナントとユーザー名の設定
            /** MySQL database password */
            define('DB_PASSWORD', 'your_db_password');  ## 対応するテナントユーザーのパスワードの設定
            /** MySQL hostname */
            define('DB_HOST', 'your_ob_cloud_host'); // ## 対応するテナントのIPアドレスとポートの設定
        ```

    * WordPressの `class-wpdb.php` ファイルを編集し、utf8mb4_unicode_520_ciをutf8mb4_general_ciに修正します。

        ```php
            if ( $this->has_cap( 'utf8mb4_520' ) && 'utf8mb4_unicode_ci' === $collate ) {
                        $collate = 'utf8mb4_general_ci';
                    }
        ```

3. こちらのリンクからWebサイトにアクセスできます：http://localhost:8888/your-wordpress-site
    ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/1202.png)
