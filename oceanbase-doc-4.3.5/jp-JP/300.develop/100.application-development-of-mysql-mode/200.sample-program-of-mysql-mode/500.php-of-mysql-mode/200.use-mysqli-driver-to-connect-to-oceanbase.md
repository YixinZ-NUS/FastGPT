|description|本記事では、mysqliドライバーを使用してOceanBaseデータベースに接続し、テーブルの作成やデータの挿入などの基本操作を実現する方法を紹介します。|
|---|---|
|keywords||
|dir-name|MySQLi|
|dir-name-en||
|tenant-type|MySQL Mode|

# MySQLiドライバー

本記事では、MySQLiドライバーを使用してOceanBaseデータベースに接続し、テーブルの作成やデータの挿入などの基本操作を実現する方法を紹介します。
MySQLiはPHP言語の拡張機能で、手続き型またはオブジェクト指向のデータベースアクセス方式を提供します。

## 適用バージョン

OceanBaseデータベースのすべてのバージョン。

## 前提条件

* PHPとphp-mysqlがインストール済みであること。
* OceanBaseデータベースがインストール済みで、MySQLモードのテナントが作成されていること。

## 操作手順

1. phpとphp-mysql環境を確認し、インストールします。
2. `obtest1.php` サンプルファイルを新規作成し、データベース接続情報を設定します。
3. `obtest1.php` ファイルを実行して検証します。

### ステップ１：PHPとPHP-MYSQL環境を確認し、インストールする

PHPとphp-mysql環境をインストールします。具体的な操作については [Extドライバーを使用したOceanBaseデータベースへの接続](../500.php-of-mysql-mode/100.ext-driver-connects-to-oceanbase-database.md) の **ステップ１：phpとphp-mysql環境を確認し、インストールする** を参照してください。

### ステップ2：obtest1.phpファイル内のデータベース接続情報を修正する

Linux環境を例にすると、`vi obtest1.php` または `vim obtest1.php` コマンドを使用して `obtest1.php` ファイルを編集し、ファイル内のデータベース接続情報を修正することで、実際の状況と一致させます。

例：

```shell
[root]# vim obtest1.php
<?php
$servername = "11.158.xx.xx";
$port = "6001";
$username = "root@mysql";
$password = "";
$dbname = "test";

// 接続の作成
$conn = new mysqli($servername, $username, $password, $dbname, $port);

// 接続に成功したかどうかを確認する
if ($conn->connect_error) {
    die("接続失敗: " . $conn->connect_error);
}

// テーブルの作成
$sql = "CREATE TABLE myguests (
id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
firstname VARCHAR(30) NOT NULL,
lastname VARCHAR(30) NOT NULL,
email VARCHAR(50),
reg_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
)";
if ($conn->query($sql) === TRUE) {
    echo "テーブルmyguestsの作成に成功しました";
} else {
    echo "テーブルの作成に失敗しました: " . $conn->error;
}

// データの挿入
$sql = "INSERT INTO myguests (firstname, lastname, email)
VALUES ('John', 'Doe', 'john@example.com')";
if ($conn->query($sql) === TRUE) {
    echo "新規レコードの挿入に成功しました";
} else {
    echo "データの挿入に失敗しました: " . $conn->error;
}

// テーブルのクエリ
$sql = "SELECT id, firstname, lastname FROM MyGuests";
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    // データの出力
    while($row = $result->fetch_assoc()) {
        echo "id: " . $row["id"]. " - Name: " . $row["firstname"]. " " . $row["lastname"]. "<br>";
    }
} else {
    echo "結果は 0 です";
}

// テーブルの削除
$sql = "DROP TABLE myguests";
if ($conn->query($sql) === TRUE) {
    echo "テーブルmyguestsの削除に成功しました";
} else {
    echo "テーブルの削除に失敗しました: " . $conn->error;
}

// 接続を閉じる
$conn->close();
?>
```

そのうち：

* `$servername` はMySQLサーバーのアドレスを指します。
* `$port` はMySQLサーバーのポート番号を指します。
* `$username` はMySQLユーザー名を指します。
* `$password` はMySQL接続用のパスワードを指します。
* `$dbname` は接続するデータベースの名前を指します。

### ステップ3：obtest1.phpファイルを実行して検証する

`php obtest1.php` コマンドを実行して `obtest1.php` ファイルを起動し、OceanBaseデータベースへの接続、テーブルの作成、データの挿入などの基本操作が成功したかどうかを検証します。

例：

```shell
[root]# php obtest1.php
テーブルmyguestsの作成と新しいレコードの挿入に成功しましたid: 1 - Name: John Doe<br>テーブルmyguestsの削除に成功しました
```
