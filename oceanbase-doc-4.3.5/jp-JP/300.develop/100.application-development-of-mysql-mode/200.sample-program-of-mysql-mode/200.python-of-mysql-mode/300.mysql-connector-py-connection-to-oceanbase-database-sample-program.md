|description|本記事では、MySQL-connector-pythonを使用してOceanBaseデータベースに接続し、データベースの作成、テーブルの作成、データの挿入、データの更新、データのクエリなどの基本操作を実行する方法について説明します。|
|---|---|
|keywords|MySQL-connector-python、Python、OceanBase、データベース接続、MySQLモード|
|dir-name|MySQL-connector-python|
|dir-name-en||
|tenant-type|MySQL Mode|

# MySQL-connector-python

本記事では、Pythonドライバーを使用してOceanBaseデータベースに接続し、使用する方法について説明します。使用するドライバーはMySQL-connector-pythonです。

## 前提条件

* Python2.7/Python 3.xおよびpipがインストール済みであること。
* OceanBaseデータベースがインストール済みで、MySQLモードのテナントが作成されていること。

## 操作手順

1. OceanBaseデータベースの接続文字列を取得します。
2. MySQL-connector-pythonドライバーをインストールします。
3. `test.py` ファイルを作成し、データベース接続情報を入力します。
4. `test.py` ファイルを実行します。

### ステップ１：OceanBaseデータベースの接続文字列を取得する

OceanBaseデータベースのデプロイ担当者または管理者から、該当するデータベース接続文字列を取得します。

```shell
obclient -h$host -P$port -u$user_name -p$password -D$database_name
```

**パラメータの説明：**

* `$host`：OceanBaseデータベースへの接続IPアドレス。OceanBaseデータベースプロキシ(OceanBase Database Proxy、ODP)接続方式ではODPアドレスを使用し、直接接続方式ではOBServerノードのIPアドレスを使用します。
* `$port`：OceanBaseデータベースへの接続ポート。ODP接続方式のデフォルトポートは`2883`で、ODPデプロイ時にカスタマイズ可能です。直接接続方式のデフォルトポートは`2881`で、OceanBaseデータベースのデプロイ時にカスタマイズ可能です。
* `$database_name`：アクセス対象のデータベース名。

    <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>接続するテナントのユーザーには、データベースに対する <code>CREATE</code>、<code>INSERT</code>、<code>UPDATE</code> および <code>SELECT</code> の権限が付与されていなければなりません。その他のユーザー権限の詳細については、<a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974758">MySQLモードの権限分類</a>を参照してください。</p>
    </main>

* `$user_name`：テナントの接続アカウント。ODP接続の一般的な形式：`ユーザー名@テナント名#クラスタ名`または`クラスタ名:テナント名:ユーザー名`。直接接続方式の形式：`ユーザー名@テナント名`。
* `$password`：アカウントのパスワード。

その他の接続文字列に関する詳細は、[OBClientを使用して OceanBase テナントに接続する](../../100.connect-to-oceanbase-database-of-mysql-mode/300.connect-to-an-oceanbase-tenant-by-using-obclient-of-mysql-mode.md)を参照してください。

**例：**

```shell
obclient -hxxx.xxx.xxx.xxx -P2881 -utest_user001@mysql001 -p****** -Dtest
```

### ステップ2：MySQL-connector-pythonドライバーをインストールする

MySQL Connector/Pythonは、MySQLが公式に提供するMySQLデータベース接続用公式ドライバーです。これは、Pythonプログラミング言語でコンパイルされており、PythonからMySQLデータベースへの接続と操作を行うために使用されます。MySQL Connector/Pythonは、Python 2.7およびPython 3.xバージョンに対応しています。

コマンドプロンプトまたはPowerShellターミナルを開き、以下のコマンドを実行してMySQL-connector-pythonドライバーをインストールします。

```shell
pip3 install mysql-connector-python
```

インストールが完了したら、以下のコマンドを実行してインストールが正常に完了したかどうかを検証します：

```shell
pip3 list | grep mysql-connector-python
```

### ステップ3：アプリケーションを作成する

### ステップ3：test.pyファイルを作成し、データベース接続情報を入力する

**ステップ１：OceanBaseデータベースの接続文字列を取得する** に記載されている情報に基づいて、`test.py`ファイルを作成して、データベース接続情報を入力します。

1. `test.py` という名前のファイルを作成します。

2. `test.py` ファイルに以下の内容を入力し、実際の状況に応じてデータベース接続情報を修正します。

   **`test.py` ファイルの内容例：**

   ```python
   import mysql.connector

   # データベース接続情報
   config = {
       'host': 'xxx.xxx.xxx.xxx',
       'port': 2881,
       'user': 'test_user001@mysql001',
       'password': '******',
       'database': 'test'
   }

   # データベース接続の作成
   conn = mysql.connector.connect(**config)
   cursor = conn.cursor()

   # データベースの作成
   cursor.execute("CREATE DATABASE IF NOT EXISTS test")

   # データベースの使用
   cursor.execute("USE testdb")

   # テーブルの作成
   cursor.execute("""
   CREATE TABLE IF NOT EXISTS test_table (
       id INT AUTO_INCREMENT PRIMARY KEY,
       name VARCHAR(255) NOT NULL,
       age INT
   )
   """)

   # データの挿入
   cursor.execute("""
   INSERT INTO test_table (name, age) VALUES
   ('John', 20),
   ('Lucy', 25),
   ('Tom', 30)
   """)

   # データの更新
   cursor.execute("""
   UPDATE test_table SET age = 26 WHERE name = 'Lucy'
   """)

   # データのクエリ
   cursor.execute("SELECT * FROM test_table")
   rows = cursor.fetchall()
   for row in rows:
       print(row)

   # 接続を閉じる
   cursor.close()
   conn.close()
   ```

### ステップ4：test.pyファイルを実行する

コマンドプロンプトまたはPowerShellターミナルを開き、`test.py` ファイルを実行して、データをクエリし、結果を出力します。

1. `test.py` ファイルがあるディレクトリに移動します。

    **例：**

    ```shell
    cd D:\demo\demo
    ```

2. `test.py` ファイルを実行します。

    **例：**

    ```shell
    python test.py
    ```

    実行結果は次のとおりです：

    ```shell
    (1, 'John', 20)
    (2, 'Lucy', 26)
    (3, 'Tom', 30)
    ```

## エラー処理

MySQL-connector-pythonを使用してOceanBaseデータベースに接続する際、さまざまなエラーが発生する可能性があります。以下は、一般的なエラーとその処理方法です：

1. **接続エラー**：データベースに接続できない場合、ホスト名、ポート、ユーザー名、パスワード、データベース名を含む接続パラメータが正しいかどうか確認してください。

2. **権限エラー**：権限に関連するエラーが発生した場合、ユーザーが必要な操作を実行するために十分な権限を持っていることを確認してください。

3. **SQL構文エラー**：SQLステートメントに構文エラーがある場合、SQLステートメントの構文が正しいかどうか確認してください。

4. **データ型エラー**：挿入したデータ型がテーブルの定義とマッチしない場合、挿入したデータ型が正しいことを確認してください。

コード内で `try-except` ステートメントを使用してこれらのエラーをキャッチし、処理することで、エラー発生時にプログラムがクラッシュすることなく適切に対処できるようにします。同時に、`logging` モジュールを使用してエラーメッセージを記録することで、デバッグや問題のトラブルシューティングを容易にします。

## 関連ドキュメント

* OceanBaseデータベースに接続するための詳細情報については、[接続方法の概要](../../100.connect-to-oceanbase-database-of-mysql-mode/100.connection-methods-overview-of-mysql-mode.md)を参照してください。

* データベースの作成に関する詳細については、[CREATE DATABASE](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974111)を参照してください。
