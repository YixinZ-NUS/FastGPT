|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|

# MySQLクライアントによるOceanBaseテナントへの接続

OceanBaseデータベースのMySQLテナントを使用する場合、MySQLクライアントを使用してそのテナントに接続できます。本記事では、この接続方式の前提条件、接続操作、およびその実例について説明します。

## 前提条件

MySQLクライアントを使用してデータベースに接続する前に、以下の情報を確認する必要があります：

* ローカルにMySQLクライアントが正しくインストールされていることを確認してください。OceanBaseデータベースの現行バージョンが対応しているMySQLクライアントのバージョンは、V5.5、V5.6、V5.7です。

* 環境変数`PATH`に、MySQLクライアントのコマンドが格納されているディレクトリが含まれていることを確認してください。

* テナントに接続する前に、現在のクライアントがテナントのアローリストに含まれていることを確認してください。テナントのアローリストのクエリと設定の具体的な操作については、[テナントのアローリストの確認と設定](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971592)を参照してください。

## 接続操作

### ODPによる接続

MySQLクライアントコマンドを使用して、OceanBaseデータベースプロキシ(OceanBase Database Proxy、ODP)を介してOceanBaseデータベースに接続する形式は、以下のとおりです：

```shell
mysql -h$host -P$port -u$user_name -p****** [-c] [-A] [$database_name]
```

**パラメータの説明：**

* `-h`：OceanBaseデータベースへの接続IPアドレスを指定します。`$host`は実際のIPアドレスに置き換える必要があり、ODPによる接続方式ではODPアドレスを使用します。
* `-P`：OceanBaseデータベースへの接続ポートを指定します。`$port`は実際のポートに置き換える必要があります。ODP接続を使用する場合デフォルトは`2883`ですが、ODPをデプロイする際にカスタマイズできます。
* `-u`：OceanBaseデータベースへの接続アカウントを指定します。`$user_name`の形式は以下のとおりです：`ユーザー名@テナント名#クラスタ名`、`クラスタ名:テナント名:ユーザー名`、`クラスタ名-テナント名-ユーザー名`または`クラスタ名.テナント名.ユーザー名`。MySQLクライアントを使用した接続は、MySQLモードのテナントのみサポートしており、その管理者ユーザー名のデフォルトは`root`です。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p><ul><li>ODPを使用してOceanBaseクラスタに接続する際、次の方法でクラスタ名を取得できます：</br>まず、直接接続方式でOceanBaseデータベースに接続します。次に、<code>SHOW PARAMETERS LIKE 'cluster';</code>コマンドを実行してクラスタ名を取得します。このコマンドが返す結果の<code>VALUE</code> の値が、OceanBaseクラスタの名前に該当します。</li><li>ODPが複数のクラスタをプロキシしている場合、接続時にクラスタ名を指定する必要があります。ODPが1つのクラスタだけをプロキシしている場合、接続時にクラスタ名を指定する必要はありません。</li></ul></p>
   </main>

* `-p`: OceanBaseデータベースに接続するためのパスワードを指定します。`******`は実際のパスワード文字列に置き換える必要があります。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>セキュリティ上の考慮から、コマンドラインに直接パスワードを入力することは推奨されません。特にスクリプトや履歴が可視化される環境下では、このオプションを省略し、プロンプトが表示されたときにパスワードを入力することを推奨します。</p>
   </main>

* `-c`：オプションのパラメータ。MySQL実行環境において、コメントを無視しないようにします。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>Hintは特殊なコメントであり、<code>-c</code>の影響を受けません。</p>
   </main>

* `-A`: オプションのパラメータ。MySQLがデータベースに接続する際、統計情報を自動的に取得しないようにします。
* `$database_name`：オプション。OceanBaseデータベースに接続した後に使用するデフォルトのデータベースを指定します。これを指定しない場合、デフォルトではどのデータベースにも直接アクセスしません。接続後に手動で選択する必要があります。

**例：**

```shell
mysql -h10.10.10.1 -uuser001@obmysql#obdemo -P2883 -p****** -c -A oceanbase
```

### 直接接続方式

MySQLクライアントコマンドを使用して、直接接続方式でOceanBaseデータベースに接続する場合の書式は、以下のとおりです：

```shell
mysql -h$host -P$port -u$user_name -p****** [-c] [-A] [$database_name]
```

**パラメータの説明：**

* `-h`：OceanBaseデータベースへの接続IPアドレスを指定します。`$host`は実際のIPアドレスに置き換える必要があります。直接接続方式では通常OBServerノードのIPアドレスを使用します。

   <main id="notice" type='notice'>
     <h4>注意</h4>
     <p>一般テナントから直接接続する場合、そのテナントのリソースが接続先のOBServerノード上に配置されている必要があります。もし、そのテナントのリソースが該当するOBServerノード上に配置されていない場合、そのノードへ直接接続しても、そのテナントに接続することはできません。</p>
   </main>

* `-P`：OceanBaseデータベースへの接続ポートを指定します。`$port`は実際のポートに置き換える必要があります。直接接続方式の場合デフォルトは2881ですが、OceanBaseデータベースをデプロイする際にカスタマイズできます。
* `-u`：OceanBaseデータベースへの接続アカウントを指定します。`$user_name`のフォーマット：`ユーザー名@テナント名`。MySQLテナントの管理者ユーザー名は、デフォルトで`root`です。

   <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>直接接続方式でOceanBaseデータベースに接続する場合、接続パラメータ<code>-u</code>の後に正しい<code>ユーザー名@テナント名</code>を入力します。クラスタ名は指定しません。もし<code>-u</code>にクラスタ名が含まれていると、接続エラーが発生します。</p>
   </main>

* `-p`: OceanBaseデータベースに接続するためのパスワードを指定します。`******` は実際のパスワード文字列に置き換える必要があります。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>セキュリティ上の考慮から、コマンドラインに直接パスワードを入力することは推奨されません。特にスクリプトや履歴が可視化される環境下では、このオプションを省略し、プロンプトが表示されたときにパスワードを入力することを推奨します。</p>
   </main>

* `-c`：オプションのパラメータ。MySQL実行環境において、コメントを無視しないようにします。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>Hintは特殊なコメントであり、<code>-c</code>の影響を受けません。</p>
   </main>

* `-A`: オプションのパラメータ。MySQLがデータベースに接続する際、統計情報を自動的に取得しないようにします。
* `$database_name`：オプション。OceanBaseデータベースに接続した後に使用するデフォルトのデータベースを指定します。これを指定しない場合、デフォルトではどのデータベースにも直接アクセスしません。接続後に手動で選択する必要があります。

**例：**

```shell
mysql -h10.10.10.1 -uuser001@obmysql -P2881 -p****** -c -A oceanbase
```

## 接続例

1. コマンドライン端末を開きます。
2. MySQLクライアントを使用してODP経由でOceanBaseデータベースのMySQLモードのテナントに接続します。

   ```shell
   mysql -hxxx.xx.xxx.xxx -P2883 -uroot@mysql001#test432 -p****** -A oceanbase
   ```

   次のような結果が返されます：

   ```shell
   Welcome to the MariaDB monitor.  Commands end with ; or \g.
   Your MySQL connection id is 15
   Server version: 5.6.25 OceanBase 4.3.2.0 (r200000272024061717-93c0ed73ebbcac6edbf7b585860b75d825935358) (Built Jun 17 2024 18:06:04)

   <...>

   Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

   MySQL [oceanbase]>
   ```

3. MySQLコマンドラインを終了するには、`exit`と入力してEnterキーを押すか、**Ctrl** + **D** のショートカットキーを押します。

## 詳細情報

MySQLクライアントを使用してOceanBaseデータベースに接続する際に問題が発生した場合は、MySQLクライアントの公式ドキュメントを参照することを推奨します。
