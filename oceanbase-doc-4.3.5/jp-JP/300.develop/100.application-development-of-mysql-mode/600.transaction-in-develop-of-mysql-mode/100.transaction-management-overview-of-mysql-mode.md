|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|

# トランザクション管理の概要

本記事は、トランザクションの基本情報と関連する制御文について主に説明します。

## トランザクションの概要

データベーストランザクションには、データベース上の一連の操作が含まれます。トランザクションはデータベースをある一貫性した状態から別の一貫した状態に変換します。通常、トランザクション内のSQLには、DMLステートメントとクエリステートメントの両方が含まれます。トランザクション内のSQLがクエリステートメントのみの場合、このトランザクションは通常読み取り専用トランザクションと呼ばれます。

トランザクションがコミットされる前であれば、`ROLLBACK` コマンドを使用してトランザクションをロールバックすることができます。トランザクションの詳細については、[トランザクションの概要](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001973761)を参照してください。

## トランザクション制御文

基本的なトランザクション制御文は以下のとおりです：

* [BEGIN](../600.transaction-in-develop-of-mysql-mode/200.start-a-transaction-of-mysql-mode.md)：明示的にトランザクションを開始します。このステートメントの使用はオプションです：

  * テナントセッションのシステム変数 `autocommit` の値が `0` の場合、トランザクションの自動コミット機能が無効であることを表します。そのため、複数のSQLが1つのトランザクションとして扱うために、明示的に `BEGIN` コマンドを発行する必要はありません。

  * テナントセッションのシステム変数 `autocommit` の値が `1` の場合、トランザクションの自動コミット機能が有効であることを表します。このモードでは、各SQLは独立したトランザクションとなります。複数のSQLを1つのトランザクションとする場合は、`BEGIN` コマンドで明示的にトランザクションを開始します。同時に、トランザクションの自動コミット機能を無効にします。`COMMIT` または `ROLLBACK` ステートメントを実行した後、自動コミットモードに戻ります。

* [SAVEPOINT](300.transaction-savepoints-of-mysql-mode/100.mark-a-savepoint-of-mysql-mode.md)：トランザクション中に「セーブポイント」としてマーカーを設定することで、トランザクションは後でセーブポイントにロールバックすることができます。セーブポイントはオプションです。1つのトランザクション内で複数のセーブポイントを設定することができます。

* [COMMIT](../600.transaction-in-develop-of-mysql-mode/400.submit-transaction-of-mysql-mode.md)：現在のトランザクションをコミットして終了し、トランザクションのすべての変更を永続的に有効化します。またすべてのセーブポイントを削除し、トランザクションが保持されているロックを解除します。

* [ROLLBACK](../600.transaction-in-develop-of-mysql-mode/500.roll-back-transactions-of-mysql-mode.md)：トランザクション全体で既に行われた変更をロールバックする、または特定のセーブポイントより後に行われた変更のみをロールバックします。また、ロールバックした部分に含まれるすべてのセーブポイントを削除し、トランザクションに保持されているロックを解除します。

`obclient` コマンド環境では、SQLプロンプトの後にトランザクション制御コマンドを開始することができます。また、Sessionレベルの `autocommit` 変数を変更することで、トランザクションを自動コミットするかどうかを制御することができます。

* `SET autocommit` で変数を設定すると、現在のセッションに対して即時有効になりますが、接続が切断されると設定した変数は無効になります。

* `SET GLOBAL autocommit` でテナントレベルの変数を設定する場合、有効化するには接続を切断する必要があります。

  <main id="notice" type='explain'>
    <h4>説明</h4>
    <p>現在のSessionの <code>autocommit</code> 値が <code>0</code> で、トランザクションが明示的にコミットされなかった場合、プログラムが異常中断すると、OceanBaseデータベースはコミットされていない最後のトランザクションを自動的にロールバックします。</p>
  </main>

## 関連ドキュメント

* [トランザクションの開始](../600.transaction-in-develop-of-mysql-mode/200.start-a-transaction-of-mysql-mode.md)

* [トランザクションのセーブポイント](300.transaction-savepoints-of-mysql-mode/100.mark-a-savepoint-of-mysql-mode.md)

* [トランザクションのコミット](../600.transaction-in-develop-of-mysql-mode/400.submit-transaction-of-mysql-mode.md)

* [トランザクションのロールバック](../600.transaction-in-develop-of-mysql-mode/500.roll-back-transactions-of-mysql-mode.md)
