|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|

# データの削除

テーブルにデータを挿入した後、`DELETE` ステートメントやその他のステートメントを使用して、テーブルのレコードを削除することができます。本記事では、関連するステートメントの使い方と例を紹介します。

## データ削除の準備

テーブルデータを削除する前に、以下の点を確認してください：

* データベースのOracleテナントに接続されていることを確認してください。データベース接続操作については、[接続方法の概要](../100.connect-to-oceanbase-database-of-oracle-mode/100.connection-methods-overview-of-oracle-mode.md)を参照してください。

  <main id="notice" type='explain'>
   <h4>説明</h4>
   <p>現在ログインしているテナントが属するテナントモードは、<code>sys</code> テナントで<code>oceanbase.DBA_OB_TENANTS</code> ビューをクエリすることで確認できます。 </p>
  </main>

* 操作対象テーブルに対する `DELETE` 権限を保有していることを確認してください。`TRUNCATE TABLE` ステートメントでテーブルデータを削除するには、そのテーブルに対する `CREATE` 権限も必要です。現在のユーザー権限に関する操作については、[ユーザー権限の確認](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974764)を参照してください。該当する権限を持っていない場合は、管理者に連絡し権限の付与を依頼してください。ユーザー権限に関する操作については、[直接権限付与](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974768)を参照してください。

## DELETEステートメントによるデータの削除

通常、テーブルの一部またはすべてのデータを削除するには、[DELETE](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001975130) ステートメントを使用します。

シンプルな `DELETE` ステートメントの構文は以下のとおりです：

```sql
DELETE FROM table_name [ WHERE condition ];
```

|          パラメータ           | 必須 |                説明                                        |
|-------------------------|---------|------------------------------------------------------------|
| table_name              | はい     | 削除対象のデータが存在するテーブルを指定する                                         |
| \[ WHERE condition \]   | いいえ      | WHEREステートメントは、削除するデータが満たす必要がある条件を指定します。条件が指定されていない場合は、テーブル全体が削除されます。 |

<main id="notice" type='explain'>
  <h4>説明</h4>
  <p>テーブルレコード数が数百万件を超えると、大規模トランザクションが発生し、パフォーマンスに影響を与える可能性があります。<code>WHERE</code> 条件で分割して削除するか、<code>TRUNCATE TABLE</code> ステートメントを使用することを推奨します。  </p>
</main>

### 一部データの削除

`DELETE` ステートメントに `WHERE` 条件を追加することで、条件に合致する一部のデータをテーブルから削除できます。

例1：テーブル `t_insert` から `value = 10004` に一致するすべての行レコードを削除します。

```shell
obclient [SYS]> SELECT * FROM t_insert;
+----+------+-------+------------+
| ID | NAME | VALUE | GMT_CREATE |
+----+------+-------+------------+
|  1 | CN   | 10002 | 31-OCT-22  |
|  2 | US   | 10004 | 31-OCT-22  |
|  3 | UK   | 10004 | 01-NOV-22  |
+----+------+-------+------------+
3 rows in set

obclient [SYS]> DELETE FROM t_insert WHERE value = 10004;
Query OK, 2 rows affected

obclient [SYS]> SELECT * FROM t_insert;
+----+------+-------+------------+
| ID | NAME | VALUE | GMT_CREATE |
+----+------+-------+------------+
|  1 | CN   | 10002 | 31-OCT-22  |
+----+------+-------+------------+
1 row in set
```

### すべてのデータの削除

テーブル内のデータ量が少ない場合、`DELETE` ステートメントを使用してすべての行を直接削除することもできます。

例2：テーブル `t_insert` のすべてのレコードを削除します。

```shell
obclient [SYS]> DELETE FROM t_insert;
Query OK, 3 row affected
```

テーブル内のデータレコードが100万件を超える場合、一度に削除を実行するとパフォーマンスに影響を与える可能性があるため、テーブル内の情報に基づいて、レコードを数回に分けて削除することを推奨します。例を以下に示します。

例3： `value < 20000`、`value < 30000`、`value < 40000` のデータを数回に分けて削除します。

```shell
obclient [SYS]> DELETE FROM t_insert WHERE value < 20000;

obclient [SYS]> DELETE FROM t_insert WHERE value < 30000;

obclient [SYS]> DELETE FROM t_insert WHERE value < 40000;
```

## TRUNCATE TABLEステートメントによるテーブルデータの削除

`TRUNCATE TABLE` ステートメントは、指定されたテーブルを完全に削除しますが、テーブルの構造、つまりテーブルで定義されたパーティション情報は保持します。論理的には、このステートメントは、すべての行を削除する `DELETE FROM` ステートメントと同じです。

`TRUNCATE TABLE` ステートメントの構文は以下のとおりです：

```sql
TRUNCATE [TABLE] table_name;
```

例4：`TRUNCATE TABLE` ステートメントを使用して、テーブル `t_insert` のすべてのデータを削除します。

```shell
obclient> TRUNCATE TABLE t_insert;
```

`TRUNCATE TABLE` ステートメントの使用方法と説明の詳細については、[TRUNCATE TABLE](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001975123)を参照してください。

## DBLinkを使用したDELETEステートメントによるデータの削除

現在、OceanBaseデータベースは、DBLinkを使用したOceanBaseデータベース（Oracleモード）およびOracleデータベースのデータ削除をサポートしています。

DBLinkを使用して、リモートデータベーステーブル `t5` から `C2 = 7` のデータ行を削除する例を以下に示します：

```shell
obclient> SET ob_trx_timeout = 1000000000;
Query OK, 0 rows affected

obclient> SELECT * FROM t5@orcl_dblink;
+------+------+
| C1   | C2   |
+------+------+
|    7 |    7 |
|    8 |    8 |
+------+------+
2 row in set

obclient> DELETE FROM t5@orcl_dblink WHERE C2 = 7;
Query OK, 1 row affected

obclient> commit;
Query OK, 0 rows affected

obclient> SELECT * FROM t5@orcl_dblink;
+------+------+
| C1   | C2   |
+------+------+
|    8 |    8 |
+------+------+
1 row in set
```

OceanBaseデータベースのOracleモードは、ローカルテーブルデータの（`INSERT`、`DELETE`、`UPDATE`、および `MERGE INTO`）リモートテーブルへの書き込みをサポートしています。詳細については、[DBLinkを使用してリモートデータベースのデータを変更する](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001973592)を参照してください。

## 関連ドキュメント

* [データの挿入](../400.write-data-of-oracle-mode/100.insert-data-of-oracle-mode-in-develop.md)

* [データの更新](../400.write-data-of-oracle-mode/200.update-data-of-oracle-mode-in-develop.md)

* [データの置換](../400.write-data-of-oracle-mode/400.replace-data-of-oracle-mode-in-develop.md)

* [DBLinkを使用してリモートデータベースのデータを変更する](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001973592)
