|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|

# OBClientによるOceanBaseテナントへの接続

本記事は、OBClientを使用してOceanBaseデータベースのOracleテナントに接続するための前提条件、接続操作、およびサンプルについて紹介します。

## 前提条件

* OBClientアプリケーションをダウンロードし、インストール済みであること。OBClientアプリケーションをダウンロードしていない場合は、以下のリンクをクリックしてダウンロードし、使用してください：

  [OBClientのダウンロード](https://open.oceanbase.com/softwareCenter/community)

* テナントに接続する前に、現在のクライアントがテナントのアローリストに含まれていることを確認してください。テナントのアローリストのクエリと設定の具体的な操作については、[テナントのアローリストの確認と設定](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971592)を参照してください。

## 接続操作

### ODPを使用した接続

OBClientクライアントコマンドを使用して、OceanBaseデータベースプロキシ(OceanBase Database Proxy、ODP)を介してOceanBaseデータベースに接続する形式は、以下のとおりです：

```shell
obclient -h$host -P$port -u$user_name -p****** [-c] [-A] [$schema_name] [--proxy_user[=]user_name]
```

**パラメータの説明：**

* `-h`：OceanBaseデータベースへの接続IPアドレス。`$host`は実際のIPアドレスに置き換える必要があります。ODP経由で接続する場合は、ODPのアドレスを指定します。
* `-P`：OceanBaseデータベースへの接続ポート。`$port`は実際のポート番号に置き換える必要があります。ODP経由で接続する場合、デフォルトのポート番号は2883ですが、ODPのデプロイ時にカスタマイズすることも可能です。
* `-u`：OceanBaseデータベースへの接続アカウント。`$user_name`の書式は以下のとおりです：`ユーザー名@テナント名#クラスタ名`、`クラスタ名:テナント名:ユーザー名`、`クラスタ名-テナント名-ユーザー名`または`クラスタ名.テナント名.ユーザー名`。Oracleモードのテナントにおける管理者ユーザー名は、デフォルトで`SYS`です。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p><ul><li>ODPを使用してOceanBaseクラスタに接続する際、次の方法でクラスタ名を取得できます：</br>まず、直接接続でOceanBaseデータベースに接続します。次に、<code>SHOW PARAMETERS LIKE 'cluster';</code> コマンドを使用してクラスタ名を取得します。このコマンドの実行結果の<code>VALUE</code>列の値が、OceanBaseクラスタの名前に対応します。</li><li>ODPが複数のクラスタをプロキシしている場合は、接続時にクラスタ名を指定する必要があります。ODPが単一のクラスタのみをプロキシしている場合は、クラスタ名を指定する必要はありません。</li></ul></p>
   </main>

* `-p`: OceanBaseデータベースに接続するためのパスワード。`******`は実際のパスワード文字列に置き換える必要があります。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>セキュリティ上の理由から、コマンドラインに直接パスワードを入力することは推奨されません。特にスクリプトや履歴が閲覧可能な環境では、このオプションを省略し、プロンプトが表示された際にパスワードを入力することを推奨します。</p>
   </main>

* `-c`：オプション。OBClient実行環境において、コメントを無視しないようにします。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>Hintは特別なコメントであり、<code>-c</code>の影響を受けません。</p>
   </main>

* `-A`: オプション。OBClientがデータベースに接続する際、統計情報を自動で取得しないようにします。
* `$schema_name`：オプション。OceanBaseデータベースに接続した後に使用するデフォルトのスキーマを指定します。指定しない場合、デフォルトで現在ログインしているユーザーのスキーマを使用します。
* `--proxy_user`：オプション。このパラメータはプロキシ対象のユーザー名、つまりターゲットのユーザー名を指定します。プロキシユーザーの使用に関するその他のサンプルについては、[プロキシユーザーの使用](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974761)を参照してください。

**例：**

```sql
obclient -h10.10.10.1 -P2883 -uuser001@obtenant#obdemo -p****** -c -A test_user001
```

#### ODPを使用してSERVICE_NAME経由で接続する

OceanBaseデータベースは、ODPの`IP:PORT`と`SERVICE_NAME`を指定したログインに対応しています。指定された`SERVICE_NAME`に基づいて、ODPは接続文字列を`-uuser_name@プライマリテナント名#プライマリテナントが存在するクラスタ`に変換します。これにより、ユーザーははプライマリ/スタンバイクラスタの切り替え後に、手動で接続文字列を修正する必要がなくなります。`SERVICE_NAME`の作成に関する詳細については、[サービスの作成](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001973937)を参照してください。

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>この機能のご利用には、V4.3.1以降のOceanBase Cloud Platform (OCP)が必要です。また、機能が正常に動作するためには、OCPによって対象のOceanBaseクラスタが管理されている必要があります。</p>
</main>

ODP経由で`SERVICE_NAME`を指定してOceanBaseデータベースに接続する際の書式は、次のようになります。

```shell
obclient -h$host -P$port -u$user_name@SERVICE:$service_name -p******
```

**パラメータの説明：**

* `$host`：ODPのIPアドレス。
* `$port`：ODPのポート番号。
* `$user_name`：ユーザー名。
* `$service_name`: サービス名。
* `-p`: OceanBaseデータベースに接続するためのパスワードを指定します。`******`は実際のパスワード文字列に置き換える必要があります。

**例：**

```sql
obclient -h10.10.10.1 -P2883 -uuser001@SERVICE:service_oracle001 -p******
```

### 直接接続

OBClientクライアントコマンドを使用して、直接にOceanBaseデータベースに接続する形式は以下のとおりです：

```shell
obclient -h$host -P$port -u$user_name -p****** [-c] [-A] [$schema_name] [--proxy_user[=]user_name]
```

**パラメータの説明：**

* `-h`：OceanBaseデータベースへの接続IPアドレス。`$host`は実際のIPアドレスに置き換える必要があります。直接接続では通常OBServerノードのIPアドレスを使用します。

   <main id="notice" type='notice'>
     <h4>注意</h4>
     <p>一般テナントが直接接続方式で接続する場合、そのテナントのリソースが接続先のOBServerノード上に配置されている必要があります。もし、テナントのリソースが配置されていないOBServerノードへ直接接続しようとしても、そのテナントに接続することはできません。</p>
   </main>

* `-P`：OceanBaseデータベースへの接続ポート。`$port`は実際のポートに置き換える必要があります。直接接続方式の場合デフォルトは2881ですが、OceanBaseデータベースをデプロイする際にカスタマイズできます。
* `-u`：OceanBaseデータベースへの接続アカウントを指定します。`$user_name`の書式は`ユーザー名@テナント名`です。Oracleテナントの管理者ユーザー名は、デフォルトで `sys` です。

   <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>直接接続方式でOceanBaseデータベースに接続する場合、接続パラメータ<code>-u</code>の後に正しい<code>ユーザー名@テナント名</code>を入力します。クラスタ名は指定しません。もし<code>-u</code>にクラスタ名が含まれていると、接続エラーが発生します。</p>
   </main>

* `-p`: OceanBaseデータベースに接続するためのパスワード。`******`は実際のパスワード文字列に置き換える必要があります。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>セキュリティ上の理由から、コマンドラインに直接パスワードを入力することは推奨されません。特にスクリプトや履歴が閲覧可能な環境では、このオプションを省略し、プロンプトが表示された際にパスワードを入力することを推奨します。</p>
   </main>

* `-c`：オプション。OBClient実行環境において、コメントを無視しないようにします。

   <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>Hintは特別なコメントであり、<code>-c</code>の影響を受けません。</p>
   </main>

* `-A`: オプション。OBClientがデータベースに接続する際、統計情報を自動で取得しないようにします。
* `$schema_name`：オプション。OceanBaseデータベースに接続した後に使用するデフォルトのスキーマを指定します。指定しない場合、デフォルトで現在ログインしているユーザーのスキーマを使用します。
* `--proxy_user`：オプション。このパラメータはプロキシ対象のユーザー名、つまりターゲットのユーザー名です。プロキシユーザーの使用に関するその他のサンプルについては、[プロキシユーザーの使用](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974761)を参照してください。

**例：**

```shell
obclient -h10.10.10.1 -P2881 -uuser001@obtenant -p****** -c -A test_user001
```

## 例

1. コマンドラインターミナルを開きます。
2. OBClientクライアントを使用し、ODP経由でOceanBaseデータベースのOracleモードのテナントに接続します。

   ```shell
   obclient -hxxx.xx.xxx.xxx -P2883 -usys@oracle001#test432 -p****** -A test_user001
   ```

   実行結果は次のとおりです：

   ```shell
   Welcome to the OceanBase.  Commands end with ; or \g.
   Your OceanBase connection id is 21
   Server version: OceanBase 4.3.2.0 (r200000272024061717-93c0ed73ebbcac6edbf7b585860b75d825935358) (Built Jun 17 2024 18:06:04)

   Copyright (c) 2000, 2018, OceanBase and/or its affiliates. All rights reserved.

   Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

   obclient [TEST_USER001]>
   ```

3. OBClientコマンドラインを終了する場合は、`exit`と入力してEnterキーを押すか、**Ctrl**+**D** のショートカットキーを押します。

## 関連ドキュメント

OBClientを使用してOceanBaseデータベースのMySQLテナントに接続する操作例については、[OBClientを使用したOceanBaseテナントへの接続](../../100.application-development-of-mysql-mode/100.connect-to-oceanbase-database-of-mysql-mode/300.connect-to-an-oceanbase-tenant-by-using-obclient-of-mysql-mode.md)を参照してください。
