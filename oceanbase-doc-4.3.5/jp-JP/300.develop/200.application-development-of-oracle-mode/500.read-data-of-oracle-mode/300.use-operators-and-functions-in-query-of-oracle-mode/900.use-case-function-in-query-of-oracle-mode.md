|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|

# クエリにおけるCASE関数の使用

CASE式は、サブルーチンを呼び出すことなく、`IF...THEN...ELSE` のようなロジックを実現できます。CASE式には、単純CASE式と検索CASE式の2種類の使い方があります。

## 例

### 例1

クエリ内で単純CASE式を使用して、国コードの略称を正式名称に翻訳します。

1. `t_case` テーブルを作成します。

   ```unknow
   obclient> CREATE TABLE t_case(id number NOT NULL PRIMARY KEY, abbr varchar(5));
   Query OK, 0 rows affected
   ```

2. `t_case` テーブルにデータを挿入します。

   ```unknow
   obclient> INSERT INTO t_case VALUES (1,'US'),(2,'UK'),(3,'CN'),(4,'JP');
   Query OK, 4 rows affected
   Records: 4  Duplicates: 0  Warnings: 0
   ```

3. `CASE` 式を使用して、国コードに対応するクエリの正式名称を照会します。

   ```unknow
   obclient> SELECT id, abbr,
             CASE abbr
             WHEN 'US' THEN 'America'
             WHEN 'UK' THEN 'English'
             WHEN 'CN' THEN 'China'
             ELSE 'UNKOWN'
             END full_name
             FROM t_case ;
   +----+------+-----------+
   | ID | ABBR | FULL_NAME |
   +----+------+-----------+
   |  1 | US   | America   |
   |  2 | UK   | English   |
   |  3 | CN   | China     |
   |  4 | JP   | UNKOWN    |
   +----+------+-----------+
   4 rows in set
   ```

### 例2

クエリ内で検索CASE式を使用します。

1. `t_case2` テーブルを作成します。

   ```unknow
   obclient> CREATE TABLE t_case2(id number NOT NULL PRIMARY KEY, c_date date );
   Query OK, 0 rows affected
   ```

2. `t_case2` テーブルにデータを挿入します。

   ```unknow
   obclient> INSERT INTO t_case2(id,c_date)
             VALUES (1,to_date('2019-03-01','yyyy-mm-dd'))
             ,(2,to_date('2019-05-08','yyyy-mm-dd'))
             ,(3,to_date('2019-07-07','yyyy-mm-dd'))
             ,(4,to_date('2019-10-11','yyyy-mm-dd'))
             ,(5,to_date('2019-12-12','yyyy-mm-dd'))
             ,(6,to_date('2020-01-05','yyyy-mm-dd'));
   Query OK, 6 rows affected
   Records: 6  Duplicates: 0  Warnings: 0
   ```

3. 検索CASE式を使用して、`Duration` 列のデータを照会します。

   ```unknow
   obclient> SELECT id, c_date,
                  CASE
                 WHEN months_between(sysdate, c_date) > 12 THEN 'More than one year ago'
                 WHEN months_between(sysdate, c_date) > 9 THEN 'More than three quarters ago'
                 WHEN months_between(sysdate, c_date) > 6 THEN 'More than half a year ago'
                 WHEN months_between(sysdate, c_date) > 3 THEN 'More than a quarter ago'
                 WHEN months_between(sysdate, c_date) >= 0 THEN 'Within a quarter'
                 ELSE 'Illegal'
                 END "Duration"
                 FROM t_case2;
   +----+-----------+------------------------+
   | ID | C_DATE    | Duration               |
   +----+-----------+------------------------+
   |  1 | 01-MAR-19 | More than one year ago |
   |  2 | 08-MAY-19 | More than one year ago |
   |  3 | 07-JUL-19 | More than one year ago |
   |  4 | 11-OCT-19 | More than one year ago |
   |  5 | 12-DEC-19 | More than one year ago |
   |  6 | 05-JAN-20 | More than one year ago |
   +----+-----------+------------------------+
   6 rows in set
   ```
