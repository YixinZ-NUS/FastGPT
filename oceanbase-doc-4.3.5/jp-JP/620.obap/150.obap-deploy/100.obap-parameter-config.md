# APシナリオにおけるパラメータ設定の推奨

本記事では、ハイブリッドトランザクション/分析処理(HTAP)、およびリアルタイム分析(OLAP)という2つのビジネスシナリオそれぞれについて、推奨されるパラメータ設定を提示します。

OceanBaseは、ユーザーがさまざまなビジネスシナリオにおいて良好なパフォーマンスを得られるように、過去の多くの実環境におけるチューニング経験に基づき、各ビジネスシナリオにおける主要な構成パラメータや変数の推奨設定をまとめました。これらの推奨設定は、カーネルV4.3.2以降のバージョンのインストールパッケージに含まれており、デプロイ後に直接確認することが可能です。

さらに、ユーザーの利便性を高めるため、パラメータテンプレートは **OceanBase Cloud Platform (OCP)**および**OceanBase Deployer (OBD)**でサポートされています。ユーザーは、OCPまたはOBDを使用してクラスタやテナントを作成する際に、対応するシナリオのパラメータテンプレートを選択するだけで、直接設定を完了できます。

## パラメータ設定テンプレート

OceanBaseデータベースのRPMパッケージをインストールすると、`/home/admin/oceanbase/etc`ディレクトリで、さまざまなビジネスシナリオの推奨されるパラメータ設定のパラメータ設定テンプレートを確認することができます。

+ `default_parameter.json`：構成パラメータの推奨設定が保存されました。
+ `default_system_variable.json`：変数の推奨設定が保存されました。

## シナリオ紹介

### ハイブリッドトランザクション/分析処理(HTAP)

ハイブリッドトランザクションおよび分析処理(以下、HTAP)は、OLTP(オンライントランザクション処理)とOLAP(オンライン分析処理)を同時にサポートするデータベース管理システムまたはアーキテクチャを指します。HTAPのシナリオには、金融取引、小売業、物流などの分野のように、リアルタイムな分析とデータ検索が必要なビジネス環境が含まれます。これらの分野では、ビジネスの意思決定と分析をサポートするために、効率的なトランザクション処理とリアルタイムなデータ分析および検索機能が求められます。HTAPアーキテクチャの利点は、データ複製と変換のコストを削減し、リアルタイムのデータ分析能力を提供し、ビジネスの意思決定プロセスを加速できる点にあります。

+ このシナリオの推奨設定の詳細については、[設定のベストプラクティス](../../400.deploy/700.best-practices.md)を参照してください。

#### HTAPシナリオにおける構成パラメータの推奨値

| **パラメータ** | **推奨値** | **推奨値の説明** | **レベル** |
| --- | --- | --- | --- |
| [large_query_threshold](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971975) | 600s | HTAPワークロードにはAPクエリが存在するため、そのクエリも高速に実行する必要があります。 | cluster |
| [enable_record_trace_log](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971850) | False | トレースログを無効にすると、APのパフォーマンスが向上します。 | cluster |
| [enable_syslog_recycle](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971847) | True | syslogの自動リサイクルを有効にすると、ログファイルがディスクスペースを使い果たすのを防ぎます。 | cluster |
| [max_syslog_file_count](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971824) | 300 | `enable_syslog_recycle`を有効にする場合、この値を適切な値に設定する必要があります。300は経験値です。 | cluster |
| [log_transport_compress_all](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972017) | True | 帯域幅が限られているシナリオでは、RPC圧縮によりわずかなCPUオーバーヘッドでネットワーク帯域を節約できます。 | tenant |
| [default_load_mode](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001976661) | DISABLED | 典型的なHTAPワークロードでは、デフォルトでダイレクトロードは使用されません。 | tenant |
| [direct_load_allow_fallback](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001976662) | True | 典型的なHTAPワークロードでは、ダイレクトロードが失敗した場合に通常のインポート方式へのフォールバックを許可します。 | tenant |




### リアルタイム分析(OLAP)
リアルタイム分析（OLAP）は、大量のデータを多角的に分析するための技術です。これにより利用者は、分析の軸、指標、条件、並べ替えといった様々な観点から、複雑なデータ分析を行うことができます。OLAPは、データに潜むパターンや傾向、関連性を見つけ出して理解を深め、企業の意思決定やビジネスインテリジェンスを支援します。それによって意思決定とビジネスインテリジェンスをサポートします。OLAP技術は、通常、データウェアハウスやビジネスインテリジェンスシステムで使用されます。

+ このシナリオにおける推奨設定の詳細と例については、[設定のベストプラクティス](../../400.deploy/700.best-practices.md)をご参照ください。

#### OLAPシナリオにおける構成パラメータの推奨値
| **パラメータ** | **推奨値** | **推奨値の説明** | **レベル** |
| --- | --- | --- | --- |
| [enable_record_trace_log](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971850) | False | トレースログを無効にすると、APのパフォーマンスが向上します。 | cluster |
| [trace_log_slow_query_watermark](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971948) | 7d | APシナリオでは、スロークエリを定義する必要はありません。 | cluster |
| [large_query_threshold](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971975) | 0ms | 大規模クエリの検出を無効にすることを示します。 | cluster |
| [enable_syslog_recycle](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971847) | True | syslogの自動リサイクルを有効にすると、ログファイルがディスクスペースを使い果たすのを防ぎます。 | cluster |
| [max_syslog_file_count](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971824) | 300 | `enable_syslog_recycle`を有効にする場合、この値を適切な値に設定する必要があります。300は経験値です。 | cluster |
| [default_table_store_format](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972072) | column | APのデフォルトフォーマットは、純粋なカラムストアテーブルとして指定されます。 | tenant |
| _io_read_batch_size | 128K | 1回のIO読み取りリクエストの最大バッチサイズ。 | tenant |
| _io_read_redundant_limit_percentage | 50 | 1回のIO読み取りリクエストにおける冗長データの最大パーセンテージ（冗長データとは、バッチの途中で読み取る必要があるが、キャッシュにヒットした、またはスキップインデックスによってフィルタリングされたデータブロックを指します）。 | tenant |
| [default_load_mode](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001976661) | FULL_DIRECT_WRITE | 典型的なOLAPワークロードでは、デフォルトでフルダイレクトロードが使用されます。 | tenant |
| [direct_load_allow_fallback](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001976662) | False | 典型的なOLAPワークロードでは、ダイレクトロードが失敗した場合は直接エラーを報告し、通常のインポート方式へのフォールバックは許可されません。 | tenant |
| _nested_loop_join_enabled | False | 典型的なOLAPワークロードでは、ネストされたループ結合は無効になります。 | tenant |
| default_table_organization | HEAP | テーブル内のデータ行の格納順序。APシナリオでは、テーブル内のデータ行は特定の順序で格納されません。<br/>#### 注釈<br/>この構成パラメータはV4.3.5 BP1バージョンから導入されました。 | tenant |


#### OLAPシナリオにおける変数の推奨値
| **パラメータ** | **推奨値** | **推奨値の説明** | **レベル** |
| --- | --- | --- | --- |
| [ob_query_timeout](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972234) | 604800000000 | 7日に設定します。 | tenant |
| [ob_trx_timeout](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972241) | 604800000000 | 7日に設定します。 | tenant |
| [parallel_degree_policy](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972281) | AUTO | Auto DOPポリシーを有効にすることを示します。Auto DOPの詳細については、[Auto DOP](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001973802)をご参照ください。 | tenant |
| [parallel_min_scan_time_threshold](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972196) | 10 | 実行時間が100ms以上のクエリに対して、最適なパラレル実行パフォーマンスをもたらします。 | tenant |
| [ob_sql_work_area_percentage](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972197) | 30 | ワークエリアのメモリを比較的に大きく設定することで、メモリリークによるコストを削減できます。 | tenant |
| [collation_server](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972158) | utf8mb4_bin | 他の照合順序と比較して、バイナリ照合順序を使用すると20%のパフォーマンス向上が実現できます。 | tenant |
| [collation_connection](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972224) | utf8mb4_bin | 他の照合順序と比較して、バイナリ照合順序を使用すると20%のパフォーマンス向上が実現できます。 | tenant |


## 関連ドキュメント
+ 構成パラメータと変数の詳細については、[構成パラメータとシステム変数の概要](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001970983)を参照してください。
+ 構成パラメータの設定方法については、[パラメータの設定](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971405)を参照してください。
+ 変数の設定方法については、[変数の設定](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971406)を参照してください。
+ [OCPシステム組み込みテンプレートの設定](https://en.oceanbase.com/docs/common-ocp-10000000002169362)
