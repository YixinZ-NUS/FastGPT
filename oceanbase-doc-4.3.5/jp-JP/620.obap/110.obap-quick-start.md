# クイックスタート

このクイックスタートはOceanBase Community Editionのデプロイの例を使用して説明します。このプランは、マシンが1台しかない場合に、使用可能なOceanBaseデータベース環境を迅速に構築するのに適しています。デプロイ済みのOceanBaseデータベース環境はデータベースの基本機能を備えており、OceanBaseデータベースを理解するのに役立ちます。ただし、この環境には分散型能力や高可用性特性が備わっておらず、長期的な使用は推奨されません。

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>本記事では、OceanBaseを迅速に使用できることを目指しています。さらにAPパフォーマンスを体験する必要がある場合は、<a href="../620.obap/150.obap-deploy/100.obap-parameter-config.md">APシナリオにおけるパラメータ設定の推奨</a>の中にある推奨設定を使用することをお勧めします。</p>
</main>

## ステップ1：体験環境を手早く構築する

1. all-in-oneインストールパッケージをダウンロードしてインストールします。

    Community Edition all-in-oneインストールパッケージを [OceanBaseソフトウェアダウンロードセンター](https://jp.oceanbase.com/softwarecenter)からダウンロードし、マシンの任意のディレクトリにアップロードします。

2.  インストールパッケージのあるディレクトリで、以下のコマンドを実行してインストールパッケージを解凍し、インストールします。

    ```shell
    [admin@test001 ~]$ tar -xzf oceanbase-all-in-one-*.tar.gz
    [admin@test001 ~]$ cd oceanbase-all-in-one/bin/
    [admin@test001 bin]$ ./install.sh
    [admin@test001 bin]$ source ~/.oceanbase-all-in-one/bin/env.sh
    ```

3. 以下のコマンドを実行して、OceanBaseデータベースをクイックデプロイできます。

    ```shell
    [admin@test001 ~]$ obd demo
    ```

    `obd demo` コマンドはデフォルトで現在のユーザーディレクトリに最小仕様をデプロイして、OceanBaseデータベースおよび関連コンポーネント(ODP、OBAgent、Grafana、Prometheusを含む)を起動し、デプロイ名は `demo` に固定されます。

    <main id="notice" type='explain'>
      <h4>説明</h4>
      <p>GrafanaまたはPrometheusをインストールする場合は、GrafanaまたはPrometheusのアクセスアドレスが出力されます。Alibaba Cloudなどのクラウド環境では、パブリックIPアドレスを取得することができないため、内部ネットワーク用のIPアドレスが出力される場合があります。このIPアドレスはパブリックアドレスではないため、正しいアドレスを使用する必要があります。</p>
    </main>

4.  出力された接続コマンドを実行してデータベースに接続します。

    `obd demo` コマンドの実行が成功したら、OBClientを使用してOceanBaseデータベースに接続するコマンドを出力します。以下に例を示します。

    * 2881ポートを使用してデータベースに直接接続

      ```shell
      [admin@test001 ~]$ obclient -h127.0.0.1 -P2881 -uroot@sys -Doceanbase -A
      ```

    * ODPを使用してデータベースにプロキシアクセス

      ```shell
      [admin@test001 ~]$ obclient -h127.0.0.1 -P2883 -uroot@sys -Doceanbase -A
      ```

5. (オプション)パスワードを設定します。

    `obd demo`コマンドを使用してOceanBaseデータベースをクイックデプロイした後、以下の手順を参考にしてdemoクラスタのパスワードを設定できます。

      1. 設定ファイルを修正します。

          ```shell
          obd cluster edit-config demo
          ```

          上記のコマンドを実行して設定ファイルを開いた後、設定ファイル内のoceanbase-ce (Community Edition) / oceanbase (Enterprise Edition)コンポーネントに `root_password: xxxx` を追加します。追加後に保存し終了します。例：

            ```yaml
            oceanbase-ce:
              servers:
                - 127.0.0.1
              global:
                home_path: /home/admin/oceanbase-ce
                ... # 他の構成パラメータは省略
                log_disk_size: 13G
                root_password: ******
            ```

      2. クラスタを再起動します。

          設定ファイルを修正して保存すると、obdは実行を待機する再起動コマンドを出力します。直接コピーして実行できます。例は以下のとおりです。

          ```shell
          [admin@test001 ~]$ obd cluster edit-config demo
          Search param plugin and load ok
          Search param plugin and load ok
          Parameter check ok
          Save deploy "demo" configuration
          Use `obd cluster reload demo` to make changes take effect.
          Trace ID: 29dd12fa-3d73-11ee-91bc-00163e01cd7a
          If you want to view detailed obd logs, please run: obd display-trace 29dd12fa-3d73-11ee-91bc-00163e01cd7a
          ```

          出力から分かるように、設定ファイル中の `root@sys` ユーザーパスワードを修正した後、`obd cluster reload demo` コマンドを実行してdemoクラスタを再起動する必要があります。

## ステップ2：テーブルを作成する

1. データベースを作成します。

    CREATE DATABASEステートメントを使用してデータベースを作成します。

    例：データベースquickstartを作成して、文字セットをutf8mb4に指定し、読み取りプロパティを作成します。

    ```sql
    obclient> CREATE DATABASE quickstart DEFAULT CHARACTER SET utf8mb4 READ WRITE;
    Query OK, 1 row affected
    ```

2. テーブルを作成します。

    `CREATE TABLE` ステートメントを使用して、データベースに新しいテーブルを作成します。

    例：データベース `quickstart` にテーブル `test` を作成します。

    ```sql
    obclient> USE quickstart;
    Database changed

    obclient> CREATE TABLE test (place VARCHAR(500), latitude VARCHAR(50),longitude  VARCHAR(50), country  VARCHAR(1000), continent  VARCHAR(100), magnitude DECIMAL(3, 1));
    Query OK, 0 rows affected
    ```

## ステップ3：データをインポートする

本記事では [Kaggle](https://www.kaggle.com/datasets/vizeno/earthquake-data-overview)内のサンプルデータセット(earthquake_dataset.csv)を使用して説明します。

1. [Kaggle](https://www.kaggle.com/datasets/vizeno/earthquake-data-overview)からearthquake_dataset.csvファイルをダウンロードします。

2. earthquake_dataset.csvファイルをOBServerノードが存在するマシンにコピーします。

    ```yaml
    scp earthquake_dataset.csv admin@10.10.10.1:/home/admin/test_data
    ```

3. OBServerノードが存在するマシンにログインして接続します。

    **例：**

    ```shell
    ssh admin@10.10.10.1
    ```

4. インポートファイルのパスを設定します。

    <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>セキュリティ上の理由から、システム変数 `secure_file_priv` を設定する際には、ローカルUnixソケットを通じてのみデータベースに接続し、このグローバル変数を変更するSQLステートメントを実行できます。詳細については、<a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001972189">secure_file_priv</a> を参照してください。</p>
    </main>

    **例：**

      1. OBServerノードが存在するマシンにログインして接続します。

          ```shell
          ssh admin@10.10.10.1
          ```

    1. 以下のコマンドを実行し、ローカルのUnixソケット接続メソッドを使用してテナント `mysql001` に接続します。

        **例：**

        ```shell
        obclient -S /home/admin/oceanbase/run/sql.sock -uroot@mysql001 -p******
        ```

    2. ファイルを置くディレクトリを `/` に設定します。これは制限がなく、任意のバスでアクセスできることを意味します。

        ```sql
        SET GLOBAL SECURE_FILE_PRIV = "/";
        ```

5. 再びデータベースに接続します。

    **例：**

    ```shell
    obclient -h127.0.0.1 -P2881 -utest_user001@mysql001 -p****** -A
    ```

6. `LOAD DATA` ステートメントを使用してデータをインポートします。

    **例：**

    以下の `LOAD DATA` ステートメントを使用して、ファイルからデータベースのテーブルにデータをロードします。そこでは以下を指定します：
    - ロードするファイルのパスとファイル名を `/home/admin/test_data/earthquake_dataset.csv` と指定します。
    - ロードするデータのターゲットテーブル名を `test` と指定します。
    - データファイル内のフィールドをカンマ(,)と指定します。
    - データファイル内のフィールド(文字列型)を指定して、二重引用符で囲みます。
    - データファイル内の行を指定して、改行文字を終了文字として使用します。
    - ロードするデータファイル内の列とターゲットテーブル内の列のマッピング関係を指定します。データファイル内の一列目をターゲットテーブルの `place` 列にマッピングし、二列目を `latitude` 列にマッピングし、三列目を `longitude` 列にマッピングし、それ以降も同じようにします。

    ```shell
    obclient [test]> LOAD DATA LOCAL INFILE '/home/admin/test_data/earthquake_dataset.csv'
        INTO TABLE test
        FIELDS TERMINATED BY ','
        ENCLOSED BY '"'
        LINES TERMINATED BY '\n'
        IGNORE 1 LINES
        (place,latitude,longitude,country,continent,magnitude);
    ```

## ステップ4：データの検索と分析

1. OBServerノードが存在するマシンにログインして接続します。

    ```shell
    ssh admin@10.10.10.1
    ```

2. データベースに接続します。

    **例：**

    ```shell
    obclient -h127.0.0.1 -P2881 -utest_user001@mysql001 -p****** -A
    ```

3. 特定の`place`の状況をクエリします。

    ```sql
    obclient [quickstart]> select * from test where place = 'Santiago';
    +----------+----------+-----------+---------+----------------+-----------+
    | place    | latitude | longitude | country | continent      | magnitude |
    +----------+----------+-----------+---------+----------------+-----------+
    | Santiago | -33.4463 | -70.6682  |  Chile  |  South America |       4.8 |
    | Santiago | -33.4521 | -70.6647  |  Chile  |  South America |       4.5 |
    | Santiago | -33.4505 | -70.6717  |  Chile  |  South America |       5.2 |
    | Santiago | -33.4489 | -70.6693  |  Chile  |  South America |       5.6 |
    | Santiago | -33.4472 | -70.6659  |  Chile  |  South America |       4.1 |
    +----------+----------+-----------+---------+----------------+-----------+
    5 rows in set
    ```

4. 各continentの地震回数を統計処理します。

    ```sql
    obclient [quickstart]> select continent,count(*) from test group by continent;
    +----------------+----------+
    | continent      | count(*) |
    +----------------+----------+
    |  South America |       90 |
    |  Africa        |      580 |
    |  Antarctica    |       70 |
    |  North America |      190 |
    |  Oceania       |       45 |
    |  Asia          |      155 |
    |  Europe        |      135 |
    +----------------+----------+
    7 rows in set
    ```
