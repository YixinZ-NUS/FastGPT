|description|  |
|---|---|
|keywords| |
|dir-name|Cline|
|dir-name-en|Cline|
|tenant-type|MySQL Mode|

# OceanBase MCP ServerとClineの連携

[MCP（Model Context Protocol）](https://modelcontextprotocol.io/introduction)は、Anthropic社が2024年11月に発表し、オープンソース化したプロトコルです。大規模言語モデル（LLM）が外部のツールやデータソースと直接やり取りできるよう設計されています。MCPを使えば、ユーザーがLLMの出力をコピー＆ペーストして手動で実行する必要はなく、LLMからツールへ直接指示を送り、そのままアクションを実行させることが可能になります。

[OceanBase MCP Server](https://github.com/oceanbase/mcp-oceanbase/tree/main/src/oceanbase_mcp_server)は、MCPプロトコルを介して大規模言語モデルとOceanBaseデータベースを連携させ、SQL文の実行を可能にするサーバーです。GitHubでオープンソースとして公開されており、対応するクライアントを利用すれば、プロジェクトのプロトタイプを素早く構築できます。

[Cline](https://cline.bot/)は、MCPプロトコルに対応したオープンソースのAIコーディングアシスタントです。

本記事では、ClineとOceanBase MCP Serverを組み合わせ、バックエンドアプリケーションを迅速に構築する手順を紹介します。

## 前提条件

* OceanBaseデータベースのデプロイが完了し、MySQLモードのユーザーテナントが作成されていること。テナント作成の詳細については、[テナントの作成](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971591)を参照してください。

* [Python 3.11以降のバージョン](https://www.python.org/downloads/)と対応する[pip](https://pip.pypa.io/en/stable/installation/)をインストールします。お使いのマシンにインストールされているPythonのバージョンが古い場合は、Minicondaを使用してPython 3.11以降の新しい環境を作成することができます。詳細は[Minicondaインストールガイド](https://docs.anaconda.com/miniconda/install/)を参照してください。

* お使いのオペレーティングシステムに応じて、[Git](https://git-scm.com//downloads)をインストールします。

* Pythonパッケージマネージャーのuvをインストールします。インストール完了後、`uv --version`コマンドでインストールが成功したかを確認できます。

    ```shell
    pip install uv
    uv --version
    ```

* Clineをインストールします。

  * Visual Studio Code IDEをご利用の場合、**拡張機能**で`Cline`プラグインを検索してインストールします。インストールが完了したら、**設定アイコン**をクリックし、Clineに大規模言語モデルのAPIを設定してください。

    ![規模言語モデルAPIの設定](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-2.png)

  * IDEをご利用でない場合は、[Clineインストールガイド](https://docs.cline.bot/getting-started/installing-cline)を参考に、[Cline公式サイト](https://cline.bot/)からダウンロードしてください。

## ステップ1：データベース接続情報を取得する

OceanBaseデータベースのデプロイ担当者または管理者に連絡し、対応するデータベース接続文字列を取得します。例：

```sql
obclient -h$host -P$port -u$user_name -p$password -D$database_name
```

**パラメータの説明：**

* `$host`：OceanBaseデータベースへの接続IPアドレスです。OceanBaseデータベースプロキシ(OceanBase Database Proxy、ODP)経由で接続する場合はODPのアドレスを、直接接続する場合はOBServerノードのIPアドレスを使用します。
* `$port`：OceanBaseデータベースの接続ポートです。ODP経由の接続ではデフォルトで`2883`が使用されますが、ODPのデプロイ時にカスタマイズ可能です。直接接続の場合はデフォルトで`2881`が使用され、OceanBaseデータベースのデプロイ時にカスタマイズできます。
* `$database_name`：アクセスするデータベースの名前です。

    <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>テナントに接続するユーザーは、データベースに対する <code>CREATE</code>、<code>INSERT</code>、<code>DROP</code>、および <code>SELECT</code> 権限が付与されていなければなりません。ユーザー権限の詳細については、<a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974758">MySQLモードの権限分類</a>を参照してください。</p>
    </main>

* `$user_name`：テナントへの接続アカウントです。ODP経由で接続する場合の一般的な形式は`ユーザー名@テナント名#クラスタ名`または`クラスタ名:テナント名:ユーザー名`。直接接続の場合は`ユーザー名@テナント名`となります。
* `$password`：アカウントのパスワードです。

接続文字列の詳細については、[OBClientを使用してOceanBaseテナントに接続する](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971649)を参照してください。

## ステップ2：OceanBase MCP Serverを設定する

ここでは、Visual Studio Codeを使用する場合を例に、OceanBase MCP Serverの設定方法を説明します。

### OceanBase MCP Serverリポジトリのクローン

下記のコマンドを実行して、ソースコードをローカルにダウンロードします。

```shell
git clone https://github.com/oceanbase/mcp-oceanbase.git
```

ソースコードのディレクトリに移動します。

```shell
cd mcp-oceanbase
```

### 依存関係のインストール

`mcp-oceanbase`ディレクトリで下記のコマンドを実行して仮想環境を作成し、依存関係をインストールします。

```shell
uv venv
source .venv/bin/activate
uv pip install .
```

### Visual Studio Codeの作業ディレクトリを作成

ローカルにVisual Studio Codeの作業ディレクトリを手動で作成し、Visual Studio Codeで開きます。今後Clineが生成するファイルはこのディレクトリに配置されます。

<!-- ![创建工作目录](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-3.png) -->

### ClineプラグインでOceanBase MCP Serverを設定する

サイドバーにある`Clineのアイコン`をクリックして、Clineのダイアログボックスを開きます。

<!-- ![打开Cline对话框](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-4.png) -->

### MCP Serversの追加と設定

1. `MCP Serversのアイコン`をクリックします。

    <!-- ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-5.png) -->

2. OceanBase MCP Serverを手動で設定します。

    <!-- ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-6.png) -->

3. 設定ファイルに情報を入力します。

    前のステップで開いた`cline_mcp_settings.json`ファイルに、以下の設定情報を入力し、ファイルを保存します。`/path/to/your/mcp-oceanbase/src/oceanbase_mcp_server`フォルダの絶対パスに、`OB_HOST`、`OB_PORT`、`OB_USER`、`OB_PASSWORD`、`OB_DATABASE`をご自身のデータベースの対応する情報に置き換える必要があります。

    設定ファイルの例は以下の通りです。

    ```json
    {
    "mcpServers": {
        "oceanbase": {
        "command": "uv",
        "args": [
            "--directory",
            "/path/to/your/mcp-oceanbase/src/oceanbase_mcp_server",
            "run",
            "oceanbase_mcp_server"
        ],
        "env": {
            "OB_HOST": "***",
            "OB_PORT": "***",
            "OB_USER": "***",
            "OB_PASSWORD": "***",
            "OB_DATABASE": "***"
        }
        }
    }
    }
    ```

4. 設定が成功すると、`使用可能`のステータスが表示され、`MCP tools`と`resources`の情報が表示されます。

    <!-- ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-7.png) -->

5. トグルスイッチをクリックして、Clineで利用できるようにします。

    <!-- ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-8.png) -->

### MCP Serverのテスト

Clineダイアログボックスに、次のプロンプトを入力します：`testデータベースにはいくつのテーブルがありますか？`。Clineクライアントが実行予定のSQL文を表示します。内容を確認し、問題がなければ`実行`ボタンをクリックします。

<!-- ![5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-9.png) -->

Clineに現在のtestデータベース内のテーブル名が表示されれば、OceanBaseデータベースに正常に接続できていることを示します。

<!-- ![6](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-10.png) -->

### FastAPIを使用してRESTful APIスタイルのプロジェクトを迅速に作成する

FastAPIは、PythonでRESTful APIを迅速に構築できるWebフレームワークです。ここでは、`customer`テーブルを作成し、テストデータを挿入したうえで、FastAPIプロジェクトを自動生成します。

1. customerテーブルの作成

    ダイアログボックスに次のプロンプトを入力します：`customerテーブルを作成してください。主キーはIDで、name、age、telephone、locationの各フィールドを含めてください`。SQL文を確認し、問題がなければ`実行`ボタンをクリックします。

    ![7](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-11.png)

2. テストデータの挿入

    ダイアログボックスに次のプロンプトを入力します：`customerテーブルに10件のデータを挿入してください`。SQL文を確認し、問題がなければ`実行`ボタンをクリックします。

    ![8](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-12.png)

    挿入が成功すると、実行結果が表示されます。

    ![9](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-13.png)

3. FastAPIプロジェクトの作成

    ダイアログボックスに次のプロンプトを入力します：`FastAPIプロジェクトを作成し、customerテーブルに基づいたRESTful APIを生成してください`。SQL文を確認し、問題がなければ`実行`ボタンをクリックします。

    ![10](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/integrations/AI/cline-14.png)

    このステップでは3つのファイルが自動生成されます。AIが生成する内容は完全ではない場合があるため、初めて使用する際は`すべて受け入れる`を選択し、後からニーズに合わせて修正することを推奨します。

4. 仮想環境の作成と依存関係のインストール

    以下のコマンドを実行し、現在のディレクトリで`uv`パッケージ管理ツールを使って仮想環境を作成し、依存パッケージをインストールします。

    ```shell
    uv venv
    source .venv/bin/activate
    uv pip install -r requirements.txt
    ```

5. FastAPIプロジェクトの起動

    以下のコマンドを実行して、FastAPIプロジェクトを起動します。

    ```shell
    uvicorn main:app --reload
    ```

6. テーブル内のデータの確認

    コマンドラインで以下のコマンドを実行するか、他のリクエストツールを使用して、テーブル内のデータを確認します。

    ```shell
    curl http://127.0.0.1:8000/customers
    ```

    <!-- 返回结果如下：

    ```json
    [{"telephone":"11111111101","id":1,"name":"张三","location":"北京","age":25},{"telephone":"11111111102","id":2,"name":"李四","location":"上海","age":30},{"telephone":"11111111103","id":3,"name":"王五","location":"广州","age":22},{"telephone":"11111111104","id":4,"name":"赵六","location":"深圳","age":28},{"telephone":"11111111105","id":5,"name":"钱七","location":"杭州","age":35},{"telephone":"11111111106","id":6,"name":"孙八","location":"南京","age":40},{"telephone":"11111111107","id":7,"name":"周九","location":"成都","age":27},{"telephone":"11111111108","id":8,"name":"吴十","location":"武汉","age":33},{"telephone":"11111111109","id":9,"name":"郑十一","location":"西安","age":29},{"telephone":"11111111110","id":10,"name":"王十二","location":"重庆","age":31}]
    ``` -->

    返された結果により、追加、削除、変更、検索のためのRESTful APIが正常に生成されたことが確認できます。

    ```python
    from fastapi import FastAPI, Depends, HTTPException
    from sqlalchemy.orm import Session
    from models import Customer
    from database import SessionLocal, engine
    from pydantic import BaseModel

    app = FastAPI()

    # データベースの依存関係
    def get_db():
        db = SessionLocal()
        try:
            yield db
        finally:
            db.close()

    # リクエストモデル
    class CustomerCreate(BaseModel):
        name: str
        age: int
        telephone: str
        location: str

    # レスポンスモデル
    class CustomerResponse(CustomerCreate):
        id: int

        class Config:
            from_attributes = True

    @app.post("/customers/")
    def create_customer(customer: CustomerCreate, db: Session = Depends(get_db)):
        db_customer = Customer(**customer.model_dump())
        db.add(db_customer)
        db.commit()
        db.refresh(db_customer)
        return db_customer

    @app.get("/customers/{customer_id}")
    def read_customer(customer_id: int, db: Session = Depends(get_db)):
        customer = db.query(Customer).filter(Customer.id == customer_id).first()
        if customer is None:
            raise HTTPException(status_code=404, detail="Customer not found")
        return customer

    @app.get("/customers/")
    def read_customers(skip: int = 0, limit: int = 10, db: Session = Depends(get_db)):
        return db.query(Customer).offset(skip).limit(limit).all()

    @app.put("/customers/{customer_id}")
    def update_customer(customer_id: int, customer: CustomerCreate, db: Session = Depends(get_db)):
        db_customer = db.query(Customer).filter(Customer.id == customer_id).first()
        if db_customer is None:
            raise HTTPException(status_code=404, detail="Customer not found")
        for field, value in customer.model_dump().items():
            setattr(db_customer, field, value)
        db.commit()
        db.refresh(db_customer)
        return db_customer

    @app.delete("/customers/{customer_id}")
    def delete_customer(customer_id: int, db: Session = Depends(get_db)):
        customer = db.query(Customer).filter(Customer.id == customer_id).first()
        if customer is None:
            raise HTTPException(status_code=404, detail="Customer not found")
        db.delete(customer)
        db.commit()
        return {"message": "Customer deleted successfully"}
    ```
