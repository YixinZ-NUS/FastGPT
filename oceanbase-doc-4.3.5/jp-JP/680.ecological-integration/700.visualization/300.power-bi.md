|description|  |
|---|---|
|keywords| |
|dir-name|Power BI|
|dir-name-en|Power BI|
|tenant-type|MySQL Mode|

# Power BIでOceanBaseに接続してデータを取得する

Power BIは、ソフトウェアサービス、アプリケーション、およびコネクタの集合体です。連携して機能し、関連するデータソースを一貫性のある視覚的にリアルなインタラクティブな洞察に変換します。データは、Excelスプレッドシートである場合もあれば、クラウドベースとオンプレミスのデータリポジトリの統合である場合もあります。Power BIを使用すると、データソースへの接続、可視化、重要な情報の発見、そして必要に応じて誰でも共有することが簡単にできます。

本記事では、Power BIを使用し、OceanBaseデータベースのMySQLモードを例として、Power BIでOceanBaseデータベースに接続してデータを表示する方法を紹介します。

## 前提条件

* Power BIを登録していること。[Power BI](https://app.powerbi.com/home?experience=power-bi)を参照してください。

* OceanBaseデータベースがインストール済みで、MySQLモードのテナントが作成されていること。

* 利用可能なデータセットの準備が整っていること。本記事で使用されているサンプルデータセットは、[Kaggle](https://www.kaggle.com/datasets/adamgrey88/megastore-sales-data?resource=download)から取得したものです。

## 操作手順

### ステップ1：データベース接続文字列を取得する

OceanBaseデータベースのデプロイ担当者または管理者から、該当するデータベース接続文字列を取得します。例：

```
obclient -h$host -P$port -u$user_name -p$password -D$database_name
```

**パラメータの説明：**

* `$host`：OceanBaseデータベースへの接続IPアドレスを提供します。OceanBaseデータベースプロキシ(OceanBase Database Proxy、ODP)接続方式はODPアドレスを使用し、直接接続方式はOBServerノードのIPアドレスを使用します。
* `$port`：OceanBaseデータベースへの接続ポートを提供します。ODP接続方式のデフォルトポートは `2883` で、ODPデプロイ時にカスタマイズ可能です。直接接続方式のデフォルトポートは `2881` で、OceanBaseデータベースのデプロイ時にカスタマイズ可能です。
* `$database_name`：アクセス対象のデータベース名。

    <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>テナントに接続するユーザーは、データベースに対する <code>CREATE</code>、<code>INSERT</code>、<code>DROP</code>、および <code>SELECT</code> 権限が付与されていなければなりません。ユーザー権限の詳細については、<a href="https://en.oceanbase.com/docs/common-oceanbase-database-10000000001974758">MySQLモードの権限分類</a>を参照してください。</p>
    </main>

* `$user_name`：テナントの接続アカウント。ODP接続の一般的な形式：`ユーザー名@テナント名#クラスタ名` または `クラスタ名:テナント名:ユーザー名`。直接接続方式の形式：`ユーザー名@テナント名`。
* `$password`：アカウントのパスワード。

接続文字列の詳細については、[OBClientを使用してOceanBaseテナントに接続する](https://en.oceanbase.com/docs/common-oceanbase-database-10000000001971649)を参照してください。

**例：**

```shell
obclient -hxxx.xxx.xxx.xxx -P2881 -utest_user001@mysql001 -p****** -Dtest
```

### ステップ2：データをインポートし、テーブルを作成する

1. **ステップ1：データベース接続文字列を取得する** 内の接続文字列を使用してOceanBaseデータベースにログインし、テーブルを作成します。テーブル作成ステートメントは以下のとおりです：

   ```sql
   CREATE TABLE `test` (
   `invoice_no` varchar(50) DEFAULT NULL,
   `stock_code` varchar(20) DEFAULT NULL,
   `description` varchar(200) DEFAULT NULL,
   `quantity` int(11) DEFAULT NULL,
   `invoice_data` datetime DEFAULT NULL,
   `unit_price` decimal(8,2) DEFAULT NULL,
   `customer_id` int(11) DEFAULT NULL,
   `country` varchar(50) DEFAULT NULL,
   `sales` float DEFAULT NULL
   ) DEFAULT CHARSET = utf8mb4
   ```

2. `LOAD DATA` ステートメントを使用して、準備したデータセットをテーブルにインポートできます。ステートメントの例：

   ```sql
   LOAD DATA INFILE '/path/superstoredata.csv'
   INTO TABLE earthquakes
   FIELDS TERMINATED BY ','
   ENCLOSED BY '"'
   LINES TERMINATED BY '\n'
   IGNORE 1 LINES
   (invoice_no, stock_code, description, quantity, invoice_data, unit_price, customer_id, country, sales);
   ```

   データ量が多い場合、またはインポート時にデータ変換が必要な場合は、[データロードツール](https://en.oceanbase.com/docs/obloader-obdumper-en)を使用してデータセットをインポートすることを推奨します。

### ステップ3：Power BIコンソールからOceanBaseデータベースに接続する

1. Power BIのコンソールページを開き、左側のメニューバーで **作成** を選択し、メインパネルの **リポジトリ** を再度選択して、新しいリポジトリを作成し、リポジトリに名前を付けます。ここでは、リポジトリの名前を **oceanbase** にします。

   <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/interface.png) -->

2. 作成されたリポジトリ **oceanbase** に入り、**データの取得 > データソースGen2の新規作成** を選択します。

   <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/create-data-flow.png) -->


3. ポップアップウィンドウで、**mysql** を検索し、**MySQLデータベース** を選択して、以下の設定を完了します：

   <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/selete-data-source.png) -->

    **ステップ1：データベース接続文字列を取得する** 内の接続文字列情報に基づいて、順次入力します。接続文字列の例が `obclient -hxxx.xxx.xxx.xxx -P2881 -utest_user001@mysql001 -p****** -Dtest` の場合、入力情報はの例は以下のとおりです：

    - サーバー：記入方法は `xxx.xxx.xxx.xxx:2881` です

    - データベース：ステップ2で作成したテーブルが存在するデータベース名を入力します

    - ユーザー名：test_user001@mysql001

    <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/edit-info-datasource.png) -->


4. **次へ** をクリックし、接続が成功した後、**データの選択 > MySQLデータベース** を選択し、データベースをダブルクリックすると、テーブルデータが以下のとおりに表示されます：

   <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/data-show.png) -->

5. Power BIをエクスペリエンスするために、レポートを自動的に作成することができます。上部のタグを切り替えて、**レポート > デフォルトPower BIセマンティックモデルの管理** を選択します。

   <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/report-1.png) -->

6. ポップアップされた **デフォルトセマンティックモデルの管理** ウィンドウでテーブルを選択し、**確認** をクリックします。しばらくお待ちいただくと、自動生成されたレポートが作成されます。

   <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/report-2.png) -->

   レポートは以下のとおりです：

   <!-- ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.1/ecological-integration/power-bi/report-3.png) -->


## 次の操作

データソースの作成が完了した後、Power BIの使用を開始できます。Power BIの詳細な操作ガイドについては、[Power BI公式ドキュメント](https://learn.microsoft.com/ja-jp/power-bi/fundamentals/power-bi-overview)を参照してください。
