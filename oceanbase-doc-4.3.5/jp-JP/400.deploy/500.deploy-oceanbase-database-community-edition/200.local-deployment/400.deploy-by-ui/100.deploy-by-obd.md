# obd グラフィカルユーザーインターフェースによる OceanBase クラスタのデプロイ

本記事では、x86 アーキテクチャの CentOS Linux 7.9 イメージを環境として、どのように obd グラフィカルユーザーインターフェースを用いて OceanBase データベースをデプロイするかについて説明します。

## 用語解説

* OceanBase データベース
  
  完全自社開発のエンタープライズレベルのネイティブ分散データベースです。詳細については、[OceanBase データベースドキュメント](https://en.oceanbase.com/docs/oceanbase-database)を参照してください。

* obd

  OceanBase Deployer、OceanBaseインストール・デプロイツール、略称はobd。詳細は[OceanBaseインストール・デプロイツールドキュメント](https://en.oceanbase.com/docs/obd-en)を参照してください。

* ODP

  OceanBase Database Proxy、OceanBase データベースプロキシは、OceanBase データベース専用のプロキシサーバーであり、ODP (OBProxy とも呼ばれる) と略称されます。詳細については、[OceanBase データベースプロキシドキュメント](https://en.oceanbase.com/docs/odp-en)を参照してください。

* OBAgent
  
  OBAgent は OceanBase データベースの監視データ収集フレームワークであり、プッシュ型とプル型の 2 種類のデータ収集モードをサポートし、様々なユースケースに対応することができます。

* obconfigserver
  
  OceanBase Configserver (obconfigserver)は、OceanBaseのメタデータの登録、保存、および検索サービスを提供します。詳細については、[ob-configserver](https://github.com/oceanbase/ob-configserver/tree/main)を参照してください。

* Grafana

  Grafanaはオープンソースのデータ可視化ツールであり、データソース内のさまざまなメトリックデータを可視化表示することで、システムの運用状況やパフォーマンス指標をより直感的に理解できます。詳細については、[Grafana公式サイト](https://en.oceanbase.com/docs/grafana)を参照してください。

* Prometheus

  Prometheusはオープンソースのサービス監視システムおよび時系列データベースであり、汎用的なデータモデルと高速なデータ収集、保存、およびクエリインターフェースを提供します。詳細については、[Prometheus公式サイト](https://en.oceanbase.com/docs/prometheus)を参照してください。

* Alertmanager

  Alertmanagerはオープンソースのアラート管理ツールであり、Prometheusなどの監視システムから送信されるアラートを処理し、アラートの重複排除、グループ化、ルーティング、および静的無視などの機能を提供します。詳細については、[Prometheus公式サイト](https://en.oceanbase.com/docs/alertmanager)を参照してください。

## 前提条件

開始する前に、以下の条件を満たしていることを確認してください：

* お使いのマシンはソフトウェアとハードウェアの要件を満たしています。詳細については、[ソフトウェアとハードウェアの要件](../../200.local-deployment/100.requirements-for-software-and-hardware.md)を参照してください。

* 本番環境では、環境と設定の確認が必要です。具体的な手順については、[デプロイ前の設定](../200.environment-and-configuration-checks/150.create-user-optional.md) セクションを参照してください。

* OceanBaseデータベースのみをデプロイする場合、最低でも2vCPU、6 GBのメモリ、20 GBのディスク容量が必要となります。注意：メモリの制限は、`free -g`コマンドを実行した後、出力結果の`available`列に対応する値を指します。

* OceanBaseデータベースとすべてのコンポーネントをデプロイする場合、少なくとも4vCPU、10 GBのメモリ、25 GBのディスク容量が必要となります。16 GB以上のメモリが推奨されます。注意：メモリの制限は、`free -g`コマンドを実行した後、出力結果の`available`列に対応する値を指します。

<main id="notice" type='explain'>
  <h4>説明</h4>
  <p>CPUコア数が少ない環境では、obdのデフォルト設定で最低CPU_Countは8に設定されます。CPUコア数を設定しすぎると、OceanBaseデータベースのパフォーマンスに悪影響を及ぼします。</p>
</main>

## ソフトウェアの準備

OceanBase データベースを obd を使用してグラフィカルにデプロイする場合、オンラインデプロイメントとオフラインデプロイメントの 2 つのデプロイ方法を選択することができます。

* オンラインデプロイメント：obd が稼働するマシンは外部ネットワークへのアクセスが可能である必要があります。デプロイメントに必要なパッケージは事前にインストールする必要がなく、デプロイメントプロセス中に obd がリモートイメージリポジトリから必要なインストールパッケージを取得します。

* オフラインデプロイメント：デプロイのプロセスにおいて外部ネットワークへのアクセスは不要です。必要なインストールパッケージについては、事前に obd ローカルイメージリポジトリにアップロードする必要があります。オフラインデプロイメントを選択する場合は、必要なバージョンの OceanBase All in One インストールパッケージを直接ダウンロードすることを推奨します。

デプロイの方法によってソフトウェアを準備する方法が異なります。状況に応じて適切な方法を選択してソフトウェアを準備することができます。

### オンラインデプロイメント

オンラインデプロイメントを選択した場合、このセクションのコマンドを参照して、コントロールマシンにobdをインストールすることができます。

```shell
[admin@test001 ~]$ sudo yum install -y yum-utils
[admin@test001 ~]$ sudo yum-config-manager --add-repo https://mirrors.aliyun.com/oceanbase/OceanBase.repo
[admin@test001 ~]$ sudo yum install -y ob-deploy
[admin@test001 ~]$ source /etc/profile.d/obd.sh
```

### オフラインデプロイメント

オフラインデプロイを選択した場合、このセクションのコマンドを参照して、OceanBase All in One をダウンロードおよびインストールすることができます。

最新のOceanBase All in Oneは、[OceanBaseソフトウェアダウンロードセンター](https://en.oceanbase.com/softwarecenter)からダウンロードして、コントロールマシンにコピーすることができます。以下のコマンドを実行して解凍し、インストールします：

```shell
[admin@test001 ~]$ tar -xzf oceanbase-all-in-one-*.tar.gz
[admin@test001 ~]$ cd oceanbase-all-in-one/bin/
[admin@test001 bin]$ ./install.sh
[admin@test001 bin]$ source ~/.oceanbase-all-in-one/bin/env.sh
```

## 操作手順

<main id="notice" type='explain'>
  <h4>説明</h4>
  <p>本記事では、obd V3.6.0を例に操作手順を説明します。obdバージョンの違いによって操作画面が異なる場合があります。実際の画面をご確認ください。obdに関する詳細については、<a href="https://en.oceanbase.com/docs/obd-en">OceanBaseインストール・デプロイメントツールドキュメント</a>を参照してください。</p>
</main>

### ステップ1：グラフィカルユーザーインターフェース(GUI)を起動する

1. グラフィカルユーザーインターフェース(GUI)を起動する

   コマンドラインで `obd web` コマンドを実行するとGUIが起動します。出力されたアドレスをクリックしてGUIにアクセスします。

   ```shell
   [admin@test001 ~]$ obd web
   start OBD WEB in 0.0.0.0:8680
   please open http://10.10.10.1:8680
   ```

   <main id="notice" type='explain'>
     <h4>説明</h4>
     <ul>
     <li>
     <p>グラフィカルユーザーインターフェースはデフォルトで8680ポートを使用します。<code>obd web -p &lt;PORT&gt;</code> コマンドでポートを指定できます。</p>
     </li>
     <li>
     <p>Alibaba Cloudなどのクラウド環境では、プログラムがインターネットIPアドレスを取得することができず、イントラネットIPアドレスが出力される場合があります。このIPアドレスはインターネットIPアドレスではないため、グラフィカルユーザーインターフェース(GUI)にアクセスするには正しいアドレスを使用する必要があります。</p>
     </li>
     <li>
     <p><code>obd web</code> コマンドは <code>0.0.0.0</code> に関連付けられているため、マルチNIC環境の下では、任意のアクセス可能なIPアドレスからGUIにアクセスすることができます。</p>
     </li>
     <li>
     <p>nohup または screen コマンドを使用して、<code>obd web</code> コマンドをバックグラウンドで実行するように設定できます。</p>
     </li>
     </ul>
   </main>

2. (オプション)グラフィカル操作インターフェースの右上にある言語切り替えアイコンにマウスを置くと、表示されている言語を切り替えることができます。

   <img width="677" height="419.5" src="https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V2.4.0/en-US/200.quick-start/3.deploy-ocp-by-ui-01.png" alt="言語切り替え">

3. グラフィカルユーザーインターフェースで **体験ツアーを開始** をクリックし、表示される **OceanBaseデプロイウィザードへようこそ** 画面で **OceanBaseと関連ツール** モジュールを選択し、**インストール** をクリックした後、OceanBaseデータベースデプロイ画面に進みます。

### ステップ2：デプロイ設定

**デプロイ設定** 画面で、クラスタ名、負荷タイプ、およびデプロイコンポーネントを設定できます。**デプロイ設定** 画面の内容は以下のとおりです。

1. クラスタ設定

   ![クラスタ設定](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V2.10.0/en-US/200.quick-start/300.use-ui-deploy-oceanbase-02.png)

   |  モジュール   |  説明   |
   |---------|--------|
   | デプロイ設定  | クラスタ名はobd専用デプロイプロダクトの唯一の名称で、デフォルトは `myoceanbase` です。カスタマイズ可能ですが、既存のデプロイ名と重複させることはできません。クラスタ名は英字で始まり、英字または数字で終わり、英数字とアンダースコア(_)を含むことができ、長さは2～32文字となります。`obd cluster list` コマンドを使用して、obdが管理するクラスタを確認できます。 |
   | データベースのデプロイ | **バージョン** のドロップダウンリストをクリックして、OceanBaseデータベースのバージョンを選択できます。対応するコンポーネントの後の **詳細はこちら** をクリックすると、対応するコンポーネントのドキュメントに切り替わり確認することができます。 |
   | 負荷タイプ | **タイプ** のドロップダウンリストをクリックして、OceanBaseクラスタの負荷タイプを自ら選択することができます。異なるタイプの負荷均衡下に、対応する説明が表示され、各タイプの適用シナリオを理解することができます。<main id="notice" type='explain'><h4>説明</h4><p>このモジュールは、デプロイする OceanBase データベースのバージョンが V4.2.5 以上である場合にのみ表示されます。</p></main> |

2. コンポーネント選択

   ![コンポーネント選択](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V2.10.0/en-US/200.quick-start/300.use-ui-deploy-oceanbase-03.png)

   デフォルトではOBProxyコンポーネントのみが選択されています。**オプションコンポーネント** の下にある、各コンポーネントのチェックボックスをクリックして、デプロイするかどうかを設定することができます。コンポーネントのバージョンは最新バージョンに固定されています。各コンポーネントの後の **詳細はこちら** をクリックすると、そのコンポーネントのドキュメントに切り替わり確認することができます。

   <main id="notice" type='explain'>
     <h4>説明</h4>
     <p>Grafana および AlertManager コンポーネントのデプロイは OBAgent および Prometheus コンポーネントに依存し、Prometheus コンポーネントのデプロイは OBAgent コンポーネントに依存します。具体的には、Grafana または AlertManager コンポーネントを選択すると、OBAgent および Prometheus コンポーネントも自動的に選択されます。OBAgent コンポーネントの選択を解除すると、Grafana、AlertManager、および Prometheus コンポーネントの選択も自動的に解除されます。</p>
   </main>

設定が完了したら、**次へ** をクリックして **ノード設定** ページに進むことができます。

### ステップ3：ノード設定

**ノード設定** 画面で、データベースとコンポーネントノード、デプロイユーザー、およびソフトウェアのインストールパスを設定することができます。**ノード設定** 画面の内容については以下のとおりです。

<!-- ![ノード設定](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V3.6.0/deploy-by-gui/200.use-ui-deploy-oceanbase-03.png) -->

<table>
  <thead>
    <tr>
      <th>モジュール</th>
      <th>パラメータ</th>
      <th>説明</th>
    </tr>
  </thead>
  <tr>
    <td rowspan="3">データベースノード設定</td>
    <td>Zone名</td>
    <td>OceanBaseデータベースのZone名を設定します。カスタマイズ可能です。Zone名は英字で始まり、英字または数字で終わり、英数字、アンダースコア(_)を含むことができ、長さは2～32文字となります。マルチZoneのOceanBaseクラスタをデプロイする場合、主Zoneと同じRegionに属するZoneが1つ必要となります。<b>+ Zoneを追加</b>をクリックするか、対応するZoneの後の削除アイコンをクリックして、Zoneを追加または削除することができます。</td>
  </tr>
  <tr>
    <td>OBServerノード</td>
    <td>OceanBaseクラスタ内のOBServerノードのIPアドレスを設定します。IPアドレスを入力し、Enterキーを押すと、複数のノードのIPアドレスを設定することができます。<main id="notice" type='notice'><h4>注意</h4><ul><li>異なるZoneに同じノードを設定することは禁止されています。</li><li><p>OBServerノードを <code>127.0.0.1</code> に設定した場合、このOceanBaseクラスタは分散クラスタに拡張できず、マスターテナントとスタンバイテナントの設定もできません。</p></li></ul></main></td>
  </tr>
  <tr>
    <td>RootServerノード</td>
    <td>ドロップダウンリストから、<b>OBServerノード</b>で設定されたIPアドレスの中から1つを選択し、OceanBaseクラスタのRootServerノードとして使用できます。マルチレプリカのOceanBaseクラスタでは、各Zoneに1つのRootServerを指定する必要があります。</td>
  </tr>
  <tr>
    <td rowspan="6">コンポーネントノード設定</td>
    <td>OBProxyノード</td>
    <td>複数のノードの設定をサポートしており、ドロップダウンリストからOBServerノードのIPアドレスを選択するか、新規ノードのIPアドレスを入力できます。非 <code>127.0.0.1</code> のIPアドレスを使用することを推奨します。IPアドレスを入力後、Enterキーを押すと、複数のノードのIPアドレスを設定できます。</td>
  </tr>
  <tr>
    <td>ロードバランシング管理</td>
    <td>展開ボタンをクリックして、OceanBaseクラスタへの業務アクセス用のロードバランシングを設定できます。複数のノードのOBProxyをデプロイする場合は、VIP/DNSアドレスを提供することを推奨します。これにより、後からOBProxyのアクセスアドレスを変更する必要がなくなります。ロードバランシングを設定しない場合、システムはデフォルトで、<b>OBProxyノード</b>で設定された最初のIPアドレスを接続文字列として選択します。<b>アクセス方式</b>のドロップダウンリストから、VIPによるアクセスかDNS（ドメイン名）によるアクセスかを選択できます：<ul><li>VIPによるアクセスを選択した場合、VIPの <b>IPアドレス</b> と <b>アクセスポート</b> を設定する必要があります。</li><li>DNSによるアクセスを選択した場合、対応する <b>ドメイン名</b> を設定する必要があります。</li></ul><main id="notice" type='notice'><h4>注意</h4><p>obdはロードバランシングのデプロイを提供していません。ロードバランシングを設定するには、事前にロードバランシングをデプロイし、設定しておく必要があります。</p></main></td>
  </tr>
  <tr>
    <td>Prometheusノード</td>
    <td>複数のノードの設定をサポートしており、ドロップダウンリストからOBServerノードのIPアドレスを選択するか、新規ノードのIPアドレスを入力できます。非 <code>127.0.0.1</code> のIPアドレスを使用することを推奨します。IPアドレスを入力後、Enterキーを押すと、複数のノードのIPアドレスを設定できます。</td>
  </tr>
  <tr>
    <td>Grafanaノード</td>
    <td>複数のノードの設定をサポートしており、ドロップダウンリストからOBServerノードのIPアドレスを選択するか、新規ノードのIPアドレスを入力できます。非 <code>127.0.0.1</code> のIPアドレスを使用することを推奨します。IPアドレスを入力後、Enterキーを押すと、複数のノードのIPアドレスを設定できます。</td>
  </tr>
  <tr>
    <td>AlertManagerノード</td>
    <td>単一のノードのみの設定をサポートしており、非 <code>127.0.0.1</code> のIPアドレスを使用することを推奨します。</td>
  </tr>
  <tr>
    <td>obconfigserverノード</td>
    <td>複数のノードの設定をサポートしており、ドロップダウンリストからOBServerノードのIPアドレスを選択するか、新規ノードのIPアドレスを入力できます。非 <code>127.0.0.1</code> のIPアドレスを使用することを推奨します。IPアドレスを入力後、Enterキーを押すと、複数のノードのIPアドレスを設定できます。<main id="notice" type='explain'><h4>説明</h4><p>obconfigserverを複数ノードで構成する場合は、事前にロードバランシングを設定し、<b>クラスタ設定</b>ページの<b>コンポーネント設定</b>モジュールで<b>詳細設定</b>ボタンをクリックして、<code>vip_address</code> と <code>vip_port</code> を設定する必要があります。</p></main></td>
  </tr>
  <tr>
    <td rowspan="3">デプロイ接続設定</td>
    <td>ユーザー名</td>
    <td>OceanBaseクラスタのデプロイに使用するユーザー名を設定します。デフォルトは現在のプロセスの起動ユーザーで、カスタムユーザー名もサポートしています。ユーザー名は英字、数字、およびピリオドのみを含み、長さは20文字以内に設定する必要があります。選択したユーザー名がすべてのホストに存在することを確認してください。</td>
  </tr>
  <tr>
    <td>パスワード</td>
    <td><b>ユーザー名</b>に対応するログインパスワードです。各ノード間でパスワードレスログインが設定済みの場合は、パスワードの入力は不要となります。</td>
  </tr>
  <tr>
    <td>SSHポート</td>
    <td>デフォルトはポート22で、SSHポートのカスタマイズをサポートします。</td>
  </tr>
  <tr>
    <td>ソフトウェアパス設定</td>
    <td>ソフトウェアパス</td>
    <td>デフォルトはデプロイユーザーのホームディレクトリで、カスタマイズ可能です。絶対パスで指定し、<code>/</code> で始まり、アルファベット、数字、および特殊文字 (<code>-_:@/.</code>) から構成される必要があります。設定後、対応するディレクトリに <b>クラスタ名</b> と同名のフォルダが作成されます。</td>
  </tr>
</table>

設定が完了したら、**次へ** をクリックして **クラスタ設定** ページに進むことができます。

### ステップ4：クラスタ構成

**クラスタ設定** 画面では、クラスタの設定を行うことができます。これには、システムテナントの管理者ユーザー(root@sys)のパスワード、データとログのディレクトリ、データベースおよび各コンポーネントのポートとパラメータの設定などが含まれます。このセクションでは、それぞれについて説明します。

1. クラスタ構成

   ![クラスタ構成](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V2.10.0/en-US/200.quick-start/300.use-ui-deploy-oceanbase-04.png)

   | パラメータ  | 説明 |
   |-------|-----|
   | モード設定 | **最大占有** または **最小利用** を選択することができます。**最大占有** モードは環境リソースを最大限に活用し、クラスタのパフォーマンスと安定性を確保し、推奨しています。**最小利用** モードは、クラスタの正常稼働に必要なリソースパラメータを設定します。2つのモードの詳細については、[モード設定ルール](https://en.oceanbase.com/docs/community-obd-en-10000000002136369)を参照してください。 |
   | root@sysパスワード  | **ランダム生成** をクリックすると、obdによってランダムな文字列が自動生成されます。また、カスタム設定も可能です。カスタム設定時には、パスワードの複雑さは以下の要件を満たす必要があります：<ul><li>長さは8～32文字</li><li>以下の4種類の文字のうち少なくとも3種類を含む：数字(0～9)、大文字(A～Z)、小文字(a～z)と特殊文字(<code>~!@#%^&*_-+=\|(){}[]:;,.?/</code>)</li></ul>設定後、**パスワードをコピー** をクリックすると設定済みのパスワードが保存されます。 |
   | データディレクトリ | デフォルトでは、`/data/1` に設定されます。カスタム設定はサポートされており、`/` から始まる絶対パスである必要があります。文字、数字、および特殊文字（<code>-_:@/.</code>）のみを含み、設定したディレクトリが空である必要があります。  |
   | ログディレクトリ | デフォルトでは、`/data/log1` に設定されます。カスタム設定はサポートされており、`/` から始まる絶対パスである必要があります。文字、数字、および特殊文字（<code>-_:@/.</code>）のみを含み、設定したディレクトリが空である必要があります。  |
   | SQLポート | SQLサービスのプロトコルポート番号。デフォルトは `2881` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定ポートが使用されていないことを確認する必要があります。 |
   | RPCポート | リモートアクセスのためのプロトコルポート番号です。デフォルトは `2882` で、カスタマイズ可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | OBShellポート | OceanBaseデータベースのO&Mポート。デフォルトは `2886` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。  |
   | 詳細設定 | **詳細設定** ボタンをクリックして、対応するクラスタパラメータを確認できます。自動的に割り当てられた値を使用するか、各パラメータをカスタマイズすることもできます。<main id="notice" type='explain'><h4>説明</h4><p><b>詳細設定</b>の <code>enable_auto_start</code> パラメータを使用して、observerプロセスのOS起動時の自動起動機能を有効にするかどうかを設定できます。この機能を有効にするには、デプロイユーザーにsudo権限があり、かつデプロイ環境がコンテナ環境でないことを確認する必要があります。</p></main> |

2. コンポーネント設定

   ![コンポーネント設定](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V2.10.0/en-US/200.quick-start/300.use-ui-deploy-oceanbase-05.png)

   | パラメータ   | 説明   |
   |--------|--------|
   | Grafanaパスワード | Grafana管理者アカウントのログインパスワードです。**ランダム生成** をクリックすると、obdによってランダムな文字列が自動生成されます。また、カスタム設定も可能です。カスタム設定時には、パスワードの複雑さは以下の要件を満たす必要があります：<ul><li>長さは8～32文字</li><li>以下の4種類の文字をそれぞれ2つ以上含む：数字(0～9)、大文字(A～Z)、小文字(a～z)と特殊文字(<code>~!@#%^&*_-+=\|(){}[]:;,.?/`$"<>\\</code>)</li></ul>設定後、**パスワードをコピー** をクリックしてコピーし、設定済みのパスワードを保存します。 |
   | Prometheusパスワード | Prometheusサービスのログインパスワードです。**ランダム生成** をクリックすると、obdによってランダムな文字列が自動生成されます。また、カスタム設定も可能です。カスタム設定時には、パスワードの複雑さは以下の要件を満たす必要があります：<ul><li>長さは8～32文字</li><li>以下の4種類の文字をそれぞれ2つ以上含む：数字(0～9)、大文字(A～Z)、小文字(a～z)と特殊文字(<code>~!@#%^&*_-+=\|(){}[]:;,.?/`$"<>\\</code>)</li></ul>設定後、**パスワードをコピー** をクリックしてコピーし、設定済みのパスワードを保存します。 |
   | AlertManagerパスワード | Alertmanagerサービスのログインパスワードです。**ランダム生成** をクリックすると、obdによってランダムな文字列が自動生成されます。また、カスタム設定も可能です。カスタム設定時には、パスワードの複雑さは以下の要件を満たす必要があります：<ul><li>長さは8～32文字</li><li>以下の4種類の文字をそれぞれ2つ以上含む：数字(0～9)、大文字(A～Z)、小文字(a～z)と特殊文字(<code>~!@#%^&*_-+=\|(){}[]:;,.?/`$"<>\\</code>)</li></ul>設定後、**パスワードをコピー** をクリックしてコピーし、設定済みのパスワードを保存します。 |
   | OBProxy SQLポート | ODPリスニングポート。デフォルトは `2883` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | OBProxy Exporterポート | PrometheusがOBProxyの監視データを収集するために使用されるOBProxy Exporterのポートです。デフォルトは `2884` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | OBProxy RPCポート  | デフォルトは `2885` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | OBAgent監視サービスポート | デフォルトは `8088` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | OBAgent管理サービスポート | デフォルトは `8089` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | obconfigserverサービスポート | obconfigserverサービスが監視するポート。デフォルトは `8080` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | Prometheusサービスポート | Prometheusサービスが監視するポート。デフォルトは `9090` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | Grafanaサービスポート | GrafanaページにアクセスするためのHTTPポート。デフォルトは `3000` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | AlertManagerサービスポート | AlertmanagerページにアクセスするためのHTTPポート。デフォルトは `9093` で、カスタマイズ設定が可能です(1025～65535の範囲のみサポート)。設定したポートが使用されていないことを確認する必要があります。 |
   | 詳細設定 | **詳細設定** ボタンをクリックして、対応するコンポーネントのパラメータを確認できます。自動的に割り当てられた値を使用するか、各パラメータをカスタマイズすることもできます。<main id="notice" type='explain'><h4>説明</h4><p><b>ノード設定</b>の <b>obconfigserverノード</b>で複数のノードを設定する場合、<b>詳細設定</b>で <code>vip_address</code> と <code>vip_port</code> を設定する必要があります。設定しないと、事前チェックでエラーが発生します。</p></main> |

すべての設定が完了したら、**次へ** をクリックして **事前チェック** ページに進むことができます。

### ステップ5：事前チェック

**事前チェック** ページで設定情報をすべて確認し、問題があれば **戻る** ボタンをクリックして修正することができます。問題がなければ **事前チェック** ボタンをクリックしてチェックを実行してください。

事前チェックでエラーが発生した場合は、ページの提案に従って **自動修復** (自動修復可能なチェック項目の場合)を選択するか、**詳細な解決策を見る** をクリックしてエラーコードドキュメントに移動し、ドキュメントを参照して修正を行うことができます。すべてのエラーを修正後、**再検査** をクリックして、事前チェックを再度実行することができます。

<!-- ![事前チェック](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V3.3.0/zh-CN/200.ui-operations/200.use-ui-deploy-oceanbase-06.png) -->

事前チェックが完了したら、**デプロイ** をクリックすると、OceanBaseデータベースのデプロイが開始されます。

### ステップ6：デプロイ

<!-- ![デプロイ](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V3.6.0/deploy-by-gui/200.use-ui-deploy-oceanbase-06.png) -->

そのうち：

* デプロイに成功したら、表示された接続文字列をコピーして、対応するコンポーネントに接続します。CLIでOceanBaseデータベースコンポーネントを実行後、接続文字列はroot@sysユーザーでOceanBaseクラスタに接続し、OBProxyコンポーネントを実行後、接続文字列はroot@proxysysユーザーでODPに接続します。

* 出力されたPrometheus、Grafana、AlertManager、およびOB-Dashboardコンポーネントの接続文字列をクリックすると、それぞれのログイン画面に移動できます。デプロイ画面に表示されたアカウントとパスワードでログインします。

  <main id="notice" type='explain'>
    <h4>説明</h4>
    <p>Alibaba Cloudなどのクラウド環境では、プログラムがインターネットIPアドレスを取得することができず、イントラネットIPアドレスが出力される場合があります。このIPアドレスはインターネットIPアドレスではないため、グラフィカルユーザーインターフェース(GUI)にアクセスするには正しいアドレスを使用する必要があります。</p>
  </main>

* **デプロイメントレポート** の該当コンポーネントの手前の展開アイコンをクリックすると、デプロイメントログを確認することができます。対応するコンポーネント一覧の **詳細を見る** をクリックした後、対応するコマンドの後のコピーアイコンをクリックすると、コマンドをコピーすることができます。コピーしたコマンドは、コントロールマシンで実行し、対応するコンポーネントのログの場所を確認することができます。

* **情報のコピー** をクリックして、OceanBaseクラスタのすべてのアカウントとパスワード情報をコピーして保存した後、**終了** をクリックしてデプロイプログラムを終了します。または、**ビジネステナントの作成** をクリックして、GUI画面でビジネステナントを作成することもできます。

<main id="notice" type='explain'>
  <h4>説明</h4>
  <ul>
  <li><p> 複数のクラスタをデプロイする場合、GUIで<b>終了</b>をクリックして現在のobdプロセスを終了し、<code>obd web</code> コマンドを再度実行してから次のクラスタのデプロイを行う必要があります。</p></li>
  <li><p>OceanBaseクラスタにビジネステナントを作成することを推奨します。sysテナントはクラスタの管理にのみ使用され、ビジネステナントとして使用するとシステムの異常が発生する可能性があります。</p></li>
  </ul>
</main>

### （オプション）ステップ7：ビジネステナントの作成

OceanBaseクラスタのデプロイが成功した後、デプロイ成功ページの右下にある **ビジネステナントの作成** ボタンをクリックして、ビジネステナントの作成プロセスに進みます。以下の表に従って、テナントの関連情報を設定できます。

| パラメータ  | 説明  |
|-------|------|
| テナント名  | 新しいテナントの名前を設定します。テナント名は以下の要件を満たす必要があります：<ul><li>長さは2〜32文字です。</li><li>大文字と小文字を区別する英字、数字、アンダースコアを含めることができます。ただし、英字で始まり、英字または数字で終わらなければなりません。</li></ul>  |
| テナントモード | ドロップダウンリストからMySQLモードまたはOracleモードを選択できます。<main id="notice"><h4>適用対象</h4><p>OceanBaseデータベースコミュニティ版では、Oracleモードのテナントを作成することはサポートされていません。</p></main>  |
| テナントrootパスワード | **ランダム生成** をクリックすると、obdがランダムな文字列を自動生成します。また、カスタム設定することもできます。カスタム設定する場合、パスワードの複雑さは以下の要件を満たす必要があります：<ul><li>長さは8〜32文字です。</li><li>数字（0\~9）、大文字（A\~Z）、小文字（a\~z）、および特殊文字（<code>~!@#%^&*_-+=\|(){}[]:;,.?/</code>）の4種類の文字から、少なくとも3種類を含める必要があります。</li></ul>  |
| モード設定 | **最大使用**、**最小可用**、または**カスタム** のいずれかを選択できます。<ul><li><b>最大使用</b>：デフォルトで、クラスタのすべての残りリソースを使用してビジネステナントを作成します。変更できません。</li><li><b>最小可用</b>：デフォルトで、テナントが必要とする最小リソースを使用してビジネステナントを作成します。変更できません。</li><li><b>カスタム</b>：CPU、メモリ、ログディスクのサイズを手動で設定します。</li></ul>  |
| ビジネス負荷タイプ | ドロップダウンリストからテナントのビジネス負荷タイプを選択できます。異なる負荷タイプを選択すると、ドロップダウンリストの下部にその負荷タイプの適用シナリオの説明が表示されます。<main id="notice" type='notice'><h4>注意</h4><p>このパラメータは、デプロイされたOceanBaseデータベースのバージョンがV4.2.5以上である場合にのみ表示されます。</p></main>  |
| 文字セット | デフォルトは `utf8mb4` です。ドロップダウンリストから他の文字セットを選択できます。 |
| 文字順序 | デフォルトは `utf8mb4_general_ci` です。ドロップダウンリストから他の文字順序を選択できます。 |
| テーブル名の大小文字の区別 | ドロップダウンリストから設定を選択できます。`0`、`1`、または `2` のいずれかを設定できます。<ul><li><code>0</code>：テーブル名は指定された大文字・小文字の形式で保存され、大文字・小文字の区別付きで比較されます。</li><li><code>1</code>：テーブル名は小文字で保存され、大文字・小文字の区別なしで比較されます。</li><li><code>2</code>：テーブル名は指定された大文字・小文字の形式で保存され、大文字・小文字の区別なしで比較されます。</li></ul>  |
| タイムゾーン  | デフォルトは (GMT+08:00)中国標準時間です。ドロップダウンリストから他のタイムゾーンを選択できます。  |
| IPアドレスの白リスト | アクセス可能なIPアドレスをカスタム設定するか、すべてのIPアドレスがアクセス可能に設定できます。カスタム設定する場合、**カスタムIP** の入力欄に許可されるクライアントIPを指定できます。IPアドレスを入力後、Enterキーを押下するか、英数字のカンマ（`,`）を入力すると、複数のノードIPを設定できます。**設定の説明を表示** をマウスオーバーすると、IPアドレスの設定に関する説明が表示されます。<main id="notice" type='explain'><h4>説明</h4><p>カスタム設定する場合、<code>%</code> を設定するとすべてのクライアントからアクセスできるようになります。アクセスセキュリティリスクがありますので、慎重に操作してください。</p></main>  |

<!-- ![設定](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V3.6.0/deploy-by-gui/200.use-ui-deploy-oceanbase-07.png) -->

設定が完了したら、**次へ:ビジネステナントの作成** をクリックします。システムが対応するテナントを作成します。作成が完了すると、ページにビジネステナントの情報が表示されます。テナント名、rootユーザーのパスワード、接続文字列などが含まれます。左下の **終了** ボタンをクリックすると、テナント作成プロセスを終了できます。その後、デプロイ結果ページの **終了** ボタンをクリックして、デプロイプログラムを終了するか、**ビジネステナントの作成** をクリックして、次のビジネステナントを作成することができます。

<!-- ![作成成功](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obd/V3.6.0/deploy-by-gui/200.use-ui-deploy-oceanbase-10.png) -->

## 関連操作

### デプロイ済みクラスタの管理

以下のコマンドを実行して、obdにデプロイされたクラスタを管理することができます。詳細については、[クラスタコマンドグループ](https://en.oceanbase.com/docs/community-obd-en-10000000002136398)を参照してください。

```shell
# クラスタ一覧の表示
[admin@test001 ~]$ obd cluster list

# クラスタ状態の確認は、myoceanbaseをデプロイ名の例とする
[admin@test001 ~]$ obd cluster display myoceanbase

# 実行中のクラスタの停止は、myoceanbaseをデプロイ名の例とする
[admin@test001 ~]$ obd cluster stop myoceanbase

# デプロイ済みクラスタの破棄は、myoceanbaseをデプロイ名の例とする
[admin@test001 ~]$ obd cluster destroy myoceanbase
```

### 特定バージョンコンポーネントのデプロイ

OceanBase All in Oneを使用してデプロイする場合、OceanBase All in OneパッケージはOceanBaseデータベースのバージョンに基づいて更新されます。パッケージに他のコンポーネントの更新バージョンが含まれる場合、[OceanBaseソフトウェアダウンロードセンター](https://en.oceanbase.com/softwarecenter)から最新バージョンのコンポーネントをダウンロードし、以下の手順に従ってローカルイメージリポジトリにアップロードすることができます。obdデプロイ時には、ローカルイメージリポジトリ内の最新バージョンが自動的に取得されます。

1. コンポーネントインストールパッケージのあるディレクトリに移動し、パッケージがローカルイメージリポジトリに追加されます

   ```shell
   [admin@test001 rpm]$ obd mirror clone *.rpm
   ```

2. ローカルイメージリポジトリ内のパッケージ一覧を確認する

   ```shell
   [admin@test001 rpm]$ obd mirror list local
   ```
