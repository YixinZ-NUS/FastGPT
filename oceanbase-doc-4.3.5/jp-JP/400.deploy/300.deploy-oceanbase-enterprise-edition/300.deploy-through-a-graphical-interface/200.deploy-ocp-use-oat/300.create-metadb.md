|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# MetaDBの作成

コンテナベースでデプロイされたOceanBaseデータベースサービスには、OceanBase Proxyが内蔵されており、外部から直接アクセスできます。OCP、ODC、OMSなどのプロダクトのメタデータの格納に使用できます。

本記事では、OATを使用してMetaDBを作成する方法を説明します。

<main id="notice" type='explain'>
   <h4>説明</h4>
   <p><ul><li>この記事では、OAT V4.2.0バージョンを例に操作手順を説明します。OATのバージョンによって操作画面が異なる場合があります。実際の画面をご確認ください。</li><li>OceanBaseにMetaDB用の独立したテナントを作成することを推奨します。MetaDBは、モニタリングデータ以外の永続化データを格納するために使用されます。CPUおよびメモリは、4コア、8 GB以上の割り当てを推奨します。</li><li>ディスク容量は、OCPで管理するクラスタの規模、保存されるファイルリソース、データ保持期間などの要因に影響されます。一般的に100 GB以上のディスク容量を推奨します。</li></ul></p>
</main>

## 前提条件

MetaDBを作成する前に、以下の情報を確認する必要があります：

* OATをインストール済みであること。詳細については、[OATのデプロイ](../../200.preparations-before-deploy/400.deploy-oat.md)を参照してください。
* スーパー管理者または運用担当者の権限を持つアカウントでOATにログインしていること。アカウントの詳細については、[ユーザー管理](https://en.oceanbase.com/docs/common-oat-10000000002095186)を参照してください。
* MetaDBをインストールするサーバーが追加済みであること。詳細については、[サーバーの追加](../100.configuring-the-deploy-environment-through-oat/100.add-server.md)を参照してください。

## 操作手順

1. 左側のナビゲーションバーで、**プロダクトサービス \> コンポーネント** をクリックして **コンポーネント管理** ページに移動し、右上の **コンポーネントの作成** をクリックして **MetaDBの作成** を選択します。

    <!-- ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.2/400.deploy/OAT420/2%E5%88%9B%E5%BB%BAmetadb-0.png) -->

2. **MetaDBの作成** ページで、**基本設定** を設定します。

    | パラメータ | 説明 |
    |------|------|
    | MetaDBイメージ | MetaDBのDockerイメージ。 |
    | コンポーネント名 | コンポーネントの名前。他のコンポーネントと重複する名前は使用できません。デフォルト名は `metadb` です。 |
    | サーバー | MetaDBをインストールするサーバーのIPアドレス。 |
    | カスタムZone | カスタムZoneを有効にするには、Zone名、データセンター、サーバー、Root Serverの位置を入力する必要があります。<main id="notice" type='notice'><h4>注意</h4><p>このパラメータとサーバーパラメータはどちらか一方を選択する必要があります。カスタムZoneを有効にすると、上記のサーバーパラメータは自動的に非表示になります。</p></main>|
    | アービトレーションサービスの設定 | 自由に有効または無効にできます。有効にする場合は、アービトレーションサービスのアドレスを入力する必要があります。例：xxx.xxx.xxx.xxx:xxxx。<main id="notice" type='notice'><h4>注意</h4><p>MetaDBイメージでV4.XバージョンのMetaDBを選択した場合のみ、アービトレーションサービスの設定が可能です。</p></main>|
    | CPU | サーバーでMetaDBが使用可能なCPU。デフォルトは `32C` です。 <main id="notice" type='explain'><h4>説明</h4><p>準備したOCPサーバーのCPUとメモリが16コア32 GBの場合、MetaDBがサーバー上で使用可能なCPUを8コアに設定することを推奨します。</p></main>|
    | メモリ | MetaDBがサーバー上で使用可能なメモリ。デフォルトは `90 GB` です。 <main id="notice" type='explain'><h4>説明</h4><p>OCPサーバーのCPUとメモリが16コア32 GBの場合、MetaDBがサーバー上で使用可能なメモリを16 GBに設定することを推奨します。</p></main>|
    | MetaDBクラスタ名 | MetaDBのクラスタ名。 |
    | root@sysパスワード | MetaDBクラスタのsysテナントのrootユーザーパスワード。 |

    <!-- ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.2/400.deploy/OAT420/2%E5%88%9B%E5%BB%BAmetadb-1%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE.png) -->

3. **MetaDBの作成** ページで、**インストールパス(オプション)** を設定します。

    MetaDBを作成するためのインストールパスの構成パラメータは以下のとおりです：

    | パラメータ | 説明 |
    |------|------|
    | インストールディレクトリ | MetaDBのインストールパス。デフォルトは `/home/admin/oceanbase` です。 |
    | データディレクトリ | MetaDBのデータ格納パス。デフォルトは `/data/1` です。 |
    | ログディレクトリ | MetaDBのログ保存パス。デフォルトは`/data/log1`です。 |
    | (オプション)バックアップディレクトリ | MetaDBのバックアップパス。デフォルトは空です。 |

    <!-- ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.0.0/4.deploy-the-oceanbase-database/OAT/create-metadb/3%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84.png) -->

4. **MetaDBの作成** ページで、**起動パラメータ(オプション)** を設定します。

    <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>OCPサーバーのCPUとメモリが16コア32 GBで、MetaDBが利用可能なCPUとメモリを8コア16 GBに設定する場合、<b>observerプロセスの起動パラメータ</b>で、<code>system_memory</code> を5 Gに、<code>resource_hard_limit</code> を150に設定する必要があります。</p>
    </main>

    MetaDBを作成するための起動パラメータの設定は以下のとおりです：

    | パラメータ | 説明 |
    |------|------|
    | MySQLポート | MetaDBのMySQLポート。デフォルトは `2881` です。 |
    | RPCポート | MetaDBのRPCポート。デフォルトは `2882` です。 |
    | (オプション) OBプロセス起動パラメータ | 必要に応じてobserverプロセスの起動パラメータを変更または追加できます。 |
    | OBProxyサービスポート | OBProxyのサービスポート。デフォルトは `2883` です。 |
    | (オプション) OBProxyプロセス起動パラメータ | 必要に応じてOB Proxyプロセスの起動パラメータを変更または追加できます。詳細については、[OBProxy構成パラメータの説明](https://en.oceanbase.com/docs/common-odp-doc-en-10000000002135916)を参照してください。 |
    | SSHDポート | MetaDBコンテナ内のSSHDポート。デフォルトは `2022` です。OCPはSSHDポートに接続してOCP Agentをデプロイします。 |
    | rootパスワード | MetaDBコンテナ内のrootユーザーパスワード。 |

    <!-- ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.0.0/4.deploy-the-oceanbase-database/OAT/create-metadb/4%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0.png) -->

5. MetaDBの設定が完了したら、**送信** をクリックします。

   設定に誤りがある場合は、**リセット** をクリックすると、デフォルト設定を復元できます。

## 次の操作

MetaDBをインストールした後、OceanBaseのエコシステムツールであるOCP、ODC、OMS、OB Shardingをインストールします。

## 関連ドキュメント

[MetaDBの作成と削除](https://en.oceanbase.com/docs/enterprise-oat-10000000000949564)
