|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# OCPのデプロイ

本記事では、OATを使用したOCPのインストール方法について説明します。

<main id="notice" type='explain'>
   <h4>説明</h4>
   <p>この記事では、OAT V4.2.0バージョンを例に操作手順を説明します。OATのバージョンによって操作画面が異なる場合があります。実際の画面をご確認ください。</p>
</main>

## 前提条件

OCPをインストールする前に、以下の情報を確認する必要があります：

* OATをインストール済みであること。詳細については、[OATのデプロイ](../../200.preparations-before-deploy/400.deploy-oat.md)を参照してください。
* スーパー管理者または運用担当者の権限を持つアカウントでOATにログインしていること。アカウントの詳細については、[ユーザー管理](https://en.oceanbase.com/docs/common-oat-10000000002095186)を参照してください。
* OCPをインストールするためのサーバーの準備が完了し、OATに追加していること。詳細については、[サーバーの準備](../../200.preparations-before-deploy/100.prepare-servers.md)と [サーバーの追加](../100.configuring-the-deploy-environment-through-oat/100.add-server.md)を参照してください。
* OCPのメタデータベースMetaDBコンポーネントを作成していること。詳細については、[MetaDBの作成](../200.deploy-ocp-use-oat/300.create-metadb.md)を参照してください。
* OCPインストールパッケージをOATサーバーにアップロードしていること。詳細については、[インストールパッケージのアップロード](../200.deploy-ocp-use-oat/200.upload-the-installation-package.md)を参照してください。
* ネットワーク環境には、OCPが正常に稼働するためのネットワークポート設定要件（ネットワークアクセス権限）が規定されています。管理者は、実際の環境におけるOCPコンポーネントの導入構成に基づき、ネットワーク側とホスト側で関連ポートを開放してください。詳細については、[コンポーネントのリスニングポート一覧](https://en.oceanbase.com/docs/common-ocp-10000000002854267)をご参照ください。

## 操作手順

1. 左側のナビゲーションバーで、**プロダクトサービス \> プロダクト** をクリックして **プロダクト管理** ページに移動し、右上の **プロダクトのインストール** をクリックして **OCPのインストール** を選択します。

   <!-- ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.2/400.deploy/OAT420/3%E5%AE%89%E8%A3%85ocp-0.png) -->

2. **OCPのインストール** ページで、**基本設定** を完了します。

   | パラメータ | 説明 |
   |------|------|
   | OCPイメージ | OCPのDockerイメージ。 |
   | プロダクト名 | プロダクトの名前。他のプロダクトと重複できません。 |
   | 管理者パスワード | OCP管理者パスワード。パスワードのフォーマットは以下のとおりです：<ul><li>長さは8～32文字です。</li><li>以下の4種類の文字のうち、少なくとも3種類以上を含む：数字(0～9)、大文字(A～Z)、小文字(a～z)、特殊文字 <code>\~!@#%\^\&\*_-+=\`\|(){}\[\]:;',.?/</code>。</li></ul>|
   | マルチゾーンモード | マルチゾーンインストールを有効にした場合、以下のパラメータがあります：<ul><li>ゾーン名：ゾーンの名前。</li><li>サーバー：OCPをインストールするサーバーのIPアドレス。</li><li>OCPプロキシIP：ゾーンのOCPアクセスエントリーのIPアドレス。</li><li>OCPプロキシポート：ゾーンのOCPアクセスエントリーのポート番号。デフォルトは `80` です。</li><li>MetaDBプロキシIP：MetaDBプロキシのIPアドレス。</li><li>MetaDBプロキシポート：MetaDBプロキシのポート。デフォルトは `2883` です。|
   | サーバー | OCPをインストールするサーバーのIPアドレス。 |
   | CPU | サーバー上でOCPが使用可能なCPU。デフォルトは `8C` です。<main id="notice" type='notice'><h4>注意</h4><p>OCPサーバーのCPUとメモリが16コア32 GBで、MetaDBが利用可能なCPUとメモリを8コア16 GBに設定する場合、OCPがサーバー上で使用可能なCPUを8コアに設定する必要があります。</p></main> |
   | メモリ | OCPがサーバー上で使用可能なメモリ。デフォルトは `20 GB` です。 <main id="notice" type='notice'><h4>注意</h4><p>OCPサーバーのCPUとメモリが16コア32 GBで、MetaDBが利用可能なCPUとメモリを8コア16 GBに設定する場合、OCPがサーバー上で使用可能なメモリを16 GBに設定する必要があります。</p></main>|
   | HTTPポート | OCPのHTTPポート番号。デフォルトは `8080` です。 |
   | マルチクラスタモード | マルチクラスタインストールモードを有効にします。 |
   | ログディレクトリ | OCPのログ保存パス。デフォルトは `/home/admin/logs/ocp` です。 |

   <!-- ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.2/400.deploy/OAT420/3%E5%AE%89%E8%A3%85ocp-1%E5%9F%BA%E7%A1%80%E8%AE%BE%E7%BD%AE.png) -->

3. **OCPのインストール** ページで、**MetaDB設定** を完了します。

   MetaDBのタイプには **作成済みMetaDB** と **その他のOB_MySQL** があり、2つの方法で **OCP Metaテナント** と **OCP Monitorテナント** を設定します。

   * 新しく作成したMetaDBで、テナントがまだ作成されていない場合は、**作成済みMetaDB** タブをクリックします。具体的なパラメータは以下のとおりです：

      | パラメータ | 説明 |
      |------|------|
      | 作成済みMetaDBの選択 | OCP用に作成済みのMetaDBを選択します。 |
      | MetaDBクラスタをOCPに引き継ぐかどうか | OCPのクラスタ引き継ぎ機能を使用して、選択したMetaDBを追加します。完了後、OCPで管理できるようになりますが、同じMetaDBは1つのOCPでのみ引き継ぐことができます。 |
      | OCP Metaテナント | OCP MetaDBの専用テナント。 |
      | テナント名 | MetaDBテナント名。 |
      | テナントパスワード | MetaDBテナントパスワード。 |
      | CPU | OCP Metaテナントが使用可能なCPU。デフォルトは `2C` です。 <main id="notice" type='notice'><h4>注意</h4><p>MetaDBがサーバー上で使用可能なCPUとメモリを8コア16 GBに設定する場合、OCP Metaテナントが使用可能なCPUを2コアに設定する必要があります。</p></main>|
      | メモリ | OCP Metaテナントが使用可能なメモリ。デフォルトは `5 GB` です。 <main id="notice" type='notice'><h4>注意</h4><p>MetaDBがサーバー上で使用可能なCPUとメモリを8コア16 GBに設定する場合、OCP Metaテナントが使用可能なメモリを3 GBに設定する必要があります。</p></main>|
      | OCP Monitorテナント | OCP MonitorDBの専用テナント。 |
      | テナント名 | MonitorDBテナント名。 |
      | テナントパスワード | MonitorDBテナントパスワード。 |
      | CPU | OCP Monitorテナントが使用可能なCPU。デフォルトは `4C` です。 <main id="notice" type='notice'><h4>注意</h4><p>MetaDBがサーバー上で使用可能なCPUとメモリを8コア16 GBに設定する場合、OCP Monitorテナントが使用可能なCPUを2コアに設定する必要があります。</p></main>|
      | メモリ | OCP Monitorテナントが使用可能なメモリ。デフォルトは `16 GB` です。<main id="notice" type='notice'><h4>注意</h4><p>MetaDBがサーバー上で使用可能なCPUとメモリを8コア16 GBに設定する場合、OCP Monitorテナントが使用可能なメモリを3 GBに設定する必要があります。</p></main> |
      | MetaDBクラスタの引継ぎ | MetaDBクラスタを引き継ぐ場合はチェックを入れます。引き継ぎ後、OCPでこのMetaDBクラスタを確認できるようになります。各MetaDBクラスタは、1つのOCPでのみ引き継ぐことができます。|

      <!-- ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.1.0/4.deploy/3.deploy-oceanbase-database-enterprise/1.deploy-ocp/6MetaDB%E9%85%8D%E7%BD%AE.png) -->

   * 既存のテナントがある場合は、**その他のOB_MySQL** タブをクリックして、**OCP Metaテナント** と **OCP Monitorテナント** の接続情報を入力します。ユーザー名がrootでない場合、ユーザーにはデータベーステーブルを作成する権限が必要です。

      <!-- ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.1.0/4.deploy/3.deploy-oceanbase-database-enterprise/1.deploy-ocp/5%E5%85%B6%E4%BB%96OB-MYSQL.png) -->

4. **OCPのインストール** ページで、**ロードバランシング設定** を完了します。

   ロードバランシングモードには、以下の4つの選択肢があります：

   * 作成済みのNLB。

      <!-- ![5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.1.0/4.deploy/3.deploy-oceanbase-database-enterprise/1.deploy-ocp/7%E5%B7%B2%E5%88%9B%E5%BB%BA%E7%9A%84NLB.png) -->

   * 作成済みのOBDNS。

      <!-- ![6](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.1.0/4.deploy/3.deploy-oceanbase-database-enterprise/1.deploy-ocp/8%E5%B7%B2%E5%88%9B%E5%BB%BA%E7%9A%84OBDNS.png) -->

   * その他のロードバランシング。

      <!-- ![7](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.2/400.deploy/OAT420/3%E5%AE%89%E8%A3%85ocp-2%E5%85%B6%E4%BB%96%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.png) -->

   * 使用しない：ロードバランシングを使用しない場合、高可用性を実現できません。デフォルトで最初のIPアドレスを接続情報として使用します。

5. **OCPのインストール** ページで、**OpenSearch設定** を完了します。

    OpenSearch設定のモードは以下の3種類に分かれています：

    * 作成済みのOpenSearch：ユーザーはドロップダウンリストからOATで作成したOpenSearchを選択できます。OpenSearchの作成方法については、[OpenSearchの作成と削除](https://en.oceanbase.com/docs/common-oat-10000000002095170)を参照してください。
    * 外部のOpenSearch：外部にデプロイされたOpenSearchのURL、ユーザー名、パスワードを入力する必要があります。
    * 使用しない。
  
6. OCPの設定が完了したら、**送信** をクリックします。

   設定に誤りがある場合は、**リセット** をクリックすると、デフォルト設定を復元できます。

## 次の操作

OCPのデプロイが完了したら、OCPにログインしてデプロイ後のチェックを行うことができます。

1. ブラウザにOCPのアクセスアドレスを入力し、Enterキーを押します。

   アクセスアドレスは、http://\< *OCPサーバーのIPアドレス* \>:8080です。

2. 表示されたログインページで、デフォルトアカウントの `admin` アカウントを使用してログインします。

   <!-- ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.2/400.deploy/OCP422/1%E7%99%BB%E5%BD%95.png) -->

  <main id="notice" type='explain'>
    <h4>説明</h4>
    <ul>
    <li>ドメイン名でアクセスする場合は、ローカルマシンのドメイン名解決サービスを設定する必要があります。</li>
    <li>OceanBaseアフターサービスサポートにお問い合わせいただき、adminアカウントのデフォルトパスワードを取得してください。アカウントのセキュリティを確保するため、初回ログイン後、速やかにパスワードを変更してください。</li>
    </ul>
  </main>

## 関連ドキュメント

* [サーバーの準備](../../200.preparations-before-deploy/100.prepare-servers.md)
* [OATのデプロイ](../../200.preparations-before-deploy/400.deploy-oat.md)
* [サーバーの追加](../100.configuring-the-deploy-environment-through-oat/100.add-server.md)
* [MetaDBの作成](../200.deploy-ocp-use-oat/300.create-metadb.md)
* [OCPのインストール、アップグレードおよびアンインストール](https://en.oceanbase.com/docs/common-oat-10000000002095176)
