|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# サーバーの追加

本記事では、OATリソースプールにサーバーを追加する方法を説明します。

<main id="notice" type='explain'>
   <h4>説明</h4>
   <p>この記事では、OAT V4.2.0バージョンを例に操作手順を説明します。OATのバージョンによって操作画面が異なる場合があります。実際の画面をご確認ください。</p>
</main>

## 前提条件

OATがインストール済みであること。詳細については、[OATのデプロイ](../../200.preparations-before-deploy/400.deploy-oat.md)を参照してください。

## 操作手順

1. OATにログインします。

2. 左側のナビゲーションバーで、**サーバー** をクリックして **サーバー管理** ページに移動し、ページの右上隅にある **サーバーの追加** をクリックします。

3. **サーバーの追加** ページで、基本情報を入力します。

   <!-- ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.0/4.deploy/oat-add-server/1%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF.png) -->

   **各フィールドの説明：**

   |   フィールド    |          説明          |
   |-----------|----------------------|
   | サーバーIP | 追加するサーバーのパブリックIPアドレス。    |
   | SSHポート | 追加するサーバーのSSHアクセスポート。   |
   | データセンター (IDC) | 追加するサーバーが属するデータセンター。        |
   | 認証情報      | 追加するサーバーのアクセス認証情報。現在、ユーザー名とパスワード、およびキーの2種類の認証情報をサポートしています。|
   | 説明 (オプション) | サーバー追加に関するコメントで、ホストの管理を容易にします。|

4. **サーバーの追加** ページで、初期設定を行います。

   <!-- ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.2.0/4.deploy/oat-add-server/2%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE.png) -->

   **各フィールドの説明：**

   |   フィールド    |          説明          |
   |----------|----------------------|
   | サーバー用途 | 追加するサーバーの用途。 |
   | OS所有者ユーザー | OB ServerおよびOBプロダクトサービスのインストールと実行を行うOSユーザー。カスタマイズ可能です。 |
   | ユーザーパスワード | 上記OS所有者ユーザーのパスワード。 |
   | ユーザーUID:GID | OS所有者ユーザーのUIDとGID。 |
   | Dockerルートディレクトリ | Dockerデータディレクトリ。 |

   * クロック同期 (オプション)：デフォルトでオフです。クロック同期を有効にするには、以下の情報を入力してください。

      <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>OceanBaseクラスタとOCPをデプロイするサーバーは、クロックソースを同期する必要があります。</p>
      </main>

      |   フィールド    |          説明          |
      |----------|----------------------|
      | クロックソースIPアドレス | クロックソースのIPアドレス。|
      | minpoll： | chronyクライアントがクロックソースへのクロック同期リクエストを送信する最小時間間隔 (秒単位)。 |
      | maxpoll： | chronyクライアントがクロックソースにクロック同期リクエストを送信する最大時間間隔 (秒単位)。 |
      | maxslewrate： | chronyクライアントのクロックの最大調整レートの制御に使用されます。単位は PPM (百万分の一) です。 |
      | このサーバーをセカンダリクロックソースとして使用する (オプション) | 設定後、アローリストに登録されたクライアントからのリクエストを許可する、およびブロックリストに登録されたクライアントからのリクエストを拒否する前に、このサーバーがクロックソースとして外部にサービスを提供できます。 |

   * OCP管理への自動同期 (オプション)：デフォルトでオフです。有効にすると、インストール済みのOCPを選択する必要があります。選択可能なOCPがない場合、デフォルトでグレーアウトされます。OATでサーバーの初期設定が完了すると、OCPのAPIを自動的に呼び出し、サーバーを指定されたOCPに追加して以降の運用を容易にします。

      <main id="notice" type='notice'>
        <h4>注意</h4>
        <p><ul><li>ここでいうインストール済みのOCPは、<strong>プロダクトサービス</strong> > <strong>プロダクト</strong> > <strong>OCP</strong>でインストールされたOCPです。OCPのインストールについては、「<a href="../200.deploy-ocp-use-oat/400.deploy-ocp.md">OCPのデプロイ</a>」を参照してください。</li><li>OCPを使用してOceanBaseクラスタをデプロイする前に、OceanBaseクラスタをデプロイするマシンをOCPリソースプールに追加する必要があります。</li></ul></p>
      </main>

   * ディスクの初期化 (オプション)：OceanBaseデータベースおよび関連するプロダクトサービスの安定性を確保するため、通常はサービスで使用されるディレクトリを独立したディスクに配置することを推奨します。ディスクの初期化を選択すると、プログラムは自動的に `lvm`を用いて対応する `vg`を作成し、指定されたサイズの `lv`を指定のマウントディレクトリにマウントします。

      * ディスクまたはパーティションの選択：システムはマウントされていないディスクデバイスを自動的に検出します。ユーザーはマウントするディスクデバイスを複数選択できます。
      * マウント用途：**ソフトウェアインストールパス**、**データディスクパス**、**ログディスクパス**、および **Dockerルートディレクトリ** があります。ユーザーは実際の要件に応じてマウント用途を選択できます。
      * マウントポイント：ユーザーは実際の状況に応じて、適切なマウントパスを入力します。
      * 容量 (/GB)：実際の状況に応じて、必要な容量を入力します。単位はGBです。

5. **確認** をクリックします。

   * ユーザーがディスクの初期化機能を有効にしている場合、送信時にチェック項目を表示するポップアップウィンドウが表示されます。チェック項目にエラーがなければ、**OK** をクリックしてサーバーを追加します。

   * ユーザーがディスク初期化機能を有効にしていない場合、直接送信され、初期化操作が実行されます。

サーバーの送信が成功すると、サーバーリストに新しく追加されたサーバーが表示されます。この時点でのマシンの状態は **初期化中** です。ユーザーは **サーバー管理** ページで追加されたサーバーを見つけて、対応する **操作** 列の **タスクの表示** をクリックすると、タスクの進捗状況を確認できます。サーバーが多すぎる場合、ページ上部でIPアドレスを使って検索できます。

エラーが発生したサブタスクがあり、それがビジネスに影響しない場合は、ログ情報を確認した上で、サブタスクを手動で成功に設定できます。

## 次の操作

マシンが正常に追加された後、必要に応じてOCPをデプロイできます。

* [OCPのデプロイ](../200.deploy-ocp-use-oat/400.deploy-ocp.md)

OCPのデプロイとマシンの追加が完了した後、必要に応じてOceanBaseクラスタをデプロイできます。

* [OCPを使用した2レプリカ + アービトレーションサービスのOceanBaseクラスタのデプロイ](../300.deploy-oceanbase-cluster-use-ocp/300.deploy-the-quorum-high-availability-service-use-ocp.md)
* [OCPを使用した1レプリカOceanBaseクラスタのデプロイ](../300.deploy-oceanbase-cluster-use-ocp/400.deploy-single-replica-oceanbase-cluster-use-ocp.md)
* [OCPを使用した3レプリカOceanBaseクラスタのデプロイ](../300.deploy-oceanbase-cluster-use-ocp/500.deploy-three-oceanbase-replica-clusters-use-ocp.md)

## 関連ドキュメント

* サーバーの追加に関する詳細は、[サーバーの追加](https://en.oceanbase.com/docs/common-oat-10000000002095181)を参照してください。
* サーバーの初期化が完了した後、そのサーバーの運用保守を実施できます。運用保守の内容には、サーバー用途の変更、クロック同期の設定、ディスクの初期化が含まれます。サーバーの運用保守に関する詳細は、[サーバーの運用保守](https://en.oceanbase.com/docs/common-oat-10000000002095178)を参照してください。
