|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# サーバーの設定

この記事では、サーバーのハードウェア設定要件について説明します。OS、BIOS設定、ディスクマウント、NIC設定、ソフトウェア要件などが含まれます。

## オペレーティングシステム(OS)

### OAT/OCPがサポートするOS

OAT/OCPは、下表に示すOSにデプロイできます。

|                OS                 | 対応バージョン | サーバーアーキテクチャ  |
|----------------------------------------|---------|------------|
| Rocky Linux         | 9      | x86_64/ARM aarch64 |
| Alibaba Cloud Linux | 2、3   | x86_64/ARM aarch64 |
| 龍蜥AnolisOS        | 8      | x86_64/ARM aarch64 |
| 麒麟OS（KylinOS）   | V10、V11  | x86_64/ARM aarch64 |
| 統信UOS             | V20   | x86_64/ARM aarch64 |
| 中科方徳NFSChina    | 4.0   | x86_64/ARM aarch64 |
| CentOS/RHEL (Red Hat Enterprise Linux) | 7、8、9   | x86_64/ARM aarch64 |
| openSUSE             | 12SP5                | x86_64/ARM aarch64 |
| Debian               | 12                   | x86_64/ARM aarch64 |
| openEuler            | 20.03 LTS、22.03 LTS | x86_64/ARM aarch64 |
| 凝思OS              | V6.0.99、V6.0.100   | x86_64/ARM aarch64 |
| Ubuntu               | 22.04 LTS、24.04 LTS | x86_64/ARM aarch64 |

### OceanBaseデータベースがサポートするOS

OceanBaseデータベースは、下表に示すLinux OSにインストールできます。

|       Linux OS      |    バージョン   |             サーバーアーキテクチャ         |
|-------------------------|-----------|-------------------------------|
| Rocky Linux             |   9   | x86_64 (海光を含む)、ARM_64 (鲲鹏、飛騰) |
| Alibaba Cloud Linux     | 2、3   | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| 龍蜥 AnolisOS           | 8   | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| KylinOS                 | V10、V11        | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| 統信 UOS                | V20         | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| 中科方徳NFSChina        | 4.0  | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| 浪潮Inspur kos          | 5.8        | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| CentOS / Red Hat Enterprise Linux | 7、8、9 | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| SUSE Enterprise Linux     | 12SP5 | x86_64 (海光を含む) |
| Debian                    | 12     | x86_64 (海光を含む) |
| openEuler                | 20.03 LTS、22.03 LTS | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| 凝思Linux | V6.0.99、V6.0.100 | x86_64 (海光を含む)、ARM_64 (鯤鵬、飛騰) |
| Ubuntu | 22.04 LTS、24.04 LTS | x86_64 (海光を含む) |

<main id="notice" type='explain'>
  <h4>説明</h4>
  <p><ul><li>OSには、ネットワークとソフトウェアマネージャー（yumまたはzypperリポジトリ）が設定されている必要があります。</li><li>OceanBaseクラスタをデプロイするサーバーは、リトルエンディアンモードである必要があります。</li><li>Hygon 7490チップを使用している場合は、Hygon(海光)のサーバーメーカーが推奨する、パッチ4を含むOSをインストールする必要があります。</li></ul></p>
</main>

## OceanBaseサーバーにおけるBIOS設定

### 特別な設定

* Intel x86アーキテクチャ環境の場合：

  * 設定ファイル`/etc/sysctl.conf`を変更し、パラメータ`vm.swappiness`を`0`に設定することを推奨します。設定方法は以下のとおりです。

    ```bash
    [root@xxx /]
    $vi /etc/sysctl.conf
    vm.swappiness = 0
    ```

    sysctl.confの設定を反映します。

    ```bash
    [root@xxx /]
    $sysctl -p
    ```

* AMDまたはARMアーキテクチャ環境では、Numaを有効にすることを推奨します。

* ARMおよび海光アーキテクチャ環境では、設定ファイル`/etc/sysctl.conf`を変更し、パラメータ`kernel.numa_balancing`、`vm.zone_reclaim_mode`、`vm.swappiness`を`0`に設定することを推奨します。設定方法は以下のとおりです。

  ```bash
  [root@xxx /]
  $vi /etc/sysctl.conf
  kernel.numa_balancing = 0
  vm.zone_reclaim_mode = 0
  vm.swappiness = 0
  ```

  sysctl.confの設定を反映します。

  ```bash
  [root@xxx /]
  $sysctl -p
  ```

### BIOSで無効にする必要があるオプション

* Cstate

* Pstate

* EIST

* Power saving

* SMMU (ARM アーキテクチャ)

### BIOSで設定する必要があるオプション

* Automatic Power on After Power Loss： Always on

* Intel Virtualization Technology：有効

* Hyper-threading：有効

* Hardware prefetcher：有効

* VT-d：有効

* SR-IOV：有効

* Turbo Mode：有効

* Energy performance：最大パフォーマンスを有効にする

  <main id="notice" type='explain'>
    <h4>説明</h4>
    <p>サーバーによってBIOSの変更方法は異なります。具体的な操作手順については、サーバーのマニュアルを参照してください。</p>
  </main>

## ディスクのマウント

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>マウントポイントのディレクトリの容量が16TBを超える場合、xfs形式のみをサポートします。</p>
</main>

* OCPサーバーのディスクのマウントポイント要件は以下の表のとおりです。

  |    マウントポイント     |       サイズ       |     用途      |          ディスクフォーマット           |
  |------------|----------------|-------------|-------------------------|
  | /home      | 100 GB ～ 300 GB | 各コンポーネントの実行ログディスク    | ext4 または xfs を推奨 |
  | /data/log1 | メモリサイズの 3 ～ 4 倍   | OCP メタデータベースのログディスク | ext4 または xfs を推奨 |
  | /data/1    | 保存するデータサイズによる   | OCP メタデータベースのデータディスク | ext4 または xfs を推奨 |
  | /docker    | 200 GB ～ 500 GB | Docker ルートディレクトリ | ext4 または xfs を推奨 |

* OBServerノードのディスクマウントポイント要件は以下の表のとおりです。

  |    マウントポイント     |       サイズ       |       用途       |         ファイルシステムのフォーマット          |
  |------------|----------------|----------------|-------------------------|
  | /home      | 100 GB ～ 300 GB | observer プロセスの実行ログディスク | ext4 または xfs を推奨 |
  | /data/log1 | メモリサイズの 3 ～ 4 倍   | observer プロセスのログディスク   | ext4 または xfs を推奨 |
  | /data/1    | 保存するデータサイズによる   | observer プロセスのデータディスク   | ext4 または xfs を推奨 |

  <main id="notice" type='explain'>
    <h4>説明</h4>
    <p>ルートディレクトリは50GB以上を推奨します。LVMを使用する場合は、作成時にストライピングパラメータの使用を推奨します。例：</p>
    <p><code>lvcreate -n data -L 3000G obvg --stripes=3 --stripesize=128</code></p>
  </main>

## NIC設定

10ギガビットNICを2枚使用した構成を推奨します。

* bondモードの名前をbond0とします。バインディングモードはmode1またはmode4を選択できますが、mode4の選択を推奨します。mode4モードを使用する場合、スイッチで802.3adプロトコルを設定する必要があります。
* NIC名はeth0およびeth1とすることを推奨します。

## SSD の I/O スケジューラの設定

* NVMe SSD のデフォルトの I/O スケジューラは`none`であり、変更は不要です。
* SATA SSD の I/O スケジューラは`none`に設定することを推奨します。

## 注意事項

OceanBaseデータベースの V4.2.5 BP3、V4.2.5 BP4、V4.2.5 BP5、V4.3.5 BP1、V4.3.5 BP2、V4.3.5 BP3 の各バージョンでは、X86アーキテクチャ環境で実行するための命令セット要件が追加されています。OBServerプロセスは起動前に、現在の環境がAVX命令セットをサポートしているかを確認し、サポートされていない場合は起動を禁止します。

<main id="notice" type='explain'>
  <h4>説明</h4>
  <p>OceanBaseデータベースでは、以下のバージョンからAVX命令セットへの強制的な依存ポリシーが変更されました。<ul><li>V4.3.5バージョンでは、V4.3.5 BP4からAVX命令セットのサポートが必須ではなくなりました。</li><li>V4.2.5バージョンでは、V4.2.5 BP6からAVX命令セットのサポートが必須ではなくなりました。</li><li>V4.4.0バージョンでは、V4.4.1からAVX命令セットのサポートが必須ではなくなりました。</li></ul></p>
</main>