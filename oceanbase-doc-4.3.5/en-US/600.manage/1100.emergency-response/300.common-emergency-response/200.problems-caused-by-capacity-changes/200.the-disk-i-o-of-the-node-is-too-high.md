|description|   |
|-----------|---|
|keywords   |   |
|dir-name   |   |
|dir-name-en|   |
|tenant-type|   |

# Node disk I/O high

There are many reasons that can lead to high disk I/O on an OBServer node. Apart from an increase in traffic, it is usually the result of factors such as migration, replication, and major compaction. The usual approach to handling this issue is to downgrade some tasks with high I/O load. This topic provides information on how to handle this issue in emergency situations.

## Emergency handling procedure

To address high disk I/O on a node, the general approach is to downgrade some high I/O load tasks. The specific steps are categorized as follows:

1. Pause running major compaction tasks.

   If a major compaction is being performed on the node with high disk I/O, pause the major compaction to reduce the I/O load. 

   ```unknow
   ALTER SYSTEM SUSPEND MERGE [ZONE [=] 'zone'];
   ```

   Once the I/O pressure is relieved, you can resume the major compaction.

   ```unknow
   ALTER SYSTEM RESUME MERGE [ZONE [=] 'zone'];
   ```

2. Pause running backup tasks.

   You can use OCP to check if the current node is performing backups. If so, pausing the backups can alleviate the I/O pressure.

3. Pause running data transmission, import, and export tasks.

   You can use the TopSQL and Session Management features in OCP to identify SQL statements that are performing batch writing. If you cannot quickly identify which system the batch task is from, you can use OMS to check whether the current node is performing data transmission tasks. If yes, pause them to alleviate the I/O pressure before resuming those tasks.

   For more information, see [View details of a data migration project](https://en.oceanbase.com/docs/enterprise-oms-doc-en-10000000001395713).

   You can also check whether a node is undergoing data imports through ODC. On the **<UI-TERM key="odc.src.store.helper.page.pages.WorkOrder">Ticket</UI-TERM>** tab of ODC, click **<UI-TERM key="odc.TreeNodeMenu.config.table.Import">Import</UI-TERM>** to view the task list. If there are pending import tasks, you can click **<UI-TERM key="odc.components.RecordPage.Terminate">Abort</UI-TERM>** to terminate the task based on your business needs. Additionally, scheduled tasks in other third-party big data platforms or the DataX component can also be stopped manually at any time.

4. Reduce the number of threads for minor compaction

   A high degree of parallelism (DOP) during minor compaction can increase disk I/O. The `compaction_high_thread_score` parameter specifies the number of threads for minor compaction. You can decrease the value of this parameter to reduce disk I/O usage. The default value is `0`, which indicates that the system adaptively adjusts the number of threads. For 64 CPU cores, it is generally set to 10. You can adjust it according to your specific situation. The modification takes effect immediately without the need for a restart.

   ```sql
   ALTER SYSTEM SET compaction_high_thread_score= 5;
   ```

   After the modification, you can execute the `SHOW PARAMETERS` statement to check whether the modification is successful.

   ```sql
   SHOW PARAMETERS LIKE 'compaction_high_thread_score';
   ```

5. Reduce the network bandwidth of background tasks.

   You can use the following command to reduce the network bandwidth for background tasks:

   ```sql
   ALTER SYSTEM SET sys_bkgd_net_percentage=30;  -- Default value: 60.
   ```

6. Apply throttling and add indexes to high-load SQL queries.

   If a particular high-load SQL query is identified, you can limit the concurrency of the SQL query by adding the `max_concurrent` hint to its execution plan. This achieves throttling the SQL query.

   If a full table scan causes high I/O due to missing indexes, you can add indexes to the relevant tables as needed.

7. Pause running index creation tasks.

   If index creation for a large table is currently in progress in the cluster, you can pause it if necessary and resume the creation after the cluster has been recovered.
