|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|

# Configure global CPU resource isolation for frontend and backend tasks

OceanBase Database supports global CPU resource isolation for frontend and backend tasks in all tenants.

## Overview

In a high-performance computing environment, reasonable resource allocation and isolation are decisive in ensuring system stability and improving efficiency. An effective resource isolation strategy can prevent resource contention and interference between tasks, thereby improving the resource utilization efficiency and overall service quality. At present, OceanBase Database allows you to configure different unit configs for tenants to implement resource isolation between the tenants, and use the `DBMS_RESOURCE_MANAGER` system package to configure resource isolation within a tenant.

Before you enable global CPU resource isolation for frontend and backend tasks on an OBServer node, the OBServer node supports CPU resource isolation between tenants and within a tenant, as shown in the following figure:

![Before global CPU resource isolation is enabled for frontend and backend tasks](https://obportal.s3.ap-southeast-1.amazonaws.com/doc/img/OceanBase-Database-EN/433/global-isolation-before.png)

The isolation hierarchy is shown as a tree structure. The strategies of resource isolation between tenants depend on the unit configs of the tenants. The strategies of resource isolation between tasks within a tenant are determined by the `DBMS_RESOURCE_MANAGER` system package.

After you enable global CPU resource isolation for frontend and backend tasks, the system creates a tenant-level sub-control group (cgroup) based on backend tasks. The backend sub-cgroup can be understood as a virtual tenant. The `MAX_CPU` value of the virtual tenant is the same as the value of the `global_background_cpu_quota` parameter, and the `MIN_CPU` value of the virtual tenant is `1`. The following figure shows the isolation hierarchy after global CPU resource isolation is enabled for frontend and backend tasks.

![After global CPU resource isolation is enabled for frontend and backend tasks](https://obportal.s3.ap-southeast-1.amazonaws.com/doc/img/OceanBase-Database-EN/433/global-isolation-after.png)

After you enable global CPU resource isolation for frontend and backend tasks, the maximum CPU resources available to all backend tasks are limited by the `global_background_cpu_quota` parameter even if you do not specify strategies of resource isolation within a tenant. This prevents backend tasks from affecting frontend tasks.

## Scenarios

We recommend that you enable global CPU resource isolation for frontend and backend tasks in the following scenarios:

* You expect global resource isolation for backend tasks to prevent them from affecting frontend tasks.

* You want to avoid calculation or configuration of complex strategies of resource isolation between tenants and within a tenant, especially when a large number of tenants are deployed.

## Prerequisites

You have configured the cgroup directory and enabled the cgroup feature on the OBServer node. For more information, see [Configure cgroups](100.config-cgroups-of-oracle-mode.md).

## Considerations

* CPU resources can be isolated between tenants. After you enable global CPU resource isolation for frontend and backend tasks, the maximum CPU resources available to backend tasks of each tenant are limited by the `global_background_cpu_quota` parameter and are equal to `min(MAX_CPU of the tenant, global_background_cpu_quota)`.

  <main id="notice" type='notice'>
  <h4>Notice</h4>
  <p>In OceanBase Database V4.2.1 and later, CPU resources for the <code>sys</code> tenant are not limited, to avoid impact on requests from the <code>sys</code> tenant. </p>
  </main>

* CPU resources can be isolated within a tenant. After you enable global CPU resource isolation for frontend and backend tasks, you can use the `DBMS_RESOURCE_MANAGER` system package to configure resource isolation within a tenant. The maximum CPU resources available to each backend task of the tenant are calculated based on the maximum CPU resources available to all backend tasks of the tenant and are equal to `min(global_background_cpu_quota, MAX_CPU of the tenant) * UTILIZATION_LIMIT within the resource group`.

## Enable global CPU resource isolation for frontend and backend tasks

In OceanBase Database, global CPU resource isolation for frontend and backend tasks is controlled by the following two parameters:

* `enable_global_background_resource_isolation`

  This parameter specifies whether to enable global CPU resource isolation for frontend and backend tasks. It is a cluster-level parameter. The default value is `False`, which specifies to disable global CPU resource isolation for frontend and backend tasks. In this case, CPU resources for frontend and backend tasks are isolated within a tenant. The setting takes effect only after you restart the OBServer node.
  
  The value `True` specifies to enable global CPU resource isolation for frontend and backend tasks. In this case, CPU resources for backend tasks are limited independently of tenants.

  For more information about the `enable_global_background_resource_isolation` parameter, see [enable_global_background_resource_isolation](../../../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/6750.enable_global_background_resource_isolation.md).

* `global_background_cpu_quota`

  This parameter specifies the CPU quota available to backend tasks. It is a cluster-level parameter. The default value is `-1`, which specifies that the CPU resources available to backend tasks are limited by the cgroup.

  For more information about the `global_background_cpu_quota` parameter, see [global_background_cpu_quota](../../../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/9850.global_background_cpu_quota.md).

To enable global CPU resource isolation for frontend and backend tasks, perform the following steps:

1. Log in to the `sys` tenant of the cluster as the `root` user.

2. Execute the following statement to enable global CPU resource isolation for frontend and backend tasks:

   ```shell
   obclient> ALTER SYSTEM SET enable_global_background_resource_isolation = True;
   ```

3. Specify the CPU quota available to backend tasks based on your business needs.

   The value must be less than the CPU quota available to the current OBServer node.

   ```shell
   obclient> ALTER SYSTEM SET global_background_cpu_quota = 3;
   ```

4. Restart the OBServer node for the setting to take effect.

   After the setting takes effect, the system creates a `background` directory at the same level as all tenants in the original cgroup directory structure. The `background` directory acts as a cgroup directory for backend tasks. The system also creates cgroup directories corresponding to all tenants in the `background` directory.

## What to do next

Global CPU resource isolation for frontend and backend tasks limits the CPU resources for backend tasks from a global perspective. If you expect finer-grained resource isolation for backend tasks, you can use the `DBMS_RESOURCE_MANAGER` system package to configure resource isolation within a tenant. For more information, see [Configure resource isolation within a tenant](200.resource-isolation-at-user-level-of-oracle-mode.md).

## References

* [Configure cgroups](100.config-cgroups-of-oracle-mode.md)

* [Configure resource isolation within a tenant](200.resource-isolation-at-user-level-of-oracle-mode.md)
