|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# Overview

OceanBase Database allows you to upgrade a cluster by using an upgrade script. The upgrade on the server side has no impact on applications and can be performed without suspending data write or services. OceanBase Database is upgraded zone by zone. During the upgrade, the leader role is switched from one zone to another, and the services running in the zone to be upgraded are migrated to other zones.

This topic describes the upgrade limitations, considerations, and upgrade paths for OceanBase Database.

<main id="notice" type='notice'>
  <h4>Notice</h4>
  <p>OceanBase Database currently does not support upgrading from the V4.2.x series or earlier versions to V4.3.x.</p>
</main>

## Upgrade limitations

Pay attention to the following limitations when you upgrade an OceanBase cluster:

* DDL is disabled in some phases of the upgrade and is automatically enabled after the upgrade.
* Major freezes are disabled during the upgrade between some versions and are automatically enabled after the upgrade.
* Migration, replication, and load balancing are disabled during the upgrade between some versions.
* During the upgrade of a cluster, physical baseline backup and physical restore are not allowed, but log archiving is not interrupted.
* New tenant cannot be created during the upgrade process.

<main id="notice" type='notice'>
  <h4>Notice</h4>
  <p>If the OceanBase cluster is associated with an arbitration service, you must upgrade the arbitration service version before upgrading the OceanBase cluster version. For detailed instructions on upgrading the arbitration service, see <a href="200.arbitration-services-version-upgrade.md">Upgrade the arbitration service</a>.</br>You can use the system tenant view <a href="../../../../../700.reference/700.system-views/300.system-view-of-sys-tenant/200.dictionary-view-of-sys-tenant/15700.o-dba_ob_arbitration_service-of-sys-tenant.md">oceanbase.DBA_OB_ARBITRATION_SERVICE</a> to check whether the current OceanBase cluster is associated with an arbitration service.</p>
</main>

## Considerations

When you upgrade an OceanBase cluster, note that:

* During the upgrade from OceanBase V4.0 to V4.1, log archiving will be suspended.
* If the `ADD SERVER` or `DELETE SERVER` operation needs to be performed during the upgrade, contact OceanBase Technical Support.
* Transition versions cannot be directly upgraded, but need to be upgraded by following the upgrade path.
* The upgrade script must be executed by directly connecting to the observer process where the Root Service resides. It cannot be executed through OceanBase Database Proxy (ODP).
* The following parameters may be modified during the upgrade. Therefore, back up these parameters before the upgrade.

  * [server_permanent_offline_time](../../../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/20300.server_permanent_offline_time.md)
  * [enable_rebalance](../../../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/2800.enable_rebalance.md)
  * [enable_rereplication](../../../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/8000.enable_rereplication.md)

* Starting from V4.3.0 Beta, OceanBase Database no longer supports the `zlib_1.0` compression algorithm. Observe the following rules during an upgrade:

  * The `zlib` compression algorithm is no longer supported for the `log_transport_compress_func` parameter. Use another compression algorithm instead.
  * If the `zlib` compression algorithm is used for any tables, replace it with another supported compression algorithm or disable compression during the upgrade.
  * The `zlib` compression algorithm is not supported for OBKV-Table. You can specify another compression algorithm for OBKV-Table by using the `tableapi_transport_compress_func` parameter.

* In clusters using Arm-based servers or x86-based servers that do not support Advanced Vector Extensions 2.0 (AVX2) instructions, if columnstore tables have been used in OceanBase Database V4.3.0, V4.3.1, or V4.3.2, upgrading to V4.3.3 or later is not supported to prevent potential data correctness risks after the upgrade.

* When you upgrade an OceanBase cluster from a version earlier than 4.3.3 to V4.3.3 or later, the earlier version cannot parse the logs generated by standby tenants in the target version. In this case, an error is returned when the standby tenants attempt to commit logs. However, the logs are not persisted. For more information about data restore, see [Preparations](../../../../600.backup-and-recovery/600.restore-data/100.preparation-before-recovery.md).

* Tenants backed up in a V4.3.2 cluster cannot be restored in a V4.3.3 cluster.
* Instruction set requirements for running in x86 architecture environments were introduced in versions V4.2.5 BP3, V4.2.5 BP4, V4.2.5 BP5, V4.3.5 BP1, V4.3.5 BP2, and V4.3.5 BP3. Before startup, the OBServer process checks whether the current environment supports the AVX instruction set. If AVX is not supported, OBServer will not start. Upgrading older versions of OBServer on x86 machines that lack AVX support to any of these versions will result in startup failure, and rollback will not be possible. Please pay close attention to this issue.

  <main id="notice" type='explain'>
    <h4>Note</h4>
    <p>Starting from the following versions, OceanBase Database no longer requires support for the AVX instruction set: <ul> <li>For V4.3.5, beginning with V4.3.5 BP4.</li> <li>For V4.2.5, beginning with V4.2.5 BP6.</li> <li>For V4.4.0, beginning with V4.4.1.</li> </ul> </p>
  </main>

## Upgrade notes

* Upgrades from any V4.3.x version to V4.3.5 BP5 are supported.
* Upgrades from the V4.2.x series or earlier versions to V4.3.5 BP5 are not supported.
* Starting with V4.3.2, the persistence format for multi-source data has been restructured. During the upgrade process, the system must convert between the old and new formats. For clusters with a large number of partitions, ensure you allocate sufficient time for the upgrade.
* For vector scenarios with continuous writes, index reconstruction is required.
* During the upgrade from V4.3.0, V4.3.1, or V4.3.2 to V4.3.5 BP5, if the tenant leader is located on the old node, the transfer will fail. You must upgrade to V4.3.5 BP5 to perform the transfer.

## Upgrade path diagram

![4257-4355-450](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.5/1500.oceanbase-version-upgrade/5-4257-4355-450-3.png)

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p><ul><li>This upgrade path diagram does not include all OceanBase Database versions. For more details about upgrade paths, refer to the <code>oceanbase_upgrade_dep.yml</code> file, which outlines the complete version upgrade topology for OceanBase.</li><li>After extracting the RPM package for the target version of OceanBase, two directories, <code>home</code> and <code>use</code>, will be created in the directory where the RPM package is stored. The upgrade scripts and the <code>oceanbase_upgrade_dep.yml</code> file are located in the <code>home/admin/oceanbase/etc</code> directory.</li></ul>For detailed information on using the <code>oceanbase_upgrade_dep.yml</code> file to confirm the upgrade path, see the section <b>Step 2: Confirm the Upgrade Process</b> in <a href="300.start-upgrade.md">Upgrade an OceanBase cluster</a>.</p>
</main>

**Explanation of the upgrade path diagram:**

* V4.2.x upgrade path:

  * Versions from V4.0.0.0/V4.1.0.0-V4.1.0.2/V4.2.0.0 can be upgraded to V4.2.1.11, and then further upgraded to V4.2.5.7.
  * V4.2.2-V4.2.4 can be upgraded directly to V4.2.5.7, or first upgraded to V4.2.5.0-V4.2.5.6, and then further upgraded to V4.2.5.7.
  * Barrier versions: V4.2.1.11, V4.2.5.7.

* V4.3.x upgrade path:

  * All V4.3.x versions can be upgraded directly to V4.3.5.5.
  * V4.2.x or earlier versions cannot be upgraded to V4.3.x versions.

* V4.4.x upgrade path:

  * V4.4.0-V4.4.0.1 can be upgraded to V4.4.1.
  * V4.2.x or earlier versions cannot be upgraded to V4.4.1.

* V4.5.x upgrade path:

  * V4.4.0-V4.4.1 can be upgraded to V4.5.0.

## What to do next

[Upgrade an OceanBase cluster](300.start-upgrade.md)

## References

For more information about how to upgrade an OceanBase cluster by using OceanBase Cloud Platform (OCP), see [Upgrade an OceanBase cluster](https://en.oceanbase.com/docs/common-ocp-10000000001187432).
