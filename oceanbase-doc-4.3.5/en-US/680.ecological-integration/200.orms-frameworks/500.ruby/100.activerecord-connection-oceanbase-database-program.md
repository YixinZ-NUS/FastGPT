|description|This topic describes how to connect to OceanBase Database using the Active Record framework of Ruby on Rails. It also explains how to perform fundamental database operations, including table creation, data insertion, and data querying.|
|---|---|
|keywords|Ruby, Ruby on Rails, Active Record, OceanBase, Database connection, ORM framework, Ecological integration|
|dir-name|Active Record connection to OceanBase Database|
|dir-name-en|Connect to OceanBase Database by using Active Record|
|category|Ecological integration|
|type|Framework and driver|
|tenant-type|MySQL mode|

# Connect to OceanBase Database by using Active Record

This topic describes how to build an application by using Active Record and OceanBase Database. It also explains how to perform fundamental database operations, including table creation, data insertion, and data querying.

## Prerequisites

* You have installed Ruby and RubyGems.
* You have installed OceanBase Database and created a MySQL-compatible tenant.

## Procedure

1. Check the versions of Ruby and RubyGems.
2. Install the necessary gems.
3. Obtain the connection information of OceanBase Database.
4. Create and configure the Rails application.
5. Run the sample application.

### Step 1: Check the versions of Ruby and RubyGems

Open the terminal and run the following commands to check the versions of Ruby and RubyGems:

```shell
ruby -v
gem -v
```

### Step 2: Install the necessary gems

1. Install the system dependencies (Ubuntu is used as an example):

    ```shell
    sudo apt-get install ruby-dev mysql-client libmysqlclient-dev
    ```

2. If you are using Ruby Version Manager (RVM):

    ```shell
    rvm requirements
    ```

3. If you are using rbenv:

    ```shell
    rbenv install -l  # View available versions
    rbenv install x.x.x  # Install a specific version
    rbenv global x.x.x  # Set the global version
    ```

4. Use `gem` to install Active Record and mysql2:

    ```shell
    gem install activerecord mysql2
    ```

### Step 3: Obtain the connection information of OceanBase Database

Contact the deployment personnel or administrator of OceanBase Database to obtain the database connection string.

```shell
mysql -h$host -P$port -u$user_name -p$password -D$database_name
```

**Parameter description:**

* `$host`: the IP address for connecting to OceanBase Database.
* `$port`: the port for connecting to OceanBase Database.
* `$database_name`: the name of the database to be accessed.
* `$user_name`: the tenant account.
* `$password`: the password of the account.

### Step 4: Create and configure the Rails application

1. Create a new Rails application:

    ```shell
    rails new activerecord_oceanbase -d mysql
    ```

2. Configure the database connection information:

    Add the following configuration to `config/database.yml`:

    ```yaml
    development:
      adapter: mysql2
      encoding: utf8mb4
      database: your_database
      username: your_username
      password: your_password
      host: your_host
      port: your_port
    ```

3. Create a sample model:

    ```ruby
    # app/models/user.rb
    class User < ActiveRecord::Base
      validates :name, presence: true
    end
    ```

### Step 5: Run the sample application

1. Create a database table:

    ```ruby
    # db/migrate/20230520_create_users.rb
    class CreateUsers < ActiveRecord::Migration[6.1]
      def change
        create_table :users do |t|
          t.string :name
          t.timestamps
        end
      end
    end
    ```

2. Run the migration:

    ```shell
    rails db:migrate
    ```

3. Test in the Rails console:

    ```shell
    rails c
    ```

    ```ruby
    # Create a record
    user = User.create(name: "John Doe")
    ```

    ```ruby
    # Query records
    users = User.all
    ```

## FAQ

1. **Connection error**: If you cannot connect to the database, check the following items:
   * Whether the database address and port are correct.
   * Whether the username and password are correct.
   * Whether the network connection is normal.

2. **Privilege error**: If you encounter a privilege-related error, make sure that the user has sufficient privileges to perform the required operation.

3. **SQL syntax error**: If there is a syntax error in the SQL statement, check whether the syntax is correct.

## Performance optimization suggestions

1. Use batch operation methods of Active Record, such as `insert_all`.
2. Use preloading to avoid N+1 queries.
3. Use cache properly.
4. Optimize database indexes.
