|description|This topic describes how to connect to OceanBase Database by using Rust and perform basic operations such as creating tables, inserting data, and querying data.|
|---|---|
|keywords|Rust, RustMySQL, OceanBase, Database connection, MySQL mode|
|dir-name|MySQL Crate|
|dir-name-en||
|tenant-type|MySQL Mode|

# Connect to OceanBase Database by using Rust

This topic describes how to build an application by using Rust and OceanBase Database. It also covers the use of the application for fundamental database operations such as creating tables, inserting data, and querying data.

## Prerequisites

* You have installed the Rust toolchain (rustup) and Cargo.
* You have installed OceanBase Database V4.2.4 or later, and created a MySQL-compatible tenant.

## Procedure

1. Check the versions of Rust and Cargo.
2. Install the necessary dependencies.
3. Obtain the connection information of OceanBase Database.
4. Modify the database connection information in the `config.rs` file.
5. Run the `main.rs` file.
6. Perform operations in the interactive CLI.

### Step 1: Check the versions of Rust and Cargo

Open the terminal and run the following commands to check the versions of Rust and Cargo:

```shell
rustc --version
cargo --version
```

### Step 2: Create a project and install the necessary dependencies

1. Create a new Rust project:

    ```shell
    cargo new oceanbase_demo
    cd oceanbase_demo
    ```

2. Use `cargo` to install the `mysql` crate:

    ```shell
    cargo add mysql
    ```

3. (Optional) If asynchronous operations are needed, install the `mysql_async` crate:

    ```shell
    cargo add mysql_async
    ```

### Step 3: Obtain the connection information of OceanBase Database

Contact the deployment personnel or administrator of OceanBase Database to obtain the database connection string.

```shell
mysql -h$host -P$port -u$user_name -p$password -D$database_name
```

**Parameter description:**

* `$host`: the IP address for connecting to OceanBase Database. For connection through ODP, use the ODP address. For direct connection, use the IP address of the OBServer node.
* `$port`: the port for connecting to OceanBase Database. For connection through ODP, the default value is 2883. For direct connection, the default value is 2881.
* `$database_name`: the name of the database to be accessed.
* `$user_name`: the tenant account. For connection through ODP, the format is `username@tenant name#cluster name` or `cluster name:tenant name:username`. For direct connection, the format is `username@tenant name`.
* `$password`: the password of the account.

### Step 4: Modify the database connection information in the main.rs file

Modify the database connection information in the `main.rs` file based on the information obtained in Step 3.

1. Go to the `oceanbase_demo` project folder.
2. Add or modify the database connection information in the `main.rs` file.

    **Add the following sample code to the `main.rs` file:**

    ```rust
    use mysql::*;
    use mysql::prelude::*;

    fn main() -> Result<(), Box<dyn std::error::Error>> {
        const OCEANBASE_CONFIG: &str = "mysql://test_user001@mysql001:password@10.10.10.1:2881/test?charset=utf8mb4";
        
        // Establish connection
        println!("Connecting to database...");
        let pool = Pool::new(DB_URL)?;
        let mut conn = pool.get_conn()?;
        println!("Connected successfully!");
        
        // Create table
        conn.query_drop(
            r"CREATE TABLE IF NOT EXISTS users (
                id INT PRIMARY KEY AUTO_INCREMENT,
                name VARCHAR(255) NOT NULL,
                email VARCHAR(255) NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )"
        )?;
        
        println!("Table created successfully!");
        
        // Insert sample data
        conn.exec_batch(
            r"INSERT INTO users (name, email) VALUES (?, ?)",
            vec![
                ("Alice", "alice@example.com"),
                ("Bob", "bob@example.com"),
                ("Charlie", "charlie@example.com"),
            ]
        )?;
        
        println!("Sample data inserted successfully!");
        
        // Query and display the data
        let selected_users = conn
            .query_map(
                "SELECT id, name, email FROM users",
                |(id, name, email)| {
                    User { id, name, email }
                }
            )?;
        
        println!("\nCurrent users in database:");
        for user in selected_users {
            println!("ID: {}, Name: {}, Email: {}", user.id, user.name, user.email);
        }
        
        Ok(())
    }

    // Structure to hold user data
    struct User {
        id: i32,
        name: String,
        email: String,
    }
    ```

### Step 5: Run the main.rs file

1. Go to the `oceanbase_demo` project directory:

    ```shell
    cd oceanbase_demo
    ```

2. Run the following command to start the program:

    ```shell
    cargo run
    ```

    The return result is as follows:

    ```shell
    Connecting to database...
    Connected successfully!
    Table created successfully!
    Sample data inserted successfully!

    Current users in database:
    ID: 1, Name: Alice, Email: alice@example.com
    ID: 2, Name: Bob, Email: bob@example.com
    ID: 3, Name: Charlie, Email: charlie@example.com
    ID: 4, Name: Alice, Email: alice@example.com
    ID: 5, Name: Bob, Email: bob@example.com
    ID: 6, Name: Charlie, Email: charlie@example.com
    ```

## FAQ

1. **Connection error**: If you cannot connect to the database, check whether the following information is correct:
   * Database address and port
   * Username and password
   * Network connection

2. **Privilege error**: If you encounter a privilege-related error, make sure that the user has sufficient privileges to perform the required operation.

3. **SQL syntax error**: If there is a syntax error in the SQL statement, check whether the syntax is correct.

4. **Data type error**: If the data type of the inserted data does not match that defined in the table, make sure that the data type is correct.

## Performance optimization suggestions

1. Manage database connections by using a connection pool.
2. Use asynchronous operations to improve concurrency performance.
3. Use batch processing to improve data insertion efficiency.
4. Set a reasonable database connection timeout.