| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   |                 |
|machine-translation||

# MIGRATE REPLICA

## Purpose

You can use this statement to migrate a replica of a log stream.

## Limitations and considerations

* You can migrate replicas only within the same zone.
* The destination OBServer node must have an available unit that does not contain replicas of the log stream.
* If the current log stream already has seven full-featured replicas, you cannot execute the migration statement.
* This statement migrates only one replica at a time. To migrate multiple replicas, you must execute this statement multiple times.
* For the same log stream of a tenant, except for replica migration tasks that can be executed in parallel, other disaster recovery tasks (including adding replicas, deleting replicas, converting replica types, and modifying the quorum size of the log stream) can only be executed one at a time.

    <main id="notice" type='explain'>
      <h4>Note</h4>
      <p>You can query ongoing replica tasks from the <code>CDB_OB_LS_REPLICA_TASKS</code> view in the `sys` tenant or from the <code>DBA_OB_LS_REPLICA_TASKS</code> view in a user tenant. </p>
    </main>

## Required privileges

To execute this statement, you must have the `ALTER SYSTEM` privilege. For more information about privileges in OceanBase Database, see [Privilege types in MySQL mode](../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md) and [Privilege types in Oracle mode](../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/300.permission-of-oracle-mode/000.permission-classification-of-oracle-mode.md).

## Syntax

```sql
ALTER SYSTEM MIGRATE REPLICA
    LS [=] ls_id
    SOURCE [=] 'svr_ip:svr_port'
    DESTINATION [=] 'destination_addr'
    [DATA_SOURCE [=] 'data_source']
    [TENANT [=] 'tenant_name'];
```

## Parameters

|     **Parameter**      |             **Description**               |
|-------------------|------------------------------------|
| ls_id             | The ID of the log stream for which you want to migrate the replica. |
| svr_ip:svr_port   | The IP address and port number of the OBServer node from which you want to migrate the replica, for example, `xxx.xx.xxx.001:2882`. |
| destination_addr  | The IP address and port number of the OBServer node to which you want to migrate the replica. The format is `svr_ip:svr_port`, for example, `xxx.xx.xxx.002:2882`. |
| data_source       | Optional. The data source of the replica that you want to migrate. You can select any other replica of the log stream as the data source based on your business needs. The format is `svr_ip:svr_port`, for example, `xxx.xx.xxx.001:2882`. If this parameter is not explicitly specified, the system automatically selects an available data source. <main id="notice" type='notice'><h4>Notice</h4><p>If the specified data source is unavailable, the system will return an error. </p></main>|
| tenant_name       | Optional. The name of the target tenant. If this parameter is not specified, the name of the current tenant is used. <main id="notice" type='notice'><h4>Notice</h4><p>You can specify another tenant in the `sys` tenant and specify only the current tenant in a user tenant. You cannot use the <code>ALL</code>, <code>ALL_USER</code>, or <code>ALL_META</code> option in this statement to specify all tenants, all user tenants, or all meta tenants. </p></main>|

## Examples

Execute the following statement in the `sys` tenant to migrate the log stream replica with the ID of `1002` on `xxx.xxx.xxx.001:2882` in the `mysql001` tenant to `xxx.xxx.xxx.002:2882`.

```sql
ALTER SYSTEM MIGRATE REPLICA
    LS = 1002
    SOURCE = 'xxx.xxx.xxx.001:2882'
    DESTINATION = 'xxx.xxx.xxx.002:2882'
    TENANT = 'mysql001';
```

For more information about how to migrate a replica, see [Migrate replicas](../../../../../600.manage/300.replica-management/200.replica-distribution/200.locality-common-operations/700.unit-migration.md).

## References

* For information about how to add a replica, see [ADD REPLICA](110.add-replica-in-system-tenants.md).
* For information about how to drop a replica, see [REMOVE REPLICA](3130.remove-replica.md).
* For information about how to modify the type of a replica, see [MODIFY REPLICA](1450.modify-replica.md).
* For information about how to modify the `PAXOS_REPLICA_NUM` parameter for a replica, see [MODIFY PAXOS_REPLICA_NUM](1440.modify-paxos-replica-num.md).
* For information about how to cancel a replica task, see [CANCEL REPLICA TASK](1120.cancel-replica-task.md).
