|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|
|machine-translation||

# GV$OB_TABLET_COMPACTION_HISTORY

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p>This view is introduced in V4.0.0. </p>
</main>

## Purpose

The `GV$OB_TABLET_COMPACTION_HISTORY` view displays the historical information about tablet-level compactions.

## Columns

| Column | Type | Nullable? | Description |
| --- | --- | --- | --- |
|SVR_IP            |varchar(46)   |NO   |Server IP address.    |
|SVR_PORT          |bigint(20)    |NO   |Server port number.    |
|TENANT_ID         |bigint(20)    |NO   |Tenant ID.    |
|LS_ID             |bigint(20)    |NO   |Log stream ID.    |
|TABLET_ID         |bigint(20)    |NO   |Data tablet ID.    |
|TYPE              |varchar(64)   |NO   | Compaction type. Valid values: <ul><li>`MDS_TABLE_MERGE`: persists the system metadata to disk in the format of an SSTable. </li> <li>`MAJOR_MERGE`: major compaction. </li> <li>`MEDIUM_MERGE`: medium compaction. </li> <li>`MINI_MERGE`: mini compaction. It converts MemTables into mini SSTables. </li> <li>`MINOR_MERGE`: minor compaction. It combines multiple mini SSTables into one or combines multiple minor SSTables and one mini SSTable into one. </li> <li>`META_MAJOR_MERGE`: a special compaction type that synthesizes data before a specified point in time into one meta major SSTable. Its data format is the same as that of a major SSTable, and it does not contain multi-version data or uncommitted transaction data. </li></ul>   |
|COMPACTION_SCN    |bigint(20) unsigned    |NO   |Compaction version.    |
|START_TIME        |timestamp(6)  |NO   |Start time.    |
|FINISH_TIME       |timestamp(6)  |NO   |End time.    |
|TASK_ID           |varchar(64)   |NO   |Task execution trace.    |
|OCCUPY_SIZE       |bigint(20)    |NO   |Data volume.    |
|MACRO_BLOCK_COUNT                |bigint(20)    |NO   |Number of macroblocks.    |
|MULTIPLEXED_MACRO_BLOCK_COUNT    |bigint(20)    |NO   |Number of reused macroblocks.    |
|NEW_MICRO_COUNT_IN_NEW_MACRO     |bigint(20)    |NO   |Number of new microblocks in a new macroblock.    |
|MULTIPLEXED_MICRO_COUNT_IN_NEW_MACRO    |bigint(20)   |NO   |Number of reused microblocks in a new macroblock.    |
|TOTAL_ROW_COUNT                  |bigint(20)    |NO   |Total number of rows.    |
|INCREMENTAL_ROW_COUNT            |bigint(20)    |NO   |Number of new output rows.    |
|COMPRESSION_RATIO                |double        |NO   |Compression ratio of new data = compressed size of new macroblocks / size of new macroblocks before compression.    |
|NEW_FLUSH_DATA_RATE              |bigint(20)    |NO   |Output speed of new data, in KB/s.    |
|PROGRESSIVE_COMPACTION_ROUND     |bigint(20)    |NO   |Current round of progressive compaction. The value is -1 for full compaction.    |
|PROGRESSIVE_COMPACTION_NUM       |bigint(20)    |NO   |Total number of rounds of progressive compaction.    |
|PARALLEL_DEGREE                  |bigint(20)    |NO   |Degree of parallelism.    |
|PARALLEL_INFO                    |varchar(512)  |NO   |Parallel task information. It displays the statistics of the minimum, maximum, and average values of the data scanned, running time, and data output for parallel tasks.    |
|PARTICIPANT_TABLE                |varchar(512)  |NO   |Tables that participate in the compaction.    |
|MACRO_ID_LIST                    |varchar(256)  |NO   |List of macroblocks. The list is not displayed if it is too long.    |
|COMMENTS                         |varchar(1024) |NO   |Comments. It displays the problems encountered before scheduling or during execution of the task.    |
| START_CG_ID                     | bigint(20)   | NO   |  Start ID of the Column Group<main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.0. </p></main>    |
| END_CG_ID                       | bigint(20)   | NO   |  End ID of the Column Group <main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.0. </p></main>   |
| KEPT_SNAPSHOT                   | varchar(128) | NO   |  Multi-version timestamp retention information of this compaction<main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.0. </p></main>    |
| MERGE_LEVEL                     | varchar(64)  | NO   |  Whether major compaction and microblock reuse are adopted<main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.0. </p></main>    |
| EXEC_MODE                       | varchar(64)  | NO   | Mode of the merge trace. Valid values: <ul><li>`EXEC_MODE_LOCAL`: local mode. Macroblocks are output to the local disk. </li> <li>`EXEC_MODE_VALIDATE`: shared mode. Only checksums are calculated. Macroblocks are not output. This mode is currently not supported. </li> <li>`EXEC_MODE_OUTPUT`: shared mode. Macroblocks are output to shared storage. This mode is currently not supported. </li></ul> <main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.3. </p></main> |
| IS_FULL_MERGE                   | varchar(5)   | NO   | Whether it is a full compaction.<main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.3. </p></main> |
| IO_COST_TIME_PERCENTAGE         | bigint(20)   | NO   | The percentage of IO time in the compaction time. <main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.3. </p></main> |
| MERGE_REASON                    | varchar(32)  | NO   | Compaction trigger cause. Valid values: <ul><li>`LOAD_DATA_SCENE`: load data scenario. </li> <li>`TOMBSTONE_SCENE`: tombstone scenario. </li> <li>`INEFFICIENT_QUERY`: inefficient query scenario. </li> <li>`FREQUENT_WRITE`: frequent write scenario. </li> <li>`TENANT_MAJOR`: tenant major compaction. </li> <li>`USER_REQUEST`: user-initiated compaction. </li> <li>`REBUILD_COLUMN_GROUP`: row-to-column scenario. </li></ul> <main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.3. </p></main> |
| BASE_MAJOR_STATUS               | varchar(64)  | NO   | The type of the major SSTable before the compaction. Valid values: <ul><li>`COL_WITH_ALL`: defined as a hybrid row-column table, and the baseline data is stored in both row and columnar formats. </li> <li>`COL_ONLY_ALL`: defined as a hybrid row-column table, but the baseline data is stored in row-based format only. </li> <li>`PURE_COL`: defined as a columnar table, and the baseline data is stored in columnar format only. </li> <li>`PURE_COL_ONLY_ALL`: defined as a columnar table, but the baseline data is stored in row-based format only. </li> <li>`ROW_STORE_MAJOR`: a row-based table. </li></ul> <main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.3. </p></main>|
| CO_MERGE_TYPE                   | varchar(64)  | NO   | Columnar compaction type. Valid values: <ul><li>`BUILD_COLUMN_STORE_MERGE`: the data is merged into a columnar table. </li> <li>`BUILD_ROW_STORE_MERGE`: the data is merged into a row-based table. </li> <li>`USE_RS_BUILD_SCHEMA_MATCH_MERGE`: the data is merged into a table of the same schema as the baseline table. </li></ul> <main id="notice" type='explain'><h4>Note</h4><p>This field is introduced in V4.3.3. </p></main> |
| MDS_FILTER_INFO                 | varchar(1024) | NO  | This view displays the MDS filter information used for major compaction. <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.3.5 and takes effect starting from V4.3.5 BP2.</p></main> |
| EXECUTE_TIME                    | bigint(20)     | NO | The time consumed by the major compaction task in CPU, in milliseconds. <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.3.5 BP3.</p></main> |

## Sample query

The following example shows how to query the historical information about tablet-level compactions on all OBServer nodes for a user tenant.

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.GV$OB_TABLET_COMPACTION_HISTORY LIMIT 1\G
```

The query result is as follows:

```shell
*************************** 1. row ***************************
                              SVR_IP: 172.xx.xxx.xxx
                            SVR_PORT: 2882
                           TENANT_ID: 1002
                               LS_ID: 1
                           TABLET_ID: 60379
                                TYPE: MAJOR_MERGE
                      COMPACTION_SCN: 1750701601908220000
                          START_TIME: 2025-06-24 02:02:58.710793
                         FINISH_TIME: 2025-06-24 02:02:58.723141
                             TASK_ID: YB42AC1E87D9-00063837DA77BB6A-0-0
                         OCCUPY_SIZE: 0
                   MACRO_BLOCK_COUNT: 0
       MULTIPLEXED_MACRO_BLOCK_COUNT: 0
        NEW_MICRO_COUNT_IN_NEW_MACRO: 0
MULTIPLEXED_MICRO_COUNT_IN_NEW_MACRO: 0
                     TOTAL_ROW_COUNT: 0
               INCREMENTAL_ROW_COUNT: 0
                   COMPRESSION_RATIO: 1
                 NEW_FLUSH_DATA_RATE: 0
        PROGRESSIVE_COMPACTION_ROUND: 1
          PROGRESSIVE_COMPACTION_NUM: 0
                     PARALLEL_DEGREE: 1
                       PARALLEL_INFO: -
                   PARTICIPANT_TABLE: table_cnt=1,[MAJOR]snapshot_version=1;
                       MACRO_ID_LIST:
                            COMMENTS:
                         START_CG_ID: 0
                           END_CG_ID: 0
                       KEPT_SNAPSHOT: {type:"LS_RESERVED", snapshot:1750699962045772000}
                         MERGE_LEVEL: MICRO_BLOCK_LEVEL
                           EXEC_MODE: EXEC_MODE_LOCAL
                       IS_FULL_MERGE: FALSE
             IO_COST_TIME_PERCENTAGE: 0
                        MERGE_REASON: TENANT_MAJOR
                   BASE_MAJOR_STATUS:
                       CO_MERGE_TYPE:
                     MDS_FILTER_INFO:
                        EXECUTE_TIME: 747
1 row in set
```

## References

* [V$OB_TABLET_COMPACTION_HISTORY](34800.v-ob_tablet_compaction_history-of-mysql-mode.md)

* [GV$OB_TABLET_COMPACTION_PROGRESS](4300.gv-ob_tablet_compaction_progress-of-mysql-mode.md)

* [View minor compaction information](../../../200.system-management/500.manage-data-storage/100.dump-management/400.view-dump-information.md)

* [View major compaction information](../../../200.system-management/500.manage-data-storage/200.merge-management/500.view-merge-process.md)