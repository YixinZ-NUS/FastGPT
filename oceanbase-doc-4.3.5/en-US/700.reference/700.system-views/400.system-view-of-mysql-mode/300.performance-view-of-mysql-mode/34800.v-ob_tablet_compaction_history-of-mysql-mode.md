|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|
|machine-translation||

# V$OB_TABLET_COMPACTION_HISTORY

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p>This view is introduced in V4.0.0. </p>
</main>

## Purpose

The `V$OB_TABLET_COMPACTION_HISTORY` view displays the historical information about tablet-level compactions.

## Columns

| Column | Type | Nullable? | Description |
| --- | --- | --- | --- |
|SVR_IP    |varchar(46)    |NO   |Server IP address.    |
|SVR_PORT    |bigint(20)    |NO   |Server port number.    |
|TENANT_ID    |bigint(20)    |NO   |Tenant ID.    |
|LS_ID    |bigint(20)    |NO   |Log stream ID.    |
|TABLET_ID    |bigint(20)    |NO   |Data tablet ID.    |
|TYPE    |varchar(64)    |NO   | Compaction type. Valid values: <ul><li>`MDS_TABLE_MERGE`: persists the system metadata to the disk in the format of an SSTable. </li> <li>`MAJOR_MERGE`: major compaction. </li> <li>`MEDIUM_MERGE`: medium compaction. </li> <li>`MINI_MERGE`: mini compaction. It converts the MemTables into mini SSTables. </li> <li>`MINOR_MERGE`: minor compaction. It combines multiple mini SSTables into a new one or combines multiple minor SSTables into a new one. </li> <li>`META_MAJOR_MERGE`: a special compaction type that combines data before a specified point in time into one meta major SSTable. Its data format is the same as that of a major SSTable, but it does not contain multi-version data or uncommitted transaction data. </li></ul>    |
|COMPACTION_SCN    |bigint(20) unsigned    |NO   |The version information of the compaction.    |
|START_TIME    |timestamp(6)    |NO   |Start time.    |
|FINISH_TIME    |timestamp(6)    |NO   |End time.    |
|TASK_ID    |varchar(64)    |NO   |Task execution trace.    |
|OCCUPY_SIZE    |bigint(20)    |NO   |Data volume.    |
|MACRO_BLOCK_COUNT    |bigint(20)    |NO   |Number of macroblocks.    |
|MULTIPLEXED_MACRO_BLOCK_COUNT    |bigint(20)    |NO   |Number of reused macroblocks.    |
|NEW_MICRO_COUNT_IN_NEW_MACRO    |bigint(20)    |NO   |Number of new microblocks in the new macroblock.    |
|MULTIPLEXED_MICRO_COUNT_IN_NEW_MACRO    |bigint(20)    |NO   |Number of reused microblocks in the new macroblock.    |
|TOTAL_ROW_COUNT    |bigint(20)    |NO   |Total number of rows.    |
|INCREMENTAL_ROW_COUNT    |bigint(20)    |NO   |Number of new rows output.    |
|COMPRESSION_RATIO    |double    |NO   |Compression ratio of new data = compressed size of new macroblocks / original size of new macroblocks.    |
|NEW_FLUSH_DATA_RATE    |bigint(20)    |NO   |Output speed of new data, in KB/s.    |
|PROGRESSIVE_COMPACTION_ROUND    |bigint(20)    |NO   |Current round of progressive compaction. If the compaction is a full compaction, the value of this column is -1.    |
|PROGRESSIVE_COMPACTION_NUM    |bigint(20)    |NO   |Total number of rounds of progressive compaction.    |
|PARALLEL_DEGREE    |bigint(20)    |NO   |Degree of parallelism.    |
|PARALLEL_INFO    |varchar(512)    |NO   |Parallel task information. This column displays the statistics of the minimum, maximum, and average values of the data scanned, running time, and data output in the parallel task.    |
|PARTICIPANT_TABLE    |varchar(512)    |NO   |Tables that participate in this compaction.    |
|MACRO_ID_LIST    |varchar(256)    |NO   |Output macroblock list. If the macroblock list is too long, it is not displayed.    |
|COMMENTS    |varchar(256)    |NO   |Records the history of failed compactions and the time consumption of this compaction.    |
| START_CG_ID                     | bigint(20)   | NO   |  The start ID of the column group. This column is introduced in V4.3.0.    |
| END_CG_ID                       | bigint(20)   | NO   |  The end ID of the column group. This column is introduced in V4.3.0.    |
| KEPT_SNAPSHOT                   | varchar(128) | NO   |  The multi-version timestamp retained by this compaction. This column is introduced in V4.3.0.    |
| MERGE_LEVEL                     | varchar(64)  | NO   |  Indicates whether major compaction and microblock reuse are used in this compaction. This column is introduced in V4.3.0.    |
| EXEC_MODE                       | varchar(64)  | NO   | The execution mode of this compaction. Valid values: <ul><li>`EXEC_MODE_LOCAL`: local mode. Output macroblocks to the local disk. </li> <li>`EXEC_MODE_VALIDATE`: shared mode. Only calculate the checksum. Do not output macroblocks. This mode is not supported in the current version. </li> <li>`EXEC_MODE_OUTPUT`: shared mode. Output macroblocks to the shared storage. This mode is not supported in the current version. </li></ul> This column is introduced in V4.3.3. |
| IS_FULL_MERGE                   | varchar(5)   | NO   | Whether the compaction is a full compaction. This column is introduced in V4.3.3. |
| IO_COST_TIME_PERCENTAGE         | bigint(20)   | NO   | The percentage of I/O time in the compaction time. This column is introduced in V4.3.3. |
| MERGE_REASON                    | varchar(32)  | NO   | The reason for initiating the compaction. Valid values: <ul><li>`LOAD_DATA_SCENE`: data loading scenario. </li> <li>`TOMBSTONE_SCENE`: tombstone scenario. </li> <li>`INEFFICIENT_QUERY`: inefficient query scenario. </li> <li>`FREQUENT_WRITE`: frequent write scenario. </li> <li>`TENANT_MAJOR`: tenant-level compaction. </li> <li>`USER_REQUEST`: user-initiated compaction. </li> <li>`REBUILD_COLUMN_GROUP`: row-to-column scenario. </li></ul> This column is introduced in V4.3.3. |
| BASE_MAJOR_STATUS               | varchar(64)  | NO   | The type of the major SSTable before the compaction. Valid values: <ul><li>`COL_WITH_ALL`: defined as a hybrid row-column store table, and the baseline data is stored in both row and columnar formats. </li> <li>`COL_ONLY_ALL`: defined as a hybrid row-column store table, but the baseline data is stored in the row-based format only. </li> <li>`PURE_COL`: defined as a columnar store table, and the baseline data is stored in the columnar format. </li> <li>`PURE_COL_ONLY_ALL`: defined as a columnar store table, but the baseline data is stored in the row-based format only. </li> <li>`ROW_STORE_MAJOR`: a row-based store table. </li></ul> This column is introduced in V4.3.3. |
| CO_MERGE_TYPE                   | varchar(64)  | NO   | The columnar store merge type. Valid values: <ul><li>`BUILD_COLUMN_STORE_MERGE`: the data is merged into a columnar store. </li> <li>`BUILD_ROW_STORE_MERGE`: the data is merged into a row-based store. </li> <li>`USE_RS_BUILD_SCHEMA_MATCH_MERGE`: the data is merged into a store of the same schema as the source data. </li></ul> This column is introduced in V4.3.3. |
| MDS_FILTER_INFO                 | varchar(1024) | NO  | This view displays the MDS filter information used for major compaction. <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.3.5 and takes effect starting from V4.3.5 BP2.</p></main> |
| EXECUTE_TIME                    | bigint(20)     | NO | The time consumed by the compaction task for CPU, in milliseconds.  <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.3.5 BP3.</p></main> |

## Sample query

A user tenant queries the history of tablet-level compactions on this OBServer node.

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.V$OB_TABLET_COMPACTION_HISTORY LIMIT 1\G
```

The query result is as follows:

```shell
*************************** 1. row ***************************
                              SVR_IP: 172.xx.xxx.xxx
                            SVR_PORT: 2882
                           TENANT_ID: 1002
                               LS_ID: 1
                           TABLET_ID: 60379
                                TYPE: MAJOR_MERGE
                      COMPACTION_SCN: 1750701601908220000
                          START_TIME: 2025-06-24 02:02:58.710793
                         FINISH_TIME: 2025-06-24 02:02:58.723141
                             TASK_ID: YB42AC1E87D9-00063837DA77BB6A-0-0
                         OCCUPY_SIZE: 0
                   MACRO_BLOCK_COUNT: 0
       MULTIPLEXED_MACRO_BLOCK_COUNT: 0
        NEW_MICRO_COUNT_IN_NEW_MACRO: 0
MULTIPLEXED_MICRO_COUNT_IN_NEW_MACRO: 0
                     TOTAL_ROW_COUNT: 0
               INCREMENTAL_ROW_COUNT: 0
                   COMPRESSION_RATIO: 1
                 NEW_FLUSH_DATA_RATE: 0
        PROGRESSIVE_COMPACTION_ROUND: 1
          PROGRESSIVE_COMPACTION_NUM: 0
                     PARALLEL_DEGREE: 1
                       PARALLEL_INFO: -
                   PARTICIPANT_TABLE: table_cnt=1,[MAJOR]snapshot_version=1;
                       MACRO_ID_LIST:
                            COMMENTS:
                         START_CG_ID: 0
                           END_CG_ID: 0
                       KEPT_SNAPSHOT: {type:"LS_RESERVED", snapshot:1750699962045772000}
                         MERGE_LEVEL: MICRO_BLOCK_LEVEL
                           EXEC_MODE: EXEC_MODE_LOCAL
                       IS_FULL_MERGE: FALSE
             IO_COST_TIME_PERCENTAGE: 0
                        MERGE_REASON: TENANT_MAJOR
                   BASE_MAJOR_STATUS:
                       CO_MERGE_TYPE:
                     MDS_FILTER_INFO:
                        EXECUTE_TIME: 747
1 row in set
```

## References

* [GV$OB_TABLET_COMPACTION_HISTORY](4200.gv-ob_tablet_compaction_history-of-mysql-mode.md)

* [V$OB_TABLET_COMPACTION_PROGRESS](34900.v-ob_tablet_compaction_progress-of-mysql-mode.md)

* [View minor compaction information](../../../200.system-management/500.manage-data-storage/100.dump-management/400.view-dump-information.md)

* [View major compaction information](../../../200.system-management/500.manage-data-storage/200.merge-management/500.view-merge-process.md)