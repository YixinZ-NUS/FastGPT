|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# V$OB_SQL_AUDIT

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p>This view is introduced in V4.0.0. </p>
</main>

## Purpose

The `V$OB_SQL_AUDIT` view displays statistics such as the source and execution status of each SQL request on the current OBServer node. This view is tenant-specific. Tenants other than the sys tenant cannot query across tenants.

## Columns

|          Column           |      Type      | Nullable? | Description |
|-------------------------|---------------------|----------------|---------------|
| SVR_IP                  | varchar(46)         | NO             | IP address                  |
| SVR_PORT                | bigint(20)          | NO             | Port number                    |
| REQUEST_ID              | bigint(20)          | NO             | ID of the request               |
| SQL_EXEC_ID             | bigint(20)          | NO             | ID of the current execution               |
| TRACE_ID                | varchar(128)        | NO             | Trace ID of the statement          |
| SID                     | bigint(20) unsigned | NO             | For V4.3.x:<ul><li>Before V4.3.5 BP2:<br>In all connection modes (direct mode/ODP mode), this field indicates the server session ID.</li><li>V4.3.5 BP2 and later versions:<ul><li>In direct mode:<br>This field indicates the server session ID.</li><li>In ODP mode:<ul><li>When the ODP parameter <code>client_session_id_version = 2</code> is set, this field indicates the client session ID.</li><li>When <code>client_session_id_version = 1</code>, this field indicates the server session ID.</li></ul></ul></li></ul></li></ul>          |
| CLIENT_IP               | varchar(46)         | NO             | <li> IP address of the ODP that forwards the request when the client connects to the OBServer node through ODP.   <li> IP address of the client when the client directly connects to the OBServer node.                      |
| CLIENT_PORT             | bigint(20)          | NO             | Port number of the client that sends the request            |
| TENANT_ID               | bigint(20)          | NO             | ID of the tenant that sends the request             |
| TENANT_NAME             | varchar(64)         | NO             | Name of the tenant that sends the request              |
| EFFECTIVE_TENANT_ID     | bigint(20)          | NO             | ID of the tenant                  |
| USER_ID                 | bigint(20)          | NO             | ID of the user that sends the request             |
| USER_NAME               | varchar(64)         | NO             | Name of the user that sends the request              |
| USER_GROUP              | bigint(20)          | NO             | ID of the resource group to which the user belongs             |
| USER_CLIENT_IP          | varchar(46)         | NO             | IP address of the client that sends the request           |
| DB_ID                   | bigint(20) unsigned | NO             | ID of the database                 |
| DB_NAME                 | varchar(128)        | NO             | Name of the database                  |
| SQL_ID                  | varchar(32)         | NO             | ID of the SQL statement  <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, starting from V4.3.2, for PL requests generated by the CALL statement and anonymous block, the value of this field is the actual generated MD5 code.  <li>For V4.2.x, starting from V4.2.3, for PL requests generated by the CALL statement and anonymous block, the value of this field is the actual generated MD5 code.  </li></ul></main>  |
| QUERY_SQL               | longtext            | NO             | Actual SQL statement             |
| PLAN_ID                 | bigint(20)          | NO             | ID of the execution plan               |
| AFFECTED_ROWS           | bigint(20)          | NO             | Number of affected rows                   |
| RETURN_ROWS             | bigint(20)          | NO             | Number of returned rows                   |
| PARTITION_CNT           | bigint(20)          | NO             | Number of partitions involved in the request              |
| RET_CODE                | bigint(20)          | NO             | Return code of the execution result: <li> 0: indicates no error and successful execution of the statement   <li> Other return codes: indicate OceanBase error codes. For more information, see [Error codes](../../../900.error-code/600.error-code-of-mysql-mode/100.use-error-information-of-mysql-mode.md)                             |
| QC_ID                   | bigint(20) unsigned | NO             | ID of the scheduler in parallel execution scenarios         |
| DFO_ID                  | bigint(20)          | NO             | ID of the current subplan in parallel execution scenarios    |
| SQC_ID                  | bigint(20)          | NO             | ID of the local coordinator in parallel execution scenarios       |
| WORKER_ID               | bigint(20)          | NO             | ID of the worker thread in parallel execution scenarios        |
| EVENT                   | varchar(64)         | NO             | Name of the longest waiting event               |
| P1TEXT                  | varchar(64)         | NO             | Parameter 1 of the waiting event               |
| P1                      | bigint(20) unsigned | NO             | Value of parameter 1 of the waiting event            |
| P2TEXT                  | varchar(64)         | NO             | Parameter 2 of the waiting event               |
| P2                      | bigint(20) unsigned | NO             | Value of parameter 2 of the waiting event            |
| P3TEXT                  | varchar(64)         | NO             | Parameter 3 of the waiting event               |
| P3                      | bigint(20) unsigned | NO             | Value of parameter 3 of the waiting event            |
| LEVEL                   | bigint(20)          | NO             | Level of the waiting event                |
| WAIT_CLASS_ID           | bigint(20)          | NO             | ID of the Class to which the waiting event belongs       |
| WAIT_CLASS#             | bigint(20)          | NO             | Index of the Class to which the waiting event belongs      |
| WAIT_CLASS              | varchar(64)         | NO             | Name of the Class to which the waiting event belongs       |
| STATE                   | varchar(19)         | NO             | Status of the waiting event                |
| WAIT_TIME_MICRO         | bigint(20)          | NO             | Waiting time of the waiting event, in microseconds      |
| TOTAL_WAIT_TIME_MICRO   | bigint(20)          | NO             | Total waiting time of all waiting events, in microseconds     |
| TOTAL_WAITS             | bigint(20)          | NO             | Total number of waiting events             |
| RPC_COUNT               | bigint(20)          | NO             | Number of RPCs sent             |
| PLAN_TYPE               | bigint(20)          | NO             | Type of the execution plan: <li> local   <li> remote   <li> distribute                |
| IS_INNER_SQL            | tinyint(4)          | NO             | Whether the request is an internal SQL request           |
| IS_EXECUTOR_RPC         | tinyint(4)          | NO             | Whether the current request is an RPC request         |
| IS_HIT_PLAN             | tinyint(4)          | NO             | Whether the plan is hit in plan_cache        |
| REQUEST_TIME            | bigint(20)          | NO             | Start time of execution, in microseconds                |
| ELAPSED_TIME            | bigint(20)          | NO             | Total time consumed from receiving the request to the end of execution, in microseconds      |
| NET_TIME                | bigint(20)          | NO             | Time from sending the RPC to receiving the request, in microseconds       |
| NET_WAIT_TIME           | bigint(20)          | NO             | Time from receiving the request to entering the queue, in microseconds          |
| QUEUE_TIME              | bigint(20)          | NO             | Waiting time of the request in the queue, in microseconds             |
| DECODE_TIME             | bigint(20)          | NO             | Time to decode the request after it is dequeued, in microseconds        |
| GET_PLAN_TIME           | bigint(20)          | NO             | Time from starting to process the request to obtaining the execution plan, in microseconds    |
| EXECUTE_TIME            | bigint(20)          | NO             | Time consumed for executing the plan, in microseconds             |
| APPLICATION_WAIT_TIME   | bigint(20) unsigned | NO             | Total time of all application events, in microseconds |
| CONCURRENCY_WAIT_TIME   | bigint(20) unsigned | NO             | Total time of all concurrency events, in microseconds |
| USER_IO_WAIT_TIME       | bigint(20) unsigned | NO             | Total time of all user_io events, in microseconds     |
| SCHEDULE_TIME           | bigint(20) unsigned | NO             | Total time of all schedule events, in microseconds     |
| ROW_CACHE_HIT           | bigint(20)          | NO             | Number of row cache hits                |
| BLOOM_FILTER_CACHE_HIT  | bigint(20)          | NO             | Number of Bloom filter cache hits    |
| BLOCK_CACHE_HIT         | bigint(20)          | NO             | Number of block cache hits                |
| DISK_READS              | bigint(20)          | NO             | Number of physical reads                  |
| RETRY_CNT               | bigint(20)          | NO             | Number of retries                   |
| TABLE_SCAN              | tinyint(4)          | NO             | Whether the request contains a full table scan           |
| CONSISTENCY_LEVEL       | bigint(20)          | NO             | Consistency level, which can be one of the following values:<ul><li>`-1`: invalid</li> <li>`1`: specifies to read data stored in SSTable</li><li>`2`: weakly consistent read</li><li>`3`: strongly consistent read</li></ul>                  |
| MEMSTORE_READ_ROW_COUNT | bigint(20)          | NO             | Number of rows read from MemStore         |
| SSSTORE_READ_ROW_COUNT  | bigint(20)          | NO             | Number of rows read from SSStore         |
| DATA_BLOCK_READ_CNT  | bigint(20)          | NO             | Number of data microblocks accessed         |
| DATA_BLOCK_CACHE_HIT  | bigint(20)          | NO             | Number of data microblocks hit in cache         |
| INDEX_BLOCK_READ_CNT  | bigint(20)          | NO             | Number of intermediate layer microblocks accessed         |
| INDEX_BLOCK_CACHE_HIT  | bigint(20)          | NO             | Number of intermediate layer microblocks hit in cache         |
| BLOCKSCAN_BLOCK_CNT  | bigint(20)          | NO             | Number of data microblocks scanned unilaterally         |
| BLOCKSCAN_ROW_CNT  | bigint(20)          | NO             | Number of data rows scanned unilaterally         |
| PUSHDOWN_STORAGE_FILTER_ROW_CNT  | bigint(20)          | NO             | Number of rows filtered by the storage filter         |
| REQUEST_MEMORY_USED     | bigint(20)          | NO             | Memory consumed by the request               |
| EXPECTED_WORKER_COUNT   | bigint(20)          | NO             | Expected number of worker threads for the request             |
| USED_WORKER_COUNT       | bigint(20)          | NO             | Actual number of worker threads used by the request           |
| SCHED_INFO              | varchar(16384)      | NO             | Scheduling information of the request                |
| FUSE_ROW_CACHE_HIT      | bigint(20)          | NO             | Not supported. The field is NULL by default.     |
| PS_CLIENT_STMT_ID      | bigint(20)          | NO             | Prepare ID corresponding to the request: <ul><li> `-1`: indicates that the SQL statement does not use the PS protocol  </li><li> Non `-1`: indicates that the SQL statement uses the PS protocol, which is the unique identifier returned by the PS protocol to the client for the statement. </li></ul>     |
| PS_INNER_STMT_ID      | bigint(20)          | NO             | Prepare ID corresponding to the request: <ul><li> `-1`: indicates that the SQL statement does not use the PS protocol   </li><li> Non `-1`: indicates that the SQL statement uses the PS protocol, which is the unique identifier returned by the PS protocol to the internal server for the statement. </li></ul>      |
| TX_ID      | bigint(20)          | NO             | ID of the transaction corresponding to the request     |
| SNAPSHOT_VERSION      | bigint(20)          | NO             | Read snapshot version used by the SQL statement     |
| REQUEST_TYPE            | bigint(20)          | NO             | Type of the request: <li> 0: illegal   <li> 1: internal request   <li> 2: local request, such as local plan   <li> 3: remote request   <li> 4: distributed request   <li> 5: prepare request of SQL   <li> 6: execute stmt request of SQL    |
| IS_BATCHED_MULTI_STMT   | tinyint(4)          | NO             | Whether to optimize batch multi statement                                                        |
| OB_TRACE_INFO           | varchar(4096)       | NO             | Trace information set by the user         |
| PLAN_HASH               | bigint(20) unsigned | NO             | Hash value of the execution plan           |
| LOCK_FOR_READ_TIME      | bigint(20)          | NO             | Time to wait for a lock when reading data, in microseconds      |
| PARAMS_VALUE            | longtext            | NO             | Values of parameters bound by PS              |
| RULE_NAME | varchar(256) | NO   | Rule name   <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.1.0. </p></main> |
| PARTITION_HIT | tinyint(4) | NO | <ul><li> 1 if the local partition is hit when the DAS execution plan is obtained, and 0 otherwise.  </li><li> 1 if no DAS plan is obtained, and 0 otherwise. </li></ul>  <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.1.0. </p></main> |
| TX_INTERNAL_ROUTING | bigint(20) | NO | Whether the SQL statement is internally routed: <ul><li>0: not internally routed, which means that the SQL statement is directly executed on the current node.  </li><li>1: internally routed, which means that the SQL statement is routed to another node on the current node. </li></ul> <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.1.0. </p></main> |
| TX_STATE_VERSION | bigint(20) unsigned | NO | Transaction state version of the SQL statement <main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.1.0. </p></main> |
| FLT_TRACE_ID | varchar(1024) | NO | Trace ID for full-link tracing of the record. If the value is empty, full-link tracing is not enabled for the record. The value is a UUID, which is different from the trace ID. The value is in the format of `000600d6-a5de-038c-6c80-df07e4e79149`.<main id="notice" type='explain'><h4>Note</h4><p>This field was introduced in V4.2.1. </p></main> |
| PL_TRACE_ID             | varchar(128)        | NO   | Trace ID of the outer PL of the current SQL statement (NULL if no outer PL exists) <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.0.  <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main>  |
| PLSQL_EXEC_TIME         | bigint(20)          | NO   | PL execution time (excluding SQL execution time), in microseconds <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.0.  <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main>   |
| TOTAL_MEMSTORE_READ_ROW_COUNT   | bigint(20)          | NO   | Total number of rows read from MemStore (displayed only in threads that display query_text) <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.0.  <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main>   |
| TOTAL_SSSTORE_READ_ROW_COUNT    | bigint(20)          | NO   | Total number of rows read from SSSTORE (displayed only in threads that display query_text) <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.0.  <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main>  |
| PROXY_USER                      | varchar(128)        | NO  |<ul><li>Username of the proxy user if the user logs in as a proxy user.  <li>Empty if the user logs in as a non-proxy user. </li></ul> <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.2.  <li>For V4.2.x, this field was introduced in V4.2.3. </li></ul> </main> |
| SEQ_NUM                         | bigint(20)          | NO   | Statement sequence number in the transaction<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5.  <li>For V4.2.x, this field was introduced in V4.2.5. </li></ul> </main>    |
| NETWORK_WAIT_TIME               | bigint(20) unsigned | YES  | Total time of all network events, in microseconds<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5.  <li>For V4.2.x, this field was introduced in V4.2.3. </li></ul></main>     |

## Sample query

The following example shows how to query the statistics, such as the source and execution status of each SQL request, on the current OBServer node.

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.V$OB_SQL_AUDIT LIMIT 1\G
```

The query result is as follows:

```shell
*************************** 1. row ***************************
                         SVR_IP: xx.xx.xx.xx
                       SVR_PORT: 2882
                     REQUEST_ID: 30867456
                    SQL_EXEC_ID: 94137199
                       TRACE_ID: YB42AC1E87E9-000XXXXXXXXX-0-0
                            SID: 3221746140
                      CLIENT_IP: 0.0.0.0
                    CLIENT_PORT: 0
                      TENANT_ID: 1
                    TENANT_NAME: sys
            EFFECTIVE_TENANT_ID: 1
                        USER_ID: 200001
                      USER_NAME: root
                     USER_GROUP: 0
                 USER_CLIENT_IP: 0.0.0.0
                          DB_ID: 201001
                        DB_NAME: oceanbase
                         SQL_ID: 664BF7B4A5CCEC68B4A59C0132E738BA
                      QUERY_SQL: SELECT * FROM __all_ls_status WHERE tenant_id = 1 ORDER BY tenant_id, ls_id
                        PLAN_ID: 15939
                  AFFECTED_ROWS: 0
                    RETURN_ROWS: 1
                  PARTITION_CNT: 1
                       RET_CODE: 0
                          QC_ID: 0
                         DFO_ID: 0
                         SQC_ID: 0
                      WORKER_ID: 0
                          EVENT: exec inner sql wait
                         P1TEXT: wait inner sql class
                             P1: 0
                         P2TEXT: inner session id
                             P2: 4611686018499956160
                         P3TEXT:
                             P3: 0
                          LEVEL: 0
                  WAIT_CLASS_ID: 100
                    WAIT_CLASS#: 0
                     WAIT_CLASS: OTHER
                          STATE: WAITED SHORT TIME
                WAIT_TIME_MICRO: 99
          TOTAL_WAIT_TIME_MICRO: 99
                    TOTAL_WAITS: 1
                      RPC_COUNT: 0
                      PLAN_TYPE: 1
                   IS_INNER_SQL: 1
                IS_EXECUTOR_RPC: 0
                    IS_HIT_PLAN: 1
                   REQUEST_TIME: 1745731122983999
                   ELAPSED_TIME: 159
                       NET_TIME: 0
                  NET_WAIT_TIME: 0
                     QUEUE_TIME: 0
                    DECODE_TIME: 0
                  GET_PLAN_TIME: 60
                   EXECUTE_TIME: 99
          APPLICATION_WAIT_TIME: 0
          CONCURRENCY_WAIT_TIME: 0
              USER_IO_WAIT_TIME: 0
                  SCHEDULE_TIME: 0
                  ROW_CACHE_HIT: 0
         BLOOM_FILTER_CACHE_HIT: 0
                BLOCK_CACHE_HIT: 0
                     DISK_READS: 0
                      RETRY_CNT: 0
                     TABLE_SCAN: 0
              CONSISTENCY_LEVEL: 3
        MEMSTORE_READ_ROW_COUNT: 0
         SSSTORE_READ_ROW_COUNT: 1
            DATA_BLOCK_READ_CNT: 0
           DATA_BLOCK_CACHE_HIT: 1
           INDEX_BLOCK_READ_CNT: 0
          INDEX_BLOCK_CACHE_HIT: 1
            BLOCKSCAN_BLOCK_CNT: 0
              BLOCKSCAN_ROW_CNT: 0
PUSHDOWN_STORAGE_FILTER_ROW_CNT: 0
            REQUEST_MEMORY_USED: 154880
          EXPECTED_WORKER_COUNT: 0
              USED_WORKER_COUNT: 0
                     SCHED_INFO: NULL
             FUSE_ROW_CACHE_HIT: 0
              PS_CLIENT_STMT_ID: -1
               PS_INNER_STMT_ID: -1
                          TX_ID: 0
               SNAPSHOT_VERSION: 1745731122942777000
                   REQUEST_TYPE: 1
          IS_BATCHED_MULTI_STMT: 0
                  OB_TRACE_INFO: NULL
                      PLAN_HASH: 8981055705934891174
             LOCK_FOR_READ_TIME: 0
                   PARAMS_VALUE:
                      RULE_NAME:
                  PARTITION_HIT: 1
            TX_INTERNAL_ROUTING: 0
               TX_STATE_VERSION: 0
                   FLT_TRACE_ID:
                    PL_TRACE_ID: NULL
                PLSQL_EXEC_TIME: 0
                  FORMAT_SQL_ID:
                      STMT_TYPE: SELECT
  TOTAL_MEMSTORE_READ_ROW_COUNT: 0
   TOTAL_SSSTORE_READ_ROW_COUNT: 1
                     PROXY_USER:
                        SEQ_NUM: 1745731122948066
              NETWORK_WAIT_TIME: 0
             PLSQL_COMPILE_TIME: 0
     INSERT_DUPLICATE_ROW_COUNT: 0
```

## References

* [GV$OB_SQL_AUDIT](3500.gv-ob_sql_audit-of-mysql-mode.md)
* [End-to-end tracing](../../../../600.manage/900.daily-inspection/900.full-link-detection/100.full-link-diagnosis-overview.md)