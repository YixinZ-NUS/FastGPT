|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|
|machine-translation||

# DBA_WR_ACTIVE_SESSION_HISTORY

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p>This view was introduced in OceanBase Database V4.2.1. </p>
</main>

## Purpose

The `DBA_WR_ACTIVE_SESSION_HISTORY` view displays the ASH data persisted in the current tenant.

## Columns

| **Column** | **Type** | **Nullable?** | **Description** |
| -------- | -------- | --------------- | ------- |
| CLUSTER_ID | NUMBER(38) | NO | Cluster ID |
| TENANT_ID | NUMBER(38) | NO | Tenant ID |
| SNAP_ID | NUMBER(38) | NO | Snapshot ID |
| SVR_IP | VARCHAR2(46) | NO | Node IP |
| SVR_PORT | NUMBER(38) | NO | Node port |
| SAMPLE_ID | NUMBER(38) | NO | Sample ID |
| SESSION_ID | bigint(20) | NO | ID of the sampled session.<br>For V4.3.x:<ul><li>For versions earlier than V4.3.5 BP2:<br>In both direct connection mode and ODP mode, this field indicates the server session ID.</li><li>V4.3.5 BP2 and later:<ul><li>In direct connection mode:<br>This field indicates the server session ID. </li> <li>In ODP mode:<ul><li>If <code>client_session_id_version = 2</code> is configured in ODP, this field indicates the Client Session ID. </li> <li>If <code>client_session_id_version = 1</code>, this field indicates the server session ID.</li></ul></li></ul></li></ul> |
| SAMPLE_TIME | TIMESTAMP(6) WITH LOCAL TIME ZONE | NO | Sampling time |
| USER_ID | NUMBER(38) | YES | User ID of the sampled session |
| SESSION_TYPE | NUMBER(38) | YES | Session type <ul><li>N: FOREGROUND indicates a foreground session, that is, a user session.  </li><li>Y: BACKGROUND indicates a background session. </li></ul> |
| SESSION_STATE | VARCHAR2(7) | NO | Status of the session at the sampling moment <ul><li>`EVENT_NO == 0`: "ON CPU" indicates that the session is not waiting and is executing SQL logic.  </li><li>`EVENT_NO â‰  0`: "WAITTING" indicates that the session is waiting. For more information about the waiting events, see the EVENT field. </li></ul> |
| SQL_ID | VARCHAR2(32) | YES | SQL ID |
| TRACE_ID | VARCHAR2(64) | YES | TRACE_ID |
| EVENT_NO | NUMBER(38) | YES | Internal event ID, which is used for queries across tables |
| EVENT_ID | NUMBER | YES | ID of the current waiting event <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main>|
| TIME_WAITED | NUMBER(38) | YES | Total wait time of the waiting event in microseconds (us) |
| P1 | NUMBER(38) | YES | Value of parameter 1 of the waiting event |
| P2 | NUMBER(38) | YES | Value of parameter 2 of the waiting event |
| P3 | NUMBER(38) | YES | Value of parameter 3 of the waiting event |
| SQL_PLAN_LINE_ID | NUMBER(38) | YES | ID of the corresponding SQL operator when the sample is taken. If there is no corresponding operator, the value is NULL |
| PLAN_HASH                   | NUMBER(38)                        | YES  | Plan hash value of the current executing SQL statement<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.4. </li></ul></main>|
| THREAD_ID                   | NUMBER(38)                        | YES  | ID of the thread where the current active session resides<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.4. </li></ul></main>|
| STMT_TYPE                   | NUMBER(38)                        | YES  | SQL type of the current active session<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.4. </li></ul></main>|
| GROUP_ID                    | NUMBER(38)                        | YES  | ID of the resource group to which the session belongs<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.3. </li></ul></main>|
| TX_ID                       | NUMBER(38)                        | YES  | ID of the current transaction<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.3. </li></ul></main>|
| BLOCKING_SESSION_ID         | NUMBER(38)                        | YES  | ID of the session that blocks the current session, which is displayed only in the case of lock conflict. The ID of the session that holds the lock is displayed<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.3. </li></ul></main>|
| TIME_MODEL | NUMBER(38) | YES | Information about the time model |
| IN_PARSE | VARCHAR2(1) | NO | Whether the current session is parsing an SQL statement during sampling |
| IN_PL_PARSE | VARCHAR2(1) | NO | Whether the current session is parsing an SQL PL statement during sampling |
| IN_PLAN_CACHE | VARCHAR2(1) | NO | Whether the current session is using the plan cache during sampling |
| IN_SQL_OPTIMIZE | VARCHAR2(1) | NO | Whether the current session is optimizing an SQL statement during sampling |
| IN_SQL_EXECUTION | VARCHAR2(1) | NO | Whether the current session is executing an SQL statement during sampling |
| IN_PX_EXECUTION | VARCHAR2(1) | NO | Whether the current session is executing an SQL statement in parallel during sampling. If the session is in this state, it is also in the IN_SQL_EXECUTION state. |
| IN_SEQUENCE_LOAD | VARCHAR2(1) | NO | Whether the current session is fetching values from an auto-increment column or a sequence during sampling |
| IN_COMMITTING | VARCHAR2(1) | NO | Whether the current sampling point is in the transaction commit phase |
| IN_STORAGE_READ | VARCHAR2(1) | NO | Whether the current sampling point is in the storage read phase |
| IN_STORAGE_WRITE | VARCHAR2(1) | NO | Whether the current sampling point is in the storage write phase |
| IN_REMOTE_DAS_EXECUTION | VARCHAR2(1) | NO | Whether the current sampling point is in the remote DAS execution phase |
| IN_FILTER_ROWS              | VARCHAR2(1)                       | NO   | Whether the current sampling point is in the storage pushdown execution phase<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main>  |
| PROGRAM                     | VARCHAR2(64)                      | YES  | Name of the program that is being executed at the current sampling point:<ul><li>For background threads: the thread name, such as `observer` and `WrTimer`  </li><li>For foreground threads:<ul><li>For ordinary requests: `user@client_ip (thread_name)`  </li><li>For remote execution of `inner_sql`: `INNER SQL REMOTE EXEC (thread_name)` </li><li>For remote execution of DAS: `DAS REMOTE EXEC (thread_name)` </li></ul> </li></ul><main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main>  |
| MODULE | VARCHAR2(64) | YES | MODULE value recorded in the current session at the sampling moment, which is set by the `DBMS_APPLICATION_INFO.SET_MODULE` package |
| ACTION | VARCHAR2(64) | YES | ACTION value recorded in the current session at the sampling moment, which is set by the `DBMS_APPLICATION_INFO.SET_ACTION` package |
| CLIENT_ID | VARCHAR2(64) | YES | CLIENT_ID value recorded in the current session at the sampling moment, which is set by the `DBMS_SESSION.set_identifier` package |
| BACKTRACE | VARCHAR2(512) | YES | Auxiliary debugging field that records the call stack of the code at the time of the event occurrence |
| PLAN_ID | NUMBER(38) | YES | Plan ID of the sampled SQL statement in the plan cache, which is used to associate the sampling point with the plan |
| TM_DELTA_TIME | NUMBER | YES | Time interval for calculating the time model, in microseconds<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| TM_DELTA_CPU_TIME | NUMBER | YES | CPU time spent in the past `TM_DELTA_TIME` period, in microseconds<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| TM_DELTA_DB_TIME | NUMBER | YES | Database call time spent in the past `TM_DELTA_TIME` period, in microseconds<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| TOP_LEVEL_SQL_ID | CHAR(32) | YES | ID of the top-level SQL<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| IN_PLSQL_COMPILATION | VARCHAR2(1) | NO | PL compilation status: Y/N<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| IN_PLSQL_EXECUTION | VARCHAR2(1) | NO | PL execution status: Y/N<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| PLSQL_ENTRY_OBJECT_ID | NUMBER | YES | OBJECT ID of the top-level PL<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| PLSQL_ENTRY_SUBPROGRAM_ID | NUMBER | YES | Subprogram ID of the top-level PL<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| PLSQL_ENTRY_SUBPROGRAM_NAME | VARCHAR2(32) | YES | Subprogram name of the top-level PL<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| PLSQL_OBJECT_ID | NUMBER | YES | ID of the PL being executed<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| PLSQL_SUBPROGRAM_ID | NUMBER | YES | ID of the subprogram being executed<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| PLSQL_SUBPROGRAM_NAME | VARCHAR2(32) | YES | Name of the subprogram being executed<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.2. </li></ul></main> |
| DELTA_READ_IO_REQUESTS      | NUMBER(38)                        | YES  | Number of read I/O requests between two sampling points<main id="notice" type='explain'><h4>Note</h4><p>For V4.3.x, this field was introduced in V4.3.5 BP2. </p></main>|
| DELTA_READ_IO_BYTES         | NUMBER(38)                        | YES  | Cumulative size of files read between two sampling points<main id="notice" type='explain'><h4>Note</h4><p>For V4.3.x, this field was introduced in V4.3.5 BP2. </p></main> |
| DELTA_WRITE_IO_REQUESTS     | NUMBER(38)                        | YES  | Number of write I/O requests between two sampling points<main id="notice" type='explain'><h4>Note</h4><p>For V4.3.x, this field was introduced in V4.3.5 BP2. </p></main>|
| DELTA_WRITE_IO_BYTES        | NUMBER(38)                        | YES  | Cumulative size of files written between two sampling points<main id="notice" type='explain'><h4>Note</h4><p>For V4.3.x, this field was introduced in V4.3.5 BP2. </p></main>|
| TABLET_ID                   | NUMBER(38)                        | YES  | ID of the tablet that is being processed by the current SQL<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li> <li>For V4.2.x, this field was introduced in V4.2.5. </li></ul></main>|
| PROXY_SID                   | NUMBER(38)                        | YES  | ID of the proxy session<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5. </li><li>For V4.2.x, this field was introduced in V4.2.5. </li></ul></main>|

## Sample query

Query the ASH data that is persisted in this tenant.

```shell
obclient [SYS]> SELECT * FROM SYS.DBA_WR_ACTIVE_SESSION_HISTORY WHERE ROWNUM <= 1\G
```

The query result is as follows:

```shell
*************************** 1. row ***************************
                 CLUSTER_ID: 10001
                  TENANT_ID: 1004
                    SNAP_ID: 1
                     SVR_IP: xx.xx.xx.xx
                   SVR_PORT: 2882
                  SAMPLE_ID: 2050
                 SESSION_ID: 29562259898368
                SAMPLE_TIME: 09-DEC-24 11.05.44.038392 AM
                    USER_ID: 200001
               SESSION_TYPE: 1
              SESSION_STATE: WAITING
                     SQL_ID: NULL
                   TRACE_ID: NULL
                   EVENT_NO: 89
                   EVENT_ID: 30000
                TIME_WAITED: 0
                         P1: 0
                         P2: 3221528469
                         P3: 0
           SQL_PLAN_LINE_ID: NULL
                  PLAN_HASH: NULL
                  THREAD_ID: 2858
                  STMT_TYPE: NULL
                   GROUP_ID: 0
                      TX_ID: NULL
        BLOCKING_SESSION_ID: 3221528469
                 TIME_MODEL: 0
                   IN_PARSE: N
                IN_PL_PARSE: N
              IN_PLAN_CACHE: N
            IN_SQL_OPTIMIZE: N
           IN_SQL_EXECUTION: N
            IN_PX_EXECUTION: N
           IN_SEQUENCE_LOAD: N
              IN_COMMITTING: N
            IN_STORAGE_READ: N
           IN_STORAGE_WRITE: N
    IN_REMOTE_DAS_EXECUTION: N
       IN_PLSQL_COMPILATION: N
         IN_PLSQL_EXECUTION: N
             IN_FILTER_ROWS: N
              IN_RPC_ENCODE: N
              IN_RPC_DECODE: N
          IN_CONNECTION_MGR: N
                    PROGRAM: T1004_ArcSrv
                     MODULE: NULL
                     ACTION: NULL
                  CLIENT_ID: NULL
                  BACKTRACE: NULL
                    PLAN_ID: 0
              TM_DELTA_TIME: 919201
          TM_DELTA_CPU_TIME: 1303
           TM_DELTA_DB_TIME: 919201
           TOP_LEVEL_SQL_ID: NULL
      PLSQL_ENTRY_OBJECT_ID: NULL
  PLSQL_ENTRY_SUBPROGRAM_ID: NULL
PLSQL_ENTRY_SUBPROGRAM_NAME: NULL
            PLSQL_OBJECT_ID: NULL
        PLSQL_SUBPROGRAM_ID: NULL
      PLSQL_SUBPROGRAM_NAME: NULL
     DELTA_READ_IO_REQUESTS: 0
        DELTA_READ_IO_BYTES: 0
    DELTA_WRITE_IO_REQUESTS: 0
       DELTA_WRITE_IO_BYTES: 0
                  TABLET_ID: NULL
                  PROXY_SID: 29562259898368
1 row in set (0.117 sec)
```