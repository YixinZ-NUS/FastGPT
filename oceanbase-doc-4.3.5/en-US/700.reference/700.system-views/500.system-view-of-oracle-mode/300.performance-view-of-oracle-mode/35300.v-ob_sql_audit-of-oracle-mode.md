|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|
|machine-translation||

# V$OB_SQL_AUDIT

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p>This view is introduced in V4.0.0. </p>
</main>

## Purpose

The `V$OB_SQL_AUDIT` view displays statistics such as the source and execution status of each SQL request on the current OBServer node. This view is tenant-distributed. Tenants other than the sys tenant cannot query across tenants.

## Columns

|          Column           |      Type      | Nullable? | Description |
|----------------|----------|----------------|---------------|
| SVR_IP         | VARCHAR2(46)    | NO             | IP address.                   |
| SVR_PORT       | NUMBER(38)      | NO             | Port number.                     |
| REQUEST_ID     | NUMBER(38)      | NO             | ID of the request.                |
| SQL_EXEC_ID    | NUMBER(38)      | NO             | ID of the current execution.                |
| TRACE_ID       | VARCHAR2(128)   | NO             | Trace ID of the statement.           |
| SID                     | NUMBER(38)      | NO             | For V4.3.x:<ul><li>Before V4.3.5 BP2:<br>In all connection modes (direct mode/ODP mode), this field indicates the server session ID.</li><li>V4.3.5 BP2 and later versions:<ul><li>In direct mode:<br>This field indicates the server session ID.</li><li>In ODP mode:<ul><li>When the ODP parameter <code>client_session_id_version = 2</code> is set, this field indicates the client session ID.</li><li>When <code>client_session_id_version = 1</code>, this field indicates the server session ID.</li></ul></li></ul></li></ul>           |
| CLIENT_IP      | VARCHAR2(46)    | NO             | <li> IP address of the ODP that forwards the request when the client connects to an OBServer node through ODP. <li> IP address of the client when the client directly connects to an OBServer node.                       |
| CLIENT_PORT    | NUMBER(38)      | NO             | Port number of the client that sends the request.             |
| TENANT_ID      | NUMBER(38)      | NO             | ID of the tenant that sends the request.              |
| EFFECTIVE_TENANT_ID | NUMBER(38)      | NO             | ID of the tenant.                   |
| TENANT_NAME    | VARCHAR2(64)    | NO             | Name of the tenant that sends the request.               |
| USER_ID        | NUMBER(38)      | NO             | ID of the user that sends the request.              |
| USER_NAME      | VARCHAR2(64)    | NO             | Name of the user that sends the request.               |
| USER_GROUP     | NUMBER(38)      | NO             | ID of the resource group to which the user belongs.              |
| USER_CLIENT_IP | VARCHAR2(32)    | NO             | IP address of the client that sends the request.            |
| DB_ID          | NUMBER(38)      | NO             | ID of the database.                  |
| DB_NAME        | VARCHAR2(128)   | NO             | Name of the database.                   |
| SQL_ID         | VARCHAR2(32)    | NO             | ID of the SQL statement.    <main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, starting from V4.3.2, the actual generated MD5 value is displayed for PL requests of CALL statements and anonymous block PL requests.  <li>For V4.2.x, starting from V4.2.3, the actual generated MD5 value is displayed for PL requests of CALL statements and anonymous block PL requests. </li></ul></main>       |
| QUERY_SQL      | CLOB            | NO             | Actual SQL statement.              |
| PLAN_ID        | NUMBER(38)      | NO             | ID of the execution plan.                 |
| AFFECTED_ROWS  | NUMBER(38)      | NO             | Number of affected rows.                    |
| RETURN_ROWS    | NUMBER(38)      | NO             | Number of returned rows.                    |
| PARTITION_CNT  | NUMBER(38)      | NO             | Number of partitions involved in the request.               |
| RET_CODE       | NUMBER(38)      | NO             | Return code of the execution result: <li> 0: indicates that no error occurred and the statement was successfully executed.   <li> Other return codes: indicate OceanBase error codes. For more information, see [Error codes](../../../900.error-code/700.error-code-of-oracle-mode/100.use-error-information-of-oracle-mode.md).   |
| QC_ID          | NUMBER(38)      | NO             | ID of the scheduler in parallel execution scenarios.          |
| DFO_ID         | NUMBER(38)      | NO             | ID of the current subplan in parallel execution scenarios.     |
| SQC_ID         | NUMBER(38)      | NO             | ID of the local coordinator in parallel execution scenarios.        |
| WORKER_ID      | NUMBER(38)      | NO             | ID of the worker thread in parallel execution scenarios.         |
| EVENT          | VARCHAR2(64)    | NO             | Name of the longest waiting event.                |
| P1TEXT         | VARCHAR2(64)    | NO             | Parameter 1 of the waiting event.                |
| P1             | NUMBER(38)      | NO             | Value of parameter 1 of the waiting event.             |
| P2TEXT         | VARCHAR2(64)    | NO             | Parameter 2 of the waiting event.                |
| P2             | NUMBER(38)      | NO             | Value of parameter 2 of the waiting event.             |
| P3TEXT         | VARCHAR2(64)    | NO             | Parameter 3 of the waiting event.                |
| P3             | NUMBER(38)      | NO             | Value of parameter 3 of the waiting event.             |
| LEVEL          | NUMBER(38)      | NO             | Level of the waiting event.                 |
| WAIT_CLASS_ID  | NUMBER(38)      | NO             | Class ID of the waiting event.        |
| WAIT_CLASS#    | NUMBER(38)      | NO             | Index of the waiting event in its class.       |
| WAIT_CLASS     | VARCHAR2(64)    | NO             | Name of the class to which the waiting event belongs.        |
| STATE          | VARCHAR2(19)    | NO             | Status of the waiting event.                 |
| WAIT_TIME_MICRO| NUMBER(38)      | NO             | Duration of the waiting event in microseconds.       |
| TOTAL_WAIT_TIME_MICRO | NUMBER(38)      | NO             | Total duration of all waits in microseconds.      |
| TOTAL_WAITS    | NUMBER(38)      | NO             | Total number of waits.              |
| RPC_COUNT      | NUMBER(38)      | NO             | Number of RPCs sent.               |
| PLAN_TYPE      | NUMBER(38)      | NO             | Type of the execution plan: <li> local   <li> remote   <li> distribute                 |
| IS_INNER_SQL   | NUMBER(38)      | NO             | Whether the request is an internal SQL request.            |
| IS_EXECUTOR_RPC| NUMBER(38)      | NO             | Whether the current request is an RPC request.          |
| IS_HIT_PLAN    | NUMBER(38)      | NO             | Whether the request hits the plan cache.         |
| REQUEST_TIME   | NUMBER(38)      | NO             | Start time of the execution in microseconds.                 |
| ELAPSED_TIME   | NUMBER(38)      | NO             | Total time consumed from receiving the request to the end of execution in microseconds.       |
| NET_TIME       | NUMBER(38)      | NO             | Duration of sending an RPC to receiving the request in microseconds.        |
| NET_WAIT_TIME  | NUMBER(38)      | NO             | Duration of receiving the request to entering the queue in microseconds.           |
| QUEUE_TIME     | NUMBER(38)      | NO             | Duration of waiting in the queue in microseconds.              |
| DECODE_TIME    | NUMBER(38)      | NO             | Duration of decoding after leaving the queue in microseconds.         |
| GET_PLAN_TIME  | NUMBER(38)      | NO             | Duration from the start of processing to obtaining the execution plan in microseconds.     |
| EXECUTE_TIME   | NUMBER(38)      | NO             | Duration of executing the plan in microseconds.              |
| APPLICATION_WAIT_TIME | NUMBER(38)      | NO             | Total duration of all application events in microseconds.  |
| CONCURRENCY_WAIT_TIME | NUMBER(38)      | NO             | Total duration of all concurrency events in microseconds.  |
| USER_IO_WAIT_TIME | NUMBER(38)      | NO             | Total duration of all user_io events in microseconds.      |
| SCHEDULE_TIME  | NUMBER(38)      | NO             | Total duration of all schedule events in microseconds.      |
| ROW_CACHE_HIT  | NUMBER(38)      | NO             | Number of cache hits in the row cache.                 |
| BLOOM_FILTER_CACHE_HIT | NUMBER(38)      | NO             | Number of cache hits in the Bloom filter cache.     |
| BLOCK_CACHE_HIT | NUMBER(38)      | NO             | Number of cache hits in the block cache.                 |
| DISK_READS     | NUMBER(38)      | NO             | Number of physical reads.                   |
| RETRY_CNT      | NUMBER(38)      | NO             | Number of retries.                    |
| TABLE_SCAN     | NUMBER(38)      | NO             | Whether the request contains a full table scan.            |
| CONSISTENCY_LEVEL | NUMBER(38)      | NO             | Consistency level. The value can be one of the following:<ul><li>`-1`: invalid</li> <li>`1`: specifies reading data stored in SSTable</li><li>`2`: weak consistency read</li><li>`3`: strong consistency read</li></ul>                    |
| MEMSTORE_READ_ROW_COUNT | NUMBER(38)      | NO             | Number of rows read from the memstore.          |
| SSSTORE_READ_ROW_COUNT  | NUMBER(38)      | NO             | Number of rows read from the ssstore.          |
| REQUEST_MEMORY_USED     | NUMBER(38)      | NO             | Memory consumed by the request.                |
| EXPECT_WORKER_COUNT     | NUMBER(38)      | NO             | Number of expected worker threads.              |
| USED_WORKER_COUNT       | NUMBER(38)      | NO             | Number of worker threads actually used.            |
| SCHED_INFO              | VARCHAR2(16384) | NO             | Scheduling information of the request.                 |
| PS_STMT_ID              | NUMBER(38)      | NO             | Prepare ID corresponding to the request: <ul><li> `-1`: indicates that the SQL statement does not use the PS protocol.   <li> A value other than `-1`: indicates that the SQL statement uses the PS protocol, and is the unique identifier returned by the PS protocol for the statement.                                                       |
| TRANSACTION_HASH        | NUMBER(38)      | NO             | Hash value of the transaction corresponding to the request.         |
| REQUEST_TYPE            | NUMBER(38)      | NO             | Type of the request: <li> 0: invalid.   <li> 1: an internal request.   <li> 2: a local request, such as a local plan.   <li> 3: a remote request.   <li> 4: a distributed request.   <li> 5: a SQL prepare request.   <li> 6: an SQL execute request.    |
| IS_BATCHED_MULTI_STMT   | NUMBER(38)      | NO             | Whether batch multi-statement optimization is performed.                                                         |
| OB_TRACE_INFO           | VARCHAR2(4096)  | NO             | User-defined trace information.          |
| PLAN_HASH               | NUMBER(38)      | NO             | Hash value of the execution plan.            |
| PARAMS_VALUE            | CLOB            | NO             | Parameter values bound by PS.               |
| RULE_NAME | VARCHAR2(256)   | NO   | Rule name <main id="notice" type='explain'><h4>Note</h4><p>Introduced in V4.1.0. </p></main> |
| TX_INTERNAL_ROUTING | NUMBER | NO | Indicates whether the SQL statement is routed internally: <ul><li>0: not routed internally, which means that the SQL statement is executed directly on the current node.  </li><li>1: routed internally, which means that the SQL statement is routed from the current node to another node for execution. </li></ul> <main id="notice" type='explain'><h4>Note</h4><p>Introduced in V4.1.0. </p></main> |
| TX_STATE_VERSION | NUMBER(38) | NO | Transaction state version of the SQL statement <main id="notice" type='explain'><h4>Note</h4><p>Introduced in V4.1.0. </p></main> |
| FLT_TRACE_ID | VARCHAR2(1024) | NO | Trace ID for end-to-end tracing of the entire request. If the field is empty, it indicates that end-to-end tracing is not enabled for the request. The value of this field is a UUID, which is different from a trace ID. An example of the value is: `000600d6-a5de-038c-6c80-df07e4e79149`. <main id="notice" type='explain'><h4>Note</h4><p>Introduced in V4.2.1. </p></main> |
| PL_TRACE_ID             | VARCHAR2(128)   | NO             | Trace ID of the outer PL for the statement (NULL if the statement does not have an outer PL). <main id="notice" type='explain'><h4>Note</h4><ul><li> For V4.3.x, introduced in V4.3.0. </li> <li> For V4.2.x, introduced in V4.2.2. </li> </ul> </main>   |
| PLSQL_EXEC_TIME         |  NUMBER(38)     | NO             | Execution time of PL (excluding SQL execution time), in microseconds. <main id="notice" type='explain'><h4>Note</h4><ul><li> For V4.3.x, introduced in V4.3.0. </li> <li> For V4.2.x, introduced in V4.2.2. </li> </ul> </main>  |
| TOTAL_MEMSTORE_READ_ROW_COUNT   | NUMBER(38)          | NO   | Total number of rows read from MemStore during the entire process (displayed only in the thread that displays query_text).<main id="notice" type='explain'><h4>Note</h4><ul><li> For V4.3.x, introduced in V4.3.0. </li> <li> For V4.2.x, introduced in V4.2.2. </li></ul> </main>   |
| TOTAL_SSSTORE_READ_ROW_COUNT    | NUMBER(38)          | NO   | Total number of rows read from SSSTORE during the entire process (displayed only in the thread that displays query_text).<main id="notice" type='explain'><h4>Note</h4><ul><li> For V4.3.x, introduced in V4.3.0. </li> <li> For V4.2.x, introduced in V4.2.2. </li></ul> </main>   |
| PROXY_USER                      | VARCHAR2(128)        | NO  |<ul><li>Indicates the name of the proxy user in proxy user login scenarios. </li><li>Displays an empty value in non-proxy user login scenarios. </li></ul> <main id="notice" type='explain'><h4>Note</h4><ul><li> For V4.3.x, introduced in V4.3.2. </li> <li> For V4.2.x, introduced in V4.2.3. </li></ul> </main>  |
| SEQ_NUM                         | NUMBER(38)          | NO   | Statement sequence number in the transaction<main id="notice" type='explain'><h4>Note</h4><ul><li> For V4.3.x, introduced in V4.3.5. </li> <li> For V4.2.x, introduced in V4.2.5. </li></ul> </main>    |
| NETWORK_WAIT_TIME               | NUMBER(38)          | NO   | Total time of all network wait events, in microseconds<main id="notice" type='explain'><h4>Note</h4><ul><li> For V4.3.x, introduced in V4.3.5. </li> <li> For V4.2.x, introduced in V4.2.3. </li></ul></main>     |
| INSERT_DUPLICATE_ROW_COUNT | NUMBER(38) | NO |Number of duplicate rows in `insertup` or `replace into` statements.<main id="notice" type='explain'><h4>Note</h4><ul><li>Introduced in V4.3.5 BP2. </li> |

## Sample query

The following example shows how to query the statistics, such as the source and execution status of each SQL request, on the current OBServer node.

```shell
obclient [SYS]> SELECT * FROM SYS.V$OB_SQL_AUDIT WHERE ROWNUM <= 1\G
```

The query result is as follows:

```shell
*************************** 1. row ***************************
                         SVR_IP: xx.xx.xx.xx
                       SVR_PORT: 2882
                     REQUEST_ID: 7576831
                    SQL_EXEC_ID: 94317229
                       TRACE_ID: YB42AC1E87E9-000XXXXXXXXXX1-0-0
                            SID: 3221582368
                      CLIENT_IP: 0.0.0.0
                    CLIENT_PORT: 0
                      TENANT_ID: 1004
            EFFECTIVE_TENANT_ID: 1004
                    TENANT_NAME: sys
                        USER_ID: 200001
                      USER_NAME: root
                     USER_GROUP: 0
                 USER_CLIENT_IP: 0.0.0.0
                          DB_ID: 201001
                        DB_NAME: oceanbase
                         SQL_ID: 2EAAA3C495632AB97F13659E429FC9CD
                      QUERY_SQL: select * from __all_balance_task where parent_list is null or parent_list = ''
                        PLAN_ID: 4728
                  AFFECTED_ROWS: 0
                    RETURN_ROWS: 0
                  PARTITION_CNT: 1
                       RET_CODE: 0
                          QC_ID: 0
                         DFO_ID: 0
                         SQC_ID: 0
                      WORKER_ID: 0
                          EVENT: exec inner sql wait
                         P1TEXT: wait inner sql class
                             P1: 0
                         P2TEXT: inner session id
                             P2: 4611686018500104803
                         P3TEXT: NULL
                             P3: 0
                          LEVEL: 0
                  WAIT_CLASS_ID: 100
                    WAIT_CLASS#: 0
                     WAIT_CLASS: OTHER
                          STATE: WAITED SHORT TIME
                WAIT_TIME_MICRO: 70
          TOTAL_WAIT_TIME_MICRO: 70
                    TOTAL_WAITS: 1
                      RPC_COUNT: 0
                      PLAN_TYPE: 1
                   IS_INNER_SQL: 1
                IS_EXECUTOR_RPC: 0
                    IS_HIT_PLAN: 1
                   REQUEST_TIME: 1745731919396962
                   ELAPSED_TIME: 179
                       NET_TIME: 0
                  NET_WAIT_TIME: 0
                     QUEUE_TIME: 0
                    DECODE_TIME: 0
                  GET_PLAN_TIME: 108
                   EXECUTE_TIME: 71
          APPLICATION_WAIT_TIME: 0
          CONCURRENCY_WAIT_TIME: 0
              USER_IO_WAIT_TIME: 0
                  SCHEDULE_TIME: 0
                  ROW_CACHE_HIT: 0
         BLOOM_FILTER_CACHE_HIT: 0
                BLOCK_CACHE_HIT: 0
                     DISK_READS: 0
                      RETRY_CNT: 0
                     TABLE_SCAN: 1
              CONSISTENCY_LEVEL: 3
        MEMSTORE_READ_ROW_COUNT: 0
         SSSTORE_READ_ROW_COUNT: 0
            DATA_BLOCK_READ_CNT: 0
           DATA_BLOCK_CACHE_HIT: 0
           INDEX_BLOCK_READ_CNT: 0
          INDEX_BLOCK_CACHE_HIT: 0
            BLOCKSCAN_BLOCK_CNT: 0
              BLOCKSCAN_ROW_CNT: 0
PUSHDOWN_STORAGE_FILTER_ROW_CNT: 0
            REQUEST_MEMORY_USED: 2161408
          EXPECTED_WORKER_COUNT: 0
              USED_WORKER_COUNT: 0
                     SCHED_INFO: NULL
              PS_CLIENT_STMT_ID: -1
               PS_INNER_STMT_ID: -1
                          TX_ID: 0
               SNAPSHOT_VERSION: 1745731919220670000
                   REQUEST_TYPE: 1
          IS_BATCHED_MULTI_STMT: 0
                  OB_TRACE_INFO: NULL
                      PLAN_HASH: 1945082731509197303
                   PARAMS_VALUE: NULL
                      RULE_NAME: NULL
            TX_INTERNAL_ROUTING: 0
               TX_STATE_VERSION: 0
                   FLT_TRACE_ID: NULL
                    PL_TRACE_ID: NULL
                PLSQL_EXEC_TIME: 0
                  FORMAT_SQL_ID: NULL
                      STMT_TYPE: SELECT
  TOTAL_MEMSTORE_READ_ROW_COUNT: 0
   TOTAL_SSSTORE_READ_ROW_COUNT: 0
                     PROXY_USER: NULL
                        SEQ_NUM: 1745731919361793
              NETWORK_WAIT_TIME: 0
             PLSQL_COMPILE_TIME: 0
     INSERT_DUPLICATE_ROW_COUNT: 0
```

## References

* [GV$OB_SQL_AUDIT](3400.gv-ob_sql_audit-of-oracle-mode.md)
* [End-to-end tracing](../../../../600.manage/900.daily-inspection/900.full-link-detection/100.full-link-diagnosis-overview.md)