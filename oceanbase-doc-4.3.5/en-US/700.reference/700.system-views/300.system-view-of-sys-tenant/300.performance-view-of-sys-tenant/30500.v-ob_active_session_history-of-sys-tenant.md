|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# V$OB_ACTIVE_SESSION_HISTORY

<main id="notice" type='explain'>
<h4>Note</h4>
<ul><li>For V4.3.x, this view was introduced in V4.3.5. </li> <li>For V4.2.x, this view was introduced in V4.2.2. </li></ul>
</main>

## Purpose

The `V$OB_ACTIVE_SESSION_HISTORY` view displays the active session history of the current OBServer node in all tenants.

## Columns

| **Column** | **Type** | **Nullable?** | **Description** |
| -------- | -------- | --------------- | ------- |
| SVR_IP                      | varchar(46)         | NO | IP address of the server where the sample is located. |
| SVR_PORT                    | bigint(20)          | NO | Port number of the server where the sample is located. |
| SAMPLE_ID                   | bigint(20)          | NO | Unique ID of the sample on the local server. |
| SAMPLE_TIME                 | datetime            | NO | Sampling time. |
| CON_ID                      | bigint(20)          | NO | ID of the tenant. |
| USER_ID                     | bigint(20)          | NO | ID of the user in the sampled session. |
| SESSION_ID                  | bigint(20)          | NO | ID of the sampled session.<br>For V4.3.x:<ul><li>For versions earlier than V4.3.5 BP2:<br>In both direct connection and ODP modes, this field indicates the Server Session ID.</li><li>V4.3.5 BP2 and later:<ul><li>In direct connection mode:<br>This field indicates the Server Session ID.</li> <li>In ODP mode:<ul><li>If <code>client_session_id_version = 2</code> is specified in ODP, this field indicates the Client Session ID. </li> <li>If <code>client_session_id_version = 1</code>, this field indicates the Server Session ID.</li></ul></li></ul></li></ul> |
| SESSION_TYPE                | varchar(10)         | NO | Session type. Valid values:<ul><li>FOREGROUND: foreground session, which is a user session.  </li><li>(Not supported) BACKGROUND: background session. </li></ul>|
| SESSION_STATE               | varchar(7)          | NO | Session status. Valid values:<ul><li>ON CPU: the session is not waiting and is executing SQL logic.  </li><li>WAITING: the session is waiting. For more information about the wait event, see the EVENT field. </li></ul>|
| SQL_ID                      | varchar(32)         | NO | ID of the SQL statement. |
| PLAN_ID                     | bigint(20)          | NO | ID of the plan in the plan cache to which the sampled SQL statement belongs. This field is used to associate the sampling point with the plan. |
| TRACE_ID                    | varchar(64)         | NO | Trace ID of the operator. |
| EVENT                       | varchar(64)         | NO | Description of the wait event. |
| EVENT_NO                    | bigint(20)          | NO | Internal ID of the wait event. This field is used for queries across tables. |
| EVENT_ID                    | bigint(20)          | NO | ID of the wait event. |
| P1TEXT                      | varchar(64)         | NO | Name of parameter 1 of the wait event. The name varies depending on the wait event. |
| P1                          | bigint(20)          | NO | Value of parameter 1 of the wait event. |
| P2TEXT                      | varchar(64)         | NO | Name of parameter 2 of the wait event. The name varies depending on the wait event. |
| P2                          | bigint(20)          | NO | Value of parameter 2 of the wait event. |
| P3TEXT                      | varchar(64)         | NO | Name of parameter 3 of the wait event. The name varies depending on the wait event. |
| P3                          | bigint(20)          | NO | Value of parameter 3 of the wait event. |
| WAIT_CLASS                  | varchar(64)         | NO | Type of the wait event. |
| WAIT_CLASS_ID               | bigint(20)          | NO | ID of the wait event type. This field is used for queries across tables. |
| TIME_WAITED                 | bigint(20)          | NO | Total wait time of the wait event, in microseconds (us). |
| SQL_PLAN_LINE_ID            | bigint(20)          | NO | Number of the SQL operator in the SQL plan when the session was sampled. |
| GROUP_ID                    | bigint(20)          | NO | ID of the resource group to which the session belongs.     |
| PLAN_HASH                   | bigint(20) unsigned | NO | Plan hash value of the current SQL statement.     |
| THREAD_ID                   | bigint(20)          | NO | ID of the thread where the active session is located.    |
| STMT_TYPE                   | bigint(20)          | NO | SQL type of the active session.     |
| TIME_MODEL                  | bigint(20)          | NO | time model information, which is a collection of values of all IN_XXX fields (such as IN_PARSE and IN_PL_PARSE).     |
| IN_PARSE                    | varchar(1)          | NO | Indicates whether the session is parsing an SQL statement when it is sampled. |
| IN_PL_PARSE                 | varchar(1)          | NO | Indicates whether the session is parsing an PL/SQL statement when it is sampled. |
| IN_PLAN_CACHE               | varchar(1)          | NO | Indicates whether the session is matching a plan in the plan cache when it is sampled. |
| IN_SQL_OPTIMIZE             | varchar(1)          | NO | Indicates whether the session is optimizing an SQL statement when it is sampled. |
| IN_SQL_EXECUTION            | varchar(1)          | NO | Indicates whether the session is executing an SQL statement when it is sampled. |
| IN_PX_EXECUTION             | varchar(1)          | NO | Indicates whether the session is executing an SQL statement in parallel when it is sampled. When the session is in this state, it is also in the IN_SQL_EXECUTION state. |
| IN_SEQUENCE_LOAD            | varchar(1)          | NO | Indicates whether the session is loading a value from an auto-increment column or a sequence when it is sampled. |
| IN_COMMITTING               | varchar(1)          | NO | Indicates whether the current sampling point is in the transaction commit phase. |
| IN_STORAGE_READ             | varchar(1)          | NO | Indicates whether the current sampling point is in the storage read phase. |
| IN_STORAGE_WRITE            | varchar(1)          | NO | Indicates whether the current sampling point is in the storage write phase. |
| IN_REMOTE_DAS_EXECUTION     | varchar(1)          | NO | Indicates whether the current sampling point is in the remote DAS execution phase. |
| IN_FILTER_ROWS              | varchar(1)          | NO | Indicates whether the current sampling point is in the storage downpress execution phase. |
| IN_RPC_ENCODE               | varchar(1)          | NO   | The serialization operation being performed by the current SQL.    |
| IN_RPC_DECODE               | varchar(1)          | NO   | The deserialization operation being performed by the current SQL.      |
| IN_CONNECTION_MGR           | varchar(1)          | NO   | The connection establishment operation being performed by the current SQL.     |
| PROGRAM                     | varchar(64)         | NO | Name of the program being executed at the current sampling point:<ul><li>For background threads: the thread name, such as `observer` or `WrTimer`.  </li><li>For foreground threads:<ul><li>For ordinary requests: `user@client_ip (thread_name)`  </li><li>For `inner_sql` remote executions: `INNER SQL REMOTE EXEC (thread_name)` </li><li>For DAS remote executions: `DAS REMOTE EXEC (thread_name)` </li></ul> </li></ul>|
| MODULE                      | varchar(64)         | NO | MODULE value recorded for the session when it is sampled. This field is set by the `DBMS_APPLICATION_INFO.SET_MODULE` package. |
| ACTION                      | varchar(64)         | NO | ACTION value recorded for the session when it is sampled. This field is set by the `DBMS_APPLICATION_INFO.SET_ACTION` package. |
| CLIENT_ID                   | varchar(64)         | NO | CLIENT_ID value recorded for the session when it is sampled. This field is set by the `DBMS_SESSION.set_identifier` package. |
| BACKTRACE                   | varchar(512)        | NO | Auxiliary debugging field that records the code call stack when the event occurs. The value of this field is always NULL. |
| TM_DELTA_TIME               | bigint(20)          | NO | Time interval for calculating the time model, in microseconds. |
| TM_DELTA_CPU_TIME           | bigint(20)          | NO | CPU time spent in the past `TM_DELTA_TIME` period. |
| TM_DELTA_DB_TIME            | bigint(20)          | NO | Database call time spent in the past `TM_DELTA_TIME` period. |
| TOP_LEVEL_SQL_ID            | varchar(32)         | NO | ID of the top-level SQL statement. |
| IN_PLSQL_COMPILATION        | varchar(1)          | NO | PL compilation status: Y/N |
| IN_PLSQL_EXECUTION          | varchar(1)          | NO | PL execution status: Y/N |
| PLSQL_ENTRY_OBJECT_ID       | bigint(20)          | NO | OBJECT ID of the top-level PL. |
| PLSQL_ENTRY_SUBPROGRAM_ID   | bigint(20)          | NO | Subprogram ID of the top-level PL. |
| PLSQL_ENTRY_SUBPROGRAM_NAME | varchar(32)         | NO | Subprogram name of the top-level PL. |
| PLSQL_OBJECT_ID             | bigint(20)          | NO | ID of the PL being executed. |
| PLSQL_SUBPROGRAM_ID         | bigint(20)          | NO | ID of the subprogram being executed. |
| PLSQL_SUBPROGRAM_NAME       | varchar(32)         | NO | Name of the subprogram being executed. |
| TX_ID                       | bigint(20)          | NO | ID of the current transaction.     |
| BLOCKING_SESSION_ID         | bigint(20)          | NO | ID of the session that blocks the current session. This field is displayed only in lock conflict scenarios, and displays the ID of the session that holds the lock.      |
| TABLET_ID                   | bigint(20)          | NO | ID of the tablet being processed by the current SQL statement.     |
| PROXY_SID                   | bigint(20)          | NO | ID of the proxy session.     |
| TX_ID                       | bigint(20)          | NO  | Current transaction ID.     |
| DELTA_READ_IO_REQUESTS      | bigint(20)          | NO  | Number of reads between two samplings.<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5 BP2.</li> <li>For V4.2.x, this field was introduced in V4.2.5 BP3.</li></ul></main>     |
| DELTA_READ_IO_BYTES         | bigint(20)          | NO  | Total size of files read between two samplings.<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5 BP2.</li> <li>For V4.2.x, this field was introduced in V4.2.5 BP3.</li></ul></main>     |
| DELTA_WRITE_IO_REQUESTS     | bigint(20)          | NO  | Number of writes between two samplings.<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5 BP2.</li> <li>For V4.2.x, this field was introduced in V4.2.5 BP3.</li></ul></main>     |
| DELTA_WRITE_IO_BYTES        | bigint(20)          | NO  | Total size of files written between two samplings.<main id="notice" type='explain'><h4>Note</h4><ul><li>For V4.3.x, this field was introduced in V4.3.5 BP2.</li> <li>For V4.2.x, this field was introduced in V4.2.5 BP3.</li></ul></main>     |

## Sample query

Query the active session history of the current OBServer node.

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.V$OB_ACTIVE_SESSION_HISTORY LIMIT 1\G
```

The query result is as follows:

```shell
*************************** 1. row ***************************
                     SVR_IP: xx.xx.xx.xx
                   SVR_PORT: 2882
                  SAMPLE_ID: 1923642
                SAMPLE_TIME: 2025-03-04 10:56:11.514023
                     CON_ID: 1002
                    USER_ID: 0
                 SESSION_ID: -9223372036854729604
               SESSION_TYPE: BACKGROUND
              SESSION_STATE: ON CPU
                     SQL_ID: NULL
                    PLAN_ID: 0
                   TRACE_ID: NULL
                      EVENT:
                   EVENT_NO: 0
                   EVENT_ID: NULL
                     P1TEXT:
                         P1: 0
                     P2TEXT:
                         P2: 0
                     P3TEXT:
                         P3: 0
                 WAIT_CLASS: OTHER
              WAIT_CLASS_ID: 100
                TIME_WAITED: 0
           SQL_PLAN_LINE_ID: NULL
                   GROUP_ID: 0
                  PLAN_HASH: NULL
                  THREAD_ID: 82045
                  STMT_TYPE: NULL
                 TIME_MODEL: 0
                   IN_PARSE: N
                IN_PL_PARSE: N
              IN_PLAN_CACHE: N
            IN_SQL_OPTIMIZE: N
           IN_SQL_EXECUTION: N
            IN_PX_EXECUTION: N
           IN_SEQUENCE_LOAD: N
              IN_COMMITTING: N
            IN_STORAGE_READ: N
           IN_STORAGE_WRITE: N
    IN_REMOTE_DAS_EXECUTION: N
             IN_FILTER_ROWS: N
              IN_RPC_ENCODE: N
              IN_RPC_DECODE: N
          IN_CONNECTION_MGR: N
                    PROGRAM: T1002_LogService
                     MODULE: LogRestoreService
                     ACTION: RemoteLogWriter
                  CLIENT_ID: NULL
                  BACKTRACE: NULL
              TM_DELTA_TIME: 1017261
          TM_DELTA_CPU_TIME: 1017261
           TM_DELTA_DB_TIME: 1017261
           TOP_LEVEL_SQL_ID: NULL
       IN_PLSQL_COMPILATION: N
         IN_PLSQL_EXECUTION: N
      PLSQL_ENTRY_OBJECT_ID: NULL
  PLSQL_ENTRY_SUBPROGRAM_ID: NULL
PLSQL_ENTRY_SUBPROGRAM_NAME: NULL
            PLSQL_OBJECT_ID: NULL
        PLSQL_SUBPROGRAM_ID: NULL
      PLSQL_SUBPROGRAM_NAME: NULL
        BLOCKING_SESSION_ID: NULL
                  TABLET_ID: NULL
                  PROXY_SID: -9223372036854729604
                      TX_ID: NULL
     DELTA_READ_IO_REQUESTS: 0
        DELTA_READ_IO_BYTES: 0
    DELTA_WRITE_IO_REQUESTS: 0
       DELTA_WRITE_IO_BYTES: 0
1 row in set (0.018 sec)
```

## References

* [GV$OB_ACTIVE_SESSION_HISTORY](400.gv-ob_active_session_history-of-sys-tenant.md)
* [ASH report](../../../../700.reference/1000.performance-tuning-guide/400.performance-diagnosis/500.ash-report-diagnosis/100.ash-introduction.md)