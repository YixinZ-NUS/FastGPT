# Expand a tenant

obshell supports expanding a tenant in the following two ways:

- Call an API to expand a tenant.

- Use obshell commands to expand a tenant.

This topic describes how to expand a tenant (from 3 replicas to 5 replicas) in an OceanBase cluster with obshell.

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p>In this topic, expanding a tenant refers to adding a tenant replica. </p>
</main>

## Prerequisites

- The OceanBase cluster is managed by obshell. For more information, see [Take over a non-obshell-deployed cluster](../200.cluster-management/300.take-over-non-obshell-deployed-clusters.md).

- All OBServer nodes of the OceanBase cluster and obshell are running.

## Deployment mode

The following table describes the deployment mode of the three servers (obshell uses the default port 2886) in this example:

| Role | Server | Remarks |
| --- | --- | --- |
| OBServer node | 10.10.10.1 | Zone 1 of OceanBase Database |
| OBServer node | 10.10.10.2 | Zone 2 of OceanBase Database |
| OBServer node | 10.10.10.3 | Zone 3 of OceanBase Database |
| OBServer node for expansion | 10.10.10.4 | Zone 4 of OceanBase Database |
| OBServer node for expansion | 10.10.10.5 | Zone 5 of OceanBase Database |

## Expand a tenant by calling an API

<main id="notice" type='explain'>
  <h4>Note</h4>
  <p>obshell performs security verification on the called API. Therefore, you must encrypt the request before you call the API and configure the encrypted request header (<code>${request_headers}</code>) and request body (<code>${request_body}</code>) in the curl command. For more information, see <a href='../../400.obshell-api-reference/20.api-hybrid-encryption.md'>API hybrid encryption</a>. </p>
</main>

### Step 1: Expand the cluster

Follow the steps in [Expand an OceanBase cluster](../200.cluster-management/400.scale-out-oceanbase-cluster.md) to expand `10.10.10.4` to `zone4` and `10.10.10.5` to `zone5`.

### Step 2: Add a tenant replica

Call the `POST /api/v1/tenant/:name/replicas` API of any obshell to expand the `tenant1` tenant.

:::tab

tab CLI

For more information about how to call this API, see [Add a tenant replica](../../400.obshell-api-reference/500.tenant-management/1000.add-tenant-copy.md). This API creates an asynchronous task. For more information about how to query the task progress, see [Get task details](../../400.obshell-api-reference/1000.task-management/2000.get-dag-detail.md). Wait for the task to complete, and then the expansion of the tenant replica is completed.

```shell
[admin@test001 ~]$ curl -H "Content-Type: application/json" -H 'X-OCS-Header:${request_headers}' -X POST -d '${request_body}' http://10.10.10.1:2886/api/v1/tenant/tenant1/replicas
```

The request body before encryption is as follows. `unit_1` is the resource specification of the `tenant1` tenant. If you want to create a new resource unit, see **Step 1: Create a resource specification** in [Create a tenant](100.create-tenant-use-obshell.md).

```shell
{
    "zone_list": [
        {
            "name": "zone4",
            "unit_config_name": "unit_1",
            "unit_num": 1
        },
        {
            "name": "zone5",
            "unit_config_name": "unit_1",
            "unit_num": 1
        }
    ]
}
```

tab Python

For more information about how to request the API method, see [Add a tenant replica](../../500.obshell-sdk-reference/100.python/500.tenant-management/1000.add-tenant-copy-of-python.md).

```python
...
client = ClientSet("10.10.10.1", 2886, PassswordAuth("****"))
client.v1.add_tenant_replica_sync("tenant1", [ZoneParam("zone4", 'unit_1', 1),
                                          ZoneParam("zone5", 'unit_1', 1))
...
```

tab GO

For more information about how to request the API method, see [Add a tenant replica](../../500.obshell-sdk-reference/200.go/500.tenant-management/1000.add-tenant-copy-of-go.md).

```go
...
req := client.V1().NewScaleOutReplicasRequest("tenant1", []v1.ZoneParam{
        {
            Name:           "zone4",
            ReplicaType:    "FULL",
            UnitConfigName: "unit_1",
            UnitNum:        1,
        },
    {
            Name:           "zone5",
            ReplicaType:    "FULL",
            UnitConfigName: "unit_1",
            UnitNum:        1,
        },
    })
    if _, err = client.V1().ScaleOutReplicasSyncWithRequest(req); err != nil {
        fmt.Print(err)
    }
...
```

:::

### Step 3: Query tenant information

Call the `GET /api/v1/tenant/:name` API of any obshell to query the information of the expanded tenant.

:::tab

tab CLI

For more information about how to call this API, see [Query tenant information](../../400.obshell-api-reference/500.tenant-management/200.view-tenant.md).

```shell
[admin@test001 ~]$ curl -H "Content-Type: application/json" -H 'X-OCS-Header:${request_headers}' -X GET http://10.10.10.1:2886/api/v1/tenant/tenant1
```

tab Python

For more information about how to request the API method, see [Query tenant information](../../500.obshell-sdk-reference/100.python/500.tenant-management/200.view-tenant-of-python.md).

```python
...
client = ClientSet("10.10.11", 2886, PasswordAuth("****"))
tenant_info = client.v1.get_tenant_info("tenant1")
...
```

tab GO

For more information about how to request the API method, see [Query tenant information](../../500.obshell-sdk-reference/200.go/500.tenant-management/200.view-tenant-of-go.md).

```go
...
client, err := services.NewClientWithPassword("10.10.10.1", 2886, "****")
tenant, err := client.V1().GetTenantInfo("tenant1")
...
```

:::

## Expand a tenant by using obshell commands

### Step 1: Expand the cluster

Follow the steps in [Expand an OceanBase cluster](../200.cluster-management/400.scale-out-oceanbase-cluster.md) to expand `10.10.10.4` to `zone4` and `10.10.10.5` to `zone5`.

### Step 2: Add a tenant replica

Run the following command on any node to add a replica of the `tenant1` tenant to `zone4` and `zone5`. For more information about the command, see [obshell tenant replica add](../../300.obshell-clients/250.tenant-commands.md).

```shell
[admin@test001 ~]$ /home/admin/oceanbase/bin/obshell tenant replica add tenant1 -z zone4,zone5 -u unit_1
```

In the preceding example, `unit_1` is the resource specification of the `tenant1` tenant. Configure it based on your actual situation. If you want to create a new resource unit, see **Step 1: Create a resource specification** in [Create a tenant](100.create-tenant-use-obshell.md).

### Step 3: Query tenant information

Run the following command on any node to query the information of the specified tenant. For more information about the command, see [obshell tenant show](../../300.obshell-clients/250.tenant-commands.md).

```shell
[admin@test001 ~]$ /home/admin/oceanbase/bin/obshell tenant show tenant1
```