# Cluster commands of obshell

This topic describes how to use cluster commands of OceanBase Shell (obshell) to deploy and manage OceanBase clusters.

You can specify the `-h` or `--help` option in a command to query its help information. When a task returns an error, you can specify the `-v` or `--verbose` option to query the execution details of the command.

## obshell cluster join

You can run this command to add the OBServer node where obshell is stored to an OceanBase cluster before the OceanBase cluster is initialized.

```shell
${home_path}/bin/obshell cluster join -z -s [-d] [-r] [-p] [-P] [-o] [-l]

# example
/home/admin/oceanbase/bin/obshell cluster join -z zone1 -s 10.10.10.1
```

`home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database.

The following table describes the options in the command.

| Option | Required? | Data type | Default value | Description |
| --- | --- | --- | --- | --- |
| -z/--zone | Yes | String | N/A | The zone to which the OBServer node belongs. |
| -s/--server | Yes | String | N/A | The IP address and port number of the OBServer node that you want to add, in the `ip:port` format. The port number is optional. By default, port `2886` is used. |
| -d/--data_dir | No | String | ${home_path}/store | The directory for storing SSTables and other data, which must be an absolute path. By default, the `store` directory under the working directory is used. The working directory is specified by the `home_path` parameter. |
| -r/--redo_dir | No | String | ${data_dir} | The directory for storing commit logs (clogs), which must be an absolute path. By default, the value of this option is the same as that of the `--data_dir` option. |
| -p/--mysql_port | No | Integer | 2881 |  The port number for the SQL service protocol. By default, port `2881` is used. |
| -P/--rpc_port | No | Integer | 2882 |  The protocol port number for remote access. By default, port `2882` is used. |
| -o/--opt_str | No | String | N/A | Other options for the OBServer node. You must specify each option in the `key=value` format, and separate multiple options with commas (`,`). The entire value string of the `-o` option must be enclosed by single quotation marks (`'`). Example: `-o 'memory_limit=16G,system_memory=8G,log_disk_size=24G,datafile_size=24G'`. |
| -l/--log_level  | No  | String   | N/A    | The log level of the OBServer node. |

## obshell cluster remove

You can run this command to remove the OBServer node where obshell is stored from an OceanBase cluster before the OceanBase cluster is initialized.

```shell
${home_path}/bin/obshell cluster remove -s [-y]

# example
/home/admin/oceanbase/bin/obshell cluster remove -s 10.10.10.1
```

`home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database.

The following table describes the options in the command.

| Option | Required? | Data type | Default value | Description |
| --- | --- | --- | --- | --- |
| -s/--server  | Yes  | String  | N/A  | The IP address and port number of the OBServer node that you want to remove, in the `ip:port` format. The port number is optional. By default, port `2886` is used. |
| -y/--yes  | No  | N/A  |  N/A   | Specifies to cancel secondary confirmation. You do not need to set a value for this option.  |

## obshell cluster init

You can run this command to initialize an OceanBase cluster.

```shell
${home_path}/bin/obshell cluster init -n --rp [-i] [-d] [-r] [-p] [-P] [--rs] [-o] [-l]

# example
/home/admin/oceanbase/bin/obshell cluster init -n ob-test --rp ********
```

`home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database.

The following table describes the options in the command.

| Option | Required? | Data type | Default value | Description |
| --- | --- | --- | --- | --- |
| -n/--cluster_name | Yes | String | N/A | The name of the OceanBase cluster. |
| --rp/--rootpassword | No | String | N/A | The password for the `root` user of the `sys` tenant. |
| -i/--cluster_id | No | Integer | 1 | The ID of the OceanBase cluster. The default value is `1`. |
| -d/--data_dir | No | String | ${home_path}/store |  The directory for storing SSTables and other data, which must be an absolute path. By default, the `store` directory under the working directory is used. The working directory is specified by the `home_path` parameter. |
| -r/--redo_dir | No | String | ${data_dir} | The directory for storing clogs, which must be an absolute path. By default, the value of this option is the same as that of the `--data_dir` option. |
| -p/--mysql_port | No | Integer | 2881 |  The port number for the SQL service protocol. By default, port `2881` is used. |
| -P/--rpc_port | No | Integer | 2882 |  The protocol port number for remote access. By default, port `2882` is used. |
| --rs/--rs_list | No | String | N/A | The list of RootService servers, with the information about each RootService server specified in the format of `observer_ip:rpc_port:mysql_port`. The information about multiple RootService servers must be separated with semicolons (`;`). The entire value string of the `--rs` option must be enclosed by single quotation marks (`'`). Example: `--rs '10.10.10.1:2882:2881;10.10.10.2:2882:2881'`. |
| -o/--opt_str | No | String | N/A | Other options for the OBServer nodes in the OceanBase cluster. You must specify each option in the `key=value` format, and separate multiple options with commas (`,`). The entire value string of the `-o` option must be enclosed by single quotation marks (`'`). Example: `-o 'memory_limit=16G,system_memory=8G,log_disk_size=24G,datafile_size=24G'`. |
| -l/--log_level  | No  | String   | N/A    | The log level of the OceanBase cluster. |

## obshell cluster show

You can run this command to query the details of the current OceanBase cluster.

```shell
${home_path}/bin/obshell cluster show [-d]
```

`home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database. The `-d` or `--show_detail` option is optional. It specifies to display the details of the current cluster. You do not need to set a value for this option.

The output of this command varies depending on the status of the OceanBase cluster.

- If you run this command before the OceanBase cluster is initialized, the following information about obshell is displayed: IP address, version, and port number.

- If you run this command after the OceanBase cluster is initialized, the information about obshell and the following information about each OBServer node are displayed: cluster, version, zone, SQL port number, server port number, RootService server, and status.

  The status of an OBServer node is described as follows:

  - `ACTIVE`: The heartbeat connection between the OBServer node and the RootService server is normal.

  - `INACTIVE`: The OBServer node lost the heartbeat connection with the RootService server.

  - `DELETING`: The OBServer node is being deleted.

  - `STOPPED`: The OBServer node is stopped.

## obshell cluster start

You can run this command to start the specified one or more OBServer nodes or take over the current OceanBase cluster. To run this command to start OBServer nodes, the OceanBase cluster must be fully managed by obshell.

For more information about how to determine whether an OceanBase cluster is managed by obshell and how to take over an OceanBase cluster, see [Take over an OceanBase cluster not deployed by obshell](../210.use-case/200.cluster-management/300.take-over-non-obshell-deployed-clusters.md). For more information about the applicable scenarios of this command, see [Start an OceanBase cluster](../210.use-case/200.cluster-management/310.start-oceanbase-cluster.md).

```shell
${home_path}/bin/obshell cluster start [-a] [-s] [-z] [-i] [-y] [--ssh_user] [--ssh_port] [--user_password] [--key_file] [--key_passphrase]

# example
/home/admin/oceanbase/bin/obshell cluster start -s 10.10.10.1:2886,10.10.10.2:2886
```

Here, `home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database.

The following table describes the options in the command.

| Option | Required? | Data type | Default value | Description |
| --- | --- | --- | --- | --- |
| -a/--all | No | N/A | N/A | Specifies to start all OBServer nodes. You do not need to set a value for this option. By default, if you do not specify this option, only the OBServer nodes managed by the current obshell process are started. |
| -s/--server | No | String | N/A | The IP addresses and port numbers of the obshell-managed OBServer nodes to be started, with the information about each OBServer node specified in the format of `obshell_ip:obshell_port`. The information about multiple OBServer nodes must be separated with commas (`,`). Example: `-s x.x.x.x:2886,x.x.x.x:2886`. |
| -z/--zone | No | String | N/A | Specifies to start all OBServer nodes in the specified zones. The names of multiple zones must be separated with commas (`,`). Example: `-z zone1,zone2`. |
|  -i/--id | No | String | N/A | The ID of the preceding task that starts or stops the specified OBServer nodes. You can use this option in special circumstances. When a cluster O&M task is locked by one or more preceding tasks, you can specify the `-i` option to release the previous tasks. Example: `-i 22130706433028869`. |
| -y/--yes  | No  | N/A  |  N/A   | Specifies to cancel secondary confirmation. You do not need to set a value for this option.  |
| --ssh_user  | No  | string  | N/A  | The username to use for an SSH connection. |
| --ssh_port   | No  | String | N/A | The port number to use for an SSH connection. |
| --user_password | No  | String  | N/A  | The password to use for an SSH connection. |
| --key_file | No   | String | "/~/.ssh/id_rsa" | The private key file to use for an SSH connection. This option takes effect only when `--user_password` is not specified. |
| --key_passphrase | No | String | N/A | The password to use for viewing the specified private key file. This option takes effect only when the `--key_file` option takes effect. |

## obshell cluster stop

You can run this command to stop the specified one or more OBServer nodes. For more information about the applicable scenarios of this command, see [Stop an OceanBase cluster](../210.use-case/200.cluster-management/320.stop-oceanbase-cluster.md).

```shell
${home_path}/bin/obshell cluster stop [-a] [-s] [-z] [-f] [-I] [-i] [-y]

# example
/home/admin/oceanbase/bin/obshell cluster stop -s 10.10.10.1:2886 -I
```

Here, `home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database.

The following table describes the options in the command.

| Option | Required? | Data type | Default value | Description |
| --- | --- | --- | --- | --- |
| -a/--all | No | N/A | N/A | Specifies to stop all OBServer nodes. You do not need to set a value for this option. By default, if you do not specify this option, only the OBServer nodes managed by the current obshell process are stopped. |
| -s/--server | No | String | N/A | The IP addresses and port numbers of the obshell-managed OBServer nodes to be stopped, with the information about each OBServer node specified in the format of `obshell_ip:obshell_port`.The information about multiple observer processes must be separated with commas (`,`). Example: `-s x.x.x.x:2886,x.x.x.x:2886`. |
| -z/--zone | No | String | N/A | Specifies to stop all OBServer nodes in the specified zones. The names of multiple zones must be separated with commas (`,`). Example: `-z zone1,zone2`. |
| -f/--force | No | Boolean | false | Specifies whether to forcibly kill the observer processes. You do not need to set a value for this option. |
| -I/--immediate | No  |  | N/A  | Specifies to run the `STOP SERVER` command. You do not need to set a value for this option. For more information about the `STOP SERVER` command, see [Isolate a node](../../../../../600.manage/100.cluster-management/300.common-cluster-operations/600.isolation-a-node.md). <main id="notice" type='explain'><h4>Note</h4><p>You can specify only one of the <code>-f</code> and <code>-I</code> options. </p></main> |
|  -i/--id | No | String | N/A | The ID of the preceding task that starts or stops the specified OBServer nodes. You can use this option in special circumstances. When a cluster O&M task is locked by one or more preceding tasks, you can specify the `-i` option to release the previous tasks. Example: `-i 22130706433028869`. |
| -y/--yes  | No  | N/A  |  N/A   | Specifies to cancel secondary confirmation. You do not need to set a value for this option.  |

## obshell cluster upgrade

You can run this command to upgrade OceanBase Database or obshell to the specified version. For more information about the applicable scenarios of this command, see [Upgrade an OceanBase cluster](../210.use-case/200.cluster-management/500.upgrade-oceanbase-cluster.md).

```shell
${home_path}/bin/obshell cluster upgrade -d [-m] [-V] [-t] [-y]

# example
/home/admin/oceanbase/bin/obshell cluster upgrade -d /home/admin/oceanbase/upgrade/ -V 4.2.2.0-20231224224959
```

`home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database.

The following table describes the options in the command.

| Option | Required? | Data type | Default value | Description |
| --- | --- | --- | --- | --- |
| -d/--pkg_directory | Yes | String | N/A | The directory where the upgrade package is stored, which must be an absolute path. |
| -m/--mode  | No | String | ROLLING | The upgrade mode. Valid values: <ul><li>`ROLLING`: During the upgrade, a majority of replicas are available for services. </li><li>`STOPSERVICE`: The service is suspended for an overall upgrade within a specified period of time. </li></ul> |
| -V/--target_version | No | String | N/A | The target version. You must specify the version in a valid format, such as `4.2.2.0` or `4.2.2.0-20231224224959`. If you do not specify this option, the latest OceanBase Database RPM package in the directory specified by `-d` is used. |
| -t/--tmp_directory | No | String | ${home_path}/upgrade | The temporary directory to use during the upgrade, which stores the downloaded packages and all files generated during decompression and installation. It must be an absolute path. |
| -y/--yes  | No  | N/A  |  N/A   | Specifies to cancel secondary confirmation. You do not need to set a value for this option.  |

## obshell cluster scale-out

You can run this command to add an OBServer node to the current cluster to be scaled out. For more information about the applicable scenarios of this command, see [Use obshell to scale out an OceanBase cluster](../210.use-case/200.cluster-management/400.scale-out-oceanbase-cluster.md).

```shell
${home_path}/bin/obshell cluster scale-out -z -s [--rp] [-d] [-r] [-p] [-P] [-l] [-o] [-y]

# example
/home/admin/oceanbase/bin/obshell cluster scale-out -s '10.10.10.1:2886' -z 'zone1' -o 'memory_limit=16G,system_memory=8G,log_disk_size=24G,datafile_size=24G' --rp *****
```

`home_path` specifies the installation directory of OceanBase Database. By default, obshell is installed in the `bin` directory under the installation directory of OceanBase Database.

The following table describes the options in the command.

| Option | Required? | Data type | Default value | Description |
| --- | --- | --- | --- | --- |
| -s/--server | Yes | String | N/A | The IP address and obshell port number of one of the OBServer nodes existing in the cluster to be scaled out, in the `ip:obshell_port` format. The obshell port number is optional. By default, port `2886` is used. |
| -z/--zone | Yes | String | N/A | The zone to which the OBServer node is to be added. |
| --rp/--rootpassword | No | String | N/A | The password for the `root` user of the `sys` tenant in the cluster to be scaled out. If the password is incorrect, the scale-out cannot be initiated.  |
| -d/--data_dir | No | String | ${home_path}/store |  The directory for storing SSTables and other data, which must be an absolute path. By default, the `store` directory under the working directory is used. The working directory is specified by the `home_path` parameter. |
| -r/--redo_dir | No | String | ${data_dir} |  The directory for storing clogs, which must be an absolute path. By default, the value of this option is the same as that of the `--data_dir` option. |
| -p/--mysql_port | No | Integer | 2881 |  The port number for the SQL service protocol. By default, port `2881` is used. |
| -P/--rpc_port | No | Integer | 2882 |  The protocol port number for remote access. By default, port `2882` is used. |
| -l/--log_level  | No  | String   | N/A    | The log level of the OBServer node. |
| -o/--opt_str | No | String | N/A | Other options for the OBServer node. You must specify each option in the `key=value` format, and separate multiple options with commas (`,`). The entire value string of the `-o` option must be enclosed by single quotation marks (`'`). Example: `-o 'memory_limit=16G,system_memory=8G,log_disk_size=24G,datafile_size=24G'`. |
| -y/--yes  | No  | N/A  |  N/A   | Specifies to cancel secondary confirmation. You do not need to set a value for this option.  |

## obshell cluster backup

This command is used to set backup-related configurations for all tenants in a cluster and initiate a backup. For more information about how to initiate a cluster-level backup, see [Initiate a cluster-level backup](../210.use-case/200.cluster-management/600.initiate-cluster-level-backup.md).

```shell
${home_path}/bin/obshell cluster backup [flags]

# example
/home/admin/oceanbase/bin/obshell obshell cluster backup -u /path/to/backup --backup_mode incremental --encryption MySecretPassword
```

`home_path` is the installation directory of OceanBase Database. By default, obshell is located in the `bin` directory of the installation directory of OceanBase Database.

The following table describes the options:

| Option | Required | Type | Default value | Description |
| --- | --- | --- | --- | --- |
| -u/--backup_base_uri | No | string | N/A | Sets the backup destination for all tenants. After you set this parameter, the data backup path and log archive path for each tenant are generated based on the specified backup destination and a certain rule. If you do not specify this parameter, the value of the `-u`/`--backup_base_uri` parameter specified in a previous backup is used. If no value is specified for this parameter in a previous backup, this parameter is set to an empty value. |
| -m/--backup_mode | No | string | full | The data backup mode, which can be either `full` or `incremental`, indicating full backup and incremental backup, respectively. |
| -c/--log_archive_concurrency | No | int | N/A | The total number of threads for log archiving. |
| -b/--binding   | No | string | Optional | Specifies the priority mode for archiving and business. Valid values include `Optional` (business takes priority) and `Mandatory` (archiving takes priority). If this parameter is not specified, the `Optional` mode is used by default. |
| -i/--piece_switch_interval | No | string | N/A | The cycle for switching pieces. Valid values are in the range of [1d, 7d]. |
| -e/--encryption  | No | string | N/A | The password for the backup set after the backup is completed. If this parameter is specified, you must enter the password when you restore from the backup set, and the password cannot be deleted. |
| -l/--archive_lag_target  | No | string | N/A | The maximum allowed latency for log archiving of a tenant. This parameter can be modified only after the log archive destination is configured. |
| -D/--delete_policy | No | string | default | The cleanup policy. A tenant with a specified cleanup policy triggers an automatic cleanup every hour. The value of this parameter can be only `default`, indicating that the cleanup scope is the backup specified in the `-u`/`--backup_base_uri` parameter. |
| -r/--delete_recovery_window | No | string | N/A | The time window for restoring backup data. The value of this parameter must contain a time unit. For more information about this parameter, see [Parameters for cleaning up backup data](../../../../../600.manage/600.backup-and-recovery/500.clear-backup-data/500.parameters-of-cleaning-up-backup.md). |
| -s/--ha_low_thread_score    | No | int | N/A | The number of current working threads for backup, backup cleanup, and other tasks with low priority. Valid values are in the range of [0, 100]. |
| -P/--plus_archive         | No | N/A | N/A | Specifies whether to back up archive logs during data backup. This parameter does not require a value. If this parameter is specified, a complete data set that includes archive logs is generated in the final backup directory. |