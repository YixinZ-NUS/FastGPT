# What's New

OceanBase 数据库 V4.3.5 是面向 AP 场景第一个 LTS 版本。在 V4.3.4 的基础上，新版本继续完善产品能力，新增了对嵌套物化视图的支持，并完善了全文索引和向量索引功能。此外，数据导入导出的能力也得到了增强：支持指定分区旁路导入、外表支持读取 ORC 格式文件，以及 SELECT INTO OUTFILE 现在支持导出 Parquet 和 ORC 格式。优化器能力的增强包括基于基线优先策略的 SPM 演进、优化器估行系统的改进、递归公用表表达式 (CTE) 的抽取与 INLINE 代价验证优化，此外，对 Query Range 提取能力也进行了强化。

在兼容性方面，OceanBase 数据库 MySQL 租户下兼容了 XA 事务功能，完善了 Latin1 字符集，Oracle 租户间的存储过程远程调用支持了复杂类型，助力 Oracle 和 MySQL 业务的平滑迁移。

在性能优化方面，V4.3.5 对表级恢复性能、旁路导入性能、DML 性能以及 DDL 性能都做了不同程度的优化，新版本不仅支持行存与列存的在线转换，还实现了快速中间加列，并且扩展了并行 DDL 操作。同时，通过将统计信息和 CLOG 日志提交集成到资源隔离机制中，并实现了 IO 层级的隔离，进一步增强了 OceanBase 数据库的资源隔离机制。此外，新版本还支持 SQL 级别的内存使用限制，并优化了存储过程的内存使用，以及通过共享线程池来减少租户的内存资源消耗，提升了多种场景下的稳定性。在易用性方面，对 ASH 和 WR 的诊断能力做了增强，支持日志流副本并行迁移优化，以及通过实现日志传输链路的监控视图来增强日志同步链路的可观测性，让 OceanBase 数据库更加好用。新版本支持了更丰富的 ARRAY 和 XML 表达式，对 JSON/XML/GIS 类型数据执行过程中内存占用进行了优化。同时对 OBKV-HBase 和 HBase 的兼容能力做了增强，并支持了 OBKV 的 P95/P99 指标观测。

本篇文章主要为您介绍 OceanBase V4.3.5 的一些关键功能特性以及主要的性能提升。

## 关键功能特性

* **支持嵌套物化视图**

    V4.3.5 之前的版本只支持在普通用户表上构建物化视图，而在数据仓库场景下，会使用物化视图来做数据加工，为了支持好轻量级实时数仓场景，V4.3.5 版本支持基于已有物化视图创建新的物化视图，即嵌套物化视图。嵌套物化视图所支持的刷新方式和非嵌套物化视图一样，都包括全量与增量刷新，所以 V4.3.5 支持基于物化视图创建物化视图日志。嵌套物化视图中数据的新鲜度与基表数据的新鲜度有关，为了保证上层物化视图数据的新鲜度，需要用户先刷新底层的物化视图。

    更多详细信息，参见 [创建物化视图（MySQL 模式）](700.reference/300.database-object-management/100.manage-object-of-mysql-mode/600.manage-views-of-mysql-mode/200.manage-materialized-views-of-mysql-mode/300.create-materialized-views-of-mysql-mode.md) 或者 [创建物化视图（Oracle 模式）](700.reference/300.database-object-management/200.manage-object-of-oracle-mode/500.manage-views-of-oracle-mode/200.manage-materialized-views-of-oracle-mode/300.create-materialized-views-of-oracle-mode.md) 中创建嵌套物化视图章节。

* **支持指定分区旁路导入**

    V4.3.5 支持 `LOAD DATA` 和 `INSERT INTO SELECT` 语法指定分区走旁路导入路径，不过不支持指定最后一级分区类型为 Hash/Key 的分区。

    更多详细信息，参见 [全量旁路导入](620.obap/300.obap-data-collection/300.obap-import-data/20.bypass-import/200.full-bypass-import.md) 或者 [增量旁路导入](620.obap/300.obap-data-collection/300.obap-import-data/20.bypass-import/300.incremental-bypass-import.md)。

* **全文索引功能增强**

    V4.3.5 版本对全文索引功能持续做了功能完善，主要包括：

    * 支持通过 `CREATE FULLTEXT INDEX` 或 `ALTER TABLE ADD FULLTEXT INDEX` 语句后建全文索引。
    * 支持基于代价的全文索引计划选择，对于存在包含 `MATCH AGAINST` 的多个 filter（过滤）的 SQL，支持根据代价选择开销较小的索引进行扫描。
    * 支持 Functional Lookup：

      * 支持查询语句中包含多个 `MATCH AGAINST` 表达式。
      * 支持走全文索引的同时走其他索引。
      * 支持不含 filter 语义的 `MATCH AGAINST` 作为投影列进行输出。
      * 支持 filter 语义的 `MATCH AGAINST` 使用 <=/< 等符号进行过滤。
      * 支持 filter 语义的 `MATCH AGAINST`，和其他 filter 语义的逻辑进行 AND/OR 链接。

    更多详细信息，参见 [MATCH AGAINST](700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/400.functions-of-mysql-mode/1000.other-functions-of-mysql-mode/2250.match-against-of-mysql-mode.md)。

* **SELECT INTO OUTFILE 功能增强**

    V4.3.5 对 `SELECT INTO` 导出功能进行了完善，支持了 `SELECT INTO` 导出 Parquet 和 ORC 类型，支持了 `SELECT INTO` 导出 CSV 类型时指定压缩算法，为 `SELECT INTO` 增加了新语法。

    * 使用 format 语法设置导出选项。
    * 导出 CSV 格式文件指定压缩算法。
    * 导出 Parquet 格式文件。
    * 导出 ORC 格式文件。

    更多详细信息，参见 [使用 OUTFILE 语句导出数据](500.data-migration/1000.use-sql-statements-migrate-data/300.use-outfile-statements-to-migrate-data.md)。

* **外表增强**

    在 V4.3.5 版本中，外表支持读 ORC 格式文件。

    更多详细信息，参见 [创建外表（MySQL 模式）](300.develop/100.application-development-of-mysql-mode/300.database-object-planning-of-mysql-mode/500.create-external-table-in-develop-of-mysql-mode.md) 或者 [创建外表（Oracle 模式）](300.develop/200.application-development-of-oracle-mode/300.database-object-planning-of-oracle-mode/400.create-external-table-in-develop-of-oracle-mode.md)。


* **中间快速加列**

    对于 MySQL 兼容方面，V4.3.5 将中间加列的 DDL 操作从 Offline DDL 改为 Online DDL，提升了中间加列的性能。支持中间 `ADD COLUMN` 以及中间 `ADD COLUMN` 与 `MODIFY COLUMN` 复合两种场景的 Online DDL。

### 性能提升

* **行存转列存操作支持异步 Online DDL**

    V4.3.0 版本支持了三种表存储格式：行存、纯列存和行列混存。将行存表转换为行列混存表或列存表的操作为 Offline DDL，可能会对客户造成影响。为此，V4.3.5 版本支持行存表异步转换为列存表，实现 Online DDL。用户在执行 DDL 语句时只需指定关键字 `delayed`，即可实时修改表的 Schema 信息，而不会阻塞数据写入。此外，列存的基线数据重整将在基线数据合并时异步执行。V4.3.5 版本现已支持将行存表转换为列存表和行列混存表的 Online DDL。

    更多详细信息，参见 [Online DDL 和 Offline DDL 操作](700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/700.ddl-function-of-mysql-mode/150.online-and-offline-ddl-list-of-mysql-mode.md) 和 [更改表](700.reference/300.database-object-management/100.manage-object-of-mysql-mode/200.manage-tables-of-mysql-mode/600.change-table-of-mysql-mode.md)。

* **旁路导入写入路径向量化**

    在 V4.3.5 版本之前，旁路导入的实现并未进行向量化，写入的函数均按行处理，导致函数调用开销较大。此外，写 SSTable 的过程是后台执行的，缺乏针对性的优化措施。V4.3.5 版本针对旁路导入路径进行了向量化，同时优化了列存 encoding，从而提升了旁路导入的性能。经过验证，无主键列存表的旁路导入性能提升约为 2 倍。

#### 可靠性提升

* **配置项及租户资源配置支持备份**

    V4.3.5 版本支持了集群级以及租户级配置项的备份。集群级配置项可以通过 `ALTER SYSTEM` 命令指定路径信息单独发起备份。租户级配置项会被包含在备份数据集中，执行数据备份时租户级配置项就会一起备份。执行租户级物理恢复时，建议目标租户的资源配置与源租户相同来有效的保证物理恢复的成功率以及后续生产业务的稳定性，为了给目标租户资源配置做参考，V4.3.5 版本还支持了备份租户的资源配置信息以及副本分布信息。

#### 安全强化

* 全面适配 Rocky linux 9 操作系统。

### 易用性提升

* **日志流副本并行迁移优化**

    从 V4.3.5 版本开始，支持一个日志流在不同 zone 上的副本可以并行迁移，可以加快扩缩容速度、提升负载均衡效率以及降低备库副本 rebuild 概率。同时主备租户对于日志流副本并行迁移的需求不同：主租户主要需求为 POC 场景时用于加速扩缩容速度，在常规使用时可能并不会开启并行迁移，这是因为多个副本同时迁移时拷贝数据量较大，有可能影响主副本的 IO 性能。备库对并行迁移是有强需求的，通过并行迁移可以有效降低备库副本 rebuild 概率。并行迁移优化提供租户级配置项 `replica_parallel_migration_mode` 用于控制日志流副本并行迁移功能模式。

    更多详细信息，参见 [replica_parallel_migration_mode](700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/7330.replica_parallel_migration_mode.md)。

#### OBKV/多模

* **Json 多值索引支持复杂 DML**

    V4.3.5 Json 多值索引完善了对复杂 DML 语句的支持，在 `UPDATE`、`DELETE` 等语句中可以支持多值谓词，同时支持了带多值索引回表的复杂 DML。

* **支持更丰富的 ARRAY 表达式**
    OceanBase 在 V4.3.3 版本中支持了 `ARRAY` 数据类型，为了更好的支持业务对 `ARRAY` 类型的使用，在 V4.3.5 版本支持了更多的 `ARRAY` 表达式，以满足业务多元化业务场景的需求。新版本新增了 `array_append`、`array_distinct`、`arrayMap`、`array_remove`、`cardinality`、`element_at`、`array_contains_all`、`array_overlaps`、`array_to_string`、`array_to_string`、`array_agg`、`unnest`、`rb_build` 等 `ARRAY` 表达式。

    更多详细信息，参见 [数组函数概述](700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/400.functions-of-mysql-mode/950.array-functions-of-mysql-mode/100.array-functions-overview-of-mysql-mode.md)。

* **向量索引功能增强**
    V4.3.5 版本除了对向量索引已有功能做了稳定性增强外，将向量索引支持的最大向量维度从 2000 维提高至 4096 维，并且新增支持了 cosine 距离算法，用户在随表建/后建索引时可以指定 cosine 距离算法，在执行 `SELECT` 查询时可以指定 `cosine_distance` 表达式过滤条件。

* **OBKV-HBase 兼容增强**

    OceanBase 在 V4.3.5 完善 Hbase 1.x/2.x 的兼容性，包括多 namespace 支持 /ColumnRangeFilter/ColumnValueFIlter/CheckAndMutateBuilder/ 混合 Batch/CheckAndMutateBuilder 等。


* **OBKV 响应时间统计直方图**

    在 V4.3.4 版本响应时间直方图功能基础上，新版本在 `[G]V$OB_QUERY_RESPONSE_TIME_HISTOGRAM` 系统视图中增加了 OBKV 相关的统计类别，包括 `TABLEAPI SELECT`、`TABLEAPI INSERT`、`TABLEAPI DELETE`、`TABLEAPI UPDATE`、`TABLEAPI REPLACE`、`TABLEAPI QUERY AND MUTATE`、`TABLEAPI OTHER`、`HBASE SCAN`、`HBASE PUT`、`HBASE DELETE`、`HBASE APPEND`、`HBASE INCREMENT`、`HBASE CHECK AND PUT`、`HBASE CHECK AND DELETE`、`HBASE HYBRID BATCH` 等。


## 相关文档

本篇文章主要向您介绍了重点的新增功能、关键特性等，如果想要了解更多版本详情以及其他各版本信息，请关注我们的版本发布记录：

- [企业版 V4.3.5 版本发布记录](https://www.oceanbase.com/product/oceanbase-database-rn/releaseNote#V4.3.5)
