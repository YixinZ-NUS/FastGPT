# OceanBase 路由策略配置指南

## 核心场景与解决方案

### 场景 1：TP/AP 可区分（推荐读写分离）

**场景描述**：业务可明确区分在线事务（TP，如订单提交）与分析（AP，如用户行为统计），AP 分析可以接受一定的最终一致性，则需通过路由策略隔离资源。

**解决方案**：

+ **读写分离配置**：

    - **实现方式**：
        * TP 请求路由到**主副本（Leader）**，确保事务一致性与低延迟。
        * 将 AP 请求路由到列存副本，确保 AP 请求通过列存存储执行查询，可加速聚合查询。


 更多信息，参考文档 [OceanBase 读写分离配置](../700.reference/1200.database-proxy/700.route-management/400.odp-routing-policy/100.read-write-splitting.md) 以及 [使用列存副本](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000003378476)。

+ **备优先读策略**：

    - **实现方式**：AP 查询优先读备副本（Follower），主副本仅处理 TP 请求。

更多信息，参考文档[备优先读配置](../700.reference/1200.database-proxy/700.route-management/400.odp-routing-policy/200.secondary-priority-read.md)。

#### 场景 2：TP/AP 不可区分

**场景描述**：AP 分析需要保证强一致，或者 TP 与 AP 业务很难切分。

**解决方案**：

+ **实现方式**：强制所有请求路由到主副本（Leader），例如通过以下参数配置：

```sql
-- 禁用弱一致性读
SET GLOBAL OB_READ_CONSISTENCY='STRONG';
```


<main id="notice" >
<h4>注意</h4>
<p>云数据库与内核有所差异，云上直连主地址（OceanBase Cloud 专属概念），即所有请求默认通过强一致性路由。但 AP 查询可能占用主副本资源，需通过云控制台启用资源组隔离。更多信息，参考 <a href="https://www.oceanbase.com/docs/common-oceanbase-cloud-1000000001018073">OceanBase Cloud 主地址配置</a>。</p>
</main>

## 其他路由策略扩展

| **策略类型** | **适用场景** |
| --- | --- |
| **LDC 路由** | 跨地域部署，就近访问副本 |
| **权重路由** | 按节点负载动态分配请求 |
| **随机路由** | 均匀分发读请求到所有可用副本 |


参考文档 [ODP 路由最佳实践](https://www.oceanbase.com/docs/common-best-practices-1000000001591716)

### 推荐阅读

+ 云用户：参考 [OceanBase Cloud文档](https://www.oceanbase.com/docs/common-oceanbase-cloud-1000000001018073)。
+ [ODP 读写分离路由策略](https://www.oceanbase.com/docs/common-odp-doc-cn-1000000002839701)
+ [OceanBase 读写分离最佳实践](https://www.oceanbase.com/docs/common-best-practices-1000000001489641)
+ [OceanBase AP 场景下读写分离配置指南](https://www.oceanbase.com/docs/common-best-practices-1000000003048509)
