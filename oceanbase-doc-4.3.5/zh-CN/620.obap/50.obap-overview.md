# OceanBase AP 概述

## OceanBase AP 是什么

OceanBase 是一款完全自研的企业级原生分布式数据库，在普通硬件上实现金融级高可用，首创“三地五中心”城市级故障自动无损容灾新标准，刷新过 TPC-C 标准测试世界纪录，单集群规模超过 1500 节点，具有云原生、强一致性、高度兼容 Oracle/MySQL 等特性。在 V4.3.x 版本中，OceanBase 数据库集中优化了分析处理（AP）能力，一套系统中支持联机交易（TP）与实时分析（AP）两种负载。此次更新实现了行存列存一体化存储引擎，同时推出了全新向量化引擎及基于列存路径的代价评估模型。其中，自研列存引擎的推出，是完整实时分析能力的里程碑。

![ap-intro](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/ap/ap-intro-1.png)

<div role="videolist">
      <a role='video' data-code='9001545' href='https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/video-center/video/video/08%20ap%20%E5%AE%9E%E6%97%B6%E5%88%86%E6%9E%90.mp4'>
          <img src='https://mdn.alipayobjects.com/huamei_22khvb/afts/img/A*DFPmToHK6hgAAAAAAAAAAAAADiGDAQ/original'/>
          通过视频和 Demo 了解 OceanBase 实时分析
      </a>
</div>

## 核心特性

* **列存/行存一体化存储引擎：**

  根据负载类型，灵活定义行存/列存/行列混存表，完善编码压缩、Skipindex、查询下压等能力，提高查询性能和压缩比。

* **向量化执行引擎：**

  全面升级向量化引擎，使用更优的列式数据描述格式, 并且基于新的格式全面优化算子和表达式以及存储向量化, 进一步大幅提升查询性能。

* **多模一体化：**

  多模类型全面支持，Btree 索引、JSON 多值索引、全文索引、向量索引等技术全面融合。

* **物化视图：**

  物化视图功能补齐，支持准实时/实时物化视图，及 SQL 自动改写，加速大查询。

* **数据导入：**

  进一步完善外表能力，支持 CSV、Parquet、ORC 等常见数据格式，兼容 S3、OSS、HDFS、ODPS 等多种存储系统，并接入 ODPS Catalog。

* **存算分离：**

  支持冷热数据分层，全量数据位于对象存储降低存储成本，热数据缓存在本地盘提升查询性能。计算节点、数据存储空间、日志服务均可单独扩展或缩减，保证高可用的同时提供极致性价比。

## 应用场景

#### 场景一：HTAP 混合负载场景

* 一体化极简架构：同一套引擎、同一份数据，同时支撑交易和分析负载，且可以根据业务需求选择行列混存和列存副本两种部署架构。
* 低成本海量存储：基于 LSM-Tree 以及高级压缩编码技术，存储成本相比传统方案降低 70%-90%。
* 支撑高并发计算：OceanBase 的对等架构，天生支持多机并行计算，最大支持 PB 级容量，轻松为业务的全域数据提供稳定的存储底盘。
* 多场景隔离：通过底层资源隔离技术以及用户资源组技术，做到多场景多用户的任务资源隔离。

![image1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/ap/ap1-1.png)

#### 场景二：实时数据分析场景

* 实时数据更新：基于 LSM-Tree 架构支持高效实时写入，增量数据行存，基线数据列存，定期/自适应执行合并，生成新的列存基线，数据一旦被写入，即可对外提供查询，保证了数据的实时性。
* 高准确性与强一致性：使用 Multi-Paxos 协议实现多副本间的数据一致性；采用 MVCC 模型，支持非阻塞读写，并保证读取数据的事务一致性；支持基于主副本的强读和其他副本的弱读；并基于 WAL 机制保障数据持久性与原子性。
* 高性能计算：通过列式存储技术、计算下压和基于压缩数据的查询处理完成高性能数据查询；利用优化器查询改写和基于规则/代价的计划选择能力，基于并行执行引擎、向量化引擎的执行优化，获得高计算性能；提供物化视图能力，进一步支撑海量数据的查询分析。
* 高可用性：继承 TP 形态的高可用能力，RPO=0，RTO<8s；支持单机房到三地五中心的灵活部署，支持系统自动容灾；云数据库还支持基于共享存储和独立日志服务的单副本形态，降本的同时最大程度保证系统的高可用。
* 平滑扩缩容：可在不中断服务的情况下，平滑进行横向、纵向扩缩容；横向扩缩容过程中，内置的数据动态均衡机制确保数据和服务负载在节点间均匀分布。
* 多模融合：多模类型全面支持，Btree 索引、JSON 多值索引、全文索引、向量索引等技术全面融合。
* 存算分离：支持多计算节点访问同一份存储数据，结合本地持久化缓存和对象存储，实现高性价比的存算分离架构。

![image2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/ap/ap3.png)

![image3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/ap/ap3-1.png)

#### 场景三：PL/SQL 批处理场景

* 极致性能提升，打破处理瓶颈。OceanBase 的列式存储引擎专为分析场景设计，数据按列存储，压缩比更高，I/O 大幅减少。结合向量化执行引擎，CPU 可以一次性在内存中对一批数据（而不是一行数据）进行计算，极大提升了 CPU 缓存命中率和计算效率。对于典型的批处理任务，可实现 10 倍甚至更高的性能提升，轻松满足甚至缩短业务批处理窗口，为准实时分析提供可能。
* 无感平滑迁移，业务风险最低。OceanBase 高度兼容 Oracle，不仅兼容常用的 SQL 语法、数据类型，更高度兼容 PL/SQL 存储过程。这意味着客户可以将 Oracle 中沉淀了大量业务逻辑的存储过程几乎不加修改地迁移到 OceanBase。应用层代码完全无需改动，极大降低了迁移的风险、成本和周期，让“不可能完成”的系统现代化改造成为可能。
* 一体化架构，实现降本增效。传统的“OLTP 数据库 + 数据仓库/大数据平台”的分离式架构，需要维护两套系统，数据需要经过复杂的 ETL/CDC 进行同步，架构复杂且成本高昂。OceanBase 的一体化架构，用一套系统同时承载在线交易和批处理分析。其内置的资源隔离机制，能确保分析任务在列存上运行时，不会与行存上的交易任务发生激烈资源冲突。这不仅简化了技术栈、降低了运维复杂度，还避免了数据冗余存储和跨系统同步的开销，显著降低了企业的总体拥有成本 (TCO)。

![image5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/ap/ap5.png)

## 技术架构

* 关于 OceanBase 数据库的技术架构介绍，参见 [OceanBase 系统架构](../100.learn-more-about-oceanbase/300.system-architecture.md)。
* 关于 OceanBase 数据库技术原理的详细介绍，参见 [OceanBase 系统原理](../700.reference/100.oceanbase-database-concepts/100.architecture-of-oceanbase.md) 章节。
