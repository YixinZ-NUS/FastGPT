# AP 场景下的参数配置推荐

针对混合事务与分析处理（HTAP）及实时分析（OLAP）两类业务场景，本文分别给出了对应的参数配置建议。

为了确保用户在各种业务场景下，能够基于 OceanBase 数据库获得比较好的性能，OceanBase 基于过往大量真实场景的调优经验总结了各类业务场景下一些核心配置项和变量的推荐配置，并将这些推荐配置放到内核 V4.3.2 以上版本的安装包中，可以在部署后直接查看。

此外，为了让用户更方便的使用，参数模版已经在 **OceanBase 云平台（OceanBase Cloud Platform，简称：OCP）** 和 **OceanBase 安装部署工具（OceanBase Deployer，简称 OBD）** 中支持，在使用 OCP 或者 OBD 创建集群和租户时，用户可以直接选择对应场景的参数模版直接完成设置。

## 参数配置模板

安装 OceanBase 数据库 RPM 包后，可以在 `/home/admin/oceanbase/etc` 目录下查看不同业务场景下的推荐参数配置的参数配置模板。

+ `default_parameter.json`：保存了配置项的推荐配置。
+ `default_system_variable.json`：保存了变量的推荐配置。

## 场景介绍

### 混合事务/分析处理（HTAP）

混合事务/分析处理（以下使用 HTAP），是一种指同时支持 OLTP (联机事务处理)和 OLAP (联机分析处理)的数据库管理系统或架构。混合事务/分析处理的场景包括需要实时分析和查询数据的业务环境，如金融交易、零售业、物流等领域。这些领域需要高效的事务处理和实时的数据分析和查询功能，以支持业务决策和分析。HTAP 架构的优势在于能够减少数据复制和转换的成本，提供实时的数据分析能力，加速业务决策过程。

+ 该场景下的推荐配置详细介绍和示例，请参见[配置最佳实践](../../400.deploy/700.best-practices.md)。

#### HTAP 场景配置项推荐值

| **配置项** | **推荐值** | **推荐值说明** | **级别** |
| --- | --- | --- | --- |
| [large_query_threshold](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/11100.large_query_threshold.md) | 600s | HTAP 工作负载中存在 AP 查询，我们也需要它快速运行。 | cluster |
| [enable_record_trace_log](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/7900.enable_record_trace_log.md) | False | 关闭追踪日志可以带来更好的 AP 性能。 | cluster |
| [enable_syslog_recycle](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/9000.enable_syslog_recycle.md) | True | 启用 syslog 自动回收可以防止日志文件填满磁盘空间。 | cluster |
| [max_syslog_file_count](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/13300.max_syslog_file_count.md) | 300 | 启用 `enable_syslog_recycle` 时，应将该值设置为适当的值。300 是一个经验值。 | cluster |
| [log_transport_compress_all](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/4900.log_transport_compress_all.md) | True | 在带宽有限的场景中，可以通过 RPC 压缩以少量 CPU 开销节省网络带宽。 | tenant |
| [default_load_mode](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/2050.default_load_mode.md) | DISABLED | 对于经典的 HTAP 工作负载，默认不使用旁路导入。 | tenant |
| [direct_load_allow_fallback](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/2240.direct_load_allow_fallback.md) | True | 对于经典的 HTAP 工作负载，当旁路导入失败时允许回退成普通导入方式。 | tenant |




### 实时分析（OLAP）
实时分析（OLAP）是一种数据处理技术，用于对大型数据集进行多维分析。它允许用户从不同的角度对数据进行复杂的分析，包括维度、度量、限制和排序等。OLAP 可以帮助用户识别和理解数据中的模式、趋势和关联，从而支持决策制定和业务智能。OLAP 技术通常用于数据仓库和商业智能系统中。

+ 该场景下的推荐配置详细介绍和示例，请参见[配置最佳实践](../../400.deploy/700.best-practices.md)。

#### OLAP 场景配置项推荐值
| **配置项** | **推荐值** | **推荐值说明** | **级别** |
| --- | --- | --- | --- |
| [enable_record_trace_log](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/7900.enable_record_trace_log.md) | False | 关闭追踪日志可以带来更好的 AP 性能。 | cluster |
| [trace_log_slow_query_watermark](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/23900.trace_log_slow_query_watermark.md) | 7d | AP 场景下无需定义慢查询。 | cluster |
| [large_query_threshold](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/11100.large_query_threshold.md) | 0ms | 表示关闭大查询的检测。 | cluster |
| [enable_syslog_recycle](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/9000.enable_syslog_recycle.md) | True | 启用 syslog 自动回收可以防止日志文件填满磁盘空间。 | cluster |
| [max_syslog_file_count](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/300.cluster-level-configuration-items/13300.max_syslog_file_count.md) | 300 | 启用 `enable_syslog_recycle` 时，应将该值设置为适当的值。300 是一个经验值。 | cluster |
| [default_table_store_format](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/2200.default_table_store_format.md) | column | AP 默认格式指定为纯列存表。 | tenant |
| _io_read_batch_size | 128K | 单次读取 IO 请求的最大批次大小。 | tenant |
| _io_read_redundant_limit_percentage | 50 | 单次读取 IO 请求中冗余数据的最大百分比（冗余数据指批次中间必须读取但已命中缓存或被跳跃索引过滤的数据块）。 | tenant |
| [default_load_mode](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/2050.default_load_mode.md) | FULL_DIRECT_WRITE | 对于经典的 OLAP 工作负载，默认使用全量旁路导入。 | tenant |
| [direct_load_allow_fallback](../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/2240.direct_load_allow_fallback.md) | False | 对于经典的 OLAP 工作负载，当旁路导入失败时直接报错，不允许回退成普通导入方式。 | tenant |
| _nested_loop_join_enabled | False | 对于经典的 OLAP 工作负载，禁用嵌套循环连接。 | tenant |
| default_table_organization | HEAP | 表中数据行的存储顺序。对于 AP 场景，表中的数据行没有特定的顺序存储。<br/>#### 说明<br/>该配置项从 V4.3.5 BP1 版本开始引入。 | tenant |


#### OLAP 场景变量推荐值
| **变量** | **推荐值** | **推荐值说明** | **级别** |
| --- | --- | --- | --- |
| [ob_query_timeout](../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/8600.ob_query_timeout-global.md) | 604800000000 | 设置为 7 天。 | tenant |
| [ob_trx_timeout](../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/9700.ob_trx_timeout-global.md) | 604800000000 | 设置为 7 天。 | tenant |
| [parallel_degree_policy](../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/10300.parallel_degree_policy-global.md) | AUTO | 表示启用 Auto DOP 策略。关于 Auto DOP 的详细介绍，参见 [Auto DOP](../../700.reference/1000.performance-tuning-guide/500.sql-optimization/300.distributed-execution-plan/600.auto-dop.md)。 | tenant |
| [parallel_min_scan_time_threshold](../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/10500.parallel_min_scan_time_threshold-global.md) | 10 | 对于执行时间在 100ms+ 的查询，可以带来最佳的并行执行性能。 | tenant |
| [ob_sql_work_area_percentage](../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/9100.ob_sql_work_area_percentage-global.md) | 30 | 设置比较大的工作区内存可以节省内存泄漏带来的成本。 | tenant |
| [collation_server](../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/1600.collation_server-global.md) | utf8mb4_bin | 相较其他 collation，使用二进制 collation 可以实现 20% 的性能提升。 | tenant |
| [collation_connection](../../700.reference/800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/1400.collation_connection-global.md) | utf8mb4_bin | 相较其他 collation，使用二进制 collation 可以实现 20% 的性能提升。 | tenant |


## 相关文档
+ [配置项和系统变量概述](../../700.reference/800.configuration-items-and-system-variables/000.configuration-items-and-system-variables-overview.md)
+ [设置参数](../../700.reference/200.system-management/200.configuration-management/200.set-parameters.md)
+ [设置变量](../../700.reference/200.system-management/200.configuration-management/300.set-variables.md)
+ [OCP 系统内置模板配置](https://www.oceanbase.com/docs/common-ocp-1000000002381079)
