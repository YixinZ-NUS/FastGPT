# AP 关键特性版本记录

本篇文档仅罗列了实时分析相关的核心能力变更。如需了解 OceanBase 数据库版本全量的能力增强和迭代，请参见[版本发布说明（Release Note）](https://www.oceanbase.com/product/oceanbase-database-rn/releaseNote)。

## V4.3.5 BP4

### 版本信息

* 发布时间：2025 年 09 月 10 日
* 版本号：V4.3.5 BP4

### 新增功能/能力增强

* 物化视图功能增强

  V4.3.5 BP4 持续对物化视图能力进行完善，从功能角度，支持增量刷新物化视图刷新时维度表不刷新，在创建物化视图时，通过新增的 AS OF PROCTIME() 语法指定不需要刷新的表，在执行物化视图增量刷新时，不刷新该表的增量数据；单表聚合的增量刷新物化视图支持 MIN()/MAX() 聚合函数；从易用性角度，支持 MLOG 的自动化管理：在创建增量刷新物化视图时，自动为基表创建/替换所需要的 MLOG 表，并在后台定期清理冗余的 MLOG 表；对物化视图的视图内容和创建物化视图的报错信息进行优化。

* AP 参数模板关闭默认开启全量旁路导入。

## V4.3.5 BP3

### 版本信息

* 发布时间：2025 年 07 月 21 日
* 版本号：V4.3.5 BP3

### 新增功能/能力增强

#### 外部数据源与集成优化

* **ODPS 外表适配 Storage API**

  基于 Tunnel API 的 ODPS 外表，执行阶段对每个分区的扫描，都需要开启独立的 Session 来处理，而打开 Session 需要秒级延迟，这导致一些本身耗时非常小的查询，会花费时间在 Session 准备阶段。除 Tunnel API 外，ODPS 还提供了一种开放的 Storage API，支持直接访问 ODPS 的底层存储，提供了更多的优化策略和更好的读取性能，因此新版本适配支持了 ODPS Storage API，进一步提升外表访问性能。

* **对象存储支持 Azure Blob**

  支持使用 Azure Blob 协议访问 Azure Blob 对象存储。

#### 物化视图全面增强

* **物化视图功能增强**

  新版本继续完善物化视图能力。主要包括物化视图支持 RENAME 能力、增量刷新支持外连接/UNION ALL/非聚合单表功能、物化视图日志支持加列、嵌套物化视图支持级联刷新能力，同时修复 DROP 物化视图卡住等多个问题，提升物化视图稳定性。

#### 存储与分区管理优化

* **分区交换支持一级与二级分区表交换**

  分区交换功能支持二级分区表的一级分区与一级分区表进行交换。

#### 优化器与查询性能提升

* **统计信息增强**

  V4.3.5 BP3 之前的版本，统计信息需要收集分区级和表级每一列的 MIN/MAX/NULL COUNT/NDV 等聚合数据，并通过采样来估算数据的分布，误差较大，新版本借助存储层的 Skip Index 能力，对列存所有列收集块级别的更准确的列聚合数据，帮助优化器进行更准确的计划生成和优化。新版本还引入分区渐进式收集统计信息的方式，来解决大分区表统计信息收集耗时长导致的超时问题，提升系统的稳定性和数据的实时性。

#### 数据导入加速

* **旁路导入性能优化**

  新版本针对旁路导入的执行逻辑进行性能优化，包括旁路导入排序算法、旁路导入向量化路径、csv 解析、column_conv 表达式、cs encoding 相关，在列存非分区堆表场景下，性能有最高 10% 的提升。



## V4.3.5 BP2

### 版本信息

* 发布时间：2025 年 05 月 15 日
* 版本号：V4.3.5 BP2

### 产品形态

- **新增 Shared-Storage AP 产品形态**

V4.3.5 BP2 版本开始，支持将 Shared-Storage 部署形态的 OceanBase 数据库用于 AP 业务。Shared-Storage AP 形态已支持 Shared-Nothing 下的关键 AP 特性，如列存表、增量旁路导入、物化视图、全文索引、多值索引等，并对 Shared-Storage 形态下 IO 读取方式进行了针对性优化。Shared-Storage AP 产品形态推荐用于存在数据冷热特征，希望进行存储降本的 AP 业务。

### 特性增强

#### 数据恢复能力增强

* **表级恢复支持恢复列存表**

  该版本前，表级恢复功能仅支持恢复成行存表。新版本在 Share Nothing 部署模式下完善了表级恢复功能，增加支持恢复成列存表/行列存混表。

#### 性能优化

* **堆表旁路导入性能优化**

  优化堆表旁路导入新建唯一索引过程中的唯一性校验流程，堆表全量导入非分区表性能不低于索引组织主键表性能。

* **硬解析性能优化**

  在一些 AP 场景或部分大小账号场景，关掉 Plan Cache 走硬解析的方式可以减少使用到差计划的情况。而关掉 Plan Cache 就对硬解析的性能提出了更高的要求。新版本通过优化 resolver 阶段的热点函数、将不必须全局代价验证的场景替换为局部代价验证、精简表达式内存占用、移除非必要的表达式类型推导操作等方案，提升了优化器 resolve、改写等阶段的性能。

#### 物化视图增强

* **全量刷新物化视图支持基于外表和普通视图构建**

  V4.3.5 BP2 版本前，OceanBase 数据库已经支持基于用户表和物化视图创建物化视图，新版本在全量刷新场景下增加支持基表为视图或外表的物化视图，扩展物化视图的适用场景。

* **物化视图诊断能力增强**

  新增 `CDB/DBA_MVIEW_RUNNING_JOBS` 系统视图用于展示正在进行的物化视图任务，如刷新任务、MLOG 清理任务等。新增 `DBA_MVIEW_DEPS` 系统视图用于展示物化视图的依赖对象信息。`CDB/DBA/ALL/USER_MVIEWS` 系统视图增加物化视图刷新位点和刷新延迟时间记录。`CDB/DBA/ALL/USER_MVIEW_LOGS` 视图增加 MLOG 清理使用的并行度和耗时信息。

* **物化视图任务接入资源隔离**

  物化视图的刷新、Purge 等操作会消耗系统资源，可能因此影响前台任务的性能。新版本基于 Resource Manager 为物化视图的增量刷新、MLOG Purge 提供了资源隔离的能力，用户可以限定物化视图任务使用的资源上限。

#### 分区管理

* **动态分区管理**

  业务常常会选择以日期或时间作为 Range 分区键，将不同时间段的数据划分至不同分区中，目前会要求 DBA 定期地预创建一些未来时间的分区来满足数据写入。一旦因为某些原因 DBA 忘记预创建分区，可能会导致数据因为分区不存在而写入失败，对业务造成影响。因此，新版本提供了一种动态分区管理的功能，通过为表指定动态分区管理属性，在内核层面自动预创建未来时间的分区，减轻 DBA 的负担。同时，动态分区管理也支持自动删除业务不再需要的过期分区，节省存储。

#### 索引与查询优化

* **全文索引 NGRAM2 分词器**

  全文索引新增内置 `NGRAM2` 分词器，支持基于 `min_ngram_size` 到 `max_ngram_size` 范围内的 `NGRAM` 分词。 `NGRAM2` 分词器适用于对性能和存储空间相对不敏感且需要对不同长度的 `token` 进行检索的场景。对于定长 `token` 可以使用 `NGRAM` 分词器。


#### 数据类型及存储优化

* **Map 数据类型**

  Map 数据类型用于存储无序的键值对 (key-value pair)，例如 {a:1, b:2, c:3}，常见使用场景包括保存配置选项信息、用户属性、产品信息等。OceanBase 在 4.3.5BP2 版本基于 Array 框架实现了 Map 数据类型，并支持了 Map 构造函数及 map_keys、map_values、=/!= 等函数和操作符。

* **MySQL 模式 JSON 半结构化存储**

  半结构化数据当前都以二进制串的形式存储，难以利用 Encoding 进行编码压缩，每条数据为了做到自解释，实际上冗余存储了一些数据 Meta，存储压缩率比较低。而 JSON 是一种典型的半结构化数据，有较强的结构化特征，理论上可以将半结构化数据在逻辑上拆分成多个基础类型的列，不可拆解的部分则放在一个 Binary 列中，结构化列可以利用 Encoding 提高压缩率，不可拆解的部分，由于提取了数据 Meta 相比以前空间占用也会减少，我们称之为“半结构化列的结构化存储”。OceanBase 在 4.3.5BP2 支持了 JSON 类型的半结构化存储，并实现了对应的编码方式，降低了存储空间占用，并优化了针对 JSON 子列的查询过滤性能。但因为 JSON 被拆成多个子列存储，对于需要频繁读取原始 JSON 数据的场景，引入了合并开销，会有性能回退，需要根据业务类型选择是否开启该特性。

#### 查询执行

* **Plan Cache 自适应**

  Plan Cache 是 TP 场景至关重要的能力，因此会默认开启。而在某些 AP 场景下，计划执行时间是计划生成时间的很多倍，这种情况下让优化器每次生成计划比计划复用往往能使用到更优的执行计划，进而获得更好的执行性能。不同场景下，尤其是 HTAP 混合负载场景中，需要提供一种方式让偏 AP 的 SQL 走硬解析，偏 TP 的 SQL 依然可以复用计划省去硬解析开销。因此，OceanBase 在新版本支持了一种 Plan Cache 自适应的能力，可以根据 SQL 执行时长和耗时分布特征来决策是否使用该 SQL 的 Plan Cache。

#### 外部数据源集成

* **MySQL 模式 ODPS（MaxCompute） Catalog**

  为了方便查询存储在各类外部数据源中的数据，新版本支持了 External Catalog 框架，并在一期支持了 ODPS Catalog 功能。OceanBase 原有的内部对象归属于 Internal Catalog；用户可自己创建 External Catalog 来连接外部数据源，获取外部数据的元信息。支持直接查询 External Catalog 下的表数据，如 select col1 from catalog1.database1.table1;  满足权限要求时，也支持任意跨 Catalog 的表关联查询。无需再进行数据导入或一张张单独创建外表，提高了外部数据访问的易用性。

#### 数据导入

* **Load Data 导入 URL CSV 外表容错模式**

  Load Data 方式导入数据，当前遇到数据类型不兼容、精度不匹配等问题时，会直接报错。新版本增加  LOG ERRORS 指令用于容错导入，MySQL 模式下会记录失败行，通过 show warnings 查看错误数据，进行错误诊断。


## V4.3.5 BP1

### 版本信息

* 发布时间：2025 年 03 月 18 日
* 版本号：V4.3.5 BP1

### 新增功能/能力增强

#### 数据导入与导出

* **增量旁路导入支持堆表带唯一索引**

  旁路导入分为全量旁路导入和增量旁路导入，在表中已存在数据的情况下，增量旁路导入性能优于全量旁路导入。但此前增量旁路导入不支持将数据导入带有唯一索引的堆表，新版本支持了使用增量旁路导入将数据导入带有一个局部唯一索引的堆表的功能。

* **旁路导入支持 HASH 分区及分区并发导入**

  从 V4.3.5 BP1 版本开始支持 HASH 类型的分区级旁路导入；同时增量旁路导入支持了多分区的并发导入，但当多个导入任务有重合的分区的时候，不支持分区并行导入。

* **旁路导入性能优化**

  通过向量化优化、临时文件流程精简、各阶段计算性能优化，clickbench 表导入性能相对 V4.3.5 提升 17%。

#### 外部数据源集成

* **外表支持读取 HDFS 文件**

  HDFS 是数据湖架构中最常见的存储介质，是多引擎数据共享的平台。因此 OceanBase 新版本支持了通过外表直接读取 HDFS 上的文件，也支持通过相关配置，接入带 Kerberos 认证的 HDFS 集群。

* **外表支持读写 MaxCompute（ODPS）数据源**

  新版本支持通过外表或 URL 外表，从 MaxCompute 读取数据，也支持将 OceanBase 数据写回 MaxCompute。

* **URL 外表**

  在 OceanBase 访问外部数据源时，通常需要先创建外表，再使用 SQL 查询。4.3.5BP1 新增支持 URL 外表功能，可通过 select 语句直接查询外部的 CSV/Parquet/ORC 和 Maxcompute 数据，而不需要创建外表。在此基础上，也扩展了 load data 语法直接引用 URL 外表进行数据导入，降低了数据导入的操作成本。

#### 索引优化

* **全文索引特性增强**

  OceanBase V4.3.1 版本开始在 MySQL 模式下支持全文索引，随着版本演进又逐渐进行了一些功能补充和扩展。V4.3.5 BP1 新增内置的中文 `IK` 分词器，支持 `smart`、`max_word` 两种分词模式；除此之外也支持了插件形式新增分词器。新增全文索引的分词器属性，支持表级的 `PARSER_PROPERTIES` 配置。在已有的全文索引查询自然语言模式外，还新增了布尔模式，可以在 `MATCH AGAINST` 下使用 `IN BOOLEAN MODE` 关键短语开启，支持 `+`、`-`、`（）`、无操作符等布尔运算符及运算嵌套。同时本期还支持了全文索引参与 Index Merge，通过索引 union merge 的计算，提升查询性能；并优化了对主表全文索引列的更新/删除场景，加快更新/删除性能。

#### 物化视图增强

* **物化视图增强**

  物化视图的刷新并行度与增量/全量刷新的效率紧密相关，新版本支持了完整的并行度控制机制，支持通过 `mview_refresh_dop` 系统变量、`DBMS_MVIEW.refresh` 子程序或创建物化视图时指定 `PARALLEL` 来设置刷新并行度。新版本的增量物化视图支持了 `LOB` 类型，也提供了直接修改物化视图或物化视图属性的能力，通过 `ALTER MATERIALIZED VIEW`/`ALTER MATERIALIZED VIEW LOG` 命令修改物化视图的并行度、后台刷新任务的时间周期、MLOG 表的并行度、MLOG 表后台清理任务的时间周期及 MLOG 的 LOB 内联存储长度阈值等。另外当在基表上创建 MLOG 之后，无法对基表再进行增加列的操作，只能先删除 MLOG 再做 DDL ，比较复杂，所以新版本支持了在 MLOG 基表上加列的操作，既包含末尾加列，也包含中间加列。除此之外，新版本也提升了 MLOG 清理性能，优化了增量刷新的报错信息。


#### 表结构与存储优化

* **堆表表组织模式**

  OceanBase 采用聚集索引表模型，这种设计在 OLTP 环境中表现优异。它将主键和主表数据存储在同一张表中，从而优化了主键查询速度和唯一性校验性能。然而，这种模型在需要高效数据导入和复杂数据分析的 OLAP 场景中，存在一定的局限性。导入过程需要对全量数据进行排序，查询时必须进行主键行融合，这些都对性能造成了影响。新版本增加支持堆表表组织模式，主键用于唯一性约束，而查询则依赖于主表，当用户数据按时间排序时，能够更有效地利用 skip index 提高查询效率。另外将主键与数据解耦后，导入过程中不需要对主表数据进行排序，进而提升了数据导入性能。

#### 数据类型与存储优化

* **MySQL 模式新增 String 数据类型**

  一些 AP 业务对列长的宽容度会比较高，往往使用不定长字符串类型来存储数据，并且需要做主键或索引键。在 OceanBase 中，char/varchar类型可以存储字符串并作为主键或索引键，但是需要指定长度，mediumtext/text 等 lob 类型可以存储不定长字符串，但是不能做主键或索引键。为了更好地满足 AP 业务需求，新增 String 数据类型，无需指定长度，默认最长 16MB。当列长小于 16KB 且不大于 lob_inrow_threshold 时，支持作为主键或索引键。

* **ARRAY 类型相关函数完善**

  OceanBase 在 4.3.3 版本支持了 ARRAY 数据类型，并支持了一些常用函数、操作符。新版本进一步完善相关函数，新增 `array_prepend`、`array_concat`、`array_compact`、`array_filter`、`array_sort`、`array_sortby`、`array_length`、`array_range`、`array_sum`、`array_first`、`array_difference`、`array_min`、`array_max`、`array_avg`、`array_position`、`array_slice`、`reverse` 等函数支持。

#### 并行查询优化

* **PX 计算节点与数据节点解耦**

  在当前的系统架构中，存储资源与计算资源高度耦合。现有的 PX 调度机制，对于 Non-Leaf DFO，仅选择数据所在的机器进行计算任务的分配，这种紧密耦合在某些场景下限制了机器资源的充分利用。为了让大 SQL 可以利用更多机器计算，新版本支持了将 PX 计算节点与数据节点解耦，通过配置项或 hint （PX_NODE_POLICY）决定 Non-Leaf DFO 的候选资源池，也提供了 hint （PX_NODE_ADDRS、PX_NODE_COUNT） 强制指定Non-Leaf DFO分配到的具体的机器或机器数。

#### 查询优化与下压

* **行存数据加列场景支持查询下压**

  行存 SCAN 过程中，对于无交集的数据，即 major sstable 和其他地方没有 rowid 相同的数据时，会将 SCAN 下压到存储层进行。当合并后，又添加新列时，SCAN 理论上是可以进行下压，但是由于新列的解析失败，会导致下压失败，回退到性能较差的逐行读取。新版本针对这一场景进行了特殊优化，支持查询下压到存储层，进而提升查询性能。

#### 列存存储优化

* **列存副本优化**

  在 V4.3.3 版本发布的列存副本特性存在一些限制，如只支持单个 C 副本，无法直接向 C 副本全量导入列存数据、用户易用性程度不够等。新版本针对性地放开了这些限制，一个集群支持指定多个 C 副本，支持对 C 副本直接全量旁路导入列存数据，同时新增了用于分区级和日志流级列存副本转换进度展示的系统视图 `CDB/DBA_OB_CS_REPLICA_STATS`，便于用户观察列存副本状态。

### 行为变更

* **AP 参数模版禁用 NLJ**

  优化器生成 nested loop join 计划后，对驱动表的行数比较敏感，驱动表的行数估计偏小时，计划的实际执行性能可能会严重下降。OLAP 场景下，数据量普遍较大，使用 nested loop join 计划带来的收益有限，所以 AP 场景下修改为默认生成 hash join 计划，只会在非等值连接场景生成 nested loop join 计划。

## V4.3.5

### 版本信息

* 发布时间：2024 年 12 月 31 日
* 版本号：V4.3.5

### 新增功能/能力增强

#### 物化视图增强

* **支持嵌套物化视图**

  V4.3.5 之前的版本只支持在普通用户表上构建物化视图，而在数据仓库场景下，会使用物化视图来做数据加工，为了支持好轻量级实时数仓场景，V4.3.5 版本支持基于已有物化视图创建新的物化视图，即嵌套物化视图。嵌套物化视图所支持的刷新方式和非嵌套物化视图一样，都包括全量与增量刷新，所以 V4.3.5 支持基于物化视图创建物化视图日志。嵌套物化视图中数据的新鲜度与基表数据的新鲜度有关，为了保证上层物化视图数据的新鲜度，需要用户先刷新底层的物化视图。

  更多详细信息，参见 [创建物化视图（MySQL 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000002016846) 或者 [创建物化视图（Oracle 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000002016839) 中创建嵌套物化视图章节。

#### 数据导入与导出

* **支持指定分区旁路导入**

  在 V4.3.5 版本之前 OBServer 仅支持整表数据导入走旁路导入路径，从而加速导入。如果用户想要只导入部分分区的数据，可以通过分区交换的方式，即先通过全量旁路导入将分区的数据导入到非分区表中，然后将对应非分区表与目标分区做分区交换，这个操作对用户来说比较麻烦。为了更好的支持分区级的数据导入，V4.3.5 支持 `LOAD DATA` 和 `INSERT INTO SELECT` 语法指定分区走旁路导入路径，不过不支持指定最后一级分区类型为 Hash/Key 的分区。

  更多详细信息，参见 [全量旁路导入](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000002012783) 或者 [增量旁路导入](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000002012782)。

* **`select into outfile` 功能增强**

  V4.3.5对 `select into` 导出功能进行了完善，支持了 `select into` 导出 parquet 和 orc 类型，支持了 `select into` 导出 csv 类型时指定压缩算法，为 `select into` 增加了新语法。

   * 使用 format 语法设置导出选项
   * 导出 csv 格式文件指定压缩算法
   * 导出 parquet 格式文件
   * 导出 orc 格式文件

#### 索引增强

* **全文索引功能增强**

  V4.3.5 在 V4.3.4 的基础上对全文索引功能持续做了功能完善，主要包括：

    - 支持通过 `CREATE FULLTEXT INDEX` 或 `ALTER TABLE ADD FULLTEXT INDEX` 语句后建全文索引。
    - 支持基于代价的全文索引计划选择，对于存在包含 `MATCH AGAINST` 的多个 filter（过滤）的 SQL，支持根据代价选择开销较小的索引进行扫描。
    - 支持 Functional Lookup：
        * 支持查询语句中包含多个 `MATCH AGAINST` 表达式。
        * 支持走全文索引的同时走其他索引。
        * 支持不含 filter 语义的 `MATCH AGAINST` 作为投影列进行输出。
        * 支持 filter 语义的 `MATCH AGAINST` 使用 <=/< 等符号进行过滤。
        * 支持 filter 语义的 `MATCH AGAINST`，和其他 filter 语义的逻辑进行 AND/OR 链接。

  更多详细信息，参见 [MATCH AGAINST](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000002017607)。

#### 外部数据源集成

* **外表增强**

  在 V4.3.5 版本中，外表支持读 ORC 格式文件。

  更多详细信息，参见 [创建外表（MySQL 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000002013230) 或者 [创建外表（Oracle 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000002013197)。

#### 列存存储优化

* **只读列存副本**

 V4.3.3 版本支持的只读列存副本功能为实验特性，经过 V4.3.4 和 V4.3.5 版本的迭代，在 V4.3.5 此功能已达到 GA 要求。

* **行存转列存操作支持异步online ddl**

  V4.3.0 版本支持了表的三种存储格式：行存/纯列存/行列混存，将行存表转为行列混存表/列存表是 offline ddl。为了降低 offline ddl 对客户的影响。V4.3.5 版本支持行存转列存异步 online，执行 DDL 时指定关键字 delayed，即可实时修改表 schema 信息，不阻塞用户的数据写入来达到 online 的目的，然后列存基线数据重整在基线数据合并时异步执行。V4.3.5 支持行存表转列存表以及行存表转行列混存表为 online ddl。

#### 性能优化

* **旁路导入写入路径向量化**

  在V4.3.5版本前，旁路导入的实现中没有做向量化，写入的函数都是按行处理的，函数调用开销极大。并且写 sstable 是后台流程，对于有些操作没有做针对性的优化。V4.3.5版本针对旁路导入路径做向量化，并且优化列存 encoding，从而提升旁路导入的性能。经验证，无主键列存表场景的旁路导入性能可以优化2倍左右。

#### 数据类型与存储优化

* **Json 多值索引支持复杂 DML**

  V4.3.5Json多值索引完善了对复杂 DML 语句的支持，在 `update`、`delete` 等语句中可以支持多值谓词，同时支持了带多值索引回表的复杂DML。

* **支持更丰富的 array 表达式**

  OceanBase 在 V4.3.3 版本中支持了 ARRAY 数据类型，为了更好的支持业务对 ARRAY类型的使用，在 V4.3.5 版本支持了更多的 ARRAY 表达式，以满足业务多元化业务场景的需求。新版本新增了 `array_append`、`array_distinct`、`arrayMap`、`array_remove`、`cardinality`、`element_at`、`array_contains_all`、`array_overlaps`、`array_to_string`、`array_to_string`、`array_agg、unnest`、`rb_build` 等 array 表达式。

## V4.3.4

### 版本信息

* 发布时间：2024 年 10 月 31 日
* 版本号：V4.3.4

### 新增功能/能力增强

#### 存储架构优化

* **共享存储（实验特性）**

  为了在公有云环境为用户提供更有性价比的数据库服务，OceanBaseV4.3.4 基于通用的对象存储首次推出 Shared-Storage Cluster 共享存储架构。通过租户多副本在标准对象存储上共享一份基线数据和日志数据，且通过自动冷热分离的机制，将热数据存储在云盘或本地 SSD 上，冷数据存储在标准对象存储上，从而达到降低数据库存储成本的目的；由于租户的各副本在本地存储上只缓存了热点数据和日志，使得计算节点能够快速扩缩容。共享存储架构目前适用于冷热数据比较分明的TP业务，且业务对延迟不敏感，比如历史库，备份库等场景，以及 KV 和时序业务。

  V4.3.4 该功能定义为实验特性，将在后续版本继续完善为正式生产特性。

#### 索引能力增强

* **全文索引能力增强**

  OceanBase 自 4.3.1 版本开始支持全文索引功能，通过预先处理文本内容，建立关键词索引，有效提升全文搜索效率。但在涉及全文索引的复杂 DML 场景，还存在一些使用限制，给业务带来一些使用上的不便。为了更好地支撑业务发展，4.3.4 版本完善了复杂 DML功能，对包含全文索引的主表，支持了 INSERT INTO ON DUPLICATE KEY、REPLACE INTO、多表更新删除以及可更新视图等复杂 DML操作。此外，新版本也基于向量执行、扩展 TAAT 处理策略等方式优化了全文搜索性能，并放开了MATCH AGAINST 谓词 token 数量限制，支持了对无主键分区表创建全文索引。同时，新版本还支持了通过 tokenize 函数查看分词结果，用以支持分词系统的调试。

  更多详细信息，参见 [创建多值索引](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001576029#20-title-%E5%88%9B%E5%BB%BA%E5%A4%9A%E5%80%BC%E7%B4%A2%E5%BC%95)。

* **多值索引能力增强**

  目前，多值索引仅支持预创建索引，DML、DDL等操作存在一些使用限制。为了更好地支持业务使用，在V 4.3.4 版放开了一些使用限制，对功能进行增强。主要是支持复杂 DML 操作，包括 `INSERT INTO ON DUPLICATE KEY`、`REPLACE INTO`、多表更新/删除及可更新视图 DML 功能。


#### 数据导入优化

* **增量旁路导入支持非唯一局部索引**

  OceanBase 支持全量旁路导入和增量旁路导入，在表中已存在数据的情况下，增量旁路导入性能优于全量旁路导入，此前增量旁路导入不支持将数据导入带有索引的表，V4.3.4 支持了增量旁路导入下将数据导入带有非唯一局部索引的表的功能。

* **旁路导入性能优化**

  旁路导入导数时，对有主键表需要排序的情况，会把数据先写入到临时文件，然后从临时文件加载到内存中，进行排序和归并处理，最后写入 sstable。这种方式将数据的导入分成了两个阶段：写数据阶段和排序归并阶段，如果数据没有完全写入，后续的排序归并阶段就无法开始；如果写入io达到瓶颈，也会间接的导致旁路导入性能达到瓶颈。V4.3.4 对数据的导入方式进行优化，数据不再写入临时文件，而是直接写进内存，再进行后续的排序和归并处理。优化之后，数据导入、数据排序都是流水线式进行的，避免了前一阶段对于后一阶段的影响。在主键表场景，1T 数据量下，导入的整体的性能提升 35%，优化效果明显。内存和 CPU 越大，数据的处理、轮转过程性能提升越大，所以本优化非常适用于大规格租户场景，同时，对小规格租户，性能不会有明显的回退。

#### 数据类型与存储优化

* **Bitmap 功能增强**

  Bitmap，也称为位图，是一种用来高效存储和处理集合中是否存在某个元素的数据结构。OceanBase V4.3.2 、V4.3.3 相继支持了 RoringBitmap 的部分功能，V4.3.4 继续完善，新增 `rb_iterate` 和 `rb_select` 表达式。`rb_iterate` 用于将 roaringbitmap 类型按元素数量展开成一列多行，`rb_select` 用于根据条件筛选 roaringbitmap 类型内的元素，并返回新的 roaringbitmap 类型。


## V4.3.3

### 版本信息

* 发布时间：2024 年 9 月 30 日
* 版本号：V4.3.3

### 新增功能/能力增强

#### 列存存储优化

* **只读列存副本（实验特性）**

  OceanBase V4.3.0 开始支持了列式存储，根据不同的业务类型，用户可以选择创建列存表、行存表或行列混存表。无论定义成哪种表形态，副本模式在租户不同 Zone 内都是一致的。举个例子，租户 X unit 分布为 1:1:1，T1 为行列混存表，那 T1 表在 3 个 Zone 上都会各存在一个行存副本和一个列存副本。为了满足 HTAP 混合负载场景下，TP、AP 资源物理强隔离的诉求，V4.3.3 推出了一种全新的部署形态，支持在原集群基础上，扩展单独的 Zone 来存放只读列存副本（Column Store Replica，简称：C 副本）。在该 Zone 上所有用户表均为列存格式存储，AP 业务可以使用独立的 ODP，通过 SESSION 级系统变量 `ob_route_policy` 设置路由策略为 `COLUMN_STORE_ONLY` 来访问列存副本进行弱读方式的查询分析，而不影响原 TP 业务。另一方面，类似 3+1 Zone 的部署形态，相比行列混存，也会节省一些存储开销。需要配套 ODP V4.3.2 及以上版本使用。更多详细信息，参见 [列存副本](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001431875)。

  V4.3.3 将该功能定义为实验特性，将在后续版本继续完善为正式生产特性。

#### 物化视图增强

* **物化视图能力增强**

  为了减少业务手工改写成本，OceanBase V4.3.1 开始支持物化视图改写能力，在系统变量 `QUERY_REWRITE_ENABLED` 设置为 `True` 的情况下，创建物化视图时可以通过指定 `ENABLE QUERY REWRITE` 来使用自动改写能力，此时系统可以将对原始表的查询改写为对物化视图的查询。V4.3.1 支持了非聚合物化视图在 `FROM` 完全匹配 `WHERE` 部分匹配情况下的改写，V4.3.3 进一步支持了非聚合物化视图的 `FROM` 连接兼容、查询包含物化视图中不存在的表的改写，并支持了聚合物化视图改写及聚合上卷改写。

  同时，新版本也扩展了增量刷新和实时物化视图支持的 SQL 类型。早期版本已经支持了单表聚合、多表连接场景的增量刷新和实时查询，V4.3.3 新增连接聚合场景的支持。更多详细信息，参见 [物化视图查询改写（MySQL 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001432591) 和 [物化视图查询改写（Oracle 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001432582)。

  此外，OceanBase 之前版本仅支持行存储格式的物化视图，V4.3.3 开始，将扩展列存储格式的物化视图支持，从而有机会在一些部分包含物化视图引用的复杂分析场景获得更好的查询性能。更多详细信息，参见 [创建物化视图（MySQL 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001432590) 和 [创建物化视图（Oracle 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001432586)。

#### 数据导入与导出优化

* **外表导入性能优化**

  V4.3.3 优化了旁路导入中读外表数据阶段的执行性能，相对前一版本提升约 15%。

* **INSERT OVERWRITE 能力增强**

  OceanBase V4.3.2 开始支持表级覆盖写能力（INSERT OVERWRITE），原子实现表内旧数据清空和新数据写入，来支撑一些数据定期刷新、数据转换、数据清洗修正的 AP 业务场景。但 V4.3.2 仅支持了整表替换写入，未提供分区级替换写入和指定部分列替换写入的能力。V4.3.3 补充完善了该特性，支持在 INSERT OVERWRITE 语句中指定目标表为一级或二级分区，也支持指定目标表的部分列信息，使得数据替换写入的方式更加灵活、适用于更多业务场景。

* **Load Data/外表支持压缩文件**

  Load Data 是一种常用的数据导入方式，包含普通服务端导入、旁路导入、客户端导入等使用场景，均可把既定格式的文本文件导入到数据库中。但之前版本仅支持普通的文本文件，类似 GZIP 压缩文件必须先解压再导入，操作起来较复杂。新版本开始支持导入压缩文件，GZIP、DEFLATE、ZSTD 格式的压缩文件可以做到边加载、边解压、边写入。在此基础上，CSV 文件外表也扩展了压缩文件的支持，可以通过访问外表直接查询以上压缩格式的文件数据。

#### 数据类型与存储优化

* **ARRAY 数据类型**

  ARRAY 是 AP 业务中常用的复杂数据类型，可以储存多个同类型的元素，在涉及到管理和查询关系型数据不能有效表示的多值属性时，ARRAY 类型是个合适的选择。OceanBase V4.3.3 在 MySQL 模式下开始支持 ARRAY 类型，建表时可以定义某列为数值型或字符型的数组类型，并允许定义为嵌套数组；支持构造表达式用于数组对象的查询或写入，支持 array_contains 表达式和 ANY 操作符用于判断数组中是否包含某个元素；同时也支持了+/-/=/!= 等操作符进行数组元素计算和判断。

* **RoaringBitmap 性能优化**

  V4.3.2 支持了 RoaringBitmap 数据类型及相关表达式，用于支撑用户画像、个性化推荐、精准营销等业务场景的多维分析需求，但部分场景下性能不优。新版本重点分析了 RoaringBitmap 类型计算的性能问题，优化内存申请和表达式执行逻辑，精简非必要的性能开销，数倍提升 cardinality、and/or/xor/andnot 及聚合场景下的执行性能。

#### 资源管理与隔离

* **QUERY 级资源组设定**

  OceanBase 当前已支持通过 DBMS_RESOURCE_MANAGER 系统包配置用户级、后台任务级、列参数级的资源组，进行 CPU 和 IOPS 的资源隔离。V4.3.3 新增 QUERY 级的资源组绑定能力，通过在 SQL 中指定 `/*+ resource_group('group_name') */` HINT，可以强制该条语句使用相应的资源组资源，若资源组不存在，使用当前默认的资源组。切换资源组时，会话需要重连生效。

## V4.3.2

### 版本信息

* 发布时间：2024 年 7 月 16 日
* 版本号：V4.3.2 Beta

### 新增功能/能力增强

#### 数据导入与导出优化

* **增量旁路导入功能增强**

  V4.3.1 开始支持增量旁路导入实验特性，存在一些限制，如不支持 `outrow lob` 的数据导入，仅支持 `load_mode` 为 `inc_replace`（即 `replace` 语义）的增量旁路导入等。V4.3.2 新增支持对 `outrow lob` 数据进行增量旁路导入的能力；并扩展 `load_mode` 为 `inc` 取值，默认为 `insert` 语义，在 SQL 中指定 `ignore` 关键字时，表现为 `ignore` 语义。作为正式功能发布。更多详细使用信息，参见 [使用 LOAD DATA 语句旁路导入数据](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001049873) 和 [使用 INSERT INTO SELECT 语句旁路导入数据](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001049871)。

* **全量旁路导入性能优化**

  全量旁路导入场景，新版本通过减少数据加载过程中的列类型转换操作、降低统计信息收集操作的 CPU 占用、`INSERT INTO SELECT` 去除 `SELECT` 端生成 pk 逻辑、列存默认关闭 `sum skip index`（存储层对应 Range 内指定列数据的预聚合 `SUM` 值）等优化，配合关闭微块校验（配置项 `micro_block_merge_verify_level` 设置 0），旁路导入性能提升 20% 左右。

* **`SELECT INTO OUTFILE` 分区导出**

  OceanBase 目前已支持通过 select into outfile 导出多文件，但尚未支持对数据分区后按分区导出。新版本增加按分区导出能力，以得到更清晰的目录结构，在此基础上还可以将文件目录构造为带分区的外表，通过分区路径裁剪，提高外表的查询效率。

#### 外部数据源集成

* **外表功能增强**

  OceanBase 数据库较早就支持了 CSV 格式的文件外部表，但随着 AP 业务的逐渐拓展，发现一些数据湖场景中，读取 Parquet 格式的外部数据源的需求也非常普遍。V4.3.2 开始支持 Parquet 文件外表，用户可通过外表将文件内数据导入 OceanBase 内表，也可直接将外表用于跨数据源的联合查询分析。同时，为了保证外表所扫描的文件目录的实效性，新版本增加文件目录自动刷新功能，建外部表时可通过 `AUTO_REFRESH` 选项指定文件列表的刷新方式（手动、实时、周期），并结合 `DBMS_EXTERNAL_TABLE.REFRESH_ALL_TABLE`（`interval int`）系统包子程序管理定时刷新任务。更多详细使用信息，参见 [创建外表](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000001053138)。

#### 性能优化

* **AP 典型场景性能优化**

  V4.3.2 对数据块预取、向量化批处理、Filter 下压、比较计算、聚合计算、DTL shuffle、单调性 Filter 等进行了全方位策略优化，100G 数据量规格下，TPCH、TPCDS、ClickBench 等多类 AP 场景基准测试性能相比 V4.3.1 提升了约 10%～15%。

#### 数据类型与存储优化

* **RoaringBitmap**

  随着大数据时代的来临，企业对于用户数据的挖掘和分析需求日益增强。RoaringBitmap 凭借着其节省空间、计算高效等特点，在用户画像、个性化推荐、精准营销等业务场景发挥了重要作用。OceanBase V4.3.2 开始在 MySQL 模式下支持 RoringBitmap 数据类型，通过存储和操作一组无符号整数，提升大数据量集合计算、去重性能。为了满足多维度分析需求，该版本支持了用于基数计算、集合运算、Bitmap 判断、Bitmap 构造、Bitmap 输出、聚合运算的二十余项表达式。

#### 数据操作优化

* **表级覆盖写**

  数据仓库中进行数据定期刷新、数据转换、数据清洗修正的场景，数据覆盖写入是较为常见的需求。OceanBase V4.3.2 新增表级覆盖写能力（INSERT OVERWRITE），原子实现表内旧数据清空和新数据写入。基于全量旁路导入能力，INSERT OVERWRITE 也体现出较高的执行性能。V4.3.2 支持 INSERT OVERWRITE tablename SELECT * FROM tablename 用法，暂不支持分区级覆盖写，分区级功能将在后续版本提供。

#### 任务调度与异步执行

* **异步任务调度**

  OceanBase 目前已支持 `insert overwrite`、`insert select`、`create table as`、`load data` 等多种数据导入命令，来支撑数据实时入库。但实时导入的方式需要在导入过程中等待导入完成，不能中断会话，这在大规模数据导入的场景比较不易用。新版本基于 DBMS_SCHEDULER 提供了异步任务调度能力，用户可通过 `submit job`、`show job status` 和 `cancel job` 等命令实现异步导入任务的创建、状态查询和任务取消。


## V4.3.1

### 版本信息

* 发布时间：2024 年 5 月 17 日
* 版本号：V4.3.1 Beta

### 新增功能/能力增强

#### 物化视图增强

* **物化视图增强**

  OceanBase V4.3.0 支持了物化视图特性，通过预计算和存储视图的查询结果，减少实时计算来提升查询性能，简化复杂查询逻辑，支撑 AP 场景需求。在此基础上，V4.3.1 版本扩展支持了实时物化视图功能，提供基于物化视图和 MLOG 两部分数据的实时计算能力，适用于实时性要求较高的分析业务。新增物化视图主键约束，支持用户为物化视图指定主键，以此优化基于主键的单行查找、范围查询或关联场景性能。同时扩展支持了内连接场景物化视图的增量更新能力，提升部分场景的物化视图刷新性能。

  另外在 V4.3.0 版本使用物化视图时，需要将业务脚本中对原始表的访问计算手工替换为查询对应的物化视图，引入了人工改写成本。新版本支持了部分场景的物化视图改写能力，在系统变量 `QUERY_REWRITE_ENABLED` 设置为 `True` 的情况下，创建物化视图时可以通过指定 `ENABLE QUERY REWRITE` 来使用物化视图的自动改写能力，此时系统可以将对原始表的查询改写为针对物化视图的查询，以此减少业务改造量。有关物化视图的自动改写的详细信息，参见 [物化视图查询改写（MySQL 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000822229) 和 [物化视图查询改写（Oracle 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000822220)。

#### 数据导入与导出优化

* **增量旁路导入（Experimental）**

  OceanBase V4.1.0 开始支持旁路导入特性，通过精简数据加载的执行路径，跳过 SQL、事务、memtable 等模块，直接将数据持久化为 SSTable 来显著提升数据导入效率。但在表数据需要多次导入的场景，每次导入都需要将表中已有数据重写一遍，影响了增量导入的性能。V4.3.1 针对性地优化了增量导入场景，增量旁路导入无需重写原有数据，只需处理新增数据，让多次导入像第一次导入一样具有高性能。支持在 `LOAD DATA` 和 `INSERT INTO SELECT` 语句中通过 `/*+ direct(need_sort, max_errors_allowed, load_mode)*/` Hint 指定是否使用增量旁路导入功能。不指定 `load_mode` 或 `load_mode` 为 `full` 时，表示使用原有的全量旁路导入方式；指定 `load_mode` 为 `inc_replace` 时使用增量旁路导入方式。该功能在 V4.3.1 定义为实验特性，后续版本会继续扩展功能并演进为生产可用特性。有关增量旁路导入的详细信息，参见 [旁路导入概述](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000818455) 中 **增量旁路导入** 章节。

* **SELECT INTO OUTFILE 性能优化**

  现有的 select into outfile 功能虽然支持并行读取数据表，但只能串行写入外部文件，存在数据导出的性能瓶颈。V4.3.1 增加并行导出能力，在 select into outfile 命令基础上增加了 single、 max_file_size 选项，用于控制数据写入外部文件的方式。single 选项可控制将数据导出到单个文件或多个文件，指定并行度大于 1 且 single = false 时，可以将数据导出到多个文件，达到并行读并行写的效果；max_file_size 选项可控制导出文件的大小。

#### 索引增强

* **MySQL 模式全文索引（Experimental）**

  关系型数据库中通常会使用索引来加速基于精准值匹配的查询，但普通的 B-Tree 索引无法应用于涉及大量文本数据需要进行模糊检索的场景，这时只能通过全表扫描来对每一行数据进行模糊查询，文本较大、数据量较多的情况下性能往往不能满足要求。另外一些复杂的查询场景，如近似匹配、相关性排序等，也难以通过改写 SQL 支撑。

  为了解决上述问题，OceanBase 在 V4.3.1 支持了全文索引功能，通过预先处理文本内容，建立关键词索引，有效提升全文搜索效率。该功能在 V4.3.1 定义为实验特性，后续版本会继续扩展功能并演进为生产可用特性。本期包含以下功能：

  MySQL 模式下支持全文索引功能，兼容 MySQL 基本语法；

   * 建表时支持对 CHAR/VARCHAR/TEXT 列预建全文索引；
   * 适用于分区表；
   * 支持对主表创建多个全文索引；
   * 支持 SPACE（空格）、NGRAM、BENG（基础英文）三种内置分词器；
   * 支持一个 match against 对多个列进行全文搜索；
   * 支持 NATURAL LANGUAGE MODE 模式。

#### 分区管理

* **分区交换**

  随着时间的推移，表中可能会累积大量的历史数据，这些数据可能不需要频繁访问，但需要保留以满足合规性或历史数据分析需求。为了提升查询性能，业务往往需要区分活跃和非活跃数据，并将非活跃数据进行归档。通过 SQL 迁移数据到新表可以解决这个场景需求，但大数据量情况下性能往往不优。因此，OceanBase V4.3.1 版本新增分区交换功能，通过修改数据字典中分区和表的定义，而无需进行数据的物理复制，可以将 A 表数据近乎瞬时地移动到 B 表某个分区下，极大地提升了数据迁移的性能。本期包含以下功能：

   * 支持分区表中的一个分区和一个普通表进行数据互换；
   * 支持一级分区表，分区类型为 Range(Range Columns) ；
   * 支持二级分区表，一级分区类型无要求，二级分区类型为 Range(Range Columns) ；
   * 支持 including indexes 的行为，即分区交换时，对应局部索引也会参与交换，并在交换后保持可用状态；
   * 支持 without validation 模式，需要用户保证数据符合分区键范围。

#### 外部数据源集成

* **外部表分区**

  OceanBase V4.2.0 开始支持外部表功能，局限于非分区表。当文件数量较多，但某次查询理论上只需要扫描一部分数据文件的场景，非分区外部表只能扫描全量文件，无法进行裁剪，性能较差。V4.3.1 版本新增外部表分区功能，支持类似普通表 list 分区的分区方式，并提供了自动/手动分区的两种语法。指定自动创建分区时，系统将按照分区键的定义方式，将文件按照分区进行分组；指定手动创建分区时，需要用户指定每个分区对应的数据文件子路径。这种情况下，外表查询可以根据分区条件实现分区裁剪，减少扫描的文件数量，显著提升查询性能。

#### 数据类型与存储优化

* **MySQL 模式 JSON 多值索引（Experimental）**

  MySQL 8.0 版本开始支持多值索引特性，适用于 JSON 文档和其他集合数据类型。这使得用户可以通过在数组或者集合上构建索引，来实现元素的高效检索。OceanBase V4.3.1 在 MySQL 模式下兼容了 JSON 多值索引特性，允许在包含多个元素的 JSON 数组字段上创建高效的二级索引，增强了复杂 JSON 数据结构的查询能力，兼顾了数据模型的灵活性和数据查询的高性能。该功能在 V4.3.1 定义为实验特性，后续版本会继续扩展功能并演进为生产可用特性。本期包含以下功能：

   * 支持多值索引、复合多值索引的预创建；
   * 支持唯一、非唯一的多值索引；
   * 支持创建多值索引的 JSON 数组元素类型为 INT、UINT、DOUBLE、FLOAT、CHAR 等；
   * 适用于分区表；
   * 支持 MEMBER_OF()、JSON_CONTAINS()、JSON_OVERLAPS() 函数使用多值索引查询。

* **MySQL JSON Partial Update**

  一些用户会使用 JSON 文档存储业务数据，文档需要更新时，目前只能全量读取后全量更新，文档较大时性能无法满足预期。V4.3.1 版本新增支持 JSON Partial Update 功能，当用户通过特定表达式（json_set/json_replace/json_remove）更新 JSON 文档的部分字段时，可以只更新要修改的部分，无需全量覆盖更新，提升更新性能。该功能需要通过 log_row_value_options 配置项开启使用。

#### 查询执行与资源管理

* **SQL 临时结果压缩**

  SQL 执行涉及的数据量过大的情况下，可能出现内存不足的问题，这时部分算子需要物化临时的中间结果。当物化的数据量过大，磁盘空间写满时，会导致 SQL 执行失败。V4.3.1 新增 SQL 临时结果压缩功能，允许通过租户级配置项 spill_compression_codec 或 SQL 级 Hint （如 /*+opt_param('spill_compression_codec', 'lz4') */）指定临时结果是否压缩及压缩算法，当指定临时结果压缩时可有效降低临时磁盘空间占用，以支撑更大运算量的查询任务。

## V4.3.0 Beta

### 版本信息

* 发布时间：2024 年 3 月 22 日
* 版本号：V4.3.0 Beta

### 新增功能

* **列存引擎**

  在大规模数据复杂分析或海量数据即席查询场景中，列式存储是 AP 数据库的关键能力之一。列式存储是一种数据文件组织方式，区别于行式存储，它将表中的数据按照列进行物理排列。数据进行列式存储时，分析场景可仅扫描用于查询计算的列数据，避免整行扫描，减少 IO 和内存等资源使用，提升计算速度。另外按列存储也天然具备更好的数据压缩条件，更易获得较高的压缩比，减少存储空间和网络传输带宽。

  不过常见的列存存储引擎在实现上往往假设不会有大量随机更新，尽量保证列存组织数据是静态的。当真正伴随大量数据随机更新时，也会不可避免的存在系统性能问题。OceanBase LSM-Tree 架构可以将基线数据和增量数据分别处理，正好可以解决这一场景问题。因此 V4.3.0 版本在当前架构基础上继续扩展支持了列存引擎，在一套代码一个架构一个 OBServer 上，实现了列存和行存数据存储一体化，兼顾 TP 和 AP 类查询性能。

  为了方便 AP 业务迁移、方便老客户顺畅使用新版本，围绕列存引擎，从优化器到执行器、从 DDL 到事务处理等多模块都进行了适配优化。包括基于列存的新的代价模型和向量化引擎，查询下压功能的扩展和增强，Skip Index，新的列式编码算法，自适应 Compaction 等。

  业务上，用户可根据负载类型灵活设置表为行存表、列存表或行列冗余表。有关列存引擎的详细信息，请参见 [列存](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000640601)。

* **新向量化引擎**

  OceanBase 在早期版本已经实现了基于 Uniform 数据描述方式的向量化引擎，性能较非向量化引擎有了明显提升，但在深度 AP 场景，还有一些性能上的不足。V4.3.0 版本实现了向量化引擎 2.0 版本，更改为 Column 数据格式描述，避免了 ObDatum 维护带来的内存使用、序列化和读写访问开销。基于数据格式描述重构，新版本也对一批常用算子和表达式进行了重新实现，如 HashJoin、AGGR、HashGroupBy、Exchange(DTL Shuffle) 等 10 余项算子，关系运算、逻辑运算、算数运算等 20 余项 MySQL 表达式。在后续的 V4.3.x 版本也会基于新的向量化引擎，持续补充完善其他算子和表达式的实现，以便获得 AP 场景更优性能。

* **物化视图**

  V4.3.0 版本新增物化视图（Materialized View）功能。物化视图是支撑 AP 业务的一个关键特性，它通过预计算和存储视图的查询结果，减少实时计算来提升查询性能，简化复杂查询逻辑，常用于快速报表生成和数据分析场景。

  因为物化视图需要存储查询结果集来优化查询性能，而物化视图与基础表之间存在数据依赖关系，每当基础表数据发生变动时，物化视图中的数据必须进行相应更新以保持同步，所以新版本也引入了物化视图刷新机制，包括全量刷新和增量刷新两种策略。全量刷新是一种较为直接的方式，每次执行刷新操作时，系统会重新执行物化视图对应的查询语句，完整地计算并覆盖原有的视图结果数据，这种方式适用于数据量相对较小的场景。相对来讲，增量刷新仅需处理自上次刷新以来发生变更的部分。为了实现精确的增量刷新，OceanBase 实现了类似 Oracle MLOG（Materialized View Log）的物化视图日志功能，通过日志详细跟踪记录基础表的增量更新数据，从而确保物化视图能够进行快速增量刷新。增量刷新方式尤其适用于数据量庞大且变更频繁的业务场景。有关物化视图的详细信息，请参见 [物化视图（MySQL 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000643271) 和 [物化视图（Oracle 模式）](https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000643294)。
