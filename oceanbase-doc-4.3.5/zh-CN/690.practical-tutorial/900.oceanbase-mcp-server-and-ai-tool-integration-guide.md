# OceanBase MCP Server 与 AI 工具集成指南

## 背景信息

AI 工具快速发展（如图形化工具 Cursor、Windsurf、Trae，命令行工具 Claude Code、Gemini CLI、Qwen Code），在 Agent 模式的加持下，能力非常强大。但是 AI 工具无法直接访问数据库，和数据库之间仍然缺少一个 “桥梁”，MCP 协议搭建了这样的一座桥梁。OceanBase MCP Server 通过 MCP 协议与 AI 工具交互，赋予了工具直接读取数据库的能力。

传统的数据分析比如 “用户数据分析”、“商品分析”、“订单分析”、“用户行为分析” 等，需要开发人员开发后端平台读取数据和前端页面展示数据，即使使用 BI 分析工具有时也需要了解 SQL 相关的知识，数据只是展示了出来，数据中包含的逻辑是什么，业务需要根据数据做什么样的改变，仍然依靠数据分析人员的洞察。

在 AI 工具、 MCP 和 LLM 的结合下，数据分析形态将被改变，分析人员不再需要开发人员参与，也不用懂得 SQL 知识，只需要将需求告诉这些 AI 工具，就可以得到想要的结果，生成精美的图表，并且可以提供初步的数据洞察。

## 功能架构

### 核心工具包

OceanBase MCP Server 提供标准化接口，支持 AI 工具直接调用数据库功能：

|            工具名称          | 功能说明 |
|-----------------------------|----------|
| `execute_sql`               | 执行任意 SQL 语句（`SELECT`/`INSERT`/`UPDATE`/`DELETE`/`DDL` 等）。|
| `get_current_tenant`        | 获取当前租户名称。|
| `get_all_server_nodes`      | 获取集群节点信息（仅限 `sys` 租户）。|
| `get_resource_capacity`     | 查询集群资源容量（仅限 `sys` 租户）。|
| `get_ob_ash_report`         | 获取 OceanBase Active Session History（ASH）报告，用于性能诊断。|
| `get_current_time`          | 返回 OceanBase 集群的当前时间。|
| `search_oceanbase_document` | 搜索 OceanBase 官方文档（实验性功能）。|
| `oceanbase_text_search`     | 在 OceanBase 数据库表中使用全文搜索查找文档。|
| `oceanbase_vector_search`   | 在 OceanBase 数据库表中执行向量相似性搜索。|
| `oceanbase_hybrid_search`   | 执行混合搜索，结合关系条件过滤和向量搜索。|
| `ob_memory_query`           | 通过语义搜索 AI 记忆系统中的历史对话记录。（AI 记忆系统工具）|
| `ob_memory_insert`          | 自动捕获并存储重要对话内容，构建知识库。（AI 记忆系统工具）|
| `ob_memory_delete`          | 删除过时或冗余的对话记忆。（AI 记忆系统工具）|
| `ob_memory_update`          | 根据新信息更新或演进记忆内容。（AI 记忆系统工具）|

### 资源接口

通过 MCP 协议暴露的资源接口，AI 工具可直接调用：

|          资源路径            | 功能说明 |
|------------------------------|---------|
| `oceanbase://tables`         | 列出数据库中的所有表。|
| `oceanbase://sample/{table}` | 获取指定表的样本数据（前 100 行），支持动态替换 `{table}` 为表名。|

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>OceanBase MCP Server 最新说明文档，参见 <a href="https://github.com/oceanbase/awesome-oceanbase-mcp/blob/main/src/oceanbase_mcp_server/README.md">OceanBase MCP Server</a>。</p>
</main>

## 前提条件

* 您已安装 Cursor 或其他支持 MCP 协议的工具（如 Windsurf、Qwen Code）。
* 您已完成部署 OceanBase 集群并且创建了 MySQL 模式用户租户，连接用户租户的用户需具备目标数据库的 `CREATE`、`INSERT`、`DROP` 和 `SELECT` 权限。

  * 有关部署 OceanBase 集群的信息，参见 [部署概述](../400.deploy/100.deploy-overview.md)。
  * 有关创建用户租户的详细信息，参见 [创建租户](../600.manage/200.tenant-management/600.common-tenant-operations/200.manage-create-tenant.md)。
  * 有关用户权限的信息，参见 [MySQL 模式下的权限分类](../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md)。

* 您已安装 Python 环境（版本 3.10 ~ 3.12）。

  * Python 安装包可在 [Python 官方网站](https://www.python.org/downloads/) 下载。

## 集成步骤

### 步骤一：获取数据库连接信息

联系 OceanBase 数据库部署人员或者管理员获取相应的数据库连接串，例如：

```sql
obclient -h$host -P$port -u$user_name -p$password -D$database_name
```

**参数说明：**

* `$host`：提供 OceanBase 数据库连接 IP。OceanBase 数据库代理（OceanBase Database Proxy，ODP）连接方式使用的是一个 ODP 地址；直连方式使用的是 OBServer 节点的 IP 地址。
* `$port`：提供 OceanBase 数据库连接端口。ODP 连接的方式默认是 `2883`，在部署 ODP 时可自定义；直连方式默认是 `2881`，在部署 OceanBase 数据库时可自定义。
* `$database_name`：需要访问的数据库名称。

    <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>连接租户的用户需要拥有该数据库的 <code>CREATE</code>、<code>INSERT</code>、<code>DROP</code> 和 <code>SELECT</code> 权限。更多有关用户权限的信息，请参见 <a href="../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md">MySQL 模式下的权限分类</a>。</p>
    </main>

* `$user_name`：提供租户的连接账户。ODP 连接的常用格式：`用户名@租户名#集群名` 或者 `集群名:租户名:用户名`；直连方式格式：`用户名@租户名`。
* `$password`：提供账户密码。

更多连接串的信息，请参见 [通过 OBClient 连接 OceanBase 租户](../300.develop/100.application-development-of-mysql-mode/100.connect-to-oceanbase-database-of-mysql-mode/300.connect-to-an-oceanbase-tenant-by-using-obclient-of-mysql-mode.md)。

**示例如下：**

```shell
obclient -hxxx.xxx.xxx.xxx -P2881 -utest_user001@mysql001 -p****** -Dtest
```

### 步骤二：安装 Python 依赖

#### 环境准备

1. 安装 uv 包管理器。

   * macOS/Linux 环境执行以下命令安装 uv 包管理器。

       ```shell
       curl -LsSf https://astral.sh/uv/install.sh | sh
       ```

   * Windows 环境执行以下命令安装 uv 包管理器。

       ```shell
       irm https://astral.sh/uv/install.ps1 | iex
       ```

   * 或者使用 pip 命令安装 uv 包管理器。

       ```shell
       pip install uv
       ```

2. 验证 uv 是否安装成功。

    ```shell
    uv --version
    ```

#### 安装 OceanBase MCP Server

1. 选择一个目录，运行以下命令创建一个虚拟环境。

    ```shell
    uv venv
    ```

2. 执行以下命令激活虚拟环境。

    ```shell
    source .venv/bin/activate
    ```

3. 执行以下命令安装 OceanBase MCP Server。

    ```shell
    uv pip install oceanbase-mcp
    ```

### 步骤三：配置 MCP Server 环境

1. 创建 `.env` 文件。

    ```shell
    cat > .env <<EOF
    OB_HOST=127.0.0.1
    OB_PORT=2881
    OB_USER=test_user001@mysql001  # 示例：MySQL模式租户用户
    OB_PASSWORD=your_password
    OB_DATABASE=test
    EOF
    ```

2. 启动 MCP Server。

    ```shell
    uv run oceanbase_mcp_server \
        --transport sse \           # 支持 stdio/streamable-http/sse 模式
        --host 0.0.0.0 \            # 允许外部访问，可改为 127.0.0.1 限制本地访问
        --port 8000                 # 自定义端口（如 8001 需调整后续配置）
    ```

### 步骤四：配置 Cursor 连接 MCP Server

1. 进入 Cursor 设置页面：点击右上角齿轮图标 → 选择 MCP → 点击 New MCP Server。

    ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/690.practical-tutorial/900.oceanbase-mcp-server-ai/1.0.png)

2. 编辑 `mcp.json` 配置。

    ```shell
    {
      "mcpServers": {
        "ob-sse": {
          "autoApprove": [],
          "disabled": false,       # 必须设为 false 启用服务
          "timeout": 60,
          "type": "sse",
          "url": "http://127.0.0.1:8000/sse"  # 与步骤 3 的端口一致
        }
      }
    }
    ```

3. 验证连接。

    保存后，返回 MCP 页面，可以看到新添加的 MCP。

4. 添加后在 Chat 窗口提问时，Cursor 会自动使用 MCP 的工具。

    ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/690.practical-tutorial/900.oceanbase-mcp-server-ai/2.png)

## 快速体验案例

当您完成 OceanBase + MCP Server 的搭建后，可以快速体验数据分析。其他的 AI 工具也可以实现本文的效果，本案例以 Cursor 为例，演示强大的 AI 工具如何与 OceanBase MCP Server 协同工作。

### 用户数据分析

1. 指令输入。

    ```shell
    帮我分析一下用户数据，看看用户年龄分布和城市分布情况
    ```

2. Cursor 执行流程。

    1. Cursor 调用 `execute_sql` 执行聚合查询。

        ```sql
        SELECT age, city, COUNT(*) AS user_count
        FROM users
        GROUP BY age, city;
        ```

    2. 自动生成结构化分析结果。

        ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/690.practical-tutorial/900.oceanbase-mcp-server-ai/3.png)

3. 指令扩展。

    ```shell
    请将上面的结果转换为图表
    ```

4. 输出结果。

    自动生成年龄分布与城市分布饼图。

    ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/690.practical-tutorial/900.oceanbase-mcp-server-ai/4.png)

### 商品销售分析

1. 指令输入。

    ```shell
    分析商品销售情况，找出最受欢迎的商品类别和品牌
    ```

2. 输出示例。

    Cursor 给出了分析报告，并且给出了策略和建议的洞察。

    ![5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/690.practical-tutorial/900.oceanbase-mcp-server-ai/5.png)

### 订单趋势分析

1. 指令输入。

    ```shell
    分析订单数据，看看销售趋势和用户购买行为
    ```

2. 输出示例。

    生成了订单数据分析报告，并根据数据给出了建议。

    ![6](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/690.practical-tutorial/900.oceanbase-mcp-server-ai/6.png)

## 相关文档

更多 OceanBase MCP Server 的介绍信息，参见 [OceanBase MCP Server](https://github.com/oceanbase/awesome-oceanbase-mcp/blob/main/src/oceanbase_mcp_server/README.md)。