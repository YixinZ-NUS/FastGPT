# 基于 Superset 对 OceanBase 数据库进行数据分析

本文将介绍如何使用 Superset 连接 OceanBase 数据库并进行数据分析。

## 背景信息

随着数字化转型的加速，企业在各个领域对数据分析的需求愈发显著。数据驱动的决策能够极大提升企业的竞争力，因此在处理历史数据和进行实时分析时，数据仓库的建设显得尤为重要。OceanBase 作为一款高性能的分布式数据库，具备强大的数据存储与查询能力，非常适合进行离线数据分析和数据仓库构建。

在此背景下，Apache Superset 作为一款现代化的数据可视化工具，能够与 OceanBase 数据库无缝集成，共同帮助用户实现高效的数据分析和可视化展示。通过 Superset，用户可以轻松地连接 OceanBase 数据库，导入数据集，创建数据表，并生成各种图表以及交互式仪表盘，使数据分析的全过程变得更加高效和直观。本文旨在详细讲解如何通过 Superset 实现与 OceanBase 数据库的连接，并演示如何进行实际的数据分析与可视化，以帮助企业更好地利用其数据资源，实现智能决策。

## 前提条件

* 您已在本地完成配置并运行 Superset。详情请参见 [Superset Quick Start](https://superset.apache.org/docs/quickstart/#1-get-superset)。
* 您已安装 OceanBase 数据库并且创建了 MySQL 模式租户。
* 您已准备好可用数据集。本文所用示例数据集来源于 [Kaggle](https://www.kaggle.com/datasets/vizeno/earthquake-data-overview)。

## 操作步骤

### 步骤一：获取数据库连接串

联系 OceanBase 数据库部署人员或者管理员获取相应的数据库连接串，例如：

```sql
obclient -h$host -P$port -u$user_name -p$password -D$database_name
```

**参数说明：**

* `$host`：提供 OceanBase 数据库连接 IP。OceanBase 数据库代理（OceanBase Database Proxy，ODP）连接方式使用的是一个 ODP 地址；直连方式使用的是 OBServer 节点的 IP 地址。
* `$port`：提供 OceanBase 数据库连接端口。ODP 连接的方式默认是 `2883`，在部署 ODP 时可自定义；直连方式默认是 `2881`，在部署 OceanBase 数据库时可自定义。
* `$database_name`：需要访问的数据库名称。

    <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>连接租户的用户需要拥有该数据库的 <code>CREATE</code>、<code>INSERT</code>、<code>DROP</code> 和 <code>SELECT</code> 权限。更多有关用户权限的信息，请参见 <a href="../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md">MySQL 模式下的权限分类</a>。</p>
    </main>

* `$user_name`：提供租户的连接账户。ODP 连接的常用格式：`用户名@租户名#集群名` 或者 `集群名:租户名:用户名`；直连方式格式：`用户名@租户名`。
* `$password`：提供账户密码。

更多有关连接串的信息，请参见 [通过 OBClient 连接 OceanBase 租户](../300.develop/100.application-development-of-mysql-mode/100.connect-to-oceanbase-database-of-mysql-mode/300.connect-to-an-oceanbase-tenant-by-using-obclient-of-mysql-mode.md)。

**示例如下：**

```shell
obclient -hxxx.xxx.xxx.xxx -P2881 -utest_user001@mysql001 -p****** -Dtest
```

### 步骤二：在 Superset 控制台连接 OceanBase 数据库

1. 打开运行的 Superset 控制台页面，在右上角选择 **+ > Data > Connect database**。

    ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/OBCloud-240420/Integrations/Superset/superset-connect-database.png)

2. 在弹出框中，完成如下配置：

    1. 在第一步 **Select a database to connect** 下，选择 OceanBase 数据库类型。
    2. 在第二步 **Enter the required MySQL credentials** 下，根据在**步骤一：获取数据库连接串**中的连接串信息依次完成填写**HOST**，**PORT**，**DATABASE NAME**，**USERNAME**，**PASSWORD**。您可以自定义**DISPLAY NAME**的内容。

3. 单击 **CONNECT**，然后单击 **FINISH**。

### 步骤三：导入数据并创建表

1. 使用 **步骤一：获取数据库连接串** 中的连接串登录到 OceanBase 数据库，建表，建表语句如下所示：

   ```sql
   CREATE TABLE earthquakes (
    Place VARCHAR(255),
    Latitude DECIMAL(10, 6),
    Longitude DECIMAL(10, 6),
    Country VARCHAR(100),
    Continent VARCHAR(100),
    Magnitude DECIMAL(3, 1)
   );
   ```

2. 您可以使用 `LOAD DATA` 语句将您准备好的数据集导入到表中，语句示例如下：

   ```sql
   LOAD DATA INFILE '/path/earthquake_dataset.csv'
   INTO TABLE earthquakes
   FIELDS TERMINATED BY ','
   ENCLOSED BY '"'
   LINES TERMINATED BY '\n'
   IGNORE 1 LINES
   (Place, Latitude, Longitude, Country, Continent, Magnitude);
   ```

   当数据量较大、或者导入时需要做数据转换的场景，建议使用[导数工具](https://www.oceanbase.com/docs/common-oceanbase-dumper-loader-1000000000628762)导入数据集。

   导入成功之后，使用下面的语句验证：

   ```shell
   obclient> SELECT COUNT(*) FROM earthquakes;
   +----------+
   | COUNT(*) |
   +----------+
   |     1264 |
   +----------+
   1 row in set
   ```

### 步骤四：在 Superset 中创建数据集

1. 回到 Superset 控制台，在右上角选择 **+ > Data > Create dataset**。

    ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/OBCloud-240420/Integrations/Superset/superset-create-dataset.png)

2. 在 **New dataset** 页面，完成如下配置：

    |配置项|说明|
    |----|----|
    |DATABASE|选择您在步骤二的 **DISPLAY NAME** 中定义的数据库名。|
    |SCHEMA|选择您在步骤一中创建的 OceanBase 数据库。|
    |TABLE|选择您在步骤三种创建的表。|

    ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/OBCloud-240420/Integrations/Superset/superset-create-dataset-1.png)

3. 单击 **CREATE DATASET AND CREATE CHART**，完成创建数据集。

### 步骤五：在 Superset 中创建图表

1. 在创建数据集后，您可根据实际情况，选择一个图表类型，单击 **CREATE NEW CHART**，并根据您的需求进行图表配置。

    ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/V4.3.5/superset.png)

    关于图表配置的更多信息，请参见 [Superset 官方文档](https://superset.apache.org/docs/creating-charts-dashboards/exploring-data)。

### 步骤六：在 Superset 中构建仪表盘

单个图表可能不足以全面表达数据分析的结果，因此，将多个相关联的图表组合成一个仪表盘是非常有用的。

1. 在顶部菜单栏点击 **Dashboards** > **+ Dashboard** 来创建一个新的仪表盘。

    ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/V4.3.5/SUPERSET2025-01-22%2014%2016%2045.png)

2. 您可以点击 **untitled dashboard** 来给新仪表盘命名。

3. 利用拖拽功能将之前创建好的图表加入到仪表盘中。

    ![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/V4.3.5/2025-01-22%2014%2058%2051.png)

4. 调整各个图表的位置大小以及布局，使得整个界面看起来更加美观协调。
5. 可以利用过滤器等功能增强仪表盘的互动性。这些功能通常位于编辑模式下每个图表上方的工具条内(可选)。
6. 完成后点击右上角 **SAVE** 按钮保存。

### 步骤七：发布仪表盘

如果您想让其他用户可以使用您的仪表板，只需选择左上角仪表板标题旁边的 **Draft** 即可将您的仪表板更改为**已发布**状态。您也可以通过选择星号来收藏此仪表板。

![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/V4.3.5/publish_dashboard.png)

## 应用展示

![](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/V4.3.5/advanced_analytics_base.png)
