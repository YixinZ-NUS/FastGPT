|description|  |
|---|---|
|keywords| |
|dir-name|观远 BI|
|dir-name-en|GuanData|

# 在观远 BI 中连接 OceanBase 数据库

本文将以 OceanBase 数据库 MySQL 模式为例，介绍如何在观远 BI 中连接 OceanBase 数据库进行数据展示。

## 前提条件

* 您已购买观远 BI。
* 您已安装 OceanBase 数据库并且创建了 MySQL 模式租户。

## 步骤一：获取 OceanBase 数据库连接串

联系 OceanBase 数据库部署人员或者管理员获取相应的数据库连接串，例如：

```SQL
obclient -h$host -P$port -u$user_name -p$password -D$database_name
```

**参数说明：**

* `$host`：提供 OceanBase 数据库连接 IP。OceanBase 数据库代理（OceanBase Database Proxy，ODP）连接方式使用的是一个 ODP 地址；直连方式使用的是 OBServer 节点的 IP 地址。
* `$port`：提供 OceanBase 数据库连接端口。ODP 连接的方式默认是 `2883`，在部署 ODP 时可自定义；直连方式默认是 `2881`，在部署 OceanBase 数据库时可自定义。
* `$database_name`：需要访问的数据库名称。

    <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>连接租户的用户需要拥有该数据库的 <code>CREATE</code>、<code>INSERT</code>、<code>DROP</code> 和 <code>SELECT</code> 权限。更多有关用户权限的信息，请参见 <a href="../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md">MySQL 模式下的权限分类</a>。</p>
    </main>

* `$user_name`：提供租户的连接账户。ODP 连接的常用格式：`用户名@租户名#集群名` 或者 `集群名:租户名:用户名`；直连方式格式：`用户名@租户名`。
* `$password`：提供账户密码。

更多连接串的信息，请参见 [通过 OBClient 连接 OceanBase 租户](../../300.develop/100.application-development-of-mysql-mode/100.connect-to-oceanbase-database-of-mysql-mode/300.connect-to-an-oceanbase-tenant-by-using-obclient-of-mysql-mode.md)。

## 步骤二：在观远 BI 中配置驱动与连接器

1. 登录观远 BI 控制台，在页面右上角选择 **管理中心** > **资源管理** > **驱动和连接器管理**。

    ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image001.png)

2. 单击 **驱动管理** 页签下的 **新增驱动**，编辑驱动名称，单击 **保存** 完成新建驱动。

    ![2](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image003.png)

3. 单击新建的驱动 OceanBase-MySQL，单击 **上传文件** 按钮，上传驱动 Jar 包及可用的 Driver Class，单击 **应用** 完成驱动配置。

    <main id="notice" type='note'>
    <h4>说明</h4>
    <p>下载 OceanBase (MySQL) 的驱动 Jar 包请前往<a href="https://www.oceanbase.com/softwarecenter-cloud">OceanBase 软件下载中心</a>，并根据 CPU 架构选择下载。</p>
    </main>

    ![3](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image005.png)

4. 单击 **数据库连接器管理** 页签，然后单击 **新建数据库连接器**，在弹窗中配置数据库连接器。完成后单击 **确定**。

    |配置项|说明|
    |-----|----|
    |显示 ICON|设置自定义数据连接的图片 ICON，用于在数据账户以及数据库数据集新建环节的展示。|
    |连接器名称|按照用户习惯自行定义，不支持特殊字符。|
    |默认方言支持|选择 MySQL。|
    |获取表列表 SQL|填写 `{"sql": "SHOW TABLES", "tableNameIdx": 1}`。|
    |默认驱动|选择第 3 步中新建的驱动 OceanBase-MySQL。|

    ![4](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image007.png)

## 步骤三：在观远 BI 中创建数据账户

1. 在观远 BI 控制台选择 **数据准备** > **数据账户**。

2. 单击 **新建数据账户**，配置数据账户：

   a. 在选择连接器处，选择步骤二中创建的连接器 OceanBase-MySQL。完成后单击 **下一步**。

   ![5](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image009.png)

   b. 在配置数据账户处，配置数据账户信息。配置完成后单击 **测试连接**，确认 OceanBase 数据库是否可正常连接。确认后单击 **下一步**。

    |配置项|说明|
    |-----|----|
    |用户名|取自连接串中 `-u` 参数，账号名称。|
    |密码|取自连接串中 `-p` 参数，账号密码。|
    |JDBC URL|根据连接串中 `-h`、`-P`、`-D`、`-u`、`-p` 参数进行拼接。拼接语法如下：<br>`jdbc:oceanbase://host:port/databasename?[username&password]`<br>示例：<br>`jdbc:oceanbase://t5******.aws-ap-southeast-1.oceanbase.cloud:3306/test?user=test_user001@sys&password=***1**`|
    |最大连接数|设置单个数据账户的连接池数上限。|
    |驱动|自定义选择步骤二中创建的驱动 OceanBase-MySQL。|

   c. 在确认数据账户信息处，为当前数据库的数据账户进行命名，完成后单击 **确认新建**。

## 步骤四：在观远 BI 中接入数据

1. 在观远 BI 控制台，在页面右上角选择 **数据准备** > **数据集**，然后选择 **新建数据集** > **数据库**。
    
    ![6](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image011.png)

2. 配置数据集接入信息：

   a. 在 **选择数据账户及数据表** 处，选择步骤三中创建的数据账户 **OceanBase 账户**，并通过 SQL 查询取数。完成后单击 **下一步**。
   
   ![7](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image013.png)

   b. 在 **数据连接及更新设置** 处，配置数据连接及更新信息。完成后单击 **下一步**。

   ![8](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image015.png)

   c. 在 **确认数据表信息** 处，确认取数结果，并配置数据集名称、保存路径等。完成后单击 **确认新建**。

3. 数据集列表中出现所接入的数据集，表示您已成功接入数据源。

    ![9](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/cloud/24V5/zh/guanyuan/image017.png)

## 后续操作

完成数据源创建后，您可开始使用观远 BI。有关观远 BI 的详细操作指南，请参见 [观远 BI 帮助中心](https://docs.guandata.com/product/bi/)。
