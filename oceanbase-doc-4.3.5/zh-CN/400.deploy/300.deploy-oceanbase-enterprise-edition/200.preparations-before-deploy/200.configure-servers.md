|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 服务器配置

本节主要介绍服务器的硬件设置要求，包括操作系统、BIOS 设置、磁盘挂载、网卡设置、软件要求等。

## 准备操作系统

### OAT/OCP 支持的操作系统

支持在下表所示的操作系统中部署 OAT/OCP。

|                操作系统                 | 支持版本 | 服务器类型  |
|----------------------------------------|---------|------------|
| Rocky Linux         | 9      | x86_64/ARM aarch64 |
| Alibaba Cloud Linux | 2、3   | x86_64/ARM aarch64 |
| 龙蜥 AnolisOS        | 8      | x86_64/ARM aarch64 |
| 麒麟 OS（KylinOS）   | V10、V11 | x86_64/ARM aarch64 |
| 统信 UOS             | V20   | x86_64/ARM aarch64 |
| 中科方德 NFSChina    | 4.0   | x86_64/ARM aarch64 |
| CentOS/RHEL（Red Hat Enterprise Linux）| 7、8、9   | x86_64/ARM aarch64 |
| openSUSE             | 12SP5                | x86_64/ARM aarch64 |
| Debian               | 12                   | x86_64/ARM aarch64 |
| openEuler            | 20.03 LTS、22.03 LTS | x86_64/ARM aarch64 |
| 凝思 OS              | V6.0.99、V6.0.100   | x86_64/ARM aarch64 |
| Ubuntu               | 22.04 LTS、24.04 LTS | x86_64/ARM aarch64 |

### OceanBase 数据库支持的操作系统

支持在下表所示的 Linux 操作系统中安装 OceanBase 数据库。

|       Linux 操作系统     |    版本   |             服务器架构         |
|-------------------------|-----------|-------------------------------|
| Rocky Linux             | 9           | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| Alibaba Cloud Linux     | 2、3        | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| 龙蜥 AnolisOS           | 8           | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| KylinOS                 | V10、V11    | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| 统信 UOS                | V20         | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| 中科方德 NFSChina        | 4.0        | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| 浪潮 Inspur kos          | 5.8        | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| CentOS / Red Hat Enterprise Linux | 7、8、9 | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| SUSE Enterprise Linux     | 12SP5        | x86_64（包括海光）|
| Debian                    | 12           | x86_64（包括海光）|
| openEuler                 | 20.03 LTS、22.03 LTS | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| 凝思 Linux                | V6.0.99、V6.0.100   | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
| Ubuntu                    | 22.04 LTS、24.04 LTS | x86_64（包括海光）|

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p><ul><li>操作系统需要配置网络和软件管理器（ yum 或 zypper 源）。</li><li>部署 OceanBase 集群的服务器需要是小端模式。</li><li>如果使用的是 Hygon 7490 芯片，必须安装 Hygon（海光）服务器厂家推荐的已经包含了 4 号补丁的操作系统。</li></ul></p>
</main>

## OceanBase 服务器 BIOS 设置

### 特殊设置

* 在 Intel x86 架构的环境中：

  * 建议修改配置文件 `/etc/sysctl.conf`，将参数 `vm.swappiness` 设置为 `0`，方法如下：

    ```bash
    [root@xxx /]
    $vi /etc/sysctl.conf
    vm.swappiness = 0
    ```

    应用 sysctl.conf 配置文件里的值：

    ```bash
    [root@xxx /]
    $sysctl -p    
    ```

* 在 AMD 或者 ARM 架构的环境中，建议开启 Numa。

* 在 ARM 和海光架构的环境中，建议修改配置文件 `/etc/sysctl.conf`，将参数 `kernel.numa_balancing`、`vm.zone_reclaim_mode` 和 `vm.swappiness` 设置为 `0`，方法如下：

  ```bash
  [root@xxx /]
  $vi /etc/sysctl.conf
  kernel.numa_balancing = 0
  vm.zone_reclaim_mode = 0
  vm.swappiness = 0
  ```

  应用 sysctl.conf 配置文件里的值：

  ```bash
  [root@xxx /]
  $sysctl -p
  ```

### BIOS 需要关闭以下选项

* Cstate

* Pstate

* EIST

* Power saving

* SMMU（ARM 架构）

### BIOS 需要配置以下选项

* Automatic Power on After Power Loss: Always on

* Intel Virtualization Technology：开启

* Hyper-threading：开启

* Hardware prefetcher：开启

* VT-d：开启

* SR-IOV：开启

* Turbo Mode：开启

* Energy performance：开启最大 performance

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>不同的服务器修改 BIOS 的方式不同，具体操作请参见服务器操作手册。</p>
  </main>

## 磁盘挂载

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>如果一个挂载点的目录文件容量大于 16 TB，仅支持 xfs 类型。</p>
</main>

* OCP 服务器的磁盘挂载点要求如下表所示。

  |    挂载点     |       大小       |     用途      |          磁盘格式           |
  |------------|----------------|-------------|-------------------------|
  | /home      | 100 GB\~300 GB | 各组件运行日志盘    | 建议 ext4 或 xfs |
  | /data/log1 | 内存大小的 3\~4 倍   | OCP 元数据库日志盘 | 建议 ext4 或 xfs |
  | /data/1    | 取决于所需存储的数据大小   | OCP 元数据库数据盘 | 建议 ext4 或 xfs |
  | /docker    | 200 GB\~500 GB | Docker 根目录  | 建议 ext4 或 xfs |

* OBServer 节点的磁盘挂载点要求如下表所示。

  |    挂载点     |       大小       |       用途       |         文件系统格式          |
  |------------|----------------|----------------|-------------------------|
  | /home      | 100 GB\~300 GB | observer 进程运行日志盘 | 建议 ext4 或 xfs |
  | /data/log1 | 内存大小的 3\~4 倍   | observer 进程日志盘   | 建议 ext4 或 xfs |
  | /data/1    | 取决于所需存储的数据大小   | observer 进程数据盘   | 建议 ext4 或 xfs |

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p>建议根目录不小于 50 GB。如果使用 LVM，建议创建时使用条带化参数。示例如下：</p>
    <p><code>lvcreate -n data -L 3000G obvg --stripes=3 --stripesize=128</code></p>
  </main>

## 网卡设置

建议配置 2 块万兆网卡：

* bond 模式取名 bond0，绑定的模式可以选择 mode1 或 mode4，但建议选择 mode4。对于 mode4 模式，交换机需要配置 802.3ad 协议。
* 网卡名建议使用 eth0、eth1。

## SSD 的 I/O 调度器建议

* NVMe SSD 默认的 I/O 调度器为 `none`，无需调整。
* SATA SSD 的 I/O 调度器建议设置为 `none`。

## 注意事项

OceanBase 数据库在 V4.2.5 BP3、V4.2.5 BP4、V4.2.5 BP5、V4.3.5 BP1、V4.3.5 BP2、V4.3.5 BP3 版本增加了对 X86 架构环境运行的指令集要求。OBServer 进程会在启动前检查当前环境是否支持 AVX 指令集，如果缺少该指令集会禁止启动。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>OceanBase 数据库自以下版本开始对 AVX 指令集的强制依赖策略已调整：<ul><li>对于 V4.3.5 版本，从 V4.3.5 BP4 版本开始不再强制要求 AVX 指令集支持。</li><li>对于 V4.2.5 版本，从 V4.2.5 BP6 版本开始不再强制要求 AVX 指令集支持。</li><li>对于 V4.4.0 版本，从 V4.4.1 版本开始不再强制要求 AVX 指令集支持。</li></ul></p>
</main>