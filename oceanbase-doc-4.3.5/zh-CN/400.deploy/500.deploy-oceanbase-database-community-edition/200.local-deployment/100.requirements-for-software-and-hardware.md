# 软硬件要求

OceanBase 数据库是一个分布式集群产品，在生产环境中至少要求三台机器，学习环境可以部署单机版本。OceanBase 数据库的部署跟传统数据库的部署相比，存在很多共同的地方，对操作系统硬件、软件设置等会有一些最佳实践建议，这些是 OceanBase 数据库发挥高性能稳定运行的基础。

## 软件资源介绍

下表列出了不同操作系统版本适用的安装包：

|                       操作系统                        |                                            安装包下载地址                                             |
|---------------------------------------------------|------------------------------------------------------------------------------------------------|
| Alibaba Cloud Linux 2、CentOS 7、RedHat 7、Ubuntu 16.X、Debian 9.X | [el7 下载地址](https://mirrors.aliyun.com/oceanbase/community/stable/el/7/) |
| Alibaba Cloud Linux 3、CentOS 8、RedHat 8、Debian 10 、Anolis OS 8.X             | [el8 下载地址](https://mirrors.aliyun.com/oceanbase/community/stable/el/8/) |

## 服务器配置要求

### 使用 obd 部署 OceanBase 集群

服务器应满足的最低可用配置要求如下表所示。

| 项目  | 描述  |
|------|-------|
| 部署产品 | OceanBase 集群和 obd |
| 服务器数量 | <ul><li>测试环境下要求最少 1 台</li><li>生产环境下要求最少 3 台</li></ul> |
| 测试开发最低配置 | <ul><li>CPU：最低要求 2 核，推荐 4 核及以上，性能测试场景推荐 24 核及以上。</li><li>内存：最低要求 6GB，推荐 8GB 及以上，性能测试场景推荐设置在 128 GB 至 1024 GB 范围内。</li></ul> |
| 生产环境最低配置  | <ul><li>CPU：最低要求 4 核，推荐 32 核及以上。</li><li>内存：最低要求 16GB，长期使用要求不低于 32 GB，推荐设置在 256 GB 至 1024 GB 范围内。</li></ul> |
| 磁盘配置  | 使用 SSD 存储，最低要求 20 GB。<main id="notice" type='explain'><h4>说明</h4><p>磁盘中日志盘需要内存的 3 倍以上，数据盘要满足目标数据量的存储。</p></main> |
| 文件系统  | ext4 或 xfs，当数据超过 16 TB 时，仅支持 xfs 类型。 |

### 使用 OCP 部署 OceanBase 集群

服务器应满足的最低可用配置要求如下表所示。

| 部署产品 | 服务器数量 | 测试开发最低配置 | 生产环境最低配置 | 磁盘配置 |
|----------|----------|-----------|-------------|--------------|
| OCP 和 MetaDB | 1 台 | CPU：16 核</br>内存：32 GB</br>磁盘：1.5 TB 存储<main id="notice" type='explain'><h4>说明</h4><p>16C32G 的配置无法保证 OCP 的稳定性，建议只做验证使用。</p></main> | CPU：32 核</br>内存：128 GB</br>磁盘：1.5 TB，万兆网卡 | 使用 SSD 存储。 |
| OceanBase 集群 | <ul><li>测试环境下要求最少 1 台</li><li>生产环境下要求最少 3 台</li></ul> | <ul><li>CPU：最低要求 2 核，推荐 4 核及以上，性能测试场景推荐 24 核及以上。</li><li>内存：最低要求 6GB，推荐 8GB 及以上，性能测试场景推荐设置在 128 GB 至 1024 GB 范围内。</li></ul>  | <ul><li>CPU：最低要求 4 核，推荐 32 核及以上。</li><li>内存：最低要求 16GB，长期使用要求不低于 32 GB，推荐设置在 256 GB 至 1024 GB 范围内。</li></ul>  | 使用 SSD 存储，最低要求 20 GB。<main id="notice" type='explain'><h4>说明</h4><p>磁盘中日志盘需要内存的 3 倍以上，数据盘要满足目标数据量的存储。</p></main> |
| （可选）ODP | 可复用 OBServer 节点服务器 | CPU：4 核</br>内存：8 GB</br>磁盘：200 GB | CPU：4 核</br>内存：8 GB</br>磁盘：200 GB | N/A |

## 软件环境要求

### 操作系统

#### OCP 操作系统

支持在下表所示的操作系统中部署 OCP，您可参照下文介绍查看自身机器的操作系统。

| 操作系统 | 支持版本 | 服务器类型 |
|----------|---------|-----------|
| RHEL (及兼容的 RockyLinux、CentOS 等) | 7.2 及以上版本 | x86_64/ARM aarch64 |
| Anolis (及兼容的 Alibaba Cloud Linux、麒麟V10、统信UOS、中国移动 BC-Linux、凝思OS、中科方德等) | 8.4 及以上版本 | x86_64/ARM aarch64 |
| Debian (及兼容的 Ubuntu 等) | 11 及以上 | x86_64/ARM aarch64 |
| openSUSE | 12SP3 及以上 | x86_64/ARM aarch64 |

#### OceanBase 数据库操作系统

支持在下表所示的 Linux 操作系统中安装 OceanBase 数据库，您可参照下文介绍查看自身机器的操作系统。

| Linux 操作系统 | 版本 | 服务器架构 |
|---------------|--------|----------|
| 龙蜥 AnolisOS | 8.x | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| Alibaba Cloud Linux | 2、3 | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| CentOS / Red Hat Enterprise Linux | 7.x、8.x | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| Rocky Linux  | 9  | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| KylinOS | V10 | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| 统信 UOS | V20 | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| 中科方德 NFSChina | 4.0 及以上 | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| 浪潮 Inspur kos | 5.8 | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| SUSE / OpenSUSE | 15.X 版本及以上版本 | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| Debian | 9.x 版本及以上 | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾） |
| Ubuntu  | 16.X 版本及以上版本  | x86_64（包括海光），ARM_64（包括鲲鹏、飞腾）  |

<main id="notice" type='explain'>
  <h4>说明</h4>
  <ul>
  <li><p>操作系统需要配置网络和软件管理器（yum 或 zypper 源）。</p></li>
  <li><p>OceanBase 数据库要求操作系统为 4.19 及以上，可执行 <code>uname -r</code> 命令查看内核信息。</p></li>
  </ul>
</main>

#### 查看操作系统

:::tab

tab Anolis OS 8.X

运行以下命令，查看操作系统信息：

```shell
cat /etc/os-release
```

返回结果如下：

```shell
NAME="Anolis OS"
VERSION="8.2"
ID="anolis"
ID_LIKE="rhel fedora centos"
VERSION_ID="8.2"
PLATFORM_ID="platform:an8"
PRETTY_NAME="Anolis OS 8.2"
ANSI_COLOR="0;31"
HOME_URL="https://openanolis.cn/"
```

tab Red Hat Enterprise Linux Server 7.X

运行以下命令，查看操作系统信息：

```shell
cat /etc/redhat-release
```

返回结果如下：

```shell
Red Hat Enterprise Linux Server release 7.2 (Maipo)
```

tab CentOS 7.X

运行以下命令，查看操作系统信息：

```shell
cat /etc/redhat-release
```

返回结果如下：

```shell
CentOS Linux release 7.2.1511 (Core)
```

tab Unbutu

运行以下命令，查看操作系统信息：

```shell
cat /etc/os-release
```

返回结果如下：

```shell
NAME="Ubuntu"
VERSION="20.04.2 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.2 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal
```

tab Debian9

运行以下命令，查看操作系统信息：

```shell
cat /etc/os-release
```

返回结果如下：

```shell
PRETTY_NAME="Debian GNU/Linux 9 (stretch)"
NAME="Debian GNU/Linux"
VERSION_ID="9"
VERSION="9 (stretch)"
VERSION_CODENAME=stretch
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"
```

:::

### 服务器 BIOS 设置

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>不同的服务器修改 BIOS 的方式不同，具体操作请参见服务器操作手册。</p>
</main>

#### BIOS 需要关闭以下选项

* Cstate

* Pstate

* EIST

* Power saving

#### BIOS 需要配置以下选项

* Automatic Power on After Power Loss: Always on

* Intel Virtualization Technology：开启

* Hyper-threading：开启

* Hardware prefetcher：开启

* VT-d：开启

* SR-IOV：开启

* Turbo Mode：开启

* Energy performance：开启最大 performance

### 关闭透明大页

对于 Red Hat 操作系统 RHEL 9 之前版本，需要运行以下命令，手动关闭透明大页：

```bash
echo never > /sys/kernel/mm/redhat_transparent_hugepage/enabled
```

对于 Red Hat 操作系统 RHEL 9 版本或 CentOS 操作系统，需要运行以下命令，手动关闭透明大页：

```bash
echo never > /sys/kernel/mm/transparent_hugepage/enabled
```

## 硬件环境要求

### CPU

若待部署 OceanBase 数据库的机器为 x86 架构，部署时要求机器的 CPU 支持 AVX。

运行以下命令，查看 CPU 是否支持 AVX。

```shell
lscpu | grep Flags | grep avx
```

如果查询结果中无 `avx` 字段，表示当前机器的 CPU 不支持 AVX，需要重新更换机器；如果查询结果中包含 `avx` 字段，表示当前机器的 CPU 支持 AVX。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>OceanBase 数据库自以下版本开始对 AVX 指令集的强制依赖策略已调整：</p>
  <ul>
  <li>对于 V4.3.5 版本，从 V4.3.5 BP4 版本开始不再强制要求 AVX 指令集支持。</li>
  <li>对于 V4.2.5 版本，从 V4.2.5 BP6 版本开始不再强制要求 AVX 指令集支持。</li>
  <li>对于 V4.4.x 版本，从 V4.4.1 版本开始不再强制要求 AVX 指令集支持。</li>
  </ul>
</main>

### 内存

运行以下命令，查看内存：

```shell
free -g
```

返回结果如下：

```shell
              total        used        free      shared  buff/cache   available
Mem:            174          38           6           0         129         123
Swap:             0           0           0
```

此处需要保障 `free` 的 `Mem` 值足够满足上述 **服务器配置要求** 内的配置要求。若不满足，请清理缓存或者更换服务器。

您可执行以下命令，清理缓存：

```shell
sudo sysctl -w vm.drop_caches=3
#或
sudo echo 3 > /proc/sys/vm/drop_caches
```

### 网卡设置

建议配置 2 块万兆网卡：

bond 模式取名 `bond0`，绑定的模式可以选择 `mode1` 或 `mode4`，建议选择 `mode4`。对于 `mode4` 模式，交换机需要配置 802.3ad 协议。
