|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 查看状态异常的索引

OceanBase 数据库 V4.x 中默认开启了索引监控功能，通过视图 `CDB_INDEX_USAGE`（系统租户）或 `DBA_INDEX_USAGE`（用户租户）可查询用户租户的索引使用情况。

由于索引监控在集群启动时采用默认的采样（`SAMPLED`）模式，该模式下，并非所有索引使用数据均会被记录到内部表，视图 `CDB_INDEX_USAGE（系统租户）或 DBA_INDEX_USAGE（用户租户）` 可能会出现查询结果为空的情况。如果需要准确的信息，可以在使用索引前，先将当前租户下索引监控信息统计的模式修改为 `ALL`，然后再查询索引的使用情况。

修改索引监控信息统计的模式的语句如下：

:::tab
tab MySQL 模式

MySQL 模式的用户租户，修改语句如下。

```shell
obclient(root@mysql001)[(none)]> ALTER SYSTEM SET _iut_stat_collection_type='ALL';
```

tab Oracle 模式

Oracle 模式的用户租户，修改语句如下。

```shell
obclient(SYS@oracle001)[SYS]> ALTER SYSTEM SET "_iut_stat_collection_type"='ALL';
```

:::

再通过以下语句，查询索引的使用情况。

* 系统租户

  系统租户下，可以通过以下语句进行查询。

  ```shell
  obclient(root@sys)[(none)]> SELECT OBJECT_ID, NAME, OWNER, TOTAL_ACCESS_COUNT, TOTAL_EXEC_COUNT, LAST_USED FROM oceanbase.CDB_INDEX_USAGE;
  ```

* 用户租户

  MySQL 模式的用户租户下，可以通过以下语句进行查询。

  ```shell
  obclient(root@mysql001)[(none)]> SELECT OBJECT_ID, NAME, OWNER, TOTAL_ACCESS_COUNT, TOTAL_EXEC_COUNT, LAST_USED FROM oceanbase.DBA_INDEX_USAGE;
  ```

  Oracle 模式的用户租户下，可以通过以下语句进行查询。

  ```shell
  obclient(SYS@oracle001)[SYS]> SELECT OBJECT_ID, NAME, OWNER, TOTAL_ACCESS_COUNT, TOTAL_EXEC_COUNT, LAST_USED FROM SYS.DBA_INDEX_USAGE;
  ```