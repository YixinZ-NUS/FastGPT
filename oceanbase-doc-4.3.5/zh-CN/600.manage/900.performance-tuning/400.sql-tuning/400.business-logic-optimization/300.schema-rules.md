| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   |                 |

# Schema 规范

## [强制][风格] 表命名规范

**说明**

数据库中（物理&逻辑）表命名规范：

* OceanBase 数据库 MySQL Mode 一般性规范

    * 由小写字母、数字、下划线组成，以小写字母开头，以小写字母或数字结尾。
    * 长度大于等于 3（研发规范）小于数据库表名最大限制字符。
    * 不以 OceanBase 数据库 MySQL Mode 中存在的关键字、保留字命名。

    <main id="notice" type='notice'>
    <h4>注意</h4>
    <p>OceanBase 数据库 MySQL Mode 当前表名最大长度限制为 64，具体版本可能有不同限制。</p>
    </main>

* OceanBase 数据库 Oracle Mode 一般性规范

    * 由大写字母、数字、下划线组成，以大写字母开头，以大写字母或数字结尾。
    * 长度大于等于 3（研发规范）小于数据库表名最大限制字符。
    * 不以 OceanBase 数据库 Oracle Mode 中存在的关键字、保留字命名。

    <main id="notice" type='notice'>
    <h4>注意</h4>
    <p><ul><li>OceanBase 数据库 Oracle Mode 规范除字母大小写要求之外，其余与 OceanBase 数据库 MySQL Mode规范相同。</li><li>OceanBase 数据库 Oracle Mode 当前表名最大长度限制为 64，具体版本可能有不同限制。</li></ul></p>
    </main>

* 临时表

    临时表为加 `tmp_` 前缀组成。

    **补充场景说明**

    资源命名需要考虑其关联依赖受限，以及避免引起不必要的歧义。

    <main id="notice" type='notice'>
    <h4>注意</h4>
    <p>歧义指资源命名虽然符合规范，但有多种解释空间，如以 <code>tmp_</code> 开头的表作为普通表，该表又可被视为临时表，应当避免此类情况。</p>
    </main>

**错误代码示例**

* 错误示例 1：不符合 OceanBase 数据库 MySQL 表名命名规范

    * `1tb`：以数字开头，违反以小写字母开头规范。
    * `中文table`：表名中出现中文字符，违反“由小写字母、数字、下划线组成”规范。
    * `tb`：长度小于 3，违反“长度大于等于 3 小于 65 个字符”规范。
    * `userTable`：表名中出现大写字母，违反“由小写字母、数字、下划线组成”规范。
    * `user_`：表名以下划线结尾，违反“以小写字母或数字结尾”规范。
    * `primay`：primay 为 MySQL 中关键字，违反“以 OceanBase 数据库 MySQL Mode 中存在的关键字、保留字命名”规范。

* 错误示例 2：不符合 OceanBase 数据库 Oracle Mode 表名命名规范

    * `user_table`：表名中出现小写字母，违反“由大写字母、数字、下划线组成”规范。

## [强制][风格] 索引命名规范

**说明**

数据库中索引命名规范：

* OceanBase 数据库 MySQL 模式索引命名规范

    * 索引由小写字母、数字、下划线 `_` 组成，普通索引以 `idx` 开头，唯一索引以 `uk` 开头。
    * 索引命名不超过数据库自身长度限制。
    * 索引名由有业务含义的字符描述，建议以所包含的列名或列名的适当形式缩写加分隔符 `_` 组成。

    <main id="notice" type='notice'>
    <h4>注意</h4>
    <p>当前 MySQL、OceanBase 数据库 MySQL 模式主流版本索引长度限制为 64 个字符，不同版本可能存在差异。</p>
    </main>

* Oracle、OceanBase 数据库 Oracle 模式索引命名规范

    * 索引由大写字母、数字、下划线 `_` 组成，普通索引以 `IDX` 开头，唯一索引以 `UK` 开头。
    * 索引命名不超过数据库自身长度限制。
    * 索引名由有业务含义的字符描述，建议以所包含的列名或列名的适当形式缩写加分隔符 `_` 组成。

    <main id="notice" type='notice'>
    <h4>注意</h4>
    <p>当前 OceanBase 数据库 Oracle 模式主流版本索引长度限制为 64 个字符，不同版本可能存在差异。</p>
    </main>

**错误代码示例**

* 错误示例 1：OceanBase 数据库 MySQL Mode 普通索引未以 idx 开头

    `index email_address(email,address)`，普通索引未由 `idx` 开头。

* 错误示例 2：OceanBase 数据库 MySQL Mode 唯一索引未以 uk 开头

    `unique index idx_email_address(email,address)`，唯一索引未以 `uk` 开头，以 `idx` 开头容易引起歧义。

* 错误示例 3：OceanBase 数据库 MySQL Mode 索引命名为无业务意义的字符

    `index idx_1(email,adress)`，索引命名无业务含义。

* 错误示例 4：OceanBase 数据库 MySQL Mode 逻辑表中索引名不一致

    索引名应当保持一致，均为 `idx_email_address`。

    ```
    逻辑表 user_[00-09]
    user_00 索引 index idx_00_email_address(email,address);
    user_01 索引 index idx_01_email_address(email,address);
    ...
    user_09 索引 index idx_09_email_address(email,address);
    ```

* 错误示例 5：OceanBase 数据库 Oracle Mode 同 SCHEMA 下索引命名冲突

    10 分库 100 分表，同一物理分库下有一个逻辑表的 10 张物理表，例如 DB00 分库中，TB_00、TB_01...TB_09 分表的索引 IDX_COLA 重名冲突。

    ```
    CREATE TABLE DB[00-09].TB_[00-99](
        COLA NUMBER,
        INDEX IDX_COLA("COLA");
    ); //
    ```

* 错误示例 6：OceanBase 数据库 Oracle Mode 单库场景中，不同表之间的索引冲突

    DB 分库中，表 TB1 与 TB2 的索引 `IDX_COLA` 重名冲突。

    ```
    CREATE TABLE DB.TB_A(
        COLA NUMBER,
        INDEX IDX_COLA("COLA");
    );
    CREATE TABLE DB.TB_B(
        COLA NUMBER,
        INDEX IDX_COLA("COLA");
    );
    ```

**正确代码示例**

* 正确示例 1：OceanBase 数据库 MySQL Mode 普通索引

    `index idx_email_address(email,address)`，普通索引，由 `idx` 开头，索引包含的列 `email`，`address` 加分割符 `_` 构成。

* 正确示例 2：OceanBase 数据库 MySQL Mode 唯一索引

    `unique index uk_email_address(email,address)`，唯一索引，由uk开头，索引包含的列 `email`，`address` 加分隔符 `_` 构成。

* 正确示例 3：OceanBase 数据库 MySQL Mode 索引名中所包含的列缩写

    `index idx_email_add(email,address)`，索引包含的列 address 缩写为 add。

* 正确示例 6：OceanBase 数据库 Oracle Mode 单库场景

    索引可以带有表名相关信息避免不同表之间的冲突：

    ```
    CREATE TABLE DB.TBA(
        COLA NUMBER,
        INDEX IDX_TBA_COLA("COLA");
    );  // 表1 COLA字段索引
    CREATE TABLE DB.TBB(
        COLA NUMBER,
        INDEX IDX_TBB_COLA("COLA");
    );  // 表2 COLA字段索引
    ```

## [强制][风格] 表&字段 Comment 备注

**说明**

建表时必须填写表的 Comment 备注（强制），同时建议填写有必要的列的 Comment 备注。

**错误代码示例**

```
CREATE TABLE user_table (
  id int,
  name varchar(255),
  address varchar(255),
  city varchar(255)
)
```

**正确代码示例**

```
CREATE TABLE user_table (
  id int,
  name varchar(255),
  address varchar(255) comment '地址',
  city varchar(255)
) COMMENT = '工单相关人'
```

## [强制][质量] OceanBase 数据库自增列类型必须使用 bigint 或 bigint unsigned，禁止使用 int

**说明**

OceanBase 数据库自增列每次会取一个区间段（生产环境通常是 100w），OceanBase 数据库某些场景会对尚未用完的区段舍弃重新取值，造成自增列的值“跳变”现象，为避免自增列值耗尽（达到类型限制的最大值），强制使用 bigint 或 bigint unsigned。

自增列在用的过程中会观测到“跳”，触发跳的场景包括：

* 两次访问的不是同一个分区
* 切主
* 合并
* 主动 insert 一个大自增值
* insert on duplicate update（已经有所改善，如果 update 中不显式指定自增列=新值，则不再跳）
