| Description   |                 |
|---------------|-----------------|
| keywords      |  |
| dir-name      |  |
| dir-name-en   |  |
| tenant-type   | MySQL Mode |

# 创建列加密规则

本文档将详细介绍创建列加密规则的语法、参数及限制说明，并为你提供实用的示例，帮助你快速掌握列加密规则的配置方法。

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>该特性仅适用于 MySQL 租户模式。</p>
</main>

## 准备工作

在使用敏感规则之前，需要开启 TDE 加密功能，并创建主密钥：

```sql
-- 设置透明表空间加密的方式为 internal 或 obcloud
ALTER SYSTEM SET tde_method = '<encryption_method>';
ALTER INSTANCE ROTATE INNODB MASTER KEY;	-- 首次执行需要等待约 20 秒使秘钥生效
```

`tde_method` 参数具体说明请参见 [tde_method](../../../700.reference/800.configuration-items-and-system-variables/100.system-configuration-items/400.tenant-level-configuration-items/7800.tde_method.md)。

## 语法

在开始创建列加密规则之前，需先了解相关的语法结构。OceanBase 提供了完整的 DDL 语句来管理列加密规则，包括创建、删除和修改操作。

### 创建列加密规则

```sql
CREATE SENSITIVE RULE <rule_name>
ON <sensitive_field_list>
USING ENCRYPTION [ = <encryption_method>];
```

详细说明请参见 [CREATE SENSITIVE RULE](../../../700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/600.sql-statement-of-mysql-mode/2550.create-sensitive-rule-of-mysql-mode.md)。

### 删除列加密规则

当您需要移除某个列加密规则时，可以使用以下语法：

```sql
DROP SENSITIVE RULE <rule_name>;
```

详细说明请参见 [DROP SENSITIVE RULE](../../../700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/600.sql-statement-of-mysql-mode/3680.drop-sensitive-rule-of-mysql-mode.md)。

### 修改列加密规则

在实际使用过程中，您可能需要根据业务需求调整列加密规则。OceanBase 提供了灵活的修改语法来满足这些需求：

```sql
-- 新增敏感列
ALTER SENSITIVE RULE <rule_name> ADD COLUMN <sensitive_field_list>;
-- 删除敏感列
ALTER SENSITIVE RULE <rule_name> DROP COLUMN <sensitive_field_list>;
-- 启用规则
ALTER SENSITIVE RULE <rule_name> ENABLE;
-- 禁用规则
ALTER SENSITIVE RULE <rule_name> DISABLE;
-- 修改加密算法
ALTER SENSITIVE RULE <rule_name> USING ENCRYPTION [= <encryption_method>];
```

详细说明请参见 [ALTER SENSITIVE RULE](../../../700.reference/500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/600.sql-statement-of-mysql-mode/1350.alter-sensitive-rule-of-mysql-mode.md)。

## 示例

通过以下具体示例可以加深对列加密规则操作的理解。这些示例涵盖了创建、删除和修改规则的主要场景。

### 创建

```sql
-- 创建敏感规则 r1, 保护 tbl1(a), tbl2(b, c), db2.tbl3(e,f);
-- 使用默认加密算法
CREATE SENSITIVE RULE r1 on tbl1(a), tbl2(b, c), db2.tbl3(e,f)
USING ENCRYPTION;

-- 创建敏感规则 r2, 保护 tbl4(x, y), tbl5(z);
-- 使用 sm4-cbc 加密算法
CREATE SENSITIVE RULE r2 on tbl4(x, y), tbl5(z)
USING ENCRYPTION = 'sm4-cbc';
```

### 删除

```sql
DROP SENSITIVE RULE r1;
```

### 修改

```sql
-- 向敏感规则 r1 中增加 tbl2(c), db2.tbl3(x);
ALTER SENSITIVE RULE r1 ADD COLUMN tbl2(c), db2.tbl3(x);

-- 从敏感规则 r1 中删除 tbl2(c)
ALTER SENSITIVE RULE r1 DROP COLUMN tbl2(c);

-- 启用敏感规则 r1
ALTER SENSITIVE RULE r1 ENABLE;

-- 禁用敏感规则 r1
ALTER SENSITIVE RULE r1 DISABLE;

-- 修改敏感规则 r1 的加密算法为默认算法
ALTER SENSITIVE RULE r1 USING ENCRYPTION;

-- 修改敏感规则 r1 的加密算法为 sm4-cbc
ALTER SENSITIVE RULE r1 USING ENCRYPTION = 'sm4-cbc';
```

## 相关文档

* [列加密功能概述](100.column-encryption-overview.md)
* [列加密权限管理](300.column-encryption-permissions.md)
* 查看敏感级规则的定义及其属性，请参见[DBA/CDB_OB_SENSITIVE_RULES](../../../700.reference/700.system-views/400.system-view-of-mysql-mode/200.dictionary-view-of-mysql-mode/11070.o-dba_ob_sensitive_rules-of-mysql-mode.md)