|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 表级恢复前准备

由于表恢复过程中需要使用辅助租户，因此，在进行表恢复前，您需要在目标租户所在的集群内为辅助租户创建所需的资源池。

## 辅助租户的资源规划

由于表级恢复过程中需要在目标集群中创建辅助租户，因此，在进行表级恢复前，需要在集群上预留充足的 CPU、内存以及磁盘资源，防止因资源不足而导致表级恢复任务执行缓慢或者恢复失败。

通常情况下，建议辅助租户的规格与源租户保持一致。如果无法与源租户保持一致，则辅助租户的最小规格要求如下。

:::tab
tab V4.3.5 BP2 及之后版本

在 V4.3.5 BP2 及之后版本中，系统采用的是快速恢复方式来执行表级恢复过程中辅助租户的恢复。快速恢复方式中，辅助租户的最小规格如下表所示。

| 资源项          |  最小规格          |  说明                                   |
|----------------|-------------------|-----------------------------------------|
|  CPU           | 2C 或者 4C         | 最小规格不建议设置太小                   |
|  内存          | 与 Tablet 数量有关  | 最小规格需要至少满足 1GB，最大支持能 2W Tablet 的限制                 |
|  磁盘          | 备份数据量/100 \+ 恢复日志量   | 最小规格推荐至少要设置为备份数据量的百分之一，再加上恢复日志量的和                 |

tab V4.3.5 BP2 （不含该该版）之前版本

在 V4.3.5 BP2 之前版本中，系统采用的是全量恢复方式来执行表级恢复过程中辅助租户的恢复。全量恢复方式中，辅助租户的最小规格如下表所示。

| 资源项          |  最小规格      |  说明             |
|----------------|----------------|------------------|
|  CPU           | 2C 或者 4C         | 最小规格不建议设置太小                   |
|  内存          | 与 Tablet 数量有关  | 最小规格需要至少满足 1GB，最大支持能 2W Tablet 的限制                 |
|  磁盘          | 备份数据量 \+ 恢复日志量   | 最小规格推荐至少要设置为备份数据量与恢复日志量的和                 |

:::

## 创建辅助租户的资源池

1. 使用 `root` 用户登录目标租户所在集群的 `sys` 租户。

2. 创建 Unit（资源单元）。

   示例如下：

   ```shell
   obclient [(none)]> CREATE RESOURCE UNIT box_16c96g MAX_CPU 16, MEMORY_SIZE = '5G', MAX_IOPS 10240, MIN_IOPS=10240;
   ```

   创建资源单元的详细操作及说明请参见 [创建租户](../../200.tenant-management/600.common-tenant-operations/200.manage-create-tenant.md)。

3. 创建 Resource Pool（资源池）。

   为辅助租户创建资源池时，建议尽量与源租户保持同构，即建议辅助租户的资源池中 `unit_num` 的个数与源租户相同。

   示例如下：

   ```shell
   obclient [(none)]> CREATE RESOURCE POOL restore_pool unit = 'box_16c96g', unit_num = 1, zone_list = ('z1','z2','z3');
   ```

   创源资源池的详细操作及说明请参见 [创建租户](../../200.tenant-management/600.common-tenant-operations/200.manage-create-tenant.md)。

## 后续操作

[执行表级恢复](200.perform-table-recovery.md)