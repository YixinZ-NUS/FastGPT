|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 附：S3 路径格式说明

本节主要介绍 AWS S3 和兼容 S3 的对象存储的备份或归档路径的通用格式及相关信息的获取方法。

## AWS S3

### 通用格式

AWS S3 备份路径或归档路径的通用格式如下：

```shell
s3://[bucket_name]/[path]?host=s3.[region].amazonaws.com&access_id=[AWS_Access_Key_ID]&access_key=[AWS_Secret_Access_Key]&s3_region=[region]
```

上述路径中，`s3://`、`/`、`?host=`、`s3.`、`.amazonaws.com`、`&access_id=`、`&access_key=` 和 `&s3_region=` 均为固定信息，不需要替换，需要替换的信息如下：

* `[bucket_name]`：AWS S3 存储桶的名称。

* `[path]`：存储桶下用户自定义的备份前缀。

* `[AWS_Access_Key_ID]`：AWS 的访问秘钥 ID。

* `[AWS_Secret_Access_Key]`：AWS 的访问秘钥。

* `[region]`：AWS S3 存储桶所在的区域。

### 获取相关信息

#### 访问秘钥、秘钥 ID 及同存储所在的区域

以 [AWS CLI](https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-welcome.html) 为例，用户通过 `aws configure` 命令配置的信息即对应备份或归档路径中的访问秘钥、访问秘钥 ID 及存储桶所在的区域信息。

执行 `aws configure` 命令时要求输入 `AWS Access Key ID`、`AWS Secret Access Key`、`Default region name`，这三个参数分别对应于路径格式中的 `[AWS_Access_Key_ID]`、`[AWS_Secret_Access_Key]` 和 `[region]`。

例如，通过 `aws configure` 命令来配置访问秘钥、秘钥 ID 及区域信息的语句示例如下：

```shell
$ aws configure
AWS Access Key ID [None]: my_fake_access_id
AWS Secret Access Key [None]: my_fake_access_key
Default region name [None]: cn-north-1
Default output format [None]:
```

#### 存储桶名

用户可以通过 `aws s3 ls` 命令列出用户拥有的所有存储桶。

语句示例如下：

```shell
$ aws s3 ls
2025-07-07 17:08:50 mybucket1
2025-07-08 14:55:44 mybucket2
```

从示例中可知，用户拥有的存储桶为 `mybucket1` 和 `mybucket2`。可以根据需要选择需要作为备份目的端的存储桶名称作为 `[bucket_name]`。

#### 存储桶下的备份前缀

备份前缀 `[path]` 是由用户自定义的。在满足 [前缀命名规则](https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/using-prefixes.html) 的前提下，请确保该前缀下没有其他任何对象。

用户可以通过 `aws s3 ls` 命令列出指定存储桶中的所有对象和前缀。

语句示例如下：

```shell
$ aws s3 ls s3://mybucket
PRE my_prefix/
2025-07-07 17:06:27         88 mydoc.txt
```

从示例中可知，存储桶 `mybucket` 下有一个根级对象 `mydoc.txt` 和前缀 `my_prefix/`。备份前缀 `[path]` 可以自定义为一个非 `my_prefix/` 的任意前缀，例如 `my_prefix/backup/data`。

### 整合为完整的备份或归档路径

根据上述方法，在文本中，获取到的路径相关的信息如下：

* `[bucket_name]`：mybucket
* `[path]`：my_prefix/backup/data
* `[AWS_Access_Key_ID]`：my_fake_access_id
* `[AWS_Secret_Access_Key]`：my_fake_access_key
* `[region]`：cn-north-1

最终整合的备份或归档路径示例如下：

```shell
s3://mybucket/my_prefix/backup/data?host=s3.cn-north-1.amazonaws.com.cn&access_id=my_fake_access_id&access_key=my_fake_access_key&s3_region=cn-north-1
```

## minio 等兼容 S3 协议的对象存储

对于 minio 等兼容 S3 协议的对象存储，其备份或归档路径的通用格式如下：

```shell
s3://[bucket_name]/[path]?host=[endpoint]&access_id=[Access_Key_ID]&access_key=[Secret_Access_Key]
```

其中：

* `[bucket_name]`：第三方对象存储的存储桶名，例如：mybucket。参数含义与 AWS S3 相同。

* `[path]`：第三方对象存储的存储桶下用户自定义的备份前缀，例如：my_prefix/backup/data。获取方式与 AWS S3 类似。

* `[endpoint]`：第三方对象存储服务的接入点。

  在 AWS CLI 中，服务接入点即为 `[endpoint]` 所指定的内容。以本地部署的 minio 为例，其 endpoint 由 `[ip]:[port]` 构成，例如：http://127.0.0.1:9000。其他第三方对象存储的 endpoint，请咨询对应服务提供商。

  在 AWS CLI 中访问 minio 的 endpoint 的示例如下。

  ```shell
  $ aws s3 ls --endpoint http://127.0.0.1:9000
  2025-07-07 17:08:50 mybucket1
  2025-07-08 14:55:44 mybucket2
  ```

* `[Access_Key_ID]`：第三方对象存储服务的访问密钥 ID，例如：my_fake_access_id。参数含义与 AWS S3 相同。

* `[Secret_Access_Key]`：第三方对象存储服务的访问秘钥，例如：my_fake_access_key。参数含义与 AWS S3 相同。

以 minio 为例，最终整合的备份或归档路径示例如下：

```shell
s3://mybucket/my_prefix/backup/data?host=http://127.0.0.1:9000&access_id=my_fake_access_id&access_key=my_fake_access_key
```

## 相关文档

* [日志归档前准备](300.log-archive/200.preparation-before-log-archive.md)

* [备份前准备](400.data-backup/100.preparation-before-data-backup.md)
