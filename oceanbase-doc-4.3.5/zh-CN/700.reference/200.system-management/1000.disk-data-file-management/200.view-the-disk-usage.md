|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 查看租户或表占用的磁盘空间

OceanBase 数据库支持通过视图来查看租户和表的磁盘空间占用情况。

## 查看租户所占用的磁盘空间

1. `root` 用户登录集群的 `sys` 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uroot@sys#obdemo -p***** -A
   ```

2. 执行以下语句，查看租户在各节点上磁盘空间的占用情况。

   系统租户下，查看租户 `mysql001` 在各节点上不同组件分别占用的磁盘空间大小，语句如下：

   ```shell
   obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_SERVER_SPACE_USAGE WHERE TENANT_NAME='mysql001' ;
   ```

   查询结果如下：

   ```shell
   +-----------+-------------+----------------+-------------+------------+------------+-------------+
   | TENANT_ID | TENANT_NAME | SERVER_IP      | SERVER_PORT | SPACE_TYPE | DATA_BYTES | USAGE_BYTES |
   +-----------+-------------+----------------+-------------+------------+------------+-------------+
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | clog Data  | 5898749661 |  5898749661 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Index Data |       2793 |       24576 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Meta Data  |   28184576 |    28184576 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | slog Data  |   26112000 |    26112000 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Table Data |      25268 |     6438912 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Tmp Data   |          0 |           0 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | clog Data  | 3348203904 |  3348203904 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Index Data |       3936 |       32768 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Meta Data  |   25452544 |    25452544 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | slog Data  |   39931904 |    39931904 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Table Data |    8056455 |     8736768 |
   | 1002      | mysql001    |  xx.xx.xx.xx   |        2882 | Tmp Data   |          0 |           0 |
   +-----------+-------------+----------------+-------------+------------+------------+-------------+
   12 rows in set
   ```

   返回结果中：

   * `SPACE_TYPE`：数据的类型，包括以下几种类型：

      * `Table Data`：所有主表所有分区的数据，包含 Lob 分区
      * `Index Data`：所有索引表所有分区的数据
      * `Meta Data`：所有元数据
      * `Tmp Data`：临时文件
      * `clog Data`：当前节点上的 clog 总大小
      * `slog Data`：当前节点上的 slog 总大小
        
   * `DATA_BYTES`：数据内容的大小，单位为字节。
   * `USAGE_BYTES`：实际占用的磁盘空间大小，单位为字节。

## 查看表所占用的磁盘空间

1. `sys` 租户或用户租户的租户管理员登录到数据库。

   <main id="notice" type='explain'>
   <h4>说明</h4>
   <p>MySQL 租户的管理员用户为 <code>root</code> 用户，Oracle 租户的管理员用户为 <code>SYS</code> 用户。</p>
   </main>

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   obclient -h10.xx.xx.xx -P2883 -uroot@sys#obdemo -p***** -A
   ```

2. 执行以下语句，查看表数据的磁盘空间占用情况。

   * 系统租户

      系统租户下，查询租户 `mysql001` 下表 `t1` 的磁盘空间占用情况，语句如下：

      ```shell
      obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_TABLE_SPACE_USAGE WHERE TENANT_NAME='mysql001' AND TABLE_NAME='t1';
      ```

      查询结果如下：

      ```shell
      +-----------+----------+-------------+---------------+---------------------+-------------+---------------+
      | TENANT_ID | TABLE_ID | TENANT_NAME | DATABASE_NAME | TABLE_NAME          | OCCUPY_SIZE | REQUIRED_SIZE |
      +-----------+----------+-------------+---------------+---------------------+-------------+---------------+
      | 1002      |   500051 | mysql001    | test          | t1                  |        1233 |          8192 |
      +-----------+----------+-------------+---------------+---------------------+-------------+---------------+
      1 row in set
      ```

   * 用户租户

      :::tab
      tab MySQL 模式

      MySQL 租户查看本租户下各表的磁盘空间占用情况，语句如下：

      ```shell
      obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_TABLE_SPACE_USAGE;
      ```

      tab Oracle 模式

      Oracle 租户查看本租户下各表的磁盘空间占用情况，语句如下：

      ```shell
      obclient [SYS]> SELECT * FROM SYS.DBA_OB_TABLE_SPACE_USAGE;
      ```

      :::

      查询结果的示例如下：

      ```shell
      +----------+---------------+--------------------------------+-------------+---------------+
      | TABLE_ID | DATABASE_NAME | TABLE_NAME                     | OCCUPY_SIZE | REQUIRED_SIZE |
      +----------+---------------+--------------------------------+-------------+---------------+
      |   500011 | test          | wide_table_row_storage2        |  4495925120 |    4613763072 |
      |   500012 | test          | wide_table_column_storage2     |  3915023145 |    4195397632 |
      |   500014 | test          | wide_table_row_column_storage2 |  8410964107 |    9805275136 |
      +----------+---------------+--------------------------------+-------------+---------------+
      3 rows in set
      ```

      返回结果中：

      * `OCCUPY_SIZE`：表压缩后落盘的数据量，单位为字节。
      * `REQUIRED_SIZE`：表压缩后落盘的数据量实际占用了多少磁盘空间，单位为字节。

      从返回结果中，还可以通过 `OCCUPY_SIZE` / `REQUIRED_SIZE` 来计算磁盘空间的利用率。