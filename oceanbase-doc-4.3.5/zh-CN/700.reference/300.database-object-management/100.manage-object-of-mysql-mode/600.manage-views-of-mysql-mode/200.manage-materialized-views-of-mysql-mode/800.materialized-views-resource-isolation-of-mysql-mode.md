|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|

# 物化视图资源隔离

OceanBase 数据库从 V4.3.5 BP2 版本开始支持 `DBMS_RESOURCE_MANAGER` 为物化视图的增量刷新、MLOG Purge 提供资源隔离的能力，可以限定物化视图能使用的资源上限。

## 示例

1. 创建资源计划 `mview_task`。

    ```sql
    CALL DBMS_RESOURCE_MANAGER.CREATE_PLAN('mview_task','该资源计划用于物化视图处理');
    ```

    更多关于创建资源计划的信息，参见 [CREATE_PLAN](../../../../600.pl-reference/200.pl-mysql/1000.pl-system-package-mysql/13300.dbms-resource-manager-mysql/300.create-plan-mysql.md)。

2. 创建定义资源用户组 `mview_group`。

    ```sql
    CALL DBMS_RESOURCE_MANAGER.CREATE_CONSUMER_GROUP('mview_group','物化视图处理组');
    ```

    更多关于创建定义资源用户组的信息，参见 [CREATE_CONSUMER_GROUP](../../../../600.pl-reference/200.pl-mysql/1000.pl-system-package-mysql/13300.dbms-resource-manager-mysql/200.create-consumer-group-mysql.md)。

3. 创建资源计划指令，限制 CPU 资源使用比例上限 5%。

    ```sql
    CALL DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
        PLAN => 'mview_task',
        GROUP_OR_SUBPLAN => 'mview_group',
        UTILIZATION_LIMIT => 5
        );
    ```

    更多关于创建资源计划指令的信息，参见 [CREATE_PLAN_DIRECTIVE](../../../../600.pl-reference/200.pl-mysql/1000.pl-system-package-mysql/13300.dbms-resource-manager-mysql/400.create-plan-directive-mysql.md)。

4. 绑定资源使用组 `mview_group` 到 `FUNCTION`。

    ```sql
    CALL DBMS_RESOURCE_MANAGER.SET_CONSUMER_GROUP_MAPPING(
        ATTRIBUTE => 'FUNCTION',
        VALUE => 'MVIEW',
        CONSUMER_GROUP => 'mview_group'
        );
    ```

    更多关于将会话映射到资源组的条目信息，参见 [SET_CONSUMER_GROUP_MAPPING](../../../../600.pl-reference/200.pl-mysql/1000.pl-system-package-mysql/13300.dbms-resource-manager-mysql/800.set-consumer-group-mappingn-directive-mysql.md)。

5. 激活资源管理计划 `mview_task`。

    ```sql
    SET GLOBAL resource_manager_plan = 'mview_task';
    ```

    更多关于激活资源管理计划的信息，参见 [resource_manager_plan](../../../../800.configuration-items-and-system-variables/200.system-variable/300.global-system-variable/11500.resource_manager_plan-global.md)。

6. 修改 CPU 资源使用上限为 30%。

    ```sql
    CALL DBMS_RESOURCE_MANAGER.UPDATE_PLAN_DIRECTIVE(
        PLAN => 'mview_task',
        GROUP_OR_SUBPLAN => 'mview_group',
        NEW_UTILIZATION_LIMIT => 30
        );
    ```

    更多关于更新资源计划的信息，参见 [UPDATE_PLAN_DIRECTIVE](../../../../600.pl-reference/200.pl-mysql/1000.pl-system-package-mysql/13300.dbms-resource-manager-mysql/900.update-plan-directive-mysql.md)。

## 相关文档

* [物化视图日志](200.materialized-views-log-of-mysql-mode.md)
* [刷新物化视图](400.refresh-materialized-views-of-mysql-mode.md)
* [DBMS_RESOURCE_MANAGER 概述](../../../../600.pl-reference/200.pl-mysql/1000.pl-system-package-mysql/13300.dbms-resource-manager-mysql/100.dbms-resource-manager-overview-mysql.md)
