|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|

# 修改动态分区表

OceanBase 数据库可以通过修改 `DYNAMIC_PARTITION_POLICY` 块，修改表的动态分区管理属性。

本文将向您介绍如何使用 SQL 语句修改动态分区表。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>对于 OceanBase 数据库 V4.3.5 版本，从 V4.3.5 BP2 版本开始支持指定 <code>DYNAMIC_PARTITION_POLICY</code> 创建动态分区表。</p>
</main>

## 使用限制及注意事项

修改动态分区管理参数后，预创建分区和删除过期分区不会立刻生效，需要等待下一次动态分区管理任务自动调度，或者手动调度一次动态分区管理任务。调度动态分区管理任务的详细介绍，参见 [动态分区管理任务](500.dynamic-partition-management-task-of-mysql-mode.md)。

## 权限要求

修改动态分区表需要有 `ALTER` 权限。更多有关 OceanBase 数据库权限的详细介绍，参见 [MySQL 模式下的权限分类](../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md)。

## 语法

创建动态分区表的 SQL 语句格式如下：

```sql
ALTER TABLE table_name [SET] DYNAMIC_PARTITION_POLICY [=] (dynamic_partition_policy_list);

dynamic_partition_policy_list:
    dynamic_partition_policy_option [, dynamic_partition_policy_option ...]

dynamic_partition_policy_option:
    ENABLE = {true | false}
    | PRECREATE_TIME = {'-1' | '0' | 'n {hour | day | week | month | year}'}
    | EXPIRE_TIME = {'-1' | '0' | 'n {hour | day | week | month | year}'}
```

## 动态分区管理属性参数说明

|   **属性名称**   | **描述** | **是否必填** | **是否可修改** |
|------------------|----------|--------------|----------------|
| ENABLE           | 表示是否启用动态分区管理。取值如下：<ul><li>`true`：默认值，表示启用动态分区管理。</li><li>`false`：表示禁用动态分区管理。</li></ul>| 否 | 是 |
| PRECREATE_TIME   | 表示预创建时间。调度一次动态分区管理，会预创建分区使得 **最大分区上界 > now() + precreate_time**。取值如下：<ul><li>`-1`：默认值，表示不预创建分区。</li><li>`0`：表示仅预创建当前分区。</li><li>`n {hour \| day \| week \| month \| year}`：表示预创建对应时间跨度的分区。例如，`3 hour` 表示预创建 3 小时内的分区。</li></ul>  <main id="notice" type='explain'><h4>说明</h4><p><ul><li>需要预创建多个分区时，分区边界的间隔为 <code>TIME_UNIT</code>。</li><li>首个预创建的分区边界为现存最大分区边界按 <code>TIME_UNIT</code> 向上取整。</li></ul></p></main>| 否 | 是 |
| EXPIRE_TIME      | 表示分区过期时间。调度一次动态分区管理，会删除所有 **分区上界 < now() - expire_time** 的过期分区。取值如下：<ul><li>`-1`：默认值，表示分区永不过期。</li><li>`0`：表示除当前分区外，之前的所有分区均过期。</li><li>`n {hour \| day \| week \| month \| year}`：表示分区过期时间。例如，`1 day` 表示分区过期时间为 1 天。</li></ul>| 否 | 是 |

更多有关修改表语法的详细参数说明信息，参见 [ALTER TABLE](../../../../500.sql-reference/100.sql-syntax/200.common-tenant-of-mysql-mode/600.sql-statement-of-mysql-mode/1600.alter-table-of-mysql-mode.md)。

## 示例

1. 查看表 `test_tbl1` 的动态分区信息。

    ```sql
    SELECT * FROM oceanbase.DBA_OB_DYNAMIC_PARTITION_TABLES
    WHERE TABLE_NAME = 'test_tbl1';
    ```

    查询结果如下：

    ```shell
    +---------------+------------+----------+-----------------------+--------+-----------+----------------+-------------+-----------+------------------+
    | DATABASE_NAME | TABLE_NAME | TABLE_ID | MAX_HIGH_BOUND_VAL    | ENABLE | TIME_UNIT | PRECREATE_TIME | EXPIRE_TIME | TIME_ZONE | BIGINT_PRECISION |
    +---------------+------------+----------+-----------------------+--------+-----------+----------------+-------------+-----------+------------------+
    | db_test       | test_tbl1  |   511335 | '2025-04-15 13:30:00' | TRUE   | HOUR      | 3HOUR          | 1DAY        | +8:00     | NONE             |
    +---------------+------------+----------+-----------------------+--------+-----------+----------------+-------------+-----------+------------------+
    1 row in set
    ```

2. 修改动态分区表 `test_tbl1`，设置动态分区属性为：

   * 预创建当前时间之后的 1 天内的分区。
   * 分区永不过期。

   ```sql
   ALTER TABLE test_tbl1 DYNAMIC_PARTITION_POLICY(
       ENABLE = true,
       PRECREATE_TIME = '1 day',
       EXPIRE_TIME = '-1'
   );
   ```

3. 再次查看表 `test_tbl1` 的动态分区信息。

    ```sql
    SELECT * FROM oceanbase.DBA_OB_DYNAMIC_PARTITION_TABLES
    WHERE TABLE_NAME = 'test_tbl1';
    ```

    查询结果如下：

    ```shell
    +---------------+------------+----------+-----------------------+--------+-----------+----------------+-------------+-----------+------------------+
    | DATABASE_NAME | TABLE_NAME | TABLE_ID | MAX_HIGH_BOUND_VAL    | ENABLE | TIME_UNIT | PRECREATE_TIME | EXPIRE_TIME | TIME_ZONE | BIGINT_PRECISION |
    +---------------+------------+----------+-----------------------+--------+-----------+----------------+-------------+-----------+------------------+
    | db_test       | test_tbl1  |   511335 | '2025-04-15 13:30:00' | TRUE   | HOUR      | 1DAY           | -1          | +8:00     | NONE             |
    +---------------+------------+----------+-----------------------+--------+-----------+----------------+-------------+-----------+------------------+
    1 row in set
    ```

    <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>修改动态分区管理参数后，预创建分区和删除过期分区不会立刻生效，需要等待下一次动态分区管理任务自动调度，或者手动调度一次动态分区管理任务。详细介绍，参见 <a href="500.dynamic-partition-management-task-of-mysql-mode.md">动态分区管理任务</a>。</p>
    </main>

## 相关文档

* [动态分区概述](100.dynamic-partition-overview-of-mysql-mode.md)
* [创建动态分区表](200.create-a-dynamic-partition-table-of-mysql-mode.md)
* [查看动态分区表](300.view-dynamic-partition-table-of-mysql-mode.md)
* [动态分区管理任务](500.dynamic-partition-management-task-of-mysql-mode.md)
