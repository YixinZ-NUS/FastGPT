|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|

# 删除物化视图

## 权限要求

删除物化视图需要有 `DROP TABLE` 权限。更多有关 OceanBase 数据库权限的详细介绍，请参见 [Oracle 模式下的权限分类](../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/300.permission-of-oracle-mode/000.permission-classification-of-oracle-mode.md)。

## 注意事项

* 单独删除物化视图的时候，物化视图不进回收站。
* 物化视图的基表上如果创建了物化视图日志，需要先删除基表上的物化视图日志，才能删除基表，否则报错。

## 语法

删除物化视图的 SQL 语句格式如下：

```sql
DROP MATERIALIZED VIEW [ schema. ] materialized_view;
```

**参数说明：**

|       **参数**    |       **描述**           |
|-------------------|--------------------------|
| schema.           | 可选项，指定物化视图所在的 Schema。如果省略 `schema.`，则默认在您自己的 Schema 中。|
| materialized_view | 指定物化视图的名称。|

## 示例

以下将展示创建物化视图、查询物化视图及删除物化视图的信息。

1. 创建表 `test_tbl1` 作为物化视图的基表。

    ```sql
    CREATE TABLE test_tbl1 (col1 INT PRIMARY KEY, col2 VARCHAR2(20), col3 INT);
    ```

2. 基于表 `test_tbl1` 创建名为 `mv_test_tbl1` 的物化视图。

    ```sql
    CREATE MATERIALIZED VIEW mv_test_tbl1(PRIMARY KEY (col1))
        AS SELECT col1, col2
           FROM test_tbl1;
    ```

3. 在物化视图 `mv_test_tbl1` 上创建物化视图日志。

    ```sql
    CREATE MATERIALIZED VIEW LOG ON mv_test_tbl1
        WITH PRIMARY KEY (col2) INCLUDING NEW VALUES;
    ```

4. 基于物化视图 `mv_test_tbl1` 创建物化视图（嵌套物化视图） `mv_mv_test_tbl1`。

    ```sql
    CREATE MATERIALIZED VIEW mv_mv_test_tbl1
        AS SELECT col1
           FROM mv_test_tbl1;
    ```

5. 查看当前所有物化视图信息。

    ```sql
    SELECT owner, mview_name, container_name, query, refresh_mode
    FROM sys.DBA_MVIEWS
    WHERE OWNER = 'TEST_USER001';
    ```

    <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>Oracle 模式中视图 <code>sys.DBA_MVIEWS</code> 中字段 <code>OWNER</code> 匹配 Schema 名时，Schema 名需使用大写字母。</p>
    </main>

    返回结果如下：

    ```shell
    +--------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------+--------------+
    | OWNER        | MVIEW_NAME      | CONTAINER_NAME  | QUERY                                                                                                                          | REFRESH_MODE |
    +--------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------+--------------+
    | TEST_USER001 | MV_TEST_TBL1    | MV_TEST_TBL1    | select "TEST_USER001"."TEST_TBL1"."COL1" AS "COL1","TEST_USER001"."TEST_TBL1"."COL2" AS "COL2" from "TEST_USER001"."TEST_TBL1" | DEMAND       |
    | TEST_USER001 | MV_MV_TEST_TBL1 | MV_MV_TEST_TBL1 | select "MV_TEST_TBL1"."COL1" AS "COL1" from "TEST_USER001"."MV_TEST_TBL1" "MV_TEST_TBL1"                                       | DEMAND       |
    +--------------+-----------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------+--------------+
    2 rows in set
    ```

6. 删除物化视图 `mv_mv_test_tbl1`。

    ```sql
    DROP MATERIALIZED VIEW mv_mv_test_tbl1;
    ```

    返回结果如下：

    ```shell
    Query OK, 0 rows affected
    ```

7. 删除物化视图 `mv_test_tbl1`。

    <main id="notice" type='notice'>
      <h4>注意</h4>
      <p>物化视图的基表上如果创建了物化视图日志，需要先删除基表上的物化视图日志，才能删除基表，否则报错。</p>
    </main>

    ```sql
    DROP MATERIALIZED VIEW mv_test_tbl1;
    ```

    返回结果如下：

    ```shell
    OBE-00600: internal error code, arguments: -4007, drop table required by materialized view refresh is not supported
    ```

8. 删除物化视图 `mv_test_tbl1` 上的物化视图日志。

    ```sql
    DROP MATERIALIZED VIEW LOG ON mv_test_tbl1;
    ```

    返回结果如下：

    ```shell
    Query OK, 0 rows affected
    ```

9. 再次删除物化视图 `mv_test_tbl1`。

    ```sql
    DROP MATERIALIZED VIEW mv_test_tbl1;
    ```

    返回结果如下：

    ```shell
    Query OK, 0 rows affected
    ```

## 相关文档

* [物化视图概述](100.materialized-views-overview-of-oracle-mode.md)
* [物化视图日志](200.materialized-views-log-of-oracle-mode.md)
* [创建物化视图](300.create-materialized-views-of-oracle-mode.md)
* [刷新物化视图](400.refresh-materialized-views-of-oracle-mode.md)
* [物化视图查询改写](500.materialized-views-rewrite-of-oracle-mode.md)
* [查询物化视图](600.view-materialized-views-of-oracle-mode.md)
