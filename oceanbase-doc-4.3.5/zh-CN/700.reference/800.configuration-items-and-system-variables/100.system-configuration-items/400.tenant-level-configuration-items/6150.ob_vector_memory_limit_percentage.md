|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# ob_vector_memory_limit_percentage

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>该配置项从 V4.3.3 版本开始引入。</p>
</main>

## 功能描述

`ob_vector_memory_limit_percentage` 用于配置向量索引模块对内存资源占用的阈值。

<main id="notice" type='notice'>
  <h4>功能适用性</h4>
  <p>该配置项仅适用于 OceanBase 数据库 MySQL 模式。</p>
</main>

## 权限要求

* 查询配置项

  `sys` 租户和 MySQL 用户租户均可以使用 `SHOW PARAMETERS` 语句或视图 `GV$OB_PARAMETERS` 查询该配置项。

* 修改配置项

  `sys` 租户和 MySQL 用户租户都可修改该配置项。

## 属性说明

|      **属性**      |   **描述**   |
|--------------------|--------------|
| 参数类型             | Int         |
| 默认值               | 0，单位为百分比 <main id="notice" type='notice'><h4>说明</h4><p>V4.3.5 BP3 之前的版本，该配置项默认值含义为不为向量索引分配内存，即关闭向量检索功能。<br>从 V4.3.5 BP3 版本开始，该配置项默认值含义变更为自适应模式，即系统自动调整租户中的向量索引数据的内存占用比例：<ul><li>租户实际内存为 8GB 及以下时，该值自适应为 40。</li><li>租户实际内存为 8GB 以上时，该值自适应为 50。</li></ul></p></main> |
| 取值范围             | [0, 100)。实际最大值是 `85 - Memstore`（即 `memstore_limit_percentage` 值）。当 `memstore_limit_percentage` 参数设置为 `0`（默认值）时，系统会自动计算 MemStore 内存占比。自动计算规则：<ul><li>如果租户内存 > 8GB：MemStore 占用 50% 的租户内存。</li><li>如果租户内存 ≤ 8GB：MemStore 占用 40% 的租户内存。</li></ul> |
| 是否可修改           | 是，支持通过 `ALTER SYSTEM SET` 语句修改。|
| 是否重启 OBServer 节点生效 | 否，设置后立即生效。     |

## 使用说明

### 内存计算

此参数的具体取值需要基于计算公式和业务需求来规划。请点击[下载内存计算表格](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer/V4.3.3/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97.xlsx)计算参数取值。

表格说明：

* 当需要在一个租户下创建多个向量索引时，所需的内存是所有内存的总和。

* 您需要按业务场景需要填写表格第一列数据量和第二列向量维度数值。

* 表格第三列 M 表示 HNSW 图索引的最大边数，`16` 为默认值，通常不需要改动。

* 表格第五列最小内存配置仅用于后建索引，且不进行任何新增数据的场景。

### 扩大向量索引内存占用

如果需要扩大向量索引内存占用的阈值，建议先降低该租户下 MemStore 内存占比。可通过在用户租户下修改 `_memstore_limit_percentage` 配置项实现。

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>降低 MemStore 占比可能会对 DML 性能产生影响，因此在 DML 压力较大的环境中，请务必在评估后再进行修改。</p>
</main>

## 配置示例

设置向量索引内存占用的阈值为 30%。

```shell
obclient> ALTER SYSTEM SET ob_vector_memory_limit_percentage = 30;
```

扩大向量索引内存占用阈值为 59%。

```shell
obclient> ALTER SYSTEM SET _memstore_limit_percentage = 25;
          ALTER SYSTEM SET ob_vector_memory_limit_percentage = 59;
```

查看当前向量索引内存配置。

```shell
obclient> SHOW PARAMETERS LIKE 'ob_vector_memory_limit_percentage';
```

## 相关文档

* [memstore_limit_percentage/_memstore_limit_percentage](../300.cluster-level-configuration-items/13800.memstore_limit_percentage.md)