
|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# enable_mv_binlog_minimal_mode

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>对于 V4.3.5 版本，该配置项从 V4.3.5 BP5 版本开始引入。</p>
</main>

## 功能描述

`enable_mv_binlog_minimal_mode` 用于控制物化视图增量刷新场景中 `binlog minimal` 模式的开关。

## 权限要求

* 查询配置项

  `sys` 租户和所有用户租户均可以使用 `SHOW PARAMETERS` 语句或视图 `GV$OB_PARAMETERS` 查询该配置项。

* 修改配置项

  `sys` 租户和用户租户均可修改该配置项。

## 属性说明

| **属性** | **描述** |
|----------|----------|
| 参数类型  | Bool |
| 默认值    | False |
| 取值范围  | <ul><li>True：表示开启物化视图增量刷新场景中 `binlog minimal` 模式。</li><li>False：表示关闭物化视图增量刷新场景中 `binlog minimal` 模式。</li></ul> |
| 是否可修改 | 是，支持通过 `ALTER SYSTEM SET` 语句修改。|
| 是否重启 OBServer 节点生效 | 否，设置后立即生效。 |

## 使用说明

* 配置项 `enable_mv_binlog_minimal_mode` 只影响物化视图的 DML 行为，不会影响其他 DML。
* 配置项 `enable_mv_binlog_minimal_mode` 不受 [binlog_row_image](../../200.system-variable/300.global-system-variable/500.binlog_row_image-global.md) 的影响，它限定了物化视图场景的特殊路径。

  * 如果打开 `enable_mv_binlog_minimal_mode` 的开关，即使 `binlog_row_image` 设置为 `full` 模式，物化视图的 DML 依旧会使用 `minimal` 模式。

* 打开配置项 `enable_mv_binlog_minimal_mode` 可以优化物化视图的刷新性能，但是该配置项会简化 `CLOG` 的内容，当有下游链路（比如 CDC + OMS）依赖物化视图完整的 `CLOG` 进行迁移、同步时，打开该配置项可能会导致同步链路出现异常。因此在有物化视图的下游数据同步需求时，不建议打开这个开关。

## 配置示例

1. 开启物化视图增量刷新场景中 `binlog minimal` 模式。

    ```shell
    obclient> ALTER SYSTEM SET enable_mv_binlog_minimal_mode = True;
    ```

2. 创建表 `test_tbl1`。

    ```shell
    obclient> CREATE TABLE test_tbl1(col1 INT, col2 INT, col3 INT);
    ```

3. 创建物化视图 `mv1_t1`。

    ```shell
    obclient> CREATE MATERIALIZED VIEW mv1_t1
        REFRESH FAST
        AS SELECT col2, COUNT(*) cnt
           FROM test_tbl1
           GROUP BY col2;
    ```

4. 增量刷新时 DML 会使用 `binlog minimal` 模式。

    ```shell
    obclient> CALL DBMS_MVIEW.REFRESH('mv1_t1', 'f');
    ```

5. 关闭物化视图增量刷新场景中 `binlog minimal` 模式。

    ```shell
    obclient> ALTER SYSTEM SET enable_mv_binlog_minimal_mode = False;
    ```