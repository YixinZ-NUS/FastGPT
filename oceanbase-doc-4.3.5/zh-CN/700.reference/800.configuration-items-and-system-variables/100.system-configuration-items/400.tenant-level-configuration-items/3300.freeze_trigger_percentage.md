|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# freeze_trigger_percentage

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>该配置项从 V1.4 版本开始引入。</p>
</main>

## 功能描述

`freeze_trigger_percentage` 用于设置触发冻结的租户使用 MemStore 内存的阈值百分比。

## 权限要求

* 查询配置项

  `sys` 租户和所有用户租户均可以使用 `SHOW PARAMETERS` 语句或视图 `GV$OB_PARAMETERS` 查询该配置项。

* 修改配置项

  `sys` 租户和用户租户均可修改该配置项。

## 属性说明

|      **属性**    |  **描述** |
|------------------|-----------|
| 参数类型         | Int        |
| 默认值           | 20  <main id="notice" type='explain'><h4>说明</h4><p>从 V4.0.0 版本开始默认值由 70 调整为 20。</p></main>     |
| 取值范围         | (0, 100) |
| 是否可修改  | 是，支持通过 `ALTER SYSTEM SET` 语句修改。|
| 是否重启 OBServer 节点生效 | 否，设置后立即生效。         |

## 使用说明

* OceanBase 数据库使用 MemStore 来存储最近写入的数据。为了避免内存溢出，系统提供了两个重要的保护机制：

  * 冻结机制：将内存中的数据持久化到磁盘，以释放内存空间。

  * 限流机制：当内存压力过大时，降低写入速度，为释放内存争取时间。

  这两个机制通过两个租户级配置项来控制触发时机：`freeze_trigger_percentage`（冻结阈值）和 [writing_throttling_trigger_percentage](8500.writing_throttling_trigger_percentage.md)（限流阈值）。

  为了避免因过早限流而导致的性能下降，要求 [writing_throttling_trigger_percentage](8500.writing_throttling_trigger_percentage.md) 的值必须大于 `freeze_trigger_percentage` 的值。

* 可以通过如下配置项来调整租户内存中 MemStore 的比例：

  * 当一个租户 Active MemStore 内存的使用量达到 `freeze_trigger_percentage * memstore_limit`（其中，`memstore_limit = 租户内存 * memstore_limit_percentage`）时，系统就会自动触发冻结（转储的前置动作），然后再调度转储。转储后，系统就会释放占用的 MemStore 内存。

  * 当内存不足时，可以调高 `memstore_limit_percentage` 的取值，并调低 `freeze_trigger_percentage` 的取值，从而达到临时扩容和尽快转储释放的效果。其中配置项 `memstore_limit_percentage` 用于控制租户内存中可用于 MemStore 写入的比例，默认值为 0，表示租户内存中可用于 MemStore 写入的比例由系统进行自适应调整。

## 配置示例

设置触发冻结的租户使用 MemStore 内存的阈值百分比为 20。

```shell
obclient> ALTER SYSTEM SET freeze_trigger_percentage=20;
```

## 相关文档

* [转储和合并](../../../../600.manage/1000.troubleshooting/400.storage/100.minor-freeze-and-compaction.md)
* [转储](../../../../700.reference/100.oceanbase-database-concepts/900.storage-architecture/300.dump-and-merge/200.dump.md)
* [自动触发合并](../../../../700.reference/200.system-management/500.manage-data-storage/200.merge-management/200.automatic-merge-triggering.md)
* [租户内存写满](../../../../600.manage/1100.emergency-response/300.common-emergency-response/200.problems-caused-by-capacity-changes/400.full-tenant-memory.md)