|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# OceanBase 数据库 TPC-DS 测试报告

本文介绍 TPC-H 测试的测试环境、测试方案以及详细的测试数据结果。

## 测试环境

以阿里云 ECS 作为部署环境为例。

* 硬件配置  

    | 服务类型 | ECS 类型 | 实例数 | 机器核心数 | 内存 |
    | ------- | -------- | ------ | -------- | ----- |
    | OceanBase 数据库  | ecs.r8i.8xlarge | 3 | 32C | 256G <br>每台机器日志盘 400G，数据盘 1200G，性能级别为 PL1|
    |  TPC-H            | ecs.r8i.8xlarge | 1 | 32c | 256G |

* 软件版本  

    | 服务类型 | 软件版本 |
    | --- | --- |
    | OceanBase 数据库 |  <ul><li>企业版：OceanBase 4.3.5.0</li> <li>社区版：OceanBase_CE 4.3.5.0 </li></ul>|
    | TPC-DS           | V3.0.0 |
    | OS              | CentOS Linux release 7.9.2009 (Core) |

* 租户规格

    ```sql
    obd cluster tenant create obperf -n tpcds_tenant --max-cpu=28 --memory-size=180G -–zone-list=zone1,zone2,zone3 -–primary-zone=RANDOM  --locality=F@zone1,F@zone2,F@zone3 --charset=utf8 -s 'ob_tcp_invited_nodes="%"' --optimize=htap
    ```

    <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>本示例中 <code>--optimize=htap</code> 为默认负载类型，在生产环境中请根据实际的集群类型来选择合适的负载类型。</p>
    </main>

## 测试方案

* 本次测试需要用到 4 台机器，TPC-DS 和 OBD 单独部署在一台机器上，作为客户端的压力机器。通过 OBD 部署 OceanBase 集群需要使用 3 台机器，OceanBase 集群规模为 1:1:1。

* 部署成功后先新建跑 TPC-DS 测试的租户及用户（`sys` 租户是管理集群的内置系统租户，请勿直接使用 `sys` 租户进行测试），设置租户的 `primary_zone` 为 RANDOM。

* 测试数据量：100G。

* 测试步骤详见 [OceanBase 数据库 TPC-DS 测试](100.run-the-tpc-ds-benchmark-on-oceanbase-database.md)。

## 测试结果

在本次 TPC-DS 测试中，涵盖 100G 和 1T 数据规模下的 `cold run` 和 `hot run` 场景，所有测试均在并发量为 96 的条件下进行。

| Query      | 100G cold run(s) |100G hot run(s)  |100G hot run(s)   | 1T cold run(s)  |  1T hot run(s)  |   1T hot run(s)    |
|------------|------------------|------------------|------------------|------------------|------------------|------------------|
| 并发量      |   parallel(96)  |   parallel(96)   |   parallel(96)   |   parallel(96)   |   parallel(96)   |   parallel(96)   |
| Q1    | 0.97       | 0.13       | 0.13       | 2.75   | 0.44   | 0.43   |
| Q2    | 1.76       | 1.32       | 1.31       | 11.01  | 9.44   | 10.08  |
| Q3    | 0.28       | 0.05       | 0.05       | 0.35   | 0.05   | 0.05   |
| Q4    | 11.21      | 3.65       | 3.65       | 101.99 | 55.34  | 55.69  |
| Q5    | 2.14       | 0.31       | 0.30       | 25.08  | 1.52   | 1.60   |
| Q6    | 0.41       | 0.15       | 0.17       | 1.31   | 0.68   | 0.75   |
| Q7    | 3.04       | 0.21       | 0.20       | 37.29  | 1.29   | 1.20   |
| Q8    | 0.23       | 0.17       | 0.18       | 1.15   | 0.66   | 0.67   |
| Q9    | 0.16       | 0.14       | 0.14       | 1.19   | 0.99   | 1.03   |
| Q10   | 0.60       | 0.20       | 0.22       | 7.49   | 1.00   | 0.95   |
| Q11   | 2.68       | 2.11       | 2.13       | 34.15  | 35.58  | 32.22  |
| Q12   | 0.13       | 0.11       | 0.11       | 0.44   | 0.35   | 0.34   |
| Q13   | 1.11       | 0.17       | 0.18       | 25.63  | 0.99   | 1.01   |
| Q14   | 4.43       | 4.00       | 3.98       | 34.09  | 30.07  | 29.44  |
| Q15   | 0.35       | 0.18       | 0.17       | 6.76   | 0.49   | 0.47   |
| Q16   | 1.22       | 0.14       | 0.15       | 18.82  | 0.43   | 0.43   |
| Q17   | 0.78       | 0.28       | 0.30       | 8.87   | 1.30   | 1.31   |
| Q18   | 0.60       | 0.19       | 0.18       | 8.64   | 0.75   | 0.74   |
| Q19   | 0.16       | 0.09       | 0.09       | 0.30   | 0.16   | 0.15   |
| Q20   | 0.12       | 0.11       | 0.12       | 0.30   | 0.23   | 0.24   |
| Q21   | 0.37       | 0.10       | 0.10       | 0.23   | 0.13   | 0.14   |
| Q22   | 0.85       | 0.82       | 0.82       | 1.51   | 1.43   | 1.31   |
| Q23   | 6.37       | 5.99       | 6.01       | 57.18  | 57.06  | 56.90  |
| Q24   | 0.80       | 0.48       | 0.47       | 3.22   | 2.96   | 2.98   |
| Q25   | 0.48       | 0.28       | 0.29       | 1.54   | 1.33   | 1.37   |
| Q26   | 0.26       | 0.13       | 0.12       | 2.86   | 0.46   | 0.51   |
| Q27   | 0.19       | 0.19       | 0.19       | 0.94   | 0.93   | 0.98   |
| Q28   | 0.51       | 0.25       | 0.26       | 5.13   | 1.43   | 1.41   |
| Q29   | 0.47       | 0.31       | 0.31       | 1.64   | 1.49   | 1.50   |
| Q30   | 0.18       | 0.12       | 0.12       | 0.54   | 0.32   | 0.33   |
| Q31   | 0.59       | 0.34       | 0.35       | 4.70   | 1.98   | 1.98   |
| Q32   | 0.05       | 0.03       | 0.03       | 0.05   | 0.03   | 0.03   |
| Q33   | 0.73       | 0.41       | 0.39       | 8.42   | 1.54   | 1.61   |
| Q34   | 0.19       | 0.15       | 0.15       | 0.82   | 0.79   | 0.79   |
| Q35   | 0.41       | 0.36       | 0.36       | 2.34   | 2.24   | 2.24   |
| Q36   | 0.19       | 0.19       | 0.20       | 1.01   | 1.02   | 0.97   |
| Q37   | 0.07       | 0.06       | 0.06       | 0.10   | 0.09   | 0.11   |
| Q38   | 0.93       | 0.91       | 0.92       | 7.77   | 7.81   | 7.79   |
| Q39   | 0.61       | 0.49       | 0.50       | 1.05   | 0.84   | 0.84   |
| Q40   | 0.14       | 0.09       | 0.09       | 0.42   | 0.24   | 0.25   |
| Q41   | 0.04       | 0.02       | 0.02       | 0.03   | 0.02   | 0.02   |
| Q42   | 0.07       | 0.04       | 0.04       | 0.14   | 0.05   | 0.05   |
| Q43   | 0.34       | 0.31       | 0.32       | 1.91   | 1.85   | 1.86   |
| Q44   | 0.10       | 0.07       | 0.09       | 0.15   | 0.13   | 0.12   |
| Q45   | 0.27       | 0.19       | 0.19       | 0.37   | 0.25   | 0.24   |
| Q46   | 0.34       | 0.23       | 0.24       | 1.18   | 1.03   | 1.02   |
| Q47   | 0.61       | 0.58       | 0.55       | 3.60   | 3.50   | 3.46   |
| Q48   | 0.34       | 0.19       | 0.19       | 1.19   | 1.06   | 1.03   |
| Q49   | 0.81       | 0.36       | 0.34       | 15.30  | 1.52   | 1.51   |
| Q50   | 0.26       | 0.23       | 0.22       | 1.37   | 1.30   | 1.40   |
| Q51   | 1.39       | 1.30       | 1.27       | 6.21   | 5.78   | 5.78   |
| Q52   | 0.05       | 0.04       | 0.04       | 0.06   | 0.05   | 0.06   |
| Q53   | 0.10       | 0.08       | 0.08       | 0.36   | 0.35   | 0.35   |
| Q54   | 0.20       | 0.18       | 0.19       | 0.84   | 0.84   | 0.83   |
| Q55   | 0.06       | 0.04       | 0.04       | 0.10   | 0.04   | 0.04   |
| Q56   | 0.36       | 0.29       | 0.28       | 0.75   | 0.75   | 0.70   |
| Q57   | 0.45       | 0.40       | 0.41       | 1.71   | 1.62   | 1.66   |
| Q58   | 0.28       | 0.25       | 0.26       | 0.79   | 0.73   | 0.75   |
| Q59   | 1.88       | 1.84       | 1.84       | 16.75  | 16.58  | 16.44  |
| Q60   | 0.35       | 0.34       | 0.35       | 1.15   | 1.14   | 1.13   |
| Q61   | 0.20       | 0.15       | 0.15       | 1.08   | 1.01   | 0.88   |
| Q62   | 0.33       | 0.18       | 0.18       | 2.17   | 1.24   | 1.21   |
| Q63   | 0.09       | 0.08       | 0.08       | 0.37   | 0.33   | 0.34   |
| Q64   | 1.41       | 0.58       | 0.58       | 4.84   | 3.18   | 3.18   |
| Q65   | 0.41       | 0.38       | 0.38       | 1.83   | 1.74   | 1.70   |
| Q66   | 1.16       | 0.26       | 0.27       | 13.89  | 1.12   | 1.10   |
| Q67   | 4.79       | 4.18       | 4.02       | 39.99  | 37.73  | 38.99  |
| Q68   | 0.60       | 0.20       | 0.21       | 35.63  | 0.95   | 0.93   |
| Q69   | 0.29       | 0.23       | 0.22       | 11.84  | 1.03   | 0.95   |
| Q70   | 0.47       | 0.47       | 0.45       | 4.83   | 3.78   | 3.81   |
| Q71   | 0.72       | 0.22       | 0.21       | 7.70   | 0.97   | 0.99   |
| Q72   | 0.80       | 0.41       | 0.39       | 15.24  | 1.96   | 1.91   |
| Q73   | 0.16       | 0.12       | 0.12       | 0.84   | 0.71   | 0.73   |
| Q74   | 1.98       | 1.73       | 1.72       | 19.95  | 17.90  | 17.85  |
| Q75   | 0.76       | 0.68       | 0.68       | 7.24   | 4.79   | 4.91   |
| Q76   | 0.11       | 0.09       | 0.09       | 0.10   | 0.09   | 0.09   |
| Q77   | 0.51       | 0.32       | 0.32       | 12.10  | 0.97   | 0.96   |
| Q78   | 1.67       | 1.52       | 1.50       | 24.46  | 14.01  | 13.73  |
| Q79   | 0.40       | 0.37       | 0.37       | 3.45   | 2.69   | 2.69   |
| Q80   | 0.74       | 0.33       | 0.34       | 8.14   | 1.07   | 1.11   |
| Q81   | 0.25       | 0.14       | 0.13       | 0.99   | 0.33   | 0.33   |
| Q82   | 0.07       | 0.06       | 0.06       | 0.17   | 0.17   | 0.17   |
| Q83   | 0.28       | 0.21       | 0.22       | 0.51   | 0.42   | 0.41   |
| Q84   | 0.22       | 0.09       | 0.09       | 0.83   | 0.13   | 0.13   |
| Q85   | 2.71       | 0.17       | 0.17       | 3.51   | 0.44   | 0.44   |
| Q86   | 0.15       | 0.15       | 0.15       | 0.74   | 0.75   | 0.76   |
| Q87   | 0.97       | 0.95       | 0.95       | 8.15   | 7.94   | 7.95   |
| Q88   | 0.23       | 0.20       | 0.18       | 5.44   | 1.06   | 1.03   |
| Q89   | 0.12       | 0.12       | 0.11       | 0.55   | 0.59   | 0.55   |
| Q90   | 0.28       | 0.07       | 0.07       | 1.10   | 0.25   | 0.24   |
| Q91   | 0.19       | 0.11       | 0.10       | 0.25   | 0.16   | 0.15   |
| Q92   | 0.07       | 0.06       | 0.06       | 0.28   | 0.17   | 0.17   |
| Q93   | 0.20       | 0.19       | 0.16       | 1.31   | 1.09   | 1.04   |
| Q94   | 0.39       | 0.11       | 0.13       | 6.14   | 0.41   | 0.40   |
| Q95   | 1.77       | 1.74       | 1.72       | 24.38  | 24.33  | 20.07  |
| Q96   | 0.11       | 0.11       | 0.11       | 0.78   | 0.73   | 0.73   |
| Q97   | 0.65       | 0.65       | 0.64       | 6.45   | 6.37   | 6.56   |
| Q98   | 0.21       | 0.21       | 0.21       | 0.65   | 0.60   | 0.58   |
| Q99   | 0.33       | 0.29       | 0.29       | 2.87   | 2.42   | 2.37   |
