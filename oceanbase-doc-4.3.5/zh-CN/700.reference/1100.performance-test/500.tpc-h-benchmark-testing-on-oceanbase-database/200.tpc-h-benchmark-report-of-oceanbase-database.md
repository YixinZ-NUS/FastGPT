|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# OceanBase 数据库 TPC-H 测试报告

本文介绍 TPC-H 测试的测试环境、测试方案以及详细的测试数据结果。

## 测试环境

以阿里云 ECS 作为部署环境为例。

* 硬件配置  

    | 服务类型 | ECS 类型 | 实例数 | 机器核心数 | 内存 |
    | --- | --- | --- | --- | --- |
    | OceanBase 数据库  | ecs.r8i.8xlarge | 3 | 32C | 256G <br>每台机器日志盘 400G，数据盘 1200G，性能级别为 PL1|

* 软件版本  

    | 服务类型 | 软件版本 |
    | --- | --- |
    | OceanBase 数据库 |  <ul><li>企业版：OceanBase 4.3.5.0</li> <li>社区版：OceanBase_CE 4.3.5.0 </li></ul>|
    | TPC-H           | V3.0.0 |
    | OS              | CentOS Linux release 7.9.2009 (Core) |

* 租户规格

    ```sql
    obd cluster tenant create obperf -n tpcc_tenant --max-cpu=28 --memory-size=180G -–zone-list=zone1,zone2,zone3 -–primary-zone=RANDOM  --locality=F@zone1,F@zone2,F@zone3 --charset=utf8 -s 'ob_tcp_invited_nodes="%"' --optimize=htap
    ```

    <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>本示例中 <code>--optimize=htap</code> 为默认负载类型，在生产环境中请根据实际的集群类型来选择合适的负载类型。</p>
    </main>

## 测试方案

* 使用 OBD 部署 OceanBase 数据库集群。TPC-H 客户端需要部署在一台机器上, 作为客户端的压力机器。您无需部署 ODP，测试时直连任意一台机器即可。

* 3 节点的 OceanBase 集群部署规模为 1：1：1。部署成功后先新建跑 TPC-H 测试的租户及用户（`sys` 租户是管理集群的内置系统租户，请勿直接使用 `sys` 租户进行测试），设置租户的 `primary_zone` 为 RANDOM。

* 测试数据量：100G。

* 测试步骤详见 [OceanBase 数据库 TPC-H 测试](../500.tpc-h-benchmark-testing-on-oceanbase-database/100.run-the-tpc-h-benchmark-on-oceanbase-database.md)。

## 测试结果

在本次 TPC-H 测试中，涵盖 100G 和 1T 数据规模下的 `hot run`、`first run` 及 `cold run` 场景，所有测试均在并发量为 96 的条件下进行。

| Query      |      100G                    |100G                    |100G                    |     1T                      |     1T                      |     1T     |
|------------|------------------|------------------|------------------|------------------|------------------|------------------|
|    -      | hot run(s)  | first run(s) | cold run(s)  | hot run(s)   | first run(s) | cold run(s)  |
| 并发量      |   parallel(96)  |   parallel(96)   |   parallel(96)   |   parallel(96)   |   parallel(96)   |   parallel(96)   |
| Q1         |      0.73       |       0.77       |      1.99        |      11.55       |      19.23       |      26.61       |
| Q2         |      0.09       |       0.14       |      0.38        |       0.58       |       1.29       |       4.72       |
| Q3         |      0.24       |       0.28       |      2.43        |       4.69       |       6.57       |      29.96       |
| Q4         |      0.19       |       0.20       |      2.92        |       1.85       |      12.70       |      32.57       |
| Q5         |      0.35       |       0.81       |      6.34        |       2.95       |      12.27       |      68.88       |
| Q6         |      0.02       |       0.04       |      0.62        |       0.09       |       0.12       |       3.39       |
| Q7         |      0.38       |       0.48       |      2.21        |       2.93       |       3.19       |      27.50       |
| Q8         |      0.31       |       0.54       |      8.23        |       2.01       |      13.95       |      91.46       |
| Q9         |      0.87       |       0.96       |      8.72        |      10.74       |      11.39       |      98.42       |
| Q10        |      0.25       |       0.26       |      3.31        |       2.69       |       5.66       |      38.16       |
| Q11        |      0.15       |       0.17       |      0.50        |       0.88       |       1.68       |       6.00       |
| Q12        |      0.10       |       0.11       |      0.57        |       0.90       |       1.07       |       7.59       |
| Q13        |      0.53       |       0.55       |      1.96        |       6.11       |      14.36       |      27.99       |
| Q14        |      0.09       |       0.11       |      0.28        |       0.94       |       0.95       |       1.19       |
| Q15        |      0.23       |       0.23       |      0.41        |       0.90       |       0.89       |       1.21       |
| Q16        |      0.25       |       0.27       |      0.38        |       1.57       |       1.66       |       2.10       |
| Q17        |      0.15       |       0.16       |      4.94        |       1.03       |       1.21       |      49.45       |
| Q18        |      0.76       |       0.81       |      2.02        |      10.71       |      10.85       |      27.92       |
| Q19        |      0.17       |       0.20       |      4.15        |       1.37       |       1.64       |      50.25       |
| Q20        |      0.15       |       0.18       |      1.03        |       0.78       |       2.69       |      13.32       |
| Q21        |      0.69       |       0.81       |      4.37        |       6.68       |      11.50       |      57.30       |
| Q22        |      0.17       |       0.17       |      0.67        |       1.46       |       1.46       |       6.91       |
| total cost |      6.87       |       8.25       |      58.43       |       73.41      |       136.33     |      672.90      |

