|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# OceanBase 数据库 Sysbench 测试报告

本文介绍 Sysbench 测试的测试环境、测试方案以及详细的测试数据结果。

## 测试环境

以阿里云 ECS 作为部署环境为例。

* 硬件配置  

    | 服务类型 | ECS 类型 | 实例数 | 机器核心数 | 内存 |
    | ------- | -------- | ----- | --------- | ---- |
    | OceanBase 数据库  | ecs.r8i.8xlarge  | 3 | 32C | 256G <br>每台机器系统盘 100G，再挂载两块 600G 云盘作为 clog 盘和 Data 盘，性能级别为 PL1|
    | Sysbench          | ecs.c7.4xlarge   | 1 | 16c | 32g |
    | ODP               | ecs.c7.16xlarge  | 1 | 32C | 128G |

* 软件版本  

    | 服务类型 | 软件版本 |
    | ------- | ------- |
    | OceanBase 数据库 | <ul><li>企业版：OceanBase 4.3.5.0</li><li>社区版：OceanBase_CE 4.3.5.0 </li></ul> |
    | ODP             | OceanBase 4.3.1 |
    | Sysbench        | 1.0.20 |
    | OS              | CentOS Linux release 7.9.2009 (Core) |

* 租户规格

    ```sql
    obd cluster tenant create obperf -n tpcc_tenant --max-cpu=28 --memory-size=180G -–zone-list=zone1,zone2,zone3 -–primary-zone=RANDOM  --locality=F@zone1,F@zone2,F@zone3 --charset=utf8 -s 'ob_tcp_invited_nodes="%"' --optimize=htap
    ```

    <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>本示例中 <code>--optimize=htap</code> 为默认负载类型，在生产环境中请根据实际的集群类型来选择合适的负载类型。</p>
    </main>

## 测试方案

* 本次测试需使用到 5 台机器，Sysbench 和 OBD 部署在一台机器上，ODP 单独部署在一台机器上。通过 OBD 部署 OceanBase 集群需要使用 3 台机器，OceanBase 集群规模为 1:1:1。部署成功后先新建跑 Sysbench 测试的租户及用户（`sys` 租户是管理集群的内置系统租户，请勿直接使用 `sys` 租户进行测试），设置租户的 `primary_zone` 为 RANDOM，RANDOM 表示新建表分区的 leader 随机到这 3 台机器。

* 通过 Sysbench 导入 30 张表，每张表有 100 万行数据。

* 启动 Sysbench 客户端，进行 `point_select`、`read_write`、`read_only` 和 `write_only` 测试。

* 每轮测试 `--time` 设置为 60s，线程数取值可以为 `32/64/128/256/512/1024` 等。

测试步骤详见 [OceanBase 数据库 Sysbench 测试](100.use-sysbench-to-test-the-performance-of-oceanbase-database.md)。

### 测试规格

```shell
--mysql-db=test 
--table_size=1000000 
--tables=30 
--threads=32/64/128/256/512/1024 
--report-interval=10
--time=30
--db-ps-mode=disable
--rand-type=uniform
```

## 测试结果

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>本测试中创建集群指定的集群负载类型与创建租户时指定的租户参数模版类型一致。</p>
</main>

在本次 Sysbench 测试中，涵盖 `32/64/128/256/512/1024` 数据规模下的 express_oltp、complex_oltp、olap 及 htap 场景。

### Point Select 性能

| Threads | express_oltp 参数模版 | complex_oltp 参数模版 | olap 参数模版 | htap 参数模版 |
|---------|----------------------|----------------------|---------------|--------------|
| 32   | 163457.60/0.22 | 162747.70/0.22 | 161428.80/0.23 | 162948.95/0.20 |
| 64   | 296206.41/0.25 | 291823.36/0.26 | 291583.48/0.26 | 293622.63/0.25 |
| 128  | 505203.80/0.30 | 493859.95/0.31 | 492135.78/0.31 | 498132.19/0.31 |
| 256  | 798005.94/0.45 | 794547.97/0.47 | 803165.10/0.49 | 797304.31/0.45 |
| 512  | 1039286.05/0.90 | 1023822.11/1.14 | 1022666.33/1.12 | 1032713.76/0.90 |
| 1024 | 1013992.61/2.39 | 1011295.14/2.39 | 997362.00/2.57 | 1004848.34/2.48 |

### Read Only 性能

| Threads | express_oltp 参数模版 | complex_oltp 参数模版 | olap 参数模版 | htap 参数模版 |
|---------|----------------------|----------------------|---------------|--------------|
| 32   | 134791.19/4.10 | 136145.15/3.97 | 137486.55/3.96 | 137327.53/3.95 |
| 64   | 244754.37/4.49 | 244093.17/4.57 | 244641.01/4.57 | 244586.46/4.57 |
| 128  | 416929.45/5.37 | 420143.73/5.47 | 419772.35/5.28 | 420445.05/5.28 |
| 256  | 613453.13/7.56 | 611436.43/8.28 | 603989.96/8.28 | 610998.14/7.43 |
| 512  | 725364.76/16.12 | 738362.91/17.65 | 736059.64/15.83 | 720899.31/16.12 |
| 1024 | 715777.22/41.10 | 707831.35/42.61 | 697077.19/44.17 | 706809.11/42.61 |

### Write Only 性能

| Threads | express_oltp 参数模版 | complex_oltp 参数模版 | olap 参数模版 | htap 参数模版 |
|---------|----------------------|----------------------|---------------|--------------|
| 32   | 50914.06/5.00   | 52894.62/4.91   | 50589.47/5.67   | 52088.46/4.74 |
| 64   | 90119.99/5.47   | 93447.67/5.37   | 90202.65/5.37   | 90264.56/5.57 |
| 128  | 164488.33/5.77  | 166099.69/5.57  | 159493.96/5.99  | 159005.24/6.09 |
| 256  | 242240.38/8.13  | 241749.01/8.43  | 232320.85/8.43  | 230522.31/8.74 |
| 512  | 304060.67/13.70 | 306416.65/13.70 | 299155.86/13.70 | 289147.63/13.95 |
| 1024 | 345068.37/23.52 | 348929.05/26.20 | 306096.92/29.72 | 327905.15/27.17 |

### Read Write 性能

| Threads | express_oltp 参数模版 | complex_oltp 参数模版 | olap 参数模版 | htap 参数模版 |
|---------|----------------------|-----------------------|--------------|--------------|
| 32   | 90881.38/7.84   | 88141.94/8.28   | 88216.59/8.58   | 89948.44/7.98 |
| 64   | 159748.46/8.90  | 160695.31/9.06  | 157714.41/10.09 | 157230.31/9.39 |
| 128  | 273142.95/10.46 | 275431.02/10.27 | 272648.28/10.27 | 269700.79/11.24 |
| 256  | 391348.85/15.27 | 402154.83/15.00 | 382679.53/16.71 | 383447.47/15.27 |
| 512  | 465031.62/28.67 | 462574.18/33.72 | 466465.96/26.20 | 461249.29/27.66 |
| 1024 | 525924.96/52.89 | 535977.26/48.34 | 510540.58/58.92 | 522066.61/51.02 |
