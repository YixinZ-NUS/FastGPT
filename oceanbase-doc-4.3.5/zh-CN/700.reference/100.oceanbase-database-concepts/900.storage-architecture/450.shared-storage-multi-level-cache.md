|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 共享存储多级缓存

为了在多云环境为用户提供更有性价比的数据库服务，OceanBase 数据库基于通用的对象存储实现了共享存储（Shared-Storage，SS）模式的集群架构。在无共享（Shared-Nothing，SN）模式中，系统会将热点数据缓存在内存中，用于提升性能。而在 SS 模式中，除了内存缓存，还引入了本地持久化缓存，缓存次热点数据。

![共享存储多级缓存](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.3.4/ss-multi-level-catch-new.png)

上图中：

* 内存缓存：主要缓存最热点数据，包括微块、索引数据等。

* 持久化缓存：存储介质可以是本地物理盘或云盘，用于缓存次热点数据。其主要功能包括：

  1. 缓存从对象存储读取的数据。
  
  2. 预读数据。例如全表扫描时，提前将待读取的数据缓存在本地。
  
  3. 预热。在合并切版本前，将热点数据加载至本地缓存。在短时间宕机重启后，持久化缓存依然有效，减少容灾场景下的性能抖动。
  
     同时，为了保证 RTO 时间，本地持久化缓存的访问序列会实时地同步给 Follower 副本，Leader 副本和 Follower 副本有近乎相同的缓存数据。在复制迁移时，也会将本地缓存数据带给目的端，保证复制迁移后的性能。

  4. 写缓存。利用本地盘的低延迟，充当写缓存，记录一些重要的本地状态，例如 Meta 文件、最新的 clog、mini 转储等。

* 对象存储：存储系统所有的数据，包含集群共享的 clog 和所有基线数据，以及当本地物理盘或云盘空间不足时写入的节点私有数据，如：增量数据、临时文件等，对象存储容量几乎无限，但访问延迟大。

通过上述多级缓存，保证了热点数据的访问性能，并能够基于对象存储提供同时满足 TP & AP 业务的产品形态。
