|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# 插件机制

随着数据库技术的演进和业务场景的多样化，灵活性与可扩展性已成为现代分布式数据库系统的核心能力之一。为了满足用户对高效、灵活的功能扩展需求，OceanBase 数据库引入了插件机制，为用户提供了一种模块化、低侵入的功能扩展方式。通过插件机制，用户能够在不修改核心代码的前提下，动态加载、卸载和更新功能模块，从而实现对数据库系统的高效定制和扩展。

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p><ul><li>对于 OceanBase 数据库 V4.3.5 版本，从 V4.3.5 BP1 版本开始支持插件机制。</li><li>OceanBase 数据库插件机制目前为实验特性，暂不建议在生产环境使用。其功能范围和稳定性正在逐步完善。现阶段，插件机制主要支持以下场景：<ul><li>分词器插件：用于扩展数据库的全文搜索能力，支持用户自定义分词逻辑。</li><li>功能验证：用户可以通过实验特性提前体验插件机制，并为后续的功能扩展提供宝贵的反馈意见。</li></ul></li></ul></p>
</main>

## 插件机制优势

### 简化扩展

通过 OceanBase 数据库插件机制，可以轻松地为 OceanBase 数据库添加新的功能模块，无需修改核心代码。这种模块化设计使得功能扩展变得更加方便和直观。

### 高效更新

插件机制支持快速迭代更新，用户可以及时获取和应用最新的功能改进和修复。这种快速响应的能力，确保了系统能够始终处于最佳状态，满足不断变化的业务需求。

### 定制化功能

插件机制允许用户根据自身业务需求定制特定功能，提高系统的灵活性和适应性。用户可以选择性地加载或卸载插件，确保系统始终运行需要的功能模块。

### 社区和生态支持

通过插件机制，OceanBase 数据库用户可以共享和发布自定义插件，促进社区的交流与合作，丰富插件生态系统。这样不仅提升了 OceanBase 数据库的功能多样性，还推动了整个社区的发展。

## 插件机制原理

OceanBase 数据库插件是以动态链接库形式扩展数据库功能的组件，无需修改数据库 OceanBase 数据库即可新增：

* 定制化功能（如特殊分词算法）。
* 兼容第三方生态（如特定数据格式支持）。
* 商业化扩展模块。

### 插件系统架构

OceanBase 数据库的插件系统设计的目标是可以满足开发者快速扩展。

![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.0/700.reference/100.oceanbase-database-concepts/1200.observer-node-architecture/%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B61.png)

相关模块如下：

1. 插件库自身：外表、分词器等。
2. Plugin Interfaces：插件接口版本号。

    <main id="notice" type='explain'>
      <h4>说明</h4>
      <p>各个插件接口（Plugin Interfaces）都有自己的版本号。</p>
    </main>

3. Plugin API：OceanBase 数据库为插件库提供的 OceanBase 数据库能力接口。

OceanBase 数据库定义好每个插件需要实现的接口，每种类型的插件都有自己特定的接口（Plugin Interfaces），比如外表、分词器。插件库实现这些接口，OceanBase 数据库在加载插件库时就可以调用插件实现。插件在实现功能时，如果需要利用 OceanBase 数据库的能力，比如访问 OceanBase 数据库数据、打印日志等，可以调用插件 API（Plugin API）。插件 API 的实现在 OceanBase 数据库中，即 Plugin API Implementation。

这样插件开发时，不需要深入了解 OceanBase 数据库源码，只需要依赖 OceanBase 数据库的插件开发库即可。另外，每种类型的插件，都会有一个样例代码可以参考，比如分词器插件的样例代码。

在 OceanBase 数据库内部，为了兼容 OceanBase 数据库功能与插件，插件系统将插件接口做转换，兼容 OceanBase 数据库原有的功能定义，即 Plugin Iterface Adaptor 模块。

当用户安装一个插件，插件对象在 OceanBase 数据库内部，由 Plugin Manager 进行维护。OceanBase 数据库使用插件时，也通过 Plugin Manager 模块进行查找。

### 兼容性

由于插件是独立于 OceanBase 数据库的，因此需要考虑不同版本的插件与不同版本 OceanBase 数据库协作的问题，即 OceanBase 数据库与插件的兼容性。OceanBase 数据库会尽量兼容旧版本的插件，确保插件运行不会由于接口问题导致系统运行时严重异常（比如宕机）。

OceanBase 数据库提供了两种类型的版本号来保证兼容性，一种是插件接口（Plugin Interfaces）版本号，一种是插件 API（Plugin API）的版本号。

OceanBase 数据库为每个插件接口都设计了一个版本号。插件在编译时，需要指定当前实现哪个版本的接口，后续插件库安装到数据库中时，OceanBase 数据库会对版本号做校验。另外，为了减少插件的编译，插件接口只允许增加，不允许减少。并且 OceanBase 数据库在调用插件接口时，会对旧版本代码做兼容处理，这个动作通常也是由 Plugin Adaptor 来做的。以分词器插件接口为例，第一版本的版本号是 0.1.0，在增加了 `check_if_charset_supported` 接口后，新增版本号 0.2.0。在编写插件库时，也可以通过版本号来判断是否需要实现新接口 `check_if_charset_supported`。

OceanBase 数据库设计的另一种类型的版本号是插件 API 版本号。此版本号是为了防止插件库需要访问更高版本 API，而运行的 OceanBase 数据库版本比较旧，无法提供此 API，可以在安装时抛出错误。与插件接口版本号类似，插件 API 版本号也会在每次新增内容时，就升高版本号。

值得留意的是，插件接口版本号是有多个的，每种类型的接口都有自己的版本号，比如分词器插件接口、外表插件接口。而插件 API 接口只有一个，即使新增加的 API 只是在分词器插件中使用，全局插件 API 版本号也需要推高。

## 相关文档

[OceanBase 数据库插件概述](../../1600.oceanbase-database-plugin/100.overview-of-oceanbase-database-plugin.md)