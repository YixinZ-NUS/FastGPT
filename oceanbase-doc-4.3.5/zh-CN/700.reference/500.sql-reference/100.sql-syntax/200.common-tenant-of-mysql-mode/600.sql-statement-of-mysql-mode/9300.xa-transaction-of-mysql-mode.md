| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | MySQL Mode      |
|machine-translation||

# XA TRANSACTION

## 描述

该语句用于 XA 事务（分布式事务）管理。

## 语法

```sql
xa_transaction_stmt:
    xa_start_stmt
    | xa_end_stmt
    | xa_prepare_stmt
    | xa_commit_stmt
    | xa_rollback_stmt
    | xa_recover_stmt

xa_start_stmt:
    XA {START | BEGIN} xid;

xa_end_stmt:
    XA END xid [SUSPEND [FOR MIGRATE]];

xa_prepare_stmt:
    XA PREPARE xid;

xa_commit_stmt:
    XA COMMIT xid [ONE PHASE];

xa_rollback_stmt:
    XA ROLLBACK xid;

xa_recover_stmt:
    XA RECOVER [CONVERT XID];
```

## 参数解释

### xa_start_stmt

`XA {START | BEGIN} xid`：该语句用于开始一个新的 XA 事务或者加入/恢复一个已经存在的 XA 事务。

* `START | BEGIN`：表示开启 XA 事务语句。`START` 和 `BEGIN` 含义相同。
* `xid`：表示 XA 事务的全局唯一标识符。

### xa_end_stmt

`XA END xid [SUSPEND [FOR MIGRATE]]`：该语句用于结束一个 XA 事务，可以选择挂起 XA 事务以便迁移。

* `xid`：表示要结束的 XA 事务的全局唯一标识符。

  * `SUSPEND [FOR MIGRATE]`：可选项，仅支持相关语法，功能不生效。

### xa_prepare_stmt

`XA PREPARE xid`：该语句用于通知资源管理器准备提交 XA 事务。

* `xid`：表示要准备提交的 XA 事务的全局唯一标识符。

### xa_commit_stmt

`XA COMMIT xid [ONE PHASE]`：该语句用于提交已经准备好的 XA 事务。

* `xid`：表示要提交的 XA 事务的全局唯一标识符。

  * `ONE PHASE`：可选项，表示使用单阶段提交。

### xa_rollback_stmt

`XA ROLLBACK xid`：该语句用于回滚一个 XA 事务。

* `xid`：表示要回滚的 XA 事务的全局唯一标识符。

### xa_recover_stmt

`XA RECOVER [CONVERT XID]`：该语句用于获取已经准备好的 XA 事务信息。

* `CONVERT XID`：可选项，表示转换 xid 格式。

## 示例

1. 创建表 `tbl1`。

   ```sql
   CREATE TABLE tbl1 (col1 INT, col2 INT);
   ```

2. 开启事务。

   ```sql
   XA START 'xa_tbl1';
   ```

3. 向表 `tbl1` 中插入一条数据。

   ```sql
   INSERT INTO tbl1 VALUES (1, 1);
   ```

4. 结束 XA 事务并挂起（暂停）以便迁移。

   ```sql
   XA END 'xa_tbl1';
   ```

5. 准备 XA 事务。

   ```sql
   XA PREPARE 'xa_tbl1';
   ```

6. 提交 XA 事务。

   ```sql
   XA COMMIT 'xa_tbl1';
   ```

7. 查看表 `tbl1` 数据。

   ```sql
   SELECT * FROM tbl1;
   ```

   返回结果如下：

   ```shell
   +------+------+
   | col1 | col2 |
   +------+------+
   |    1 |    1 |
   +------+------+
   1 row in set
   ```

## 相关文档

* [XA 事务](../../../../100.oceanbase-database-concepts/800.transaction-management/100.transaction/900.xa-transactions.md)
* [长事务](../../../../../600.manage/1000.troubleshooting/600.transaction/300.long-transaction.md)
* [悬挂事务](../../../../../600.manage/1000.troubleshooting/600.transaction/400.hung-transaction.md)