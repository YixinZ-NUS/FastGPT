| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   |                 |
|machine-translation||

# MODULE DATA

## 描述

`MODULE DATA` 语句有以下两种功能：

* `ALTER SYSTEM LOAD MODULE DATA ...`：该语句用于向某个特定租户导入指定功能。
* `ALTER SYSTEM CHECK MODULE DATA ...`：该语句用于检查某个特定租户的指定功能是否已导入。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>对于 V4.3.5 版本，从 V4.3.5 BP4 版本开始支持 <code>MODULE DATA</code> 语句。</p>
</main>

## 使用限制及注意事项

* 该语句仅支持在 `sys`（系统）租户中执行。
* 当前版本仅支持向 MySQL 模式租户导入 `REDIS` 模块功能。
* 当前版本仅支持检查（`CHECK MODULE DATA`）导入的 `REDIS` 模块功能。

## 权限要求

执行该语句的用户需要拥有 `ALTER SYSTEM` 权限。有关 OceanBase 数据库权限的详细介绍，参见 [MySQL 模式下的权限分类](../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/200.permission-of-mysql-mode/100.permission-classification-of-mysql.md)。

## 语法

```sql
ALTER SYSTEM {LOAD | CHECK} MODULE DATA
    MODULE = module_value
    TENANT = tenant_name
    [INFILE = file_path];

module_value:
    REDIS
    | GIS
    | TIMEZONE
```

## 参数说明

|      参数     |            描述            |
|---------------|---------------------------|
| LOAD \| CHECK | 用于指定是导入还是检查，具体如下：<ul><li>`LOAD`：用于向某个特定租户导入指定功能。</li><li>`CHECK`：用于检查某个特定租户的指定功能是否已导入。</li><li>|
| tenant_name   | 指定待操作的租户名称。|
| module_value  | 用于指定待操作的功能，详细介绍可参见下文 [module_value](#module_value)。|
| file_path     | 用于指定待导入的 SQL 文件路径。 <main id="notice" type='notice'><h4>注意</h4><p><ul><li>因为 <code>TIMEZONE</code> 和 <code>GIS</code> 可能出现多版本数据，所以需要指定对应版本的 SQL 文件。因为目前 <code>TIMEZONE</code> 和 <code>GIS</code> 都只有一个版本，所以支持缺省的 <code>INFILE</code> 参数。</li><li>当前版本 <code>REDIS</code> 模块功能不支持 <code>INFILE</code> 参数，输入 <code>INFILE</code> 参数路径将会报错。</li></ul></p></main>|

### module_value

* `REDIS`：表示操作 `REDIS` 模块功能。
* `GIS`：表示操作 `GIS` 模块功能。
* `TIMEZONE`：表示操作 `TIMEZONE` 模块功能。

## 示例

### LOAD MODULE DATA 示例

1. 向租户 `mysql001` 导入 `REDIS` 模块功能。目前 `REDIS` 模块功能不支持使用 `INFILE` 路径，所以会报错。

    ```sql
    ALTER SYSTEM LOAD MODULE DATA
        MODULE = REDIS
        TENANT = mysql001
        INFILE = '/home/admin/test.sql';
    ```

    返回结果如下：

    ```shell
    ERROR 4025 (HY000): loading redis module does not need to specify infile
    ```

2. 向租户 `mysql001` 导入 `REDIS` 模块功能。

    ```sql
    ALTER SYSTEM LOAD MODULE DATA
        MODULE = REDIS
        TENANT = mysql001;
    ```

    返回结果如下：

    ```shell
    Query OK, 0 rows affected
    ```

3. 向租户 `mysql001` 导入 `GIS` 模块功能, 其中 `INFILE` 参数是可以省略的，缺省值为 `etc/`, 相应文件在部署目录的 `etc` 目录下。

    ```sql
    ALTER SYSTEM LOAD MODULE DATA
        MODULE = GIS
        TENANT = mysql001
        INFILE = 'etc/';
    ```

    返回结果如下：

    ```shell
    Query OK, 0 rows affected
    ```

4. 向租户 `mysql001` 导入 `TIMEZONE` 模块功能, 其中 `INFILE` 参数是可以省略的，缺省值为 `etc/`, 相应文件在部署目录的 `etc` 目录下。

    ```sql
    ALTER SYSTEM LOAD MODULE DATA
        MODULE = TIMEZONE
        TENANT = mysql001
        INFILE = 'etc/';
    ```

    返回结果如下：

    ```shell
    Query OK, 0 rows affected
    ```

### CHECK MODULE DATA 示例

<main id="notice" type='notice'>
  <h4>注意</h4>
  <p>当前版本仅支持检查（<code>CHECK MODULE DATA</code>）导入的 <code>REDIS</code> 模块功能。</p>
</main>

* 未向租户导入功能时，执行 `CHECK MODULE DATA`  语句将会报错。检查租户 `mysql002` 导入 `REDIS` 模块功能情况。

    ```sql
    ALTER SYSTEM CHECK MODULE DATA
        MODULE = REDIS
        TENANT = mysql002;
    ```

    返回结果如下：

    ```shell
    ERROR 4025 (HY000): redis info is not complete，please retry loading
    ```

* 先向租户导入功能后，再检查导入功能情况。

    1. 向租户 `mysql002` 导入 `REDIS` 模块功能。

        ```sql
        ALTER SYSTEM LOAD MODULE DATA
            MODULE = REDIS
            TENANT = 'mysql002';
        ```

        返回结果如下：

        ```shell
        Query OK, 0 rows affected
        ```

    2. 检查租户 `mysql002` 导入 `REDIS` 模块功能情况。

        ```sql
        ALTER SYSTEM CHECK MODULE DATA
            MODULE = REDIS
            TENANT = mysql002;
        ```

        返回结果如下：

        ```shell
        Query OK, 0 rows affected
        ```
