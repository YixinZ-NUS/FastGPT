| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |
|machine-translation||

# SAVEPOINT

## 描述

该语句用来在提交事务之前创建保存点，可以实现将事务部分回滚。

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <ul>
    <li>保存点名称在同一个事务范围内是唯一的，后一个保存点会覆盖前一个同名的保存点。</li>
    <li>创建保存点后可以继续处理、提交工作、回滚整个事务或者将事务回滚到指定保存点。有关回事务滚事务的详细信息，请参见 <a href="../300.dcl-of-oracle-mode/3000.rollback-of-oracle-mode.md">ROLLBACK</a>。</li>
    </ul>
  </main>

## 语法

```sql
SAVEPOINT savepoint_name
```

## 参数说明

|       参数       |    描述     |
|----------------|-----------|
| savepoint_name | 指定保存点的名称。 |

## 示例

创建示例表 `employee`。

```sql
obclient> CREATE TABLE employee (id INT, name VARCHAR(10), salary INT);

obclient> INSERT INTO employee VALUES (1, 'Alice', 1000), (2, 'Bob', 2000), (3, 'Alice', 3000);
```

```sql
obclient> SELECT * FROM employee;
```

```sql
+------+-------+--------+
| ID   | NAME  | SALARY |
+------+-------+--------+
|    1 | Alice |   1000 |
|    2 | Bob   |   2000 |
|    3 | Alice |   3000 |
+------+-------+--------+
3 rows in set
```

1. 更新表 `employee`，将 `id = 3` 的 `name` 改为 'Carol'，并创建 `point_after_update`。

   ```sql
   obclient> UPDATE employee SET name = 'Carol' WHERE id = 3;
   obclient> SAVEPOINT point_after_update;
   ```

2. 向表 `employee` 插入一行数据，并查询表。

   ```sql
   obclient> INSERT INTO employee VALUES (4, 'David', 4000);
   obclient> SELECT * FROM employee;
   ```

   ```sql
   Query OK, 1 row affected

   +------+-------+--------+
   | ID   | NAME  | SALARY |
   +------+-------+--------+
   |    1 | Alice |   1000 |
   |    2 | Bob   |   2000 |
   |    3 | Carol |   3000 |
   |    4 | David |   4000 |
   +------+-------+--------+
   4 rows in set
   ```

3. 回滚到 `point_after_update`，并查询表。

   ```sql
   obclient> ROLLBACK TO SAVEPOINT point_after_update;
   obclient> SELECT * FROM employee;
   ```

   ```sql
   Query OK, 0 rows affected

   +------+-------+--------+
   | ID   | NAME  | SALARY |
   +------+-------+--------+
   |    1 | Alice |   1000 |
   |    2 | Bob   |   2000 |
   |    3 | Carol |   3000 |
   +------+-------+--------+
   3 rows in set
   ```

   ```sql
   obclient> COMMIT;
   ```