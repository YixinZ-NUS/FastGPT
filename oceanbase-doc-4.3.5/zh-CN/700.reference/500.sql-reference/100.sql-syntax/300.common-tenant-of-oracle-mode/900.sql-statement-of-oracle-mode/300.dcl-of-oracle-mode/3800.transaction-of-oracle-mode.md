| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |
|machine-translation||

# TRANSACTION

## 描述

该语句用于开启事务。

数据库事务（Database Transaction）是指作为单个逻辑工作单元执行的一系列操作。事务处理可以用来维护数据库的完整性，保证成批的 SQL 操作全部执行或全部不执行。

显示事务是用户自定义或用户指定的事务。通过 `BEGIN` 和 `BEGIN WORK`（`BEGIN` 和 `BEGIN WORK` 被作为 `START TRANSACTION`的别名）语句显示开始，以 `COMMIT` 或 `ROLLBACK` 语句显示结束。

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <ul>
    <li>在事务 <code>COMMIT</code> 前，可以执行一条 <code>SELECT</code> 语句查看本事务中的操作是否已经生效。</li>
    <li>在事务 <code>COMMIT</code> 前，当前事务会话之外的会话都是看不到本事务中的操作的。即在事务 <code>COMMIT</code> 前，只有本事务 Session 的访问能读到最新的结果，本事务 Session 之外的访问是看不到最新结果的。</li>
    <li>如果您想回滚该事务，直接用 <code>ROOLBACK</code> 代替 <code>COMMIT</code>。</li>
    </ul>
  </main>

## 语法

```sql
{
  | START TRANSACTION [READ ONLY | READ WRITE]
  | BEGIN [WORK]
  | COMMIT [WORK]
  | ROLLBACK [WORK]
  | SET TRANSACTION {READ ONLY | READ WRITE}
}
```

## 参数解释

|                    **参数**                     |                                                                                       **描述**                                                                                        |
|-----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| START TRANSACTION [READ ONLY \| READ WRITE ] | 开启事务语句。一旦开启事务，则随后的 SQL 数据操作语句（即 `INSERT`、`UPDATE`、`DELETE` 等）直到显式提交时才会生效。<ul><li>`READ ONLY`：以只读方式开启事务，事务内不允许执行修改操作。</li><li> `READ WRITE`：以读写方式开启事务（默认模式）</li> |
| BEGIN         | `BEGIN` 和 `BEGIN WORK` 被作为 `START TRANSACTION` 的别名       |
| COMMIT                                  | 提交当前事务         |
| ROLLBACK                                | 回滚当前事务          |
| SET TRANSACTION {READ ONLY \| READ WRITE} | 将当前事务设置成 `READ ONLY` 或者 `READ WRITE` 模式    |

## 示例

本节提供使用事务相关语句的示例。

1. 创建示例表 `employees` 并插入数据：

   ```sql
   obclient> CREATE TABLE employees (
     emp_id INT,
     emp_name VARCHAR(10),
     salary INT
   );

   obclient> INSERT INTO employees VALUES
     (1, 'Alice', 5000),
     (2, 'Bob', 6000),
     (3, 'Charlie', 4500);
   ```

   查看初始数据：

   ```sql
   obclient> SELECT * FROM employees;
   ```

   结果：

   ```sql
   +--------+---------+--------+
   | EMP_ID | EMP_NAME| SALARY |
   +--------+---------+--------+
   |      1 | Alice   |   5000 |
   |      2 | Bob     |   6000 |
   |      3 | Charlie |   4500 |
   +--------+---------+--------+
   ```

2. 提交事务示例：开始一个事务，更新员工信息并添加新员工

   ```sql
   obclient> START TRANSACTION;

   obclient> UPDATE employees SET emp_name = 'Charles' WHERE emp_id = 3;
   obclient> INSERT INTO employees VALUES (4, 'David', 5500);

   obclient> COMMIT;
   ```

   查看更新后的数据：

   ```sql
   obclient> SELECT * FROM employees;
   ```

   结果：

   ```sql
   +--------+---------+--------+
   | EMP_ID | EMP_NAME| SALARY |
   +--------+---------+--------+
   |      1 | Alice   |   5000 |
   |      2 | Bob     |   6000 |
   |      3 | Charles |   4500 |
   |      4 | David   |   5500 |
   +--------+---------+--------+
   ```

3. 回滚事务示例：开始一个事务，进行修改后回滚

   ```sql
   obclient> BEGIN;

   obclient> UPDATE employees SET emp_name = 'Eve' WHERE emp_id = 3;
   obclient> INSERT INTO employees VALUES (5, 'Frank', 7000);

   -- 查看事务中的更改
   obclient> SELECT * FROM employees;
   ```

   结果：

   ```sql
   +--------+---------+--------+
   | EMP_ID | EMP_NAME| SALARY |
   +--------+---------+--------+
   |      1 | Alice   |   5000 |
   |      2 | Bob     |   6000 |
   |      3 | Eve     |   4500 |
   |      4 | David   |   5500 |
   |      5 | Frank   |   7000 |
   +--------+---------+--------+
   ```

   执行回滚：

   ```sql
   obclient> ROLLBACK;
   ```

   查看回滚后的数据：

   ```sql
   obclient> SELECT * FROM employees;
   ```

   结果：

   ```sql
   +--------+---------+--------+
   | EMP_ID | EMP_NAME| SALARY |
   +--------+---------+--------+
   |      1 | Alice   |   5000 |
   |      2 | Bob     |   6000 |
   |      3 | Charles |   4500 |
   |      4 | David   |   5500 |
   +--------+---------+--------+
   ```