| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |
|machine-translation||

# CREATE CONCURRENT_LIMITING_RULE

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>该语句从 OceanBase 数据库 V4.3.5 BP3 版本开始引入。</p>
</main>

## 描述

该语句用于创建限流规则，指定限流范围来限制特定 SQL 的并发度。

## 注意事项

OceanBase 数据库 Oracle 模式下执行 `CREATE CONCURRENT_LIMITING_RULE` 语句需要专用权限 `create any concurrent_limiting_rule`。

## 语法

```sql
CREATE CONCURRENT_LIMITING_RULE ccl_rule_name
ON `database`.`table`
TO '<usename>'@'ip'
FOR { ALL | UPDATE | SELECT | INSERT | DELETE }
filter_options:
    [ FILTER BY KEYWORD('KEYWORD1', 'KEYWORD2',…) ]
 with_options:
    WITH MAX_CONCURRENCY = value1 [per sql]
```

## 参数解释

|  参数             |       描述        |
|----------------------------|----------|
|`ccl_rule_name`|必选，表示限流规则的名称。|
|`database`.`table`|必选，表示数据库和数据表的名称，支持使用星号（*）表示任意匹配。<main id="notice" type='explain'><h4>说明</h4><p>为避免名称与 SQL 关键字冲突，建议在规则名称前后各加一个反引号（`）</p></main>|
|`<usename>@<host>`|必选，表示账号名称。其中 Host 部分支持用百分号（%）来表示任意匹配。|
|`ALL`\|`UPDATE \| SELECT \| INSERT\| DELETE`|必选，表示 SQL 语句类型。当前支持`ALL`、`UPDATE`、`SELECT`、`INSERT` 和 `DELETE` 类型。<main id="notice" type='explain'><h4>说明</h4><p>每条限流规则仅支持传入一种类型的 SQL 语句。</p></main>|
|`[ filter_options ]`|可选，表示限流关键字。<main id="notice" type='explain'><h4>说明</h4><p><ul><li>关键字之间将用通配符<code>%</code>连接，例如给定 3 个关键词<code>"asdasd", "c2 = 123", "xxyyzz"</code>，其会被拼成 <code>"%asdasd%c2 = 123%xxyyzz%"</code>，后续将按照这个字符串进行 SQL 文本的通配匹配。</li><li>当关键字中有<code>'_'</code>时会被转义，如<code>"table_t1"</code>会被记录成<code>"%table\_t1%"</code>。</li><li> 限流关键字无个数限制，但限制拼凑后的字符串长度不能超过 <code>OB_MAX_VARCHAR_LENGTH=1048576</code>。</li></ul></p></main>|
|`with_options`|必选，用于控制限流的并发度, 并且指定限流统计粒度是规则级别的还是 Format SQLID 语句级别的。目前仅支持 `MAX_CONCURRENCY` 参数，表示匹配到该限流规则的 SQL 语句的最大并发度。|

## 示例

执行如下命令进行关键词限流：

```shell
obclient> CREATE CONCURRENT_LIMITING_RULE   sql1_keywords_ccl_rule
ON *.* TO '%'@'%' FOR SELECT
FILTER BY KEYWORD('table1', 'table2', 'c1') WITH MAX_CONCURRENCY 100;
```