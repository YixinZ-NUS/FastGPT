| description |             |
|-------------|-------------|
| keywords    |             |
| dir-name    |             |
| dir-name-en |             |
| tenant-type | Oracle Mode |
|machine-translation||

# ALTER MATERIALIZED VIEW LOG

## 描述

该语句用来修改物化视图日志（Materialized View Log，mlog）属性。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>对于 OceanBase 数据库 V4.3.5 版本，从 V4.3.5 BP1 版本开始支持 <code>ALTER MATERIALIZED VIEW LOG</code> 语句。</p>
</main>

## 权限要求

执行 `ALTER MATERIALIZED VIEW LOG` 语句，需要当前用户拥有基表（普通表或物化视图）的 `ALTER` 权限。更多有关 OceanBase 数据库权限的详细介绍，请参见 [Oracle 模式下的权限分类](../../../../../../600.manage/500.security-and-permissions/300.access-control/200.user-and-permission/300.permission-of-oracle-mode/000.permission-classification-of-oracle-mode.md)。

## 语法

```sql
ALTER MATERIALIZED VIEW LOG ON [schema.]table_name alter_mlog_action_list;

alter_mview_action_list:
    alter_mlog_action [, alter_mlog_action ...]

alter_mlog_action:
    parallel_clause
    | PURGE [[START WITH expr] [NEXT expr]]

parallel_clause:
    NOPARALLEL
    | PARALLEL integer
```

## 参数说明

|        **参数**        |       **描述**           |
|------------------------|--------------------------|
| schema.                | 可选项，指定物化视图日志基表所在的 Schema。如果省略 `schema.`，则默认基表在当前会话所在的 Schema 中。|
| table_name             | 指定物化视图日志对应的基表名称。|
| alter_mlog_action_list | 表示可以对物化视图日志执行修改的操作列表。可以同时指定多个操作，使用英文逗号（`,`）分隔。详细介绍可参见下文 [alter_mlog_action](#alter_mlog_action)。|

### alter_mlog_action

* `parallel_clause`：用于修改物化视图日志表的并行度。取值如下：

  * `NOPARALLEL`：并行度为 1，默认配置。
  * `PARALLEL integer`：指定并行度，`integer` 取值为大于等于 1 的整数。

  **示例如下：**

  ```sql
  ALTER MATERIALIZED VIEW LOG ON tbl1 PARALLEL 5;
  ```

* `PURGE [[START WITH expr] [NEXT expr]]`：用于修改物化视图日志的后台清理任务的时间周期。

  * `[START WITH expr]`：可选项，表示物化视图日志的首次清除时间。
  * `[NEXT expr]`：可选项，表示下一次清除物化视图日志的时间。用于设置下一次清除物化视图日志的时间。

  <main id="notice" type='notice'>
    <h4>注意</h4>
    <p>请确保 <code>START WITH expr</code> 和 <code>NEXT expr</code> 这两个时间表达式设定在未来的时间点，否则会引发错误。</p>
  </main>

  建议使用 `current_date` 表示当前时区时间，时间表达式示例如下：

  * 从当前时间（`current_date`）开始，每隔 10 秒清理一次过期的物化视图日志记录。

    ```sql
    START WITH current_date NEXT current_date + INTERVAL '10' SECOND
    ```

  * 从当前时间（`current_date`）开始，每隔 10 小时清理一次过期的物化视图日志记录。

    ```sql
    START WITH current_date NEXT current_date + INTERVAL '10' HOUR
    ```

  * 表示从当前时间（`current_date`）开始，每隔 1 天清理一次过期的物化视图日志记录。

    ```sql
    START WITH current_date NEXT current_date + 1
    ```

  **示例如下：**

  ```sql
  ALTER MATERIALIZED VIEW LOG ON tbl1 PURGE START WITH current_date;
  ```

  ```sql
  ALTER MATERIALIZED VIEW LOG ON tbl1 PURGE NEXT current_date + 1;
  ```

  ```sql
  ALTER MATERIALIZED VIEW LOG ON tbl1 PURGE START WITH current_date NEXT current_date + 1;
  ```

## 相关文档

[物化视图日志](../../../../../300.database-object-management/200.manage-object-of-oracle-mode/500.manage-views-of-oracle-mode/200.manage-materialized-views-of-oracle-mode/200.materialized-views-log-of-oracle-mode.md)