| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |Group By Hint    |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |
|machine-translation||

# Optimized Hint 类型下的 Group By Hint

| Hint 类型                     |  描述                                    |
|------------------------------|-------------------------------------------|
| `USE_HASH_AGGREGATION`       | 强制使用哈希聚合。它的反向操作是 `NO_USE_HASH_AGGREGATION`。                         |
| `NO_USE_HASH_AGGREGATION`    | 避免使用哈希聚合。它的反向操作是 `USE_HASH_AGGREGATION`。                             |
| `GBY_PUSHDOWN`               | 设置使用两阶段 `GROUP BY` 下压。它的反向操作是 `NO_GBY_PUSHDOWN`。              |
| `NO_GBY_PUSHDOWN`            | 设置禁止两阶段 `GROUP BY` 下压。它的反向操作是 `GBY_PUSHDOWN`。             |

## `USE_HASH_AGGREGATION` Hint

`USE_HASH_AGGREGATION` Hint 指示优化器在生成计划时强制使用 `HASH` 聚合算法运行该 SQL 语句。设置 `GROUP BY`/`DISTINCT` 使用 HASH AGGREGATE，例如 HASH `GROUP BY`，HASH `DISTINCT`。它的反向操作为 `NO_USE_HASH_AGGREGATION`。

### 语法

```sql
/*+USE_HASH_AGGREGATION([qb_name]) */
```

### 示例

```sql
-- 使用 USE_HASH_AGGREGATION Hint 来强制查询优化器使用哈希聚合算法执行聚合计算
-- 在此查询中，这意味着对 e.department_id 分组后的薪水总和将通过哈希表来计算
SELECT /*+ USE_HASH_AGGREGATION */ e.department_id, sum(e.salary)
FROM employees e
WHERE e.department_id = 1001
GROUP BY e.department_id;
```

## `NO_USE_HASH_AGGREGATION` Hint

`NO_USE_HASH_AGGREGATION` Hint 指示优化器在执行 SQL 语句时避免使用 HASH 聚合算法运行该语句。设置groupby/distinct不使用HASH AGGREGATE，使用MERGE GROUP BY，MERGE DISTINCT。它的反向操作为 `USE_HASH_AGGREGATION`。

### 语法

```sql
/*+ NO_USE_HASH_AGGREGATION([qb_name]) */
```

### 示例

```sql
-- 使用 NO_USE_HASH_AGGREGATION Hint 来指示查询优化器避免使用哈希聚合算法
-- 优化器将选择其他聚合方法，如排序聚合，来执行对 e.department_id 分组的薪水总和计算
SELECT /*+ NO_USE_HASH_AGGREGATION */ e.department_id, sum(e.salary)
FROM employees e
WHERE e.department_id = 1001
GROUP BY e.department_id;
```

## `GBY_PUSHDOWN` Hint

`GBY_PUSHDOWN` Hint 用于指示优化器在可行的情况下，将 `GROUP BY` 操作下推到分布式数据库中的各个数据节点上进行。这样，每个节点可以对其拥有的数据部分先进行分组和聚合，然后将这些局部聚合的结果发送到中央节点以完成最终的聚合。它的反向操作为 `NO_GBY_PUSHDOWN`。

### 语法

```sql
/*+ GBY_PUSHDOWN([qb_name]) */
```

### 示例

```sql
SELECT /*+ GBY_PUSHDOWN */ department_id, COUNT(*) as emp_count
FROM employees
GROUP BY department_id;
```

## `NO_GBY_PUSHDOWN` Hint

`NO_GBY_PUSHDOWN` Hint 与 `GBY_PUSHDOWN` Hint 相反，用于告诉优化器不要将 `GROUP BY` 操作下推到数据节点上，而是在中央节点上完成整个分组和聚合过程。它的反向操作为 `GBY_PUSHDOWN`。

### 语法

```sql
/*+ NO_GBY_PUSHDOWN([qb_name]) */
```

### 示例

```sql
SELECT /*+ NO_GBY_PUSHDOWN */ department_id, COUNT(*) as emp_count
FROM employees
GROUP BY department_id;
```