| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |
|machine-translation||

# REFRESH

`REFRESHE` 用于刷新指定的一个物化视图。

<main id="notice" >
  <h4>功能适用性</h4>
  <p>该内容仅适用于 OceanBase 数据库企业版。OceanBase 数据库社区版仅提供 MySQL 模式。</p>
</main>

## 语法

```sql
DBMS_MVIEW.REFRESH (
   { list                 IN     VARCHAR2,
   | tab                  IN     DBMS_UTILITY.UNCL_ARRAY,}
   method                 IN     VARCHAR2       := NULL,
   rollback_seg           IN     VARCHAR2       := NULL,
   push_deferred_rpc      IN     BOOLEAN        := true,
   refresh_after_errors   IN     BOOLEAN        := false,
   purge_option           IN     BINARY_INTEGER := 1,
   parallelism            IN     BINARY_INTEGER := 0,
   heap_size              IN     BINARY_INTEGER := 0,
   atomic_refresh         IN     BOOLEAN        := true,
   nested                 IN     BOOLEAN        := false,
   out_of_place           IN     BOOLEAN        := false,
   skip_ext_data   	      IN     BOOLEAN        := false,
   refresh_parallel       IN     BINARY_INTEGER := 0,
   nested_refresh_mode    IN     VARCHAR2       := NULL
);
```

## 参数解释

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>非嵌套物化视图不存在级联刷新行为，指定 <code>nested</code> 和 <code>nested_refresh_mode</code> 参数无意义，默认独立刷新。</p>
</main>

| **参数**                | **说明**                                                                                                      |
|----------------------|-----------------------------------------------------------------------------------------------------------|
| list         | 逗号分隔的待刷新物化视图名称清单。目前仅支持对单一物化视图进行刷新，不支持同时刷新多个物化视图。                |
| tab          | 待刷新物化视图名称的数组。目前仅支持对单一物化视图名称数组进行刷新，不支持同时刷新多个物化视图名称数组。          |
| method       | 定义了物化视图的刷新策略，可在创建物化视图时指定默认的策略。可选方法包括：<ul><li>'f' 或 'F'：快速刷新。</ul></li> <ul><li>'?'：强制刷新。</ul></li> <ul><li>'C' 或 'c'：全量刷新。</ul></li> <ul><li> 'A' 或 'a'：全量刷新。</ul></li>  |
| rollback_seg      | 暂无实际作用，仅作 Oracle 兼容。     |
| push_deferred_rpc  | 暂无实际作用，仅作 Oracle 兼容。                                                       |
| refresh_after_errors | 暂无实际作用，仅作 Oracle 兼容。                                                         |
| purge_option      | 暂无实际作用，仅作 Oracle 兼容。                                       |
| parallelism      | 暂无实际作用，仅作 Oracle 兼容。                                                             |
| heap_size          | 暂无实际作用，仅作 Oracle 兼容。                                                                               |
| atomic_refresh     | 暂无实际作用，仅作 Oracle 兼容。     |
| nested          | 指定嵌套物化视图的刷新模式。取值如下：<ul><li>`FALSE`：默认值，表示独立刷新嵌套物化视图。</li><li>`TRUE`：表示级联刷新嵌套物化视图。</li></ul> <main id="notice" type='explain'><h4>说明</h4><p>对于 OceanBase 数据库 V4.3.5 版本，参数 <code>nested</code> 的功能从 V4.3.5 BP3 版本开始生效。</p></main>|
| out_of_place       | 暂无实际作用，仅作 Oracle 兼容。                               |
| skip_ext_data      | 暂无实际作用，仅作 Oracle 兼容。                                                                   |
|refresh_parallel |刷新操作的并发度，即同时执行刷新操作的线程数。<main id="notice" type='explain'><h4>说明</h4><p>对于 OceanBase 数据库 V4.3.5 版本，从 V4.3.5 BP1 版本开始支持该参数默认值变更为 0。</p></main>|
| nested_refresh_mode | 指定级联刷新嵌套物化视图是一致刷新行为还是非一致刷新行为。取值如下：<ul><li>当指定参数 `nested` 为 `FALSE` 时，指定参数 `nested_refresh_mode` 会报错。</li><li>当指定参数 `nested` 为 `TRUE` 时：<ul><li>指定参数 `nested_refresh_mode` 取值如下：  <ul><li>`inconsistent`：表示级联非一致刷新。</li><li>`consistent`：表示级联一致刷新。</li></ul>  </li><li>不指定参数 `nested_refresh_mode` 时默认为级联非一致刷新。</li></ul>  </li></ul> <main id="notice" type='explain'><h4>说明</h4><p>对于 OceanBase 数据库 V4.3.5 版本：<ul><li>从 V4.3.5 BP3 版本开始支持参数 <code>nested_refresh_mode</code> 并支持级联非一致性刷新 (<code>inconsistent</code>)，即支持指定参数 <code>nested_refresh_mode</code> 取值为 <code>inconsistent</code>。</li><li>从 V4.3.5 BP4 版本开始支持级联一致性刷新 (<code>consistent</code>)，即支持指定参数 <code>nested_refresh_mode</code> 取值为 <code>consistent</code>。</li></ul></p></main>|

## 示例

* 独立刷新模式：

  * 只指定参数 `mv_name`。

    ```sql
    CALL DBMS_MVIEW.REFRESH('mv1');
    ```

  * 指定参数 `mv_name` 及参数 `nested` 值为 `false`。

    ```sql
    CALL DBMS_MVIEW.REFRESH('mv1', nested=> false);
    ```

* 级联非一致刷新模式：

  * 指定参数 `mv_name`，参数 `nested` 值为 `true`，不指定参数 `nested_refresh_mode`。

    ```sql
    CALL DBMS_MVIEW.REFRESH(
        'mv1',   nested=> true);
    ```

  * 指定参数 `mv_name`，参数 `nested` 值为 `true` 及参数 `nested_refresh_mode` 值为 `inconsistent`。

    ```sql
    CALL DBMS_MVIEW.REFRESH(
        'mv1',
        nested=> true,
        nested_refresh_mode => 'inconsistent');
    ```

* 级联一致刷新模式：

  指定参数 `mv_name`，参数 `nested` 值为 `true` 及参数 `nested_refresh_mode` 值为 `consistent`。

  ```sql
  CALL DBMS_MVIEW.REFRESH(
      'mv1',
      nested=> true,
      nested_refresh_mode => 'consistent');
  ```

* 以下为报错场景：

  * 参数 `nested` 值为 `false`，又指定参数 `nested_refresh_mode` 值，报错。

    ```sql
    CALL DBMS_MVIEW.REFRESH(
        'mv1',
        nested=> false,
        nested_refresh_mode => 'xxxx');
    ```

  * 没有指定参数 `nested` 的值，只指定参数 `nested_refresh_mode` 的值，报错。

    ```sql
    CALL DBMS_MVIEW.REFRESH('mv1', nested_refresh_mode => 'xxxx');
    ```

  * 参数 `nested` 值为 `true`，参数 `nested_refresh_mode` 值为非法字符串，报错。

    ```sql
    CALL DBMS_MVIEW.REFRESH(
        'mv1',
        nested=> true,
        nested_refresh_mode => '非法字符串');
    ```

## 相关文档

关于刷新物化视图的介绍信息，参见 [刷新物化视图](../../../../300.database-object-management/200.manage-object-of-oracle-mode/500.manage-views-of-oracle-mode/200.manage-materialized-views-of-oracle-mode/400.refresh-materialized-views-of-oracle-mode.md)。
