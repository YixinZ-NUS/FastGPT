| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |
|machine-translation||

# DISPLAY

`DISPLAY` 函数用于查询并格式化历史的 `EXPLAIN` 计划。

  <main id="notice">
  <h4>功能适用性</h4>
  <p>社区版自 V4.2.5 版本支持该功能。</p>
  </main>

## 语法

```sql
TYPE DBMS_XPLAN_TYPE_TABLE IS TABLE OF VARCHAR2(4000);

DBMS_XPLAN.DISPLAY(format VARCHAR2 DEFAULT 'TYPICAL',
                  statement_id VARCHAR2 DEFAULT null,
                  table_name   VARCHAR2 DEFAULT 'PLAN_TABLE',
                  filter_preds VARCHAR2 DEFAULT null)
RETURN DBMS_XPLAN_TYPE_TABLE;
```

## 参数说明

| 参数 | 说明 |
| --- | --- |
| format | 指定计划格式信息，可选参数如下：<ul><li>`'BASIC'`：展示少量信息，例如算子 ID、算子名称、算子备注信息、表达式信息。</li><li> `'TYPICAL'`：展示基础信息，例如算子 ID、算子名称、算子备注信息、优化器估计的输出行数、优化器估计的执行时间，表达式信息。如果该计划执行过，还会展示计划第一次执行真实反馈信息，例如真实行数，开销等等。</li><li> `'ALL'`：展示丰富的计划信息，例如算子 ID、算子名称、算子备注信息、优化器估计的输出行数、优化器估计的执行时间，表达式信息、生效的 Hint、Query Block Name Trace 信息、Outline 信息、基表优化信息、常量参数化信息、约束信息、Plan Note 等。</li><li> `'ADVANCED'`：展示丰富的计划信息，计划信息与 'ALL' 参数一致，除此之外还为复杂的计划展示树状结构信息。</li></ul>|
| statement_id | `EXPLAIN` 查询的标记信息，可以通过命令 `EXPLAIN SET STATEMENT_ID='XXX'` 设置查询的的标记信息。 |
| table_name | `EXPLAIN` 计划保存的目标表，目前默认值是 `PLAN_TABLE`。 |
| filter_preds | 额外的 `PLAN_TABLE` 过滤条件，用于过滤特定的算子或计划。 |

## 示例

Oracle 租户 需要配合 Function Table 功能使用。

```shell
-- 连接数据库，创建表
CREATE TABLE t1 (
    c1 INT
);

CREATE TABLE plan_table (
    statement_id         VARCHAR2(30),
    plan_id              INT,
    gmt_create           TIMESTAMP,
    remarks              VARCHAR2(4000),
    operator             VARCHAR2(255),
    options              VARCHAR2(255),
    object_node          VARCHAR2(40),
    object_owner         VARCHAR2(128),
    object_name          VARCHAR2(128),
    object_alias         VARCHAR2(261),
    object_instance      INT,
    object_type          VARCHAR2(30),
    optimizer            VARCHAR2(4000),
    search_columns       INT,
    id                   INT,
    parent_id            INT,
    depth                INT,
    position             INT,
    is_last_child        INT,
    cost                 INT,
    cardinality          INT,
    bytes                INT,
    rowset               INT,
    other_tag            VARCHAR2(4000),
    partition_start      VARCHAR2(4000),
    partition_stop       VARCHAR2(4000),
    partition_id         INT,
    other                VARCHAR2(4000),
    distribution         VARCHAR2(64),
    cpu_cost             INT,
    io_cost              INT,
    temp_space           INT,
    access_predicates    VARCHAR2(4000),
    filter_predicates    VARCHAR2(4000),
    startup_predicates   VARCHAR2(4000),
    projection           VARCHAR2(4000),
    special_predicates   VARCHAR2(4000),
    time                 INT,
    qblock_name          VARCHAR2(128),
    other_xml            VARCHAR2(4000)
);

-- 使用 EXPLAIN 查看查询计划
EXPLAIN SELECT * FROM t1;
+-------------------------------------------------------------------+
| Query Plan                                                        |
+-------------------------------------------------------------------+
| ===============================================                   |
| |ID|OPERATOR       |NAME|EST.ROWS|EST.TIME(us)|                   |
| -----------------------------------------------                   |
| |0 |TABLE FULL SCAN|T1  |1       |4           |                   |
| ===============================================                   |
| Outputs & filters:                                                |
| -------------------------------------                             |
|   0 - output([T1.C1]), filter(nil), rowset=16                     |
|       access([T1.C1]), partitions(p0)                             |
|       is_index_back=false, is_global_index=false,                 |
|       range_key([T1.__pk_increment]), range(MIN ; MAX)always true |
+-------------------------------------------------------------------+
11 rows in set

-- 使用 DBMS_XPLAN 包查看历史计划
SELECT * FROM table(dbms_xplan.display);
+-------------------------------------------------------------------+
| COLUMN_VALUE                                                      |
+-------------------------------------------------------------------+
| ==========================================                        |
| |ID|OPERATOR  |NAME|EST.ROWS|EST.TIME(us)|                        |
| ------------------------------------------                        |
| |0 |TABLE SCAN|T1  |1       |2           |                        |
| ==========================================                        |
| Outputs & filters:                                                |
| -------------------------------------                             |
|   0 - output([T1.C1]), filter(nil), rowset=16                     |
|       access([T1.C1]), partitions(p0)                             |
|       is_index_back=false, is_global_index=false,                 |
|       range_key([T1.__pk_increment]), range(MIN ; MAX)always true |
+-------------------------------------------------------------------+
```
