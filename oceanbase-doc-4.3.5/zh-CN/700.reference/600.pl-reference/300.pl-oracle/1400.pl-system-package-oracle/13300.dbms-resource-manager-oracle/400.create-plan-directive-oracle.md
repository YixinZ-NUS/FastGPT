| Description   |                 |
|---------------|-----------------|
| keywords      |                 |
| dir-name      |                 |
| dir-name-en   |                 |
| tenant-type   | Oracle Mode     |
|machine-translation||

# CREATE_PLAN_DIRECTIVE

`CREATE_PLAN_DIRECTIVE` 过程用于创建资源计划指令。


  <main id="notice" >
    <h4>功能适用性</h4>
    <p>该内容仅适用于 OceanBase 数据库企业版。OceanBase 数据库社区版仅提供 MySQL 模式。</p>
  </main>
  
## 语法

```sql
DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE (
    PLAN                      IN VARCHAR2, 
    GROUP_OR_SUBPLAN          IN VARCHAR2, 
    COMMENT                   IN VARCHAR2 DEFAULT'', 
    MGMT_P1                   IN NUMBER   DEFAULT 100,
    UTILIZATION_LIMIT         IN NUMBER   DEFAULT 100,
    MIN_IOPS                  IN NUMBER   DEFAULT 0,
    MAX_IOPS                  IN NUMBER   DEFAULT 100,
    WEIGHT_IOPS               IN NUMBER   DEFAULT 0,
    MAX_NET_BANDWIDTH         IN INT DEFAULT 100,
    NET_BANDWIDTH_WEIGHT      IN INT DEFAULT 0);
```

## 参数说明

|        参数        |           说明          |
|-------------------|--------------------------|
| plan              | 资源计划的名称。   |
| group_or_subplan  | 资源使用组或子计划的名称。    |
| comment           | 对计划指令的注释。   |
| mgmt_p1           | 指定系统满负载情况下，相对可用的最大 CPU 占比。 |
| utilization_limit | CPU 资源使用比例上限。该参数的取值范围为 \[0, 100\]。"100"表示最大可使用租户全部 CPU 资源。如果取值为 `20`，则表示最大可使用租户 20% 的 CPU 资源。 |
| MIN_IOPS | 指 IO 争用时预留的 IOPS 资源，所有资源组的 `MIN_IOPS` 总和不超过 100，缺省值为 0。 |
| MAX_IOPS |  IOPS 资源上限，所有资源组的 `MAX_IOPS` 总和可以超过 100，缺省值 100。 |
| WEIGHT_IOPS | 在发生 IO 资源争用的情况下的 IOPS 资源权重，所有资源组的 `WEIGHT_IOPS` 总和可以超过 100，并会做归一化，缺省值为 0。 |
| MAX_NET_BANDWIDTH | 指定最大可以使用的网络带宽资源，总和可以超过 100，默认值为 `100`。 |
| NET_BANDWIDTH_WEIGHT | 指定网络带宽的权重值，总和可以超过 100，按比例切分，默认值为 `0`。|

## 示例

* 为资源计划 `DAY` 绑定资源组 `group1`，并指定资源组中 CPU 资源的资源计划指令。

  ```shell
  obclient [SYS]> delimiter //
  ```

  ```shell
  obclient> BEGIN DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
      PLAN=>'DAY',
      GROUP_OR_SUBPLAN=>'group1',
      mgmt_p1=>80,
      utilization_limit=>100);
      END; //
  ```

  ```shell
  obclient [SYS]> delimiter ;
  ```

* 为资源计划 `plan_a` 绑定资源组 `big_group`，并指定资源组中 CPU、IOPS、网络带宽等资源的资源计划指令。

  ```shell
  obclient [SYS]> delimiter //
  ```

  ```shell
      obclient [SYS]> BEGIN DBMS_RESOURCE_MANAGER.CREATE_PLAN_DIRECTIVE(
      PLAN => 'plan_a',
      GROUP_OR_SUBPLAN => 'big_group',
      COMMENT  => 'TP 优先',
      UTILIZATION_LIMIT =>60,
      MIN_IOPS => 20,
      MAX_IOPS => 100,
      WEIGHT_IOPS => 20,
      MAX_NET_BANDWIDTH => 50,
      NET_BANDWIDTH_WEIGHT =>50);
      END; //
  ```

  ```shell
  obclient [SYS]> delimiter ;
  ```

## 相关文档

有关资源隔离配置的详细操作，参见 [配置租户内资源隔离](../../../../../600.manage/200.tenant-management/600.common-tenant-operations/300.resource-isolation/200.resource-isolation-of-oracle-mode/200.resource-isolation-at-user-level-of-oracle-mode.md)。
