# obshell 恢复命令组

本文档介绍 obshell 的恢复命令组，恢复命令组可用于取消租户的恢复任务及查看恢复任务。该命令组要求 OceanBase 集群已经被初始化。您可通过在命令中配置 `-h`/`--help` 选项查看命令的帮助信息，当任务执行报错时，也可配置 `-v`/`--verbose` 选项查看命令的详细执行过程。

## obshell tenant restore

使用该命令可将备份文件恢复到指定租户。

```shell
${home_path}/bin/obshell tenant restore <tenant_name> [flags]

# example
/home/admin/oceanbase/bin/obshell tenant restore mytenant --timestamp "2021-01-01T00:00:00.000+08:00" -z "zone1,zone2,zone3" -d '/path/to/backup/data' -a '/path/to/backup/clog' -u unit1
```

`home_path` 为 OceanBase 数据库的安装目录，obshell 默认在 OceanBase 数据库安装目录的 `bin` 目录下。`tenant_name` 为待恢复的租户名称。

命令的选项说明如下：

| 选项名 | 是否必选 | 数据类型 | 默认值 | 说明 |
|------|------|------|------|------|
| -d/--data_backup_uri | 是 | string | 无 | 源租户的数据备份路径。 |
| -z/--zone   | 否 | string | 无 | 租户的 Zone 分布。如果未指定，则默认为集群中的所有 Zone。 |
| --unit_num | 否 | int | 1 | 租户在目标 Zone 上的 unit 个数，取值需要小于目标 Zone 的节点个数。 |
| -u/--unit | 否 | string | 无 | 租户资源池使用的资源规格。<main id="notice" type='explain'><h4>说明</h4><p>可通过如 <code>--zone1.unit=s1</code> 的方式单独指定某个 Zone 上的资源规格，该方式的优先级高于通过 <code>-u</code>/<code>--unit</code> 指定。</p></main> |
| --replica_type  | 否 | string | FULL | 租户在目标 Zone 上的副本类型，可设置为 `FULL`（全功能型副本）或者 `READONLY`（只读型副本）。<main id="notice" type='explain'><h4>说明</h4><p>可通过如 <code>--zone1.replica_type=FULL</code> 的方式单独指定某个 Zone 上的副本类型，该方式的优先级高于通过 <code>--replica_type</code> 指定。</p></main> |
| -p/--primary_zone | 否 | string | RANDOM | 租户的 Primary Zone，指定了租户提供读写服务的 Zone 的优先级。例如 `primary_zone ='zone1;zone2,zone3'` 表示该租户优先由 `zone1` 提供读写服务，`zone1` 比 `zone2`、`zone3` 的优先级高，`zone2` 和 `zone3` 是同一优先级。 |
| -T/--timestamp  | 否 | string | 无 | 恢复到指定时间戳。需要满足格式如 `"2006-01-02T15:04:05.000Z07:00"`。 |
| -S/--scn  | 否 | int | 无 | 恢复到指定 SCN。 |
| -a/--archive_log_uri  | 否 | string | ${data_backup_uri} | 源租户的日志归档路径。未设置的情况下，和 `-d`/`--data_backup_uri` 取相同值。 |
| -s/--ha_high_thread_score | 否 | int | 无 | 用于设置高可用高优先级线程的当前工作线程数。取值范围为 [0,100]。 |
| -c/--concurrency | 否 | int | 无 | 指定数据恢复的并发度。如果不指定，则默认等于该租户被分配的 MAX_CPU 数。 |
| -D/--decryption | 否 | string | 无 | 设置备份的恢复密码。仅在数据备份时添加了密码的场景下才需要设置备份的恢复密码。 |
| -k/--kms_encrypt_info | 否 | string | 无 | 设置加密信息。如果未加密或恢复时可以访问原来的密钥管理服务，则不需要设置。 |
| -y/--yes  | 否  | 无  |  无   | 该选项无需传值，命令中配置即表示跳过二次确认。  |

## obshell restore cancel

使用该命令可取消某个租户的恢复任务。

```shell
${home_path}/bin/obshell restore cancel <tenant_name> [-y]

# example
/home/admin/oceanbase/bin/obshell restore cancel tenant1
```

`home_path` 为 OceanBase 数据库的安装目录，obshell 默认在 OceanBase 数据库安装目录的 `bin` 目录下。`tenant_name` 为待取消恢复任务的租户名。

可通过 `-y`/`--yes` 控制是否取消二次确认，无需传值。

## obshell restore show

使用该命令可展示指定租户的恢复任务。

```shell
${home_path}/bin/obshell restore show <tenant_name> [-d]

# example
/home/admin/oceanbase/bin/obshell restore show tenant1
```

`home_path` 为 OceanBase 数据库的安装目录，obshell 默认在 OceanBase 数据库安装目录的 `bin` 目录下。`tenant_name` 为待展示恢复任务的租户名。

可通过 `-d`/`--show_detail` 控制是否展示恢复任务的详细信息，该选项无需传值。
