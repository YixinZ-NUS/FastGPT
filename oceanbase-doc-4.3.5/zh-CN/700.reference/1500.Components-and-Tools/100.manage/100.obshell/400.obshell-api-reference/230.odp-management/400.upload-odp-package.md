# 上传 OBProxy 安装包

本文介绍如何通过 obshell 上传 OBProxy（OceanBase 数据库代理，又称 ODP）升级所需的安装包到 obshell 元数据库中。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>自 obshell V4.2.6 起支持该 API。</p>
</main>

## 调用说明

### 接口约束

* obshell Server 会对该 API 进行安全校验，详细介绍可参见 [API 混合加密](../20.api-hybrid-encryption.md)。
* 要求该 obshell 下已管理 OBProxy 服务。

### 请求路径

POST /api/v1/obproxy/package

### 请求类型

multipart/form-data

### 请求参数

| 参数 | 类型 | 必选 | 示例值 | 描述 |
|-------|-----|------|------|------|
| file | file | 是 | 无 | 指定需要上传的 RPM 包。 |

### 返回结果

| 参数 | 类型 | 说明 |
|------|------|------|
| successful | bool | 请求是否成功。 |
| timestamp | time.Time | 服务端完成请求的时间戳。 |
| duration | int | 服务端处理请求的时间（毫秒）。 |
| status | int | 符合 HTTP Status 规范的编码。 |
| traceId | string | 请求的 Trace ID。 |
| data | sqlite.UpgradePkgInfo | 详情参见下文 **UpgradePkgInfo 信息的数据结构**。 |
| error | ApiError | 请求产生的 Error，包含如下信息：<ul><li>`code`：错误码。</li><li>`message`：错误详细信息。</li><li>`subErrors`：子错误信息。</li></ul> |

UpgradePkgInfo 信息的数据结构如下：

|        参数         |   类型    |           说明           |
| ------------------- | --------- | ------------------------ |
| pkgId               | int       | 软件包 ID                |
| name                | string    | 软件包名称               |
| version             | string    | 软件包版本               |
| releaseDistribution | string    | 软件包的发行版构建号     |
| distribution        | string    | 软件包的发行版           |
| release             | string    | 软件包的构建号           |
| architecture        | string    | 软件包架构               |
| Size                | int       | 软件包解压大小，单位字节 |
| PayloadSize         | int       | 软件包大小，单位字节     |
| ChunkCount          | int       | 软件包切片数量           |
| Md5                 | string    | 软件包的 MD5             |
| GmtModify           | time.Time | 软件包的修改时间         |

## 示例

### 请求示例

POST 10.10.10.1:2886/api/v1/obproxy/package

```json
 -F "file=@/home/rpmbuild/RPMS/x86_64/obproxy-ce-4.3.3.0-5.el7.x86_64.rpm"
/api/v1/obproxy/package
```

### 返回示例

```json
{
    "successful": true,
    "timestamp": "2025-03-20T16:36:37.887767957+08:00",
    "duration": 1491,
    "status": 200,
    "traceId": "e01a49a077931ea4",
    "data": {
        "PkgId": 2,
        "Name": "obproxy-ce",
        "Version": "4.3.3.0",
        "ReleaseDistribution": "5.el7",
        "Distribution": "el7",
        "Release": "5",
        "Architecture": "x86_64",
        "Size": 118448854,
        "PayloadSize": 29122380,
        "ChunkCount": 2,
        "Md5": "ab2e9b3b86eeafc482170927210a2fa4",
        "GmtModify": "2025-03-20T08:36:37Z"
    }
}
```

## 相关文档

除通过命令行调用 API 接口外，还可以通过 SDK 方法调用 API。通过 obshell-sdk-python 请求 API 方法的介绍可参见 [上传 OBProxy 安装包](../../500.obshell-sdk-reference/100.python/230.odp-management/400.upload-odp-package-of-python.md)。
