# 性能监控

性能监控是 obshell Dashboard 的核心模块之一，为您提供 OceanBase 集群的集群维度、主机维度、租户维度、OBServer 维度、Unit 维度等多种资源的多维度性能指标实时监控能力，帮助您快速定位性能瓶颈、优化系统资源使用。

## OceanBase 集群

OceanBase 集群分为数据库性能和主机性能两个页面，展示了集群维度、主机维度、租户维度、OBServer 维度、Unit 维度五个维度的数据。默认使用数据库性能的集群维度进行展示，不同维度支持查看的监控指标有所不同。

| 页面  | 监控项  |
|-------|------|
| 数据库性能 | 数据库性能分为集群维度、租户维度、OBServer 维度、Unit 维度四个维度，分别展示不同时间内集群和租户的 **QPS**、**SQL 响应时间**、**TPS**、**事务响应时间**、**会话数**、**请求等待队列耗时**、**事务日志数**、**事务日志量**、**事务日志耗时**、**物理 IO 次数**、**物理 IO 耗时**、**物理 IO 吞吐量**、**事务数量** 多个性能指标的图表变化。  |
| 主机性能 | 主机性能分为集群维度和主机维度两个维度，分别展示了 **Linux 系统负载**、**CPU 使用率**、**内存**、**内存使用率**、**IOPS**、**IO 耗时**、**IO 吞吐量**、**网络吞吐率** 多个性能指标的图表变化。 |

下文以数据库性能的集群维度为例，为您介绍操作步骤。

### 操作步骤

1. 登录 obshell Dashboard。

2. 在左侧导航栏单击 **性能监控**。

	<main id="notice" type='explain'>
	  <h4>说明</h4>
	  <p>仅首次登录需要输入 Prometheus 的地址、用户名、密码。若暂未部署，建议使用 obd 安装部署。</p>
	</main>

3. 系统默认进入 OceanBase 集群的 **数据库性能** 页签下。

4. 在 **数据筛选** 区域，配置监控数据筛选条件。

   ![数据筛选](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/obshell/V4.3.2/420.Performance-monitoring-1.png)

   | 筛选条件  | 描述  |
   |-------|------|
   | 刷新 | 性能数据的 **刷新频率** 需更新，您可将光标悬停在 **关闭** 按钮上，在显示的下选框中选择刷新频率，刷新频率取值可选项为 `Off`、`5s`、`10s`、`30s`，默认为 `Off`。您也可以在任意时间点击 **刷新** 按钮实时刷新。  |
   | 展示时间区间 | 支持自定义。<ul><li>单击左侧可选择距当前时间最近一段时间内的监控信息，如单击 `近 30 分钟`，将展示当前时间前 30 分钟内的监控信息。默认展示近 1 小时内的数据，您可根据需求选择。</li><li>右侧包含日期和时间，日期处可手动输入或通过下方日历选择，时间处可手动输入或通过鼠标滑动选择。</li></ul>  |
   | Zone | 默认展示全部 Zone 的性能数据，可单击单击 **Zone** 字段后的选项可选择查看对应 Zone 的性能数据。  |
   | OBServer | 默认展示全部 OBServer 节点的性能数据，可单击 **OBServer** 字段后的选项选择查看其他 OBServer 节点的性能数据。  |

5. **数据库性能** 页签展示不同时间内集群维度、租户维度、OBServer 维度、Unit 维度四个维度的数据库性能监控数据，分别展示不同时间内各维度的 **QPS**、**SQL 响应时间**、**TPS**、**事务响应时间**、**会话数**、**请求等待队列耗时**、**事务日志数**、**事务日志量**、**事务日志耗时**、**物理 IO 次数**、**物理 IO 耗时**、**物理 IO 吞吐量**、**事务数量** 多个性能指标的图表变化。

   ![性能监控](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/oceanbase-database-standalone/V4.3.5/obshell/V4.3.2/410.Performance-monitoring-01.png)

6. 下述功能能够帮您更好的在趋势图中查看和分析性能监控数据，您可结合图片及下述文字理解。

   + 光标悬停在问号图标处可查看对应监控项介绍，光标悬停在监控图表上任意位置，可查看折线图的详细信息。单击右上角的 ▲ 和 ▼ 可以进行上翻页和下翻页。

	  ![翻页](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/oceanbase-database-standalone/V4.3.5/obshell/V4.3.2/410.Performance-monitoring-04.png)

   + 支持对具体的监控项进行操作，如单击下图红色框选位置，将不展示对应线的信息，单击下图蓝色框选位置，将只展示这一条线的信息。

	  ![自定义](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/oceanbase-database-standalone/V4.3.5/obshell/V4.3.2/410.Performance-monitoring-05.png)

 ## OceanBase 租户

obshell Dashboard 支持通过租户维度和 Unit 维度查看 OceanBase 租户中的性能与 SQL、事务、存储与缓存三个方面的监控数据，您可通过以下两个入口进行查看：

+ **入口一**：登录 obshell Dashboard，在左侧导航栏单击 **租户管理**，在 **租户管理** 页面的租户列表中单击相应租户，进入该租户的管理页面，在左侧导航栏单击 **性能监控**，系统默认进入 **性能与 SQL** 页签。

+ **入口二**：登录 obshell Dashboard，在左侧导航栏单击 **性能监控**，进入 **OceanBase 集群** 页签下，单击上方 **OceanBase 租户**，进入 **性能与 SQL** 页签。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>通过入口一即从 <b>租户管理</b> 页面进入 <b>性能监控</b> 页面，只能查看当前租户的监控信息。</p>
</main>

OceanBase 租户页面从租户维度和 Unit 维度展示了 **性能与 SQL**、**事务**、**存储与缓存** 三个维度的性能数据，默认展示性能与 SQL 的租户维度数据，不同维度支持查看的监控指标有所不同。

| 页面  | 监控项  |
|-------|------|
| 性能与 SQL | 展示 **QPS**、**响应时间**、**SQL 执行计划类别**、**SQL 执行时间**、**会话数**、**等待时间**、**等待事件耗时**、**请求等待队列**、**请求等待队列耗时**、**租户 CPU 消耗**、**租户线程使用率**、**内存使用率**、**MEMStore 使用百分比**、**RPC 包耗时**、**RPC 包吞吐量**、**打开的游标数**、**RPC 请求成功率**、**Gts 请求数**、**RPC 网络延迟**、**RPC 交付失败** 多个性能指标的图表变化。 |
| 事务 | 展示 **TPS**、**事务响应时间**、**事务响应时间明细**、**事务回滚比例**、**事务日志数**、**事务日志量**、**事务日志耗时**、**事务锁等待次数**、**事务锁平均等待时间**、**事务数量**、**Memstore 锁申请成功率** 多个性能指标的图表变化。 |
| 存储与缓存 | 展示 **MEMStore**、**物理 IO 次数**、**物理 IO 耗时**、**物理 IO 吞吐量**、**缓存大小**、**缓存命中率**、**缓存请求次数**、**日志盘**、**日志盘百分比**、**Vector 内存**、**Vector 内存百分比** 多个性能指标的性能变化。 |

下文以 **入口二** 的 **性能与 SQL** 页签为例，为您介绍具体操作步骤。

### 操作步骤

1. 登录 obshell Dashboard。

2. 在左侧导航栏选择 **性能监控**，系统进入 **OceanBase 集群** 页签。

3. 选择 **OceanBase 租户** 页签。

4. 在 **数据筛选** 区域，配置监控数据筛选条件。

   ![数据筛选](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/observer-enterprise/V4.4.1/obshell/V4.3.2/420.Performance-monitoring-2.png)

   | 筛选条件  | 描述  |
   |-------|------|
   | 刷新 | 性能数据的 **刷新频率** 需更新，您可将光标悬停在 **关闭** 按钮上，在显示的下选框中选择刷新频率，刷新频率取值可选项为 `Off`、`5s`、`10s`、`30s`，默认为 `Off`。您也可以在任意时间点击 **刷新** 按钮实时刷新。  |
   | 展示时间区间 | 支持自定义。<ul><li>单击左侧可选择距当前时间最近一段时间内的监控信息，如单击 `近 30 分钟`，将展示当前时间前 30 分钟内的监控信息。默认展示近 1 小时内的数据，您可根据需求选择。</li><li>右侧包含日期和时间，日期处可手动输入或通过下方日历选择，时间处可手动输入或通过鼠标滑动选择。</li></ul>  |
   | 租户 | 默认展示 sys 租户的性能数据，可单击 **租户** 字段后的选项选择查看其他租户的性能数据。  |
   | Zone | 默认展示全部 Zone 的性能数据，可单击单击 **Zone** 字段后的选项可选择查看对应 Zone 的性能数据。  |
   | OBServer | 默认展示全部 OBServer 节点的性能数据，可单击 **OBServer** 字段后的选项选择查看其他 OBServer 节点的性能数据。  |

5. 默认进入 **性能与 SQL** 页签的租户维度，展示了 **QPS**、**响应时间**、**SQL 执行计划类别**、**SQL 执行时间**、**会话数**、**等待时间**、**等待事件耗时**、**请求等待队列**、**请求等待队列耗时**、**租户 CPU 消耗**、**租户线程使用率**、**内存使用率**、**MEMStore 使用百分比**、**RPC 包耗时**、**RPC 包吞吐量**、**打开的游标数**、**RPC 请求成功率**、**Gts 请求数**、**RPC 网络延迟**、**RPC 交付失败** 多个性能指标的图表变化。

   ![性能与 SQL](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/oceanbase-database-standalone/V4.3.5/obshell/V4.3.2/410.Performance-monitoring-06.png)

6. 下述功能能够帮您更好的在趋势图中查看和分析性能监控数据，您可结合图片及下述文字理解。

   + 光标悬停在问号图标处可查看对应监控项介绍，光标悬停在监控图表上任意位置，可查看折线图的详细信息。单击右上角的 ▲ 和 ▼ 可以进行上翻页和下翻页。

	 ![翻页](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/oceanbase-database-standalone/V4.3.5/obshell/V4.3.2/410.Performance-monitoring-08.png)

   + 支持对具体的监控项进行操作，如单击下图红色框选位置，将不展示对应线的信息，单击下图蓝色框选位置，将只展示这一条线的信息。

	 ![操作](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/oceanbase-database-standalone/V4.3.5/obshell/V4.3.2/410.Performance-monitoring-09.png)