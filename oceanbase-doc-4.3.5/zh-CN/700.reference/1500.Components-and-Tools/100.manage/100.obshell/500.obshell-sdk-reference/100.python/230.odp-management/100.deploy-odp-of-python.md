# 部署 OBProxy

本文介绍如何通过 obshell-sdk-python 在指定节点上部署 OBProxy（OceanBase 数据库代理，又称 ODP）。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <ul>
  <li><p>目前仅支持部署 OBProxy V4.1.0.0 及之后版本。</p></li>
  <li><p>自 obshell V4.2.6 起支持通过 obshell-sdk-python 在指定节点上部署 OBProxy。</p></li>
  </ul>
</main>

## 注意事项

* 请确保 obshell 正常运行。

* 请确保请求的 client 对应的节点未部署 OBProxy。

* 请确保请求的 client 对应的节点已设置 agent password。

## 示例代码

:::tab

tab 任务同步执行

```python
from obshell import ClientSet
from obshell.auth import PasswordAuth

# 创建 client 实例，节点地址为 '10.10.10.1'，端口为 2886，节点的 agent password 为 '***'.
client = ClientSet("10.10.10.1", 2886, PasswordAuth(agent_password='***'))

client.v1.add_obproxy_sync(home_path="/home/obproxy",
                           app_name="myobproxy",
                           sql_port=2883,
                           exporter_port=2884,
                           rpc_port=2885,
                           rs_list="10.10.10.1:2881;10.10.10.2:2881;10.10.10.3:2881",
                           proxyro_password="******",
                           obproxy_sys_password="*****",
                           parameters={"server_tcp_keepidle": "5", "enable_strict_kernel_release": "false"}
                          )
```

tab 任务异步执行

```python
from obshell import ClientSet
from obshell.auth import PasswordAuth

# 创建 client 实例，节点地址为 '10.10.10.1'，端口为 2886，节点的 agent password 为 '***'.
client = ClientSet("10.10.10.1", 2886, PasswordAuth(agent_password='***'))

dag = client.v1.add_obproxy(home_path="/home/obproxy",
                           app_name="myobproxy",
                           sql_port=2883,
                           exporter_port=2884,
                           rpc_port=2885,
                           rs_list="10.10.10.1:2881;10.10.10.2:2881;10.10.10.3:2881",
                           proxyro_password="******",
                           obproxy_sys_password="*****",
                           parameters={"server_tcp_keepidle": "5", "enable_strict_kernel_release": "false"}
                          )
# 等待任务完成。
client.v1.wait_dag_succeed(dag.generic_id)
```

:::

## 相关文档

部署 OBProxy 的 API 接口说明可参见 [部署 OBProxy](../../../400.obshell-api-reference/230.odp-management/100.deploy-odp.md)。
