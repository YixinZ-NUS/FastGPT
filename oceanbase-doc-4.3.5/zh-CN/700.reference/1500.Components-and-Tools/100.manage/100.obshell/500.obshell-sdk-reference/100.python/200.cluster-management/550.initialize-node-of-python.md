# 初始化节点

本文介绍如何通过 obshell-sdk-python 初始化节点，目标是将部署 OceanBase 数据库所需的 RPM 包（包括 oceanbase-ce、oceanbase-ce-libs、oceanbase-ce-utils、obshell）发送给各个节点，并完成目录初始化。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>建议先查看 <a href='../100.quickstart-of-python.md'>obshell-sdk-python 快速上手</a> 内容，了解如何使用 obshell-sdk-python。</p>
</main>

## 注意事项

在执行初始化节点之前请先就将所需的 RPM 包下载到机器上。您可以手动下载，也可以使用 obshell-sdk-python 下载，使用 obshell-sdk-python 下载的介绍可参见 [下载 RPM 包](../1500.other-api/400.download-rpm-package-of-python.md)。

## 示例代码

:::tab

tab 强制清空目标目录

```python
from obshell import initialize_nodes, start_obshell, NodeConfig


def init_nodes():
    pkgs = [
        "/root/download/oceanbase-ce-libs-4.2.5.0-100000052024102022.el7.x86_64.rpm",
        "/root/download/oceanbase-ce-4.2.5.0-100000052024102022.el7.x86_64.rpm",
        # 以上的两个软件包已经足够初始化 OceanBase 集群了，但为了后续运维方便建议同时安装下面两个软件包
        # utils 提供 ob_admin，在后续恢复中可以提供恢复窗口解析的能力
        "/root/download/oceanbase-ce-utils-4.2.5.0-100000052024102022.el7.x86_64.rpm",
        # 上文配置的 OceanBase 数据库 4.2.5.0 版本中已经包含了 obshell，但推荐使用最新版本的 obshell，所以这里单独安装了最新版本的 obshell
        "/root/download/obshell-4.2.4.3-12024110711.el7.x86_64.rpm",
    ]

    ips = [
        "10.10.10.1",
        "10.10.10.2",
        "10.10.10.3",
    ]
    work_dir = "/data/ob" # OceanBase 数据库的工作目录，不需要提前创建，初始化 OBServer 节点时会自动创建
    nodes_config = []
    for _, ip in enumerate(ips):
        node = NodeConfig(ip, work_dir)
        nodes_config.append(node)

    ## SDK 会自动判断是否使用 rsync，如果不使用 rsync，传输效率会比较低
    ## 使用 rsync 传输文件时，需要在 SDK 执行机器和目标机器之间配置免密登录，同时两边都需要安装 rsync
    ## 你可以通过以下方法关闭 rsync 传输，但是不推荐这么做
    # from obshell.ssh import USE_RSYNC
    # USE_RSYNC = False

    # 初始化节点
    # 参数说明：
    # rpm_packages: 所需安装的软件包路径
    # force_clean: 是否强制清理 OBServer 节点工作目录，如果为 True，则工作目录会被清空并 kill 掉所有相关进程
    # configs: 集群配置项, 必须是 NodeConfig 类型的列表
    initialize_nodes(rpm_packages=pkgs, force_clean=True, configs=nodes_config)

    # 初始化完成
```

tab 不强制清空目标目录

```python
from obshell import initialize_nodes, start_obshell, NodeConfig

def init_nodes():
    pkgs = [
        "/root/download/oceanbase-ce-libs-4.2.5.0-100000052024102022.el7.x86_64.rpm",
        "/root/download/oceanbase-ce-4.2.5.0-100000052024102022.el7.x86_64.rpm",
        # 以上的两个软件包已经足够初始化 OceanBase 集群了，但为了后续运维方便建议同时安装下面两个软件包
        # utils 提供 ob_admin，在后续恢复中可以提供恢复窗口解析的能力
        "/root/download/oceanbase-ce-utils-4.2.5.0-100000052024102022.el7.x86_64.rpm",
        # 上文配置的 OceanBase 数据库 4.2.5.0 版本中已经包含了 obshell，但推荐使用最新版本的 obshell，所以这里单独安装了最新版本的 obshell
        "/root/download/obshell-4.2.4.3-12024110711.el7.x86_64.rpm",
    ]

    ips = [
        "10.10.10.1",
        "10.10.10.2",
        "10.10.10.3",
    ]
    work_dir = "/data/ob" # OceanBase 数据库的工作目录，不需要提前创建，初始化 OBServer 节点时会自动创建
    nodes_config = []
    for _, ip in enumerate(ips):
        node = NodeConfig(ip, work_dir)
        nodes_config.append(node)

    ## SDK 会自动判断是否使用 rsync，如果不使用 rsync，传输效率会比较低
    ## 使用 rsync 传输文件时，需要在 SDK 执行机器和目标机器之间配置免密登录，同时两边都需要安装 rsync
    ## 你可以通过以下方法关闭 rsync 传输，但是不推荐这么做
    # from obshell.ssh import USE_RSYNC
    # USE_RSYNC = False

    # 初始化节点
    # 参数说明：
    # rpm_packages: 所需要安装的软件包路径
    # force_clean: 是否强制清理 OBServer 节点工作目录，如果为 True，则工作目录会被清空并 kill 掉所有相关进程
    # configs: 集群配置项, 必须是 NodeConfig 类型的列表
    initialize_nodes(rpm_packages=pkgs, force_clean=False, configs=nodes_config)

    # 初始化完成
```

## 相关文档

通过 obshell-sdk-go 请求 API 方法的介绍可参见 [初始化节点](../../200.go/200.cluster-management/550.initialize-node-of-go.md)。
