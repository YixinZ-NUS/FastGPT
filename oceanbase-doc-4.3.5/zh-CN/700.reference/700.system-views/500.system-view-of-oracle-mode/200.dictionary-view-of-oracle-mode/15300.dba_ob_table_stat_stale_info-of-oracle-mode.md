|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|
|machine-translation||

# DBA_OB_TABLE_STAT_STALE_INFO

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.2.0 版本开始引入。</p>
</main>

## 功能描述

展示当前租户下自上次收集统计信息以来每个表发生的 DML 操作次数，以及当前统计信息是否已过期。

## 字段说明

| **字段** | **类型** | **是否为 NULL** | **描述** |
| --- | --- | --- | --- |
| OWNER | VARCHAR2(128) | NO | 表的所有者 |
| TABLE_NAME | VARCHAR2(128) | NO | 表名|
| PARTITION_NAME | VARCHAR2(128) | YES | 分区名。当分区表此列的值为 NULL 时，表示当前记录在表级别进行了汇总 |
| SUBPARTITION_NAME | VARCHAR2(128) | YES | 二级分区名。当二级分区表此列的值为 NULL 时，表示当前记录在表级别或分区级别进行了汇总 |
| LAST_ANALYZED_ROWS | NUMBER | YES | 上次收集统计信息时的行数。值为 NULL 表示没有收集过统计信息 |
| LAST_ANALYZED_TIME | TIMESTAMP(6) WITH LOCAL TIME ZONE | YES | 上次收集统计信息时的时间。值为 NULL 表示没有收集过统计信息 |
| INSERTS | NUMBER | NO | 从上次收集统计信息起发生了多少行的插入 |
| UPDATES | NUMBER | NO | 从上次收集统计信息起发生了多少行的更新 |
| DELETES | NUMBER | NO | 从上次收集统计信息起发生了多少行的删除 |
| STALE_PERCENT | NUMBER | NO | 判定统计信息过期的百分比 |
| IS_STALE | VARCHAR2(3) | NO | 统计信息是否过期。<ul><li>`YES` 表示过期<ul><li>当表收集过统计信息时，过期的条件为 `INSERTS + UPDATES + DELETES > LAST_ANALYZED_ROWS * STALE_PERCENT / 100`  </li><li>当表没有收集过统计信息时，过期的条件为 `INSERTS + UPDATES + DELETES > 0` </li></ul>  </li><li>`NO` 表示未过期 </li></ul>|

## 查询示例

查看本租户的表 `T_SUBPART` 自上次收集统计信息以来发生的 DML 操作次数及统计信息的过期情况。

```shell
obclient [SYS]> SELECT * FROM SYS.DBA_OB_TABLE_STAT_STALE_INFO WHERE TABLE_NAME='T_SUBPART';
```

查询结果如下：

```shell
+-------+------------+----------------+-------------------+--------------------+------------------------------+---------+---------+---------+---------------+----------+
| OWNER | TABLE_NAME | PARTITION_NAME | SUBPARTITION_NAME | LAST_ANALYZED_ROWS | LAST_ANALYZED_TIME           | INSERTS | UPDATES | DELETES | STALE_PERCENT | IS_STALE |
+-------+------------+----------------+-------------------+--------------------+------------------------------+---------+---------+---------+---------------+----------+
| SYS   | T_SUBPART  | NULL           | NULL              |               1000 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P1             | NULL              |                500 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P2             | NULL              |                300 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P3             | NULL              |                200 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P1             | P1SP0             |                150 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P1             | P1SP1             |                150 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P1             | P1SP2             |                100 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P1             | P1SP3             |                100 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P2             | P2SP0             |                 90 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P2             | P2SP1             |                 90 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P2             | P2SP2             |                 60 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P2             | P2SP3             |                 60 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P3             | P3SP0             |                 60 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P3             | P3SP1             |                 60 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P3             | P3SP2             |                 40 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
| SYS   | T_SUBPART  | P3             | P3SP3             |                 40 | 21-MAR-25 04.21.31.118193 PM |       0 |       0 |       0 |            10 | NO       |
+-------+------------+----------------+-------------------+--------------------+------------------------------+---------+---------+---------+---------------+----------+
16 rows in set
```