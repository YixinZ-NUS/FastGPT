|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|
|machine-translation||

# USER_AUDIT_TRAIL

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V2.2.77 版本开始引入。</p>
</main>

## 功能描述

视图 `USER_AUDIT_TRAIL` 用于展示与当前用户相关的标准审计跟踪条目。

  <main id="notice" >
    <h4>功能适用性</h4>
    <p>该视图仅适用于 OceanBase 数据库 Oracle 模式。</p>
  </main>

## 字段说明

|      **字段名称**      |           **类型**            | **是否可以为 NULL** |                         **描述**                         |
|--------------------|-----------------------------|----------------|--------------------------------------------------------|
| OS_USERNAME        | VARCHAR2(255)               | NO             | 目前暂不支持该字段，当前该字段默认为 NULL             |
| USERNAME           | VARCHAR2(64)                | NO             | 操作被审计的用户的名称                                            |
| USERHOST           | VARCHAR2(32)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                        |
| TERMINAL           | VARCHAR2(255)               | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                       |
| TIMESTAMP          | DATE                        | NO             | 在本地数据库会话时区中创建审计跟踪条目的日期和时间                              |
| OWNER              | VARCHAR2(64)                | YES            | 受行为影响的对象的创建者                                           |
| OBJ_NAME           | VARCHAR2(256)               | YES            | 受操作影响的对象的名称                                            |
| ACTION             | NUMBER(38)                  | NO             | 数字操作类型代码                                               |
| ACTION_NAME        | VARCHAR2(128)               | NO             | 与操作列中的数字代码对应的操作类型的名称                                   |
| NEW_OWNER          | VARCHAR2(64)                | YES            | 在 NEW_NAME 列中命名的对象的所有者                                 |
| NEW_NAME           | VARCHAR2(256)               | YES            | 在 RENAME 或基础对象的名称后对象的新名称                               |
| OBJ_PRIVILEGE      | VARCHAR2(255)               | NO             | 由 GRANT 或 REVOKE 语句授予或撤销的对象特权                  |
| SYS_PRIVILEGE      | VARCHAR2(255)               | NO             | 由 GRANT 或 REVOKE 语句授予或撤消的系统特权                  |
| ADMIN_OPTION       | VARCHAR2(1)                 | NO             | 指示是否使用 ADMIN 选项授予角色或系统特权                       |
| GRANTEE            | VARCHAR2(128)               | NO             | GRANT 或 REVOKE 中指定的授予者名称                       |
| AUDIT_OPTION       | VARCHAR2(40)                | NO             | AUDIT 语句设置的审计选项                                 |
| SES_ACTIONS        | VARCHAR2(19)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                                   |
| LOGOFF_TIME        | DATE                        | NO             | 用户注销的日期和时间                                             |
| LOGOFF_LREAD       | NUMBER(38)                  | NO             | 会话的逻辑读取                                                |
| LOGOFF_PREAD       | NUMBER                      | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                        |
| LOGOFF_LWRITE      | NUMBER                      | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                       |
| LOGOFF_DLOCK       | VARCHAR2(40)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                     |
| COMMENT_TEXT       | VARCHAR2(65536)             | YES            | 在审计跟踪条目上的文本注释，提供关于被审计的语句的更多信息                          |
| SESSIONID          | NUMBER(38)                  | NO             | 对于 V4.3.x 版本：<ul><li> V4.3.5 BP2 之前版本：<br>在所有连接方式（直连模式/ODP 模式）下，该字段均表示 Server Session ID。</li><li> V4.3.5 BP2 及之后版本：<ul><li>在直连模式下：<br>该字段表示 Server Session ID。</li> <li>在 ODP 模式下：</li><ul><li>当 ODP 中的配置项 <code>client_session_id_version = 2</code> 时，该字段表示 Client Session ID。 </li> <li>当 <code>client_session_id_version = 1</code> 时，该字段表示 Server Session ID。</li></ul></ul></li></ul>                                               |
| ENTRYID            | NUMBER(38)                  | NO             | 每个审计跟踪条目的数字 ID                                         |
| STATEMENTID        | NUMBER(38)                  | NO             | 每个语句的数字 ID                                             |
| RETURNCODE         | NUMBER(38)                  | NO             | 操作生成的错误代码                                              |
| PRIV_USED          | VARCHAR2(40)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                    |
| CLIENT_ID          | VARCHAR2(40)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                     |
| ECONTEXT_ID        | VARCHAR2(40)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                   |
| SESSION_CPU        | NUMBER(38)                  | NO             | 会话使用的 CPU 时间                                           |
| EXTENDED_TIMESTAMP | TIMESTAMP(6) WITH TIME ZONE | NO             | 在 UTC 时区中创建审计跟踪条目的时间戳                                  |
| PROXY_SESSIONID    | NUMBER(38)                  | NO             | 代理会话序列号                                                |
| GLOBAL_UID         | NUMBER(38)                  | NO             | 用户的全局用户标识符                                             |
| INSTANCE_NUMBER    | VARCHAR2(40)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL |
| OS_PROCESS         | VARCHAR2(40)                | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                   |
| TRANSACTIONID      | VARCHAR2(128)               | NO             | 在其中访问或修改对象的事务标识符                                       |
| SCN                | NUMBER(38)                  | NO             | 目前暂不支持该字段，当前该字段默认为 0                     |
| SQL_BIND           | VARCHAR2(2000)              | YES            | 目前暂不支持该字段，当前该字段默认为 NULL                      |
| SQL_TEXT           | VARCHAR2(2000)              | YES            | 查询的 SQL 文本                                             |
| OBJ_EDITION_NAME   | VARCHAR2(128)               | NO             | 目前暂不支持该字段，当前该字段默认为 NULL                  |
| DBID               | NUMBER(38)                  | NO             | 被审计数据库的数据库标识符                                          |

## 查询示例

查看当前用户的所有审计跟踪条目。

```shell
obclient [SYS]> SELECT USERNAME, USERHOST, TIMESTAMP, ACTION, SQL_TEXT FROM SYS.USER_AUDIT_TRAIL;
```

查询结果如下：

```shell
+----------+----------------+-----------+--------+----------+
| USERNAME | USERHOST       | TIMESTAMP | ACTION | SQL_TEXT |
+----------+----------------+-----------+--------+----------+
| SYS      | 100.xx.xxx.xxx | 08-APR-25 |    100 | CONNECT  |
| SYS      | 100.xx.xxx.xxx | 08-APR-25 |    100 | CONNECT  |
| SYS      | 100.xx.xxx.xxx | 08-APR-25 |    100 | CONNECT  |
+----------+----------------+-----------+--------+----------+
3 rows in set
```

## 相关视图或文档

* 查看当前租户下的所有审计跟踪条目：[DBA_AUDIT_TRAIL](7200.dba_audit_trail-of-oracle-mode.md)

* 查看审计记录中 action id 和对应的名称：[AUDIT_ACTIONS](6500.audit_actions-of-oracle-mode.md)

* 查看 `AUDIT EXISTS` 和 `AUDIT NOT EXISTS` 产生的审计跟踪条目：[DBA_AUDIT_EXISTS](6800.dba_audit_exists-of-oracle-mode.md)

* 查看对所有对象的审计跟踪条目：

  * [DBA_AUDIT_OBJECT](6900.dba_audit_object-of-oracle-mode.md)

  * [USER_AUDIT_OBJECT](25100.user_audit_object-of-oracle-mode.md)

* 查看对 `CONNECT` 和 `DISCONNECT` 的审计跟踪条目：

  * [DBA_AUDIT_SESSION](7000.dba_audit_session-of-oracle-mode.md)

  * [USER_AUDIT_SESSION](25200.user_audit_session-of-oracle-mode.md)

* 查看对 `GRANT`、`REVOKE`、`AUDIT`、`NOAUDIT` 和 `ALTER SYSTEM` 语句的审计跟踪条目：

  * [DBA_AUDIT_STATEMENT](7100.dba_audit_statement-of-oracle-mode.md)

  * [USER_AUDIT_STATEMENT](25300.user_audit_statement-of-oracle-mode.md)

* 有关安全审计相关的介绍及操作，参见以下文档：

  * [开启审计](../../../../600.manage/500.security-and-permissions/600.security-audit/300.security-audit-of-oracle-mode/200.audit-open-of-oracle-mode.md)
  * [设置和查看审计规则](../../../../600.manage/500.security-and-permissions/600.security-audit/300.security-audit-of-oracle-mode/300.set-up-and-view-audit-rules-of-oracle-mode.md)
  * [查看审计记录](../../../../600.manage/500.security-and-permissions/600.security-audit/300.security-audit-of-oracle-mode/500.audit-records-of-oracle-mode.md)
  * [审计用户登录](../../../../600.manage/500.security-and-permissions/600.security-audit/300.security-audit-of-oracle-mode/600.audit-user-logon-of-oracle-mode.md)
  * [审计用户操作](../../../../600.manage/500.security-and-permissions/600.security-audit/300.security-audit-of-oracle-mode/700.audit-user-operations-of-oracle-mode.md)