|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|Oracle Mode|
|machine-translation||

# GV$OB_LOCKS

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>该视图从 V4.2.0 版本开始引入。</p>
</main>

## 功能描述

视图 `GV$OB_LOCKS` 用于显示当前用户各表持锁或请求锁的情况。

## 字段说明

| **字段** | **类型** | **是否为 NULL** | **描述** |
| ---- | ---- | ---- | ---- |
| SVR_IP | VARCHAR2(46) | NO | 持锁或请求锁的 OBServer 节点的 IP 地址 |
| SVR_PORT | NUMBER(38) | NO | 持锁或请求锁的 OBServer 节点的端口号 |
| TENANT_ID | NUMBER(38) | NO | 持锁或请求锁的租户的 ID |
| TRANS_ID | NUMBER(38) | NO | 持锁或请求锁的事务 ID |
| SESSION_ID | NUMBER(38)    | NO   | 持锁或请求锁的会话 ID<ul><li>在 V4.3.x 版本中，该字段从 V4.3.2 版本开始引入。<ul><li> V4.3.5 BP2 之前版本：<br>在所有连接方式（直连模式/ODP 模式）下，该字段均表示 Server Session ID。</li><li> V4.3.5 BP2 及之后版本：<ul><li>在直连模式下：<br>该字段表示 Server Session ID。</li> <li>在 ODP 模式下：</li><ul><li>当 ODP 中的配置项 <code>client_session_id_version = 2</code> 时，该字段表示 Client Session ID。 </li> <li>当 <code>client_session_id_version = 1</code> 时，该字段表示 Server Session ID。</li></ul></ul></li></ul> </li><li>在 V4.2.x 版本中，该字段从 V4.2.5 版本开始引入。在所有连接方式（直连模式/ODP 模式）下，该字段均表示 Server Session ID。 </li></ul> |
| TYPE | VARCHAR2(9) | NO | 锁类型：<ul><li>TM：表锁</li><li>TX：事务锁</li><li>TR：行锁</li></ul> |
| ID1 | bigint(20) | NO | 锁标识符 1：<ul><li>TM：事务 ID</li><li>TX：事务 ID</li><li>TR：事务 ID</li></ul> |
| ID2 | bigint(20) | NO | 锁标识符 2：<ul><li>TM：会话 ID（对事务外表锁，为 NULL）</li><li>TX：会话 ID</li><li>TR：会话 ID</li></ul> |
| ID3 | varchar(512) | NO | 锁标识符 3：<ul><li>TM：TABLE_ID / TABLET_ID</li><li>TX：NULL</li><li>TR：TABLET_ID + 行 rowkey</li></ul> <main id="notice" type='explain'><h4>说明</h4><p><ul><li>在 V4.3.x 版本中，该字段从 V4.3.2 版本开始引入。</li><li>在 V4.2.x 版本中，该字段从 V4.2.5 版本开始引入。</li></ul></p></main>|
| LMODE | VARCHAR2(4) | NO | 当前持有锁的模式：<ul><li>NONE：表示未持有任何锁</li><li>RS：ROW SHARE</li><li>RX：ROW EXCLUSIVE</li><li>S：SHARE</li><li>SRX：SHARE ROW EXCLUSIVE</li><li>X：EXCLUSIVE</li></ul> |
| REQUEST | VARCHAR2(8) | NO | 当前请求锁的模式：<ul><li>NONE：表示未请求任何锁 </li><li>RS：ROW SHARE  </li><li>RX：ROW EXCLUSIVE  </li><li>S：SHARE  </li><li>SRX：SHARE ROW EXCLUSIVE  </li><li>X：EXCLUSIVE  </li></ul>|
| CTIME | NUMBER(38) | NO | 持有或等待锁的时间，单位为微秒 |
| BLOCK | NUMBER | NO |表示当前事务请求的锁是否被其他事务持有：<ul><li>0：表示请求的锁未被其他事务持有，即该事务持有锁  </li><li>1:  表示请求的锁被其他事务持有，即该事务被阻塞 </li></ul>|

## 查询示例

查看当前用户各表持锁或请求锁的情况。

```shell
obclient [SYS]> SELECT * FROM SYS.GV$OB_LOCKS;
```

查询结果如下：

```shell
+----------------+----------+-----------+----------+------------+------+---------+------------+--------+-------+---------+----------+-------+
| SVR_IP         | SVR_PORT | TENANT_ID | TRANS_ID | SESSION_ID | TYPE | ID1     | ID2        | ID3    | LMODE | REQUEST | CTIME    | BLOCK |
+----------------+----------+-----------+----------+------------+------+---------+------------+--------+-------+---------+----------+-------+
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 500084 | X     | NONE    | 97318270 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200069 | X     | NONE    | 97301357 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200068 | X     | NONE    | 97301364 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200067 | X     | NONE    | 97301372 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200066 | X     | NONE    | 97301379 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200065 | X     | NONE    | 97301389 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200064 | X     | NONE    | 97301396 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200063 | X     | NONE    | 97301403 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200062 | X     | NONE    | 97301431 |     0 |
| 11.xxx.xxx.xxx |    28825 |      1004 |  3966849 | 3221605368 | TM   | 3966849 | 3221605368 | 200061 | X     | NONE    | 97301442 |     0 |
+----------------+----------+-----------+----------+------------+------+---------+------------+--------+-------+---------+----------+-------+
10 rows in set
```

## 相关视图或文档

有关表锁的详细操作及介绍，参见 [锁表](../../../300.database-object-management/200.manage-object-of-oracle-mode/100.manage-tables-of-oracle-mode/900.lock-a-table-of-oracle-mode.md)。