|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# oceanbase.CDB_OB_ARCHIVELOG_PIECE_FILES

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.0.0 版本开始引入。</p>
</main>

## 功能描述

展示所有租户备份集中 Piece 的状态。

## 字段说明

| 字段名称 | 类型 | 是否可以为 NULL | 描述 |
| --- | --- | --- | --- |
| TENANT_ID | bigint(20) | NO | 租户 ID |
| DEST_ID | bigint(20) | NO | 路径编号，系统对于每一个设置的路径都会分配一个唯一 ID |
| ROUND_ID | bigint(20) | NO | 用于标识第几轮完整的 Clog 备份数据流 |
| PIECE_ID | bigint(20) | NO | 备份日志分片的 ID |
| INCARNATION | bigint(20) | NO | 表示 Flashback Database 后的第几次分身 |
| DEST_NO | bigint(20) | NO | 标识 log_archive_dest_n，例如：log_archive_dest 的 dest_no 是 0，log_archive_dest_1 的 dest_no 是 1 等 |
| STATUS | varchar(64) | NO | 切 Piece 的状态：<ul><li>ACTIVE：当前活跃的 Piece</li><li>FREEZING：正在冻结的 Piece</li><li>FROZEN：已经冻结的 Piece，此状态后，该 Piece 的状态不会再修改了</li></ul> |
| START_SCN | bigint(20) unsigned | NO | Piece 实际开始位点 |
| START_SCN_DISPLAY | varchar(26) | NO | 将 START_SCN 转换成时间单位之后的展示 |
| CHECKPOINT_SCN | bigint(20) unsigned | NO | 当前归档位点 |
| CHECKPOINT_SCN_DISPLAY | varchar(26) | NO | 将 CHECKPOINT_SCN 转换成时间单位之后的展示 |
| MAX_SCN | bigint(20) unsigned | NO | 最大归档位点 |
| END_SCN | bigint(20) unsigned | NO | Piece 理论上的结束位点 |
| COMPATIBLE | bigint(20) | NO | 日志归档的兼容版本号 |
| UNIT_SIZE   | bigint(20)   | NO   | 日志归档数据单次压缩或加密的日志块大小，当前暂不支持该字段    |
| COMPRESSION | varchar(128) | NO   | 压缩算法：<ul><li> none: 表示不压缩 </li><li> lz4_1.0：表示使用压缩算法 lz4_1.0 </li><li>zstd_1.3.8：表示使用压缩算法 zstd_1.3.8</li>当前暂不支持该字段    |
| INPUT_BYTES | bigint(20) | NO | 原始数据量，单位为字节 |
| INPUT_BYTES_DISPLAY | varchar(27) | NO | 将 INPUT_BYTES 转换单位之后的展示 |
| OUTPUT_BYTES | bigint(20) | NO | 加密、压缩之后的有效数据量，单位为字节 |
| OUTPUT_BYTES_DISPLAY | varchar(27) | NO | 将 OUTPUT_BYTES 转换单位之后的展示 |
| COMPRESSION_RATIO | decimal(23,2) | NO | 压缩比 |
| FILE_STATUS | varchar(64) | NO | 备份日志分片的文件状态：<ul><li>AVAILABLE：表示有效的备份，可以用于恢复</li><li>COPYING：表示日志文件正在备份中</li><li>INCOMPELTE：表示 Piece 下的日志不完整，缺少一些日志流的日志</li><li>DELETING：日志文件正在删除</li><li>EXPIRED: 表示备份文件已失效</li><li>BROKEN：备份的文件不完整，不可使用</li><li>DELETED：日志文件已删除</li></ul> |
| PATH | varchar(2048) | NO | 归档路径 |

## 查询示例

系统租户查看租户 ID 为 1002 的租户的备份集中 Piece 的状态。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_ARCHIVELOG_PIECE_FILES WHERE TENANT_ID = 1002\G
```

查询结果如下：

```shell
*************************** 1. row ***************************
             TENANT_ID: 1002
               DEST_ID: 1001
              ROUND_ID: 1
              PIECE_ID: 1
           INCARNATION: 1
               DEST_NO: 0
                STATUS: ACTIVE
             START_SCN: 1736228322307513000
     START_SCN_DISPLAY: 2025-01-07 13:38:42.307513
        CHECKPOINT_SCN: 1736233365380528000
CHECKPOINT_SCN_DISPLAY: 2025-01-07 15:02:45.380528
               MAX_SCN: 1736233365682585000
               END_SCN: 1736314722307513000
       END_SCN_DISPLAY: 2025-01-08 13:38:42.307513
            COMPATIBLE: 1
             UNIT_SIZE: 1
           COMPRESSION: none
           INPUT_BYTES: 84860528
   INPUT_BYTES_DISPLAY: 80.93MB
          OUTPUT_BYTES: 84860528
  OUTPUT_BYTES_DISPLAY: 80.93MB
     COMPRESSION_RATIO: 1.00
           FILE_STATUS: AVAILABLE
                  PATH: file:///home/admin/oceanbase/arglog
1 row in set
```

## 相关视图或文档

有关 Piece 的详细介绍，参见 [日志归档概述](../../../../600.manage/600.backup-and-recovery/300.log-archive/100.overview-of-log-archive.md)。