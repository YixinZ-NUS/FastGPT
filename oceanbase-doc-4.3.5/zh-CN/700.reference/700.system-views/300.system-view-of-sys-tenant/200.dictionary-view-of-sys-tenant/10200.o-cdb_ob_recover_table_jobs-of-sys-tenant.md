|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# oceanbase.CDB_OB_RECOVER_TABLE_JOBS

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>该视图从 V4.2.1 版本开始引入。</p>
</main>

## 功能描述

展示整个表级恢复任务相关信息。表级恢复的整个过程包括辅助租户的恢复操作和跨租户的导入操作。该视图对应两条任务记录：一条 `sys` 租户的任务记录和一条目标用户租户自身的任务记录。其中：

* `sys` 租户的任务记录主要记录目标用户租户的表级恢复的进度。当目标租户的整个表级恢复任务结束，则表示该任务结束。

* 目标用户租户自身的任务记录包括辅助租户的恢复进度和表导入任务的进度。当辅助租户的恢复任务和表的导入任务均结束，则表示该任务结束。

## 字段说明

| **字段** | **类型** | **是否为 NULL** | **描述** |
| --- | --- | --- | --- |
| TENANT_ID | bigint(20) | NO | 任务租户 ID |
| JOB_ID | bigint(20) | NO | 任务 ID |
| INITIATOR_TENANT_ID | bigint(20) | NO | 父任务的租户 ID |
| INITIATOR_JOB_ID | bigint(20) | NO | 父任务所属的 JOB ID |
| START_TIMESTAMP | timestamp(6) | NO | 任务开始时租户当前时间 |
| FINISH_TIMESTAMP | timestamp(6) | NO | 任务完成时租户当前时间 |
| STATUS | varchar(64) | NO | 任务状态，包含：<ul><li>PREPARE: 任务初始化阶段  </li><li>RECOVERING：恢复中 </li><li>RESTORE_AUX_TENANT：恢复辅助租户 </li><li>PRECHECK_IMPORT： 导入前检查 </li><li>GEN_IMPORT_JOB：导入任务初始化 </li><li>IMPORTING：表导入中 </li><li> CANCELING：任务取消中</li><li>COMPLETED：任务完成 </li><li>FAILED：任务失败 </li></ul> |
| AUX_TENANT_NAME | varchar(64) | NO | 辅助租户名 |
| TARGET_TENANT_NAME | varchar(64) | NO | 标识目标租户名 |
| IMPORT_ALL | tinyint(4) | NO | 是否导入整个租户下所有的表。仅当用户指定 `RECOVER TABLE *.*` 时，该值为 1，其他场景值均为 0 |
| DB_LIST | longtext | YES | 要完整恢复的库 |
| TABLE_LIST | longtext | YES | 要恢复的表 |
| RESTORE_SCN | bigint(20) unsigned | NO | 用户指定的恢复位点 |
| RESTORE_SCN_DISPLAY | datetime(6) | NO | 用户指定的恢复位点的时间戳表示 |
| RESTORE_OPTION | varchar(4096) | NO | 辅助租户依赖的 restore_option 参数 |
| BACKUP_DEST | varchar(4096) | NO | 备份和归档路径 |
| BACKUP_SET_LIST | longtext | NO | 数据备份路径 |
| BACKUP_PIECE_LIST | longtext | NO | 日志归档路径 |
| BACKUP_PASSWD | varchar(4096) | YES | 备份集密码 |
| EXTERNAL_KMS_INFO | varchar(4096) | YES | 如果源租户有设置秘钥托管，需通过session配置此项。 |
| REMAP_DB_LIST | longtext | YES | 重命名的库。格式如下：db1:new_db1, db2:newdb2 |
| REMAP_TABLE_LIST | longtext | YES | 重命名的表。格式如下：db1.t1:new_t1, db1.t2:db2.new_t2 |
| REMAP_TABLEGROUP_LIST | longtext | YES | 重映射表组的列表，可以将表从原始表组重新映射到目标表组。格式如下：tg1:new_tg1, tg2:new_tg2 |
| REMAP_TABLESPACE_LIST | longtext | YES | 重映射表空间的列表，可以将表从原始表空间重新映射到目标表空间。格式如下：ts1:new_ts1, ts2:new_ts2 |
| RESULT | varchar(64) | YES | 表级恢复任务的结果：<ul><li>SUCCESS  </li><li>FAIL </li></ul> |
| COMMENT | longtext | YES | 备注信息 |
| DESCRIPTION | longtext | YES | 恢复命令里指定的 DESCRIPTION 信息 |

## 查询示例

表级恢复过程中，系统租户下查看整个表级恢复任务的相关信息。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.CDB_OB_RECOVER_TABLE_JOBS\G
```

查询结果如下：

```shell
*************************** 1. row ***************************
            TENANT_ID: 1
               JOB_ID: 1
  INITIATOR_TENANT_ID: 1
     INITIATOR_JOB_ID: 0
      START_TIMESTAMP: 2025-01-07 16:07:33.965561
     FINISH_TIMESTAMP: NULL
               STATUS: RECOVERING
      AUX_TENANT_NAME: AUX_RECOVER$1736237253959061
   TARGET_TENANT_NAME: mysql001
           IMPORT_ALL: 0
              DB_LIST:
           TABLE_LIST: `infotest`.`t2`
          RESTORE_SCN: 1736237207609421000
  RESTORE_SCN_DISPLAY: 2025-01-07 16:06:47.609421
       RESTORE_OPTION: pool_list=rptest
          BACKUP_DEST: file:///home/admin/oceanbase/arglog,file:///home/admin/oceanbase/backupdata
      BACKUP_SET_LIST: file:///home/admin/oceanbase/backupdata/backup_set_4_full
    BACKUP_PIECE_LIST: file:///home/admin/oceanbase/arglog/piece_d1001r1p1
        BACKUP_PASSWD: NULL
    EXTERNAL_KMS_INFO: NULL
        REMAP_DB_LIST:
     REMAP_TABLE_LIST: `infotest`.`t2`:`infotest`.`newtb2`
REMAP_TABLEGROUP_LIST:
REMAP_TABLESPACE_LIST:
               RESULT:
              COMMENT:
          DESCRIPTION: NULL
*************************** 2. row ***************************
            TENANT_ID: 1002
               JOB_ID: 5
  INITIATOR_TENANT_ID: 1
     INITIATOR_JOB_ID: 1
      START_TIMESTAMP: 2025-01-07 16:07:33.965561
     FINISH_TIMESTAMP: NULL
               STATUS: RESTORE_AUX_TENANT
      AUX_TENANT_NAME: AUX_RECOVER$1736237253959061
   TARGET_TENANT_NAME: mysql001
           IMPORT_ALL: 0
              DB_LIST:
           TABLE_LIST: `infotest`.`t2`
          RESTORE_SCN: 1736237207609421000
  RESTORE_SCN_DISPLAY: 2025-01-07 16:06:47.609421
       RESTORE_OPTION: pool_list=rptest
          BACKUP_DEST: file:///home/admin/oceanbase/arglog,file:///home/admin/oceanbase/backupdata
      BACKUP_SET_LIST: file:///home/admin/oceanbase/backupdata/backup_set_4_full
    BACKUP_PIECE_LIST: file:///home/admin/oceanbase/arglog/piece_d1001r1p1
        BACKUP_PASSWD: NULL
    EXTERNAL_KMS_INFO: NULL
        REMAP_DB_LIST:
     REMAP_TABLE_LIST: `infotest`.`t2`:`infotest`.`newtb2`
REMAP_TABLEGROUP_LIST:
REMAP_TABLESPACE_LIST:
               RESULT:
              COMMENT:
          DESCRIPTION: NULL
2 rows in set
```

## 相关视图或文档

查看表级恢复任务进度的详细操作及说明，参见 [查看表级恢复进度](../../../../600.manage/600.backup-and-recovery/700.recover-table/400.view-the-table-recovery-progress.md)。