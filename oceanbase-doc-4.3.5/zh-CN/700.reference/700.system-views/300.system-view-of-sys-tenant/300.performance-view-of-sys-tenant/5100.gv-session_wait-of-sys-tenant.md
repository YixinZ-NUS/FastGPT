|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# GV$SESSION_WAIT

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>该视图从 V1.4 版本开始引入。</p>
</main>

## 功能描述

视图 `GV$SESSION_WAIT` 用于展示所有节点上所有 Session 的当前或者上一次等待事件的一些信息，包括等待事件名称、等待耗时等。

## 字段说明

| **字段名称** | **类型** | **是否可以为 NULL** | **描述** |
| ---- | ---- | ---- | ---- |
| SID | bigint(20) | NO | 对于 V4.3.x 版本：<ul><li> V4.3.5 BP2 之前版本：<br>在所有连接方式（直连模式/ODP 模式）下，该字段均表示 Server Session ID。</li><li> V4.3.5 BP2 及之后版本：<ul><li>在直连模式下：<br>该字段表示 Server Session ID。</li> <li>在 ODP 模式下：</li><ul><li>当 ODP 中的配置项 <code>client_session_id_version = 2</code> 时，该字段表示 Client Session ID。 </li> <li>当 <code>client_session_id_version = 1</code> 时，该字段表示 Server Session ID。</li></ul></ul></li></ul>  |
| CON_ID | bigint(20) | NO | 租户 ID |
| SVR_IP | varchar(46) | NO | 服务器的 IP |
| SVR_PORT | bigint(20) | NO | 服务器端口 |
| EVENT | varchar(64) | NO | 等待事件名称 |
| P1TEXT | varchar(64) | NO | 等待事件的第一个参数的描述 |
| P1 | bigint(20) unsigned | NO | 等待事件的第一个参数的值 |
| P2TEXT | varchar(64) | NO | 等待事件的第二个参数的描述 |
| P2 | bigint(20) unsigned | NO | 等待事件的第二个参数的值 |
| P3TEXT | varchar(64) | NO | 等待事件的第三个参数的描述 |
| P3 | bigint(20) unsigned | NO | 等待事件的第三个参数的值 |
| WAIT_CLASS_ID | bigint(20) | NO | 等待事件的类别 ID |
| WAIT_CLASS# | bigint(20) | NO | 等待事件的类别序号 |
| WAIT_CLASS | varchar(64) | NO | 等待事件的类别名称 |
| STATE | varchar(19) | NO | 当前等待事件的状态，包含四种状态：<li>Waiting：Session 正等待这个事件<li>Waited unknown time：由于设置了 timed_statistics 值为 false，导致不能得到时间信息。表示发生了等待，但时间很短<li>Wait short time：表示发生了等待，但由于时间非常短不超过一个时间单位，所以没有记录<li>Waited known time：如果 Session 等待然后得到了所需资源，那么将从 waiting 进入本状态 |
| WAIT_TIME_MICRO | bigint(20) | NO | 等待时间，单位为微秒。如果当前正在等待，表示已经等待的时长；如果当前没有等待，表示最后一次等待的总等待时长 |
| TIME_REMAINING_MICRO | bigint(20) | NO |<li>> 0：最后一次等待时间（单位：微秒），当前未在等待状态<li>0：Session 正在等待当前的事件<li>-1：最后一次等待时间小于 1 个统计单位，当前未在等待状态<li>-2：时间统计状态未置为可用，当前未在等待状态 |
| TIME_SINCE_LAST_WAIT_MICRO | bigint(20) | NO | 上一次等待结束到现在的时间，单位为微秒，如果当前正在等待，其值为 0 |

## 查询示例

查询所有节点上所有 Session 的当前或者上一次等待事件的一些信息。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.GV$SESSION_WAIT LIMIT 1\G
```

查询结果如下：

```shell
*************************** 1. row ***************************
                       SID: 3221608040
                    CON_ID: 1
                    SVR_IP: xx.xx.xx.xx
                  SVR_PORT: 2882
                     EVENT: wait in request queue
                    P1TEXT: pcode
                        P1: 0
                    P2TEXT: level
                        P2: 0
                    P3TEXT: priority
                        P3: 0
             WAIT_CLASS_ID: 102
               WAIT_CLASS#: 2
                WAIT_CLASS: CONFIGURATION
                     STATE: WAITED SHORT TIME
           WAIT_TIME_MICRO: 12
      TIME_REMAINING_MICRO: -1
TIME_SINCE_LAST_WAIT_MICRO: -360944228277398966
```