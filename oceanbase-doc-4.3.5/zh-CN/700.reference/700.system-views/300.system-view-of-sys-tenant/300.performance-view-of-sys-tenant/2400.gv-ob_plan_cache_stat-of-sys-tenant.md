|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||
|machine-translation||

# GV$OB_PLAN_CACHE_STAT

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.0.0 版本开始引入。</p>
</main>

## 功能描述

展示所有租户在所有 OBServer 节点上的每个计划缓存的整体状态。

## 字段说明

|     字段名称     |     类型      | 是否可以为 NULL |                描述                 |
|--------------|-------------|------------|-----------------------------------|
| TENANT_ID    | bigint(20)  | NO         | 租户 ID                             |
| SVR_IP       | varchar(46) | NO         | 服务器的 IP 地址                        |
| SVR_PORT     | bigint(20)  | NO         | 端口号                               |
| SQL_NUM      | bigint(20)  | NO         | plan_cache 涉及 SQL 条数              |
| MEM_USED     | bigint(20)  | NO         | plan_cache 已经使用的内存                |
| MEM_HOLD     | bigint(20)  | NO         | plan_cache 持有的内存                  |
| ACCESS_COUNT | bigint(20)  | NO         | 查询访问 plan_cache 的次数                |
| HIT_COUNT    | bigint(20)  | NO         | 命中 plan_cache 的次数                 |
| HIT_RATE     | bigint(20)  | NO         | plan_cache 的命中率                   |
| PLAN_NUM     | bigint(20)  | NO         | plan 的个数                          |
| MEM_LIMIT    | bigint(20)  | NO         | plan_cache 的内存上限，单位为字节                  |
| HASH_BUCKET  | bigint(20)  | NO         | plan_cache hash map 中的 Bucket 的个数 |
| STMTKEY_NUM  | bigint(20)  | NO         | plan_cache 中 stmt_key 的个数         |

## 查询示例

系统租户下，查看所有租户在所有节点上的计划缓存的整体状态。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.GV$OB_PLAN_CACHE_STAT;
```

查询结果如下：

```shell
+-----------+----------------+----------+---------+------------+-----------+--------------+-----------+----------+----------+-----------+-------------+-------------+
| TENANT_ID | SVR_IP         | SVR_PORT | SQL_NUM | MEM_USED   | MEM_HOLD  | ACCESS_COUNT | HIT_COUNT | HIT_RATE | PLAN_NUM | MEM_LIMIT | HASH_BUCKET | STMTKEY_NUM |
+-----------+----------------+----------+---------+------------+-----------+--------------+-----------+----------+----------+-----------+-------------+-------------+
|         1 | 11.xxx.xxx.xxx |    28825 |     383 | -487995042 | 136499200 |     42006732 |  41977955 |       99 |      383 | 161061270 |       49157 |           0 |
|      1001 | 11.xxx.xxx.xxx |    28825 |     197 | -563375074 |  47575040 |     23662632 |  23631074 |       99 |      197 |  53687090 |       49157 |           0 |
|      1002 | 11.xxx.xxx.xxx |    28825 |     460 |    5760423 |  75497472 |      4825830 |   4822364 |       99 |      460 | 214748360 |       49157 |           0 |
|      1003 | 11.xxx.xxx.xxx |    28825 |     132 | -585128658 |  41943040 |     23658450 |  23624490 |       99 |      132 |  53687090 |       49157 |           0 |
|      1004 | 11.xxx.xxx.xxx |    28825 |     476 |   12579810 |  88080384 |      5378059 |   5374230 |       99 |      476 | 214748360 |       49157 |           0 |
|      1005 | 11.xxx.xxx.xxx |    28825 |     154 | -546485963 |  33554432 |     22695250 |  22665728 |       99 |      154 |  53687090 |       49157 |           0 |
|      1006 | 11.xxx.xxx.xxx |    28825 |     348 |    -840236 |  60817408 |      4627947 |   4624894 |       99 |      348 | 214748360 |       49157 |           0 |
+-----------+----------------+----------+---------+------------+-----------+--------------+-----------+----------+----------+-----------+-------------+-------------+
7 rows in set
```

## 相关视图或文档

[V$OB_PLAN_CACHE_STAT](32800.v-ob_plan_cache_stat-of-sys-tenant.md)