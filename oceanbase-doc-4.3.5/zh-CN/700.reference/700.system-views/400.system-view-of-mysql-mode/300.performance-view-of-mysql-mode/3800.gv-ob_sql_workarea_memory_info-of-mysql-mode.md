|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|
|machine-translation||

# GV$OB_SQL_WORKAREA_MEMORY_INFO

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V2.2.77 版本开始引入。</p>
</main>

## 功能描述

展示所有 OBServer 节点上 SQL Workarea 总体的一些信息，如最大可用内存、当前使用内存、当前 hold 内存等。通过该视图可以知道当前租户下，Workarea 的使用情况，包括内存利用率等。

## 字段说明

|        **字段名称**        |   **类型**   | **是否可以为 NULL** |                                                         **描述**                                                         |
|------------------------|------------|----------------|------------------------------------------------------------------------------------------------------------------------|
| MAX_WORKAREA_SIZE      | bigint(20) | NO             | 最大 Workarea 内存，由参数决定可以使用多少内存，单位为字节         |
| WORKAREA_HOLD_SIZE     | bigint(20) | NO             | workarea 当前 hold 内存大小，单位为字节 <main id="notice" type='explain'><h4>说明</h4><p>>由于具体的使用量无法从内存管理模块获取到，故只能获取 hold 值。</p></main>    |
| MAX_AUTO_WORKAREA_SIZE | bigint(20) | NO             | auto 时，预计最大可用内存大小，单位为字节。可以简单认为最大可用内存会根据公式 `max_work_area_size - hold + total_mem_used` 进行计算得到，表示当前 Workarea 情况下，auto 管理的最大内存大小 |
| MEM_TARGET             | bigint(20) | NO             | 当前 Workarea 可用内存的目标大小，单位为字节。与 max_auto_work_area 的区别在于该值是 max_auto_work_area 值的一定比例                                          |
| TOTAL_MEM_USED         | bigint(20) | NO             | 当前 auto 内存使用大小，单位为字节。这里是由 SQL 自动内存管理模块统计的大小，不是真正使用大小                                                                         |
| GLOBAL_MEM_BOUND       | bigint(20) | NO             | auto 模式下，全局最大可用内存大小，单位为字节                 |
| DRIFT_SIZE             | bigint(20) | NO             | 当前需求内存变化大小，单位为字节。主要用来统计波动值，当波动达到一定范围，会自动触发重新计算 global bound size                                                                     |
| WORKAREA_COUNT         | bigint(20) | NO             | 注册的 operator profile 个数             |
| MANUAL_CALC_COUNT      | bigint(20) | NO             | 非定时触发的计算 global bound size 次数       |
| TENANT_ID                 | bigint(20) | NO             | 租户 ID                                    |
| SVR_IP                 | varchar(46)   | NO             | 服务器 IP 地址                   |
| SVR_PORT                 | bigint(20)   | NO             | 服务器端口号                   |

## 查询示例

用户租户下，查询本租户在所有 OBServer 节点上的 SQL Workarea 信息。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.GV$OB_SQL_WORKAREA_MEMORY_INFO;
```

查询结果如下：

```shell
+-------------------+--------------------+------------------------+------------+----------------+------------------+------------+----------------+-------------------+-----------+----------------+----------+
| MAX_WORKAREA_SIZE | WORKAREA_HOLD_SIZE | MAX_AUTO_WORKAREA_SIZE | MEM_TARGET | TOTAL_MEM_USED | GLOBAL_MEM_BOUND | DRIFT_SIZE | WORKAREA_COUNT | MANUAL_CALC_COUNT | TENANT_ID | SVR_IP         | SVR_PORT |
+-------------------+--------------------+------------------------+------------+----------------+------------------+------------+----------------+-------------------+-----------+----------------+----------+
|         214748364 |                  0 |              214748364 |  214748364 |              0 |         26843545 |          0 |              0 |              1166 |      1002 | 11.xxx.xxx.xxx |    28825 |
+-------------------+--------------------+------------------------+------------+----------------+------------------+------------+----------------+-------------------+-----------+----------------+----------+
1 row in set
```