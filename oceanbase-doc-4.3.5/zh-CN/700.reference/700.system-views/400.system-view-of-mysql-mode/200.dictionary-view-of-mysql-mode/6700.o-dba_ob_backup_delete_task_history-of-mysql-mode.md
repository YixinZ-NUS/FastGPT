|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|
|machine-translation||

# oceanbase.DBA_OB_BACKUP_DELETE_TASK_HISTORY

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.0.0 版本开始引入。</p>
</main>

## 功能描述

展示本租户下已完成的 `backup_set`/`backup_piece` 清理任务的历史信息。

## 字段说明

| 字段名称 | 类型 | 是否可以为 NULL | 描述 |
| --- | --- | --- | --- |
| TASK_ID | bigint(20) | NO | 任务组 ID，用于标识一组任务 |
| INCARNATION | bigint(20) | NO | 分身 ID |
| JOB_ID | bigint(20) | NO | 任务 ID，对应 JOB 表 |
| TASK_TYPE | varchar(64) | NO | 任务类型：<ul><li>`BACKUP SET`：清理 `backup_set`</li><li>`BACKUP PIECE`：清理 `backup_piece`</li></ul> |
| ID | bigint(20) | NO | 任务 ID，包括：backup_set、piece |
| ROUND_ID | bigint(20) | NO | piece 所属的 dest_round_id，对于 backup_set 的清理，ROUND_ID 为 0 |
| DEST_ID | bigint(20) | NO | 备份目的端的 DEST_ID |
| START_TIMESTAMP | timestamp(6) | NO | 任务开始时间 |
| END_TIMESTAMP | timestamp(6) | NO | 任务结束时间 |
| STATUS | varchar(64) | NO | 任务状态：<ul><li>`INIT`：任务初始化阶段 </li><li>`DOING`：任务执行阶段 </li><li>`CANCELING`：任务被取消阶段 </li><li>`COMPLETED`：任务执行成功 </li><li>`FAILED`：任务执行失败 </li><li>`CANCELED`：任务成功被取消 </li></ul> |
| TOTAL_LS_COUNT | bigint(20) | YES | 任务下的日志流数目 |
| FINISH_LS_COUNT | bigint(20) | YES | 成功的日志流任务数目 |
| RESULT | bigint(20) | YES | 错误码 |
| COMMENT | varchar(4096) | YES | 注释 |
| PATH | varchar(1024) | NO | backup_set/backup_piece 所属备份目的地 |

## 查询示例

用户租户查询本租户已完成的 `backup_set` 或 `backup_piece` 清理任务的历史信息。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_BACKUP_DELETE_TASK_HISTORY\G
```

查询结果如下：

```shell
*************************** 1. row ***************************
           TASK_ID: 4
       INCARNATION: 1
            JOB_ID: 7
         TASK_TYPE: BACKUP SET
                ID: 1
          ROUND_ID: 0
           DEST_ID: 1002
   START_TIMESTAMP: 2022-06-01 12:09:50.800772
     END_TIMESTAMP: 2022-06-01 12:09:54.954691
            STATUS: COMPLETED
    TOTAL_LS_COUNT: 2
   FINISH_LS_COUNT: 2
            RESULT: 0
           COMMENT:
              PATH: file:///data/nfs/backup/data
*************************** 2. row ***************************
           TASK_ID: 5
       INCARNATION: 1
            JOB_ID: 7
         TASK_TYPE: BACKUP PIECE
                ID: 1
          ROUND_ID: 1
           DEST_ID: 1001
   START_TIMESTAMP: 2022-06-01 12:09:50.968413
     END_TIMESTAMP: 2022-06-01 12:09:56.283804
            STATUS: COMPLETED
    TOTAL_LS_COUNT: 2
   FINISH_LS_COUNT: 2
            RESULT: 0
           COMMENT:
              PATH: file:///data/nfs/backup/archive
2 rows in set
```

## 相关视图或文档

* 查看正在执行的备份清理的 Job 任务的执行进度：[DBA_OB_BACKUP_DELETE_JOBS](6500.o-dba_ob_backup_delete_jobs-of-mysql-mode.md)

* 查看正在执行的备份清理的 Task 任务的执行进度：[DBA_OB_BACKUP_DELETE_TASKS](6800.o-dba_ob_backup_delete_tasks-of-mysql-mode.md)

* 查看备份清理的 Job 任务历史信息：[DBA_OB_BACKUP_DELETE_JOB_HISTORY](6400.o-dba_ob_backup_delete_job_history-of-mysql-mode.md)

* 设置自动清理过期备份的详细操作，参见 [自动清理过期备份](../../../../600.manage/600.backup-and-recovery/500.clear-backup-data/100.cleaning-up-backed-up-data-automatically.md)。