|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|
|machine-translation||

# oceanbase.DBA_OB_RESTORE_HISTORY

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.0.0 版本开始引入。</p>
</main>

## 功能描述

展示当前租户已完成的租户级恢复任务。

## 字段说明

| 字段名称 | 类型 | 是否可以为 NULL | 描述 |
| --- | --- | --- | --- |
| JOB_ID                           | bigint(20)          |  NO   |恢复所属 job_id, 对应一次恢复任务 |
| RESTORE_TENANT_NAME              | varchar(128)        |  NO   |恢复的租户名  |
| RESTORE_TENANT_ID                | bigint(20)          |  NO   |恢复的租户 ID  |
| BACKUP_TENANT_NAME               | varchar(128)        |  NO   |备份的源租户名    |
| BACKUP_TENANT_ID                 | bigint(20)          |  NO   |备份的源租户 ID  |
| BACKUP_CLUSTER_NAME              | varchar(128)        |  NO   |备份的源集群名   |
| BACKUP_DEST                      | longtext            |  NO   |备份集路径，指用户输入的数据备份路径与日志归档路径   |
| RESTORE_SCN                      | bigint(20) unsigned |  NO   |用户指定的恢复位点  |
| RESTORE_SCN_DISPLAY              | datetime(6)         |  NO   |用户指定的恢复位点的时间戳表示  |
| RESTORE_OPTION                   | varchar(4096)       |  NO   |恢复选项，发起恢复时，用户指定的 `restore_option`  |
| RESTORE_TYPE                      | varchar(4096)            |  NO   |恢复类型。<ul> <li>`FULL`：表示全量恢复</li> <li> `QUICK`：表示快速恢复</li></ul>  <main id="notice" type='explain'><h4>说明</h4><p>该字段从 V4.3.5 BP1 版本开始引入。</p></main>   |
| START_TIMESTAMP                  | timestamp(6)        |  YES   |恢复任务开始时间戳  |
| FINISH_TIMESTAMP                 | timestamp(6)        |  YES   |恢复任务结束时间戳  |
| STATUS                           | varchar(64)         |  NO   |恢复结果: <ul> <li> `SUCCESS` : 表示恢复成功 </li> <li> `FAILED` : 表示恢复失败 </li></ul> |
| BACKUP_PIECE_LIST                | longtext            |  NO   |恢复依赖的日志归档分片路径列表, 分片间以 `,` 分隔, 例如：`file:///data/nfs/backup/archive/2_1_2,file:///data/nfs/backup/archive/2_1_3` |
| BACKUP_SET_LIST                  | longtext            |  NO   |恢复依赖的数据备份集路径列表, 备份集间以 `,` 分隔，例如：`file:///data/nfs/backup/data/backup_set_1_full,file:///data/nfs/backup/data/backup_set_2_inc` |
| BACKUP_CLUSTER_VERSION           | bigint(20)          |  NO   |备份源集群版本号 |
| LS_COUNT                         | bigint(20)          |  NO   |恢复日志流总量   |
| FINISH_LS_COUNT                  | bigint(20)          |  NO   |完成恢复日志流数量  |
| TABLET_COUNT                     | bigint(20)          |  NO   |恢复分片总量  |
| FINISH_TABLET_COUNT              | bigint(20)          |  NO   |完成恢复分片数量  |
| TOTAL_BYTES                      | bigint(20)          |  NO   |恢复总字节数  |
| TOTAL_BYTES_DISPLAY              | varchar(27)         |  NO   |恢复总字节数，以存储容量单位显示  |
| FINISH_BYTES                     | bigint(20)          |  NO   |完成恢复字节数  |
| FINISH_BYTES_DISPLAY             | varchar(27)         |  NO   |完成恢复字节数，以存储容量单位显示  |
| DESCRIPTION                      | varchar(1024)       |  YES   |恢复命令里指定的 `DESCRIPTION` 信息  |
| COMMENT                          | varchar(1024)       |  YES   |恢复失败时记录失败信息  |

## 查询示例

用户租户查询本租户已完成的恢复任务。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_RESTORE_HISTORY\G
```

查询结果如下所示：

```shell
*************************** 1. row ***************************
                JOB_ID: 3
   RESTORE_TENANT_NAME: AUX_RECOVER$1736315512813183
     RESTORE_TENANT_ID: 1012
    BACKUP_TENANT_NAME: mysql001
      BACKUP_TENANT_ID: 1002
   BACKUP_CLUSTER_NAME: test425
           BACKUP_DEST: file:///home/admin/oceanbase/arglog,file:///home/admin/oceanbase/backupdata
           RESTORE_SCN: 1736315345952321000
   RESTORE_SCN_DISPLAY: 2025-01-08 13:49:05.952321
        RESTORE_OPTION: pool_list=rptest
          RESTORE_TYPE: QUICK
       START_TIMESTAMP: 2025-01-08 13:51:52.836523
      FINISH_TIMESTAMP: 2025-01-08 13:55:55.937792
                STATUS: SUCCESS
     BACKUP_PIECE_LIST: file:///home/admin/oceanbase/arglog/piece_d1001r1p1,file:///home/admin/oceanbase/arglog/piece_d1001r1p2
       BACKUP_SET_LIST: file:///home/admin/oceanbase/backupdata/backup_set_5_full
BACKUP_CLUSTER_VERSION: 17180001538
              LS_COUNT: 2
       FINISH_LS_COUNT: 0
          TABLET_COUNT: 1258
   FINISH_TABLET_COUNT: 1258
           TOTAL_BYTES: 56561873
   TOTAL_BYTES_DISPLAY: 53.94MB
          FINISH_BYTES: 0
  FINISH_BYTES_DISPLAY: 0.00MB
           DESCRIPTION: NULL
               COMMENT:
1 row in set
```