|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type|MySQL Mode|
|machine-translation||

# oceanbase.DBA_OB_TABLE_STAT_STALE_INFO

<main id="notice" type='explain'>
<h4>说明</h4>
<p>该视图从 V4.2.0 版本开始引入。</p>
</main>

## 功能描述

展示当前租户下自上次收集统计信息以来每个表发生的 DML 操作次数，以及当前统计信息是否已过期。

## 字段说明

| **字段** | **类型** | **是否为 NULL** | **描述** |
| --- | --- | --- | --- |
| DATABASE_NAME | varchar(128) | NO | 表所在的数据库名 |
| TABLE_NAME | varchar(128) | NO | 表名|
| PARTITION_NAME | varchar(128) | YES | 分区名。当分区表此列的值为 NULL 时，表示当前记录在表级别进行了汇总 |
| SUBPARTITION_NAME | varchar(128) | YES | 二级分区名。当二级分区表此列的值为 NULL 时，表示当前记录在表级别或分区级别进行了汇总 |
| LAST_ANALYZED_ROWS | bigint(20) | YES | 上次收集统计信息时的行数。值为 NULL 表示没有收集过统计信息 |
| LAST_ANALYZED_TIME | timestamp(6) | YES | 上次收集统计信息时的时间。值为 NULL 表示没有收集过统计信息 |
| INSERTS | bigint(21) | NO | 从上次收集统计信息起发生了多少行的插入 |
| UPDATES | bigint(21) | NO | 从上次收集统计信息起发生了多少行的更新 |
| DELETES | bigint(21) | NO | 从上次收集统计信息起发生了多少行的删除 |
| STALE_PERCENT | bigint(21) | NO | 判定统计信息过期的百分比 |
| IS_STALE | varchar(3) | NO | 统计信息是否过期。<ul><li>`YES` 表示过期<ul><li>当表收集过统计信息时，过期的条件为 `INSERTS + UPDATES + DELETES > LAST_ANALYZED_ROWS * STALE_PERCENT / 100`  </li><li>当表没有收集过统计信息时，过期的条件为 `INSERTS + UPDATES + DELETES > 0` </li></ul>  </li><li>`NO` 表示未过期 </li></ul>|

## 查询示例

查看本租户的表 `t_subpart` 自上次收集统计信息以来发生的 DML 操作次数及统计信息的过期情况。

```shell
obclient [oceanbase]> SELECT * FROM oceanbase.DBA_OB_TABLE_STAT_STALE_INFO WHERE TABLE_NAME='t_subpart';
```

查询结果如下：

```shell
+---------------+---------------+----------------+-------------------+--------------------+----------------------------+---------+---------+---------+---------------+----------+
| DATABASE_NAME | TABLE_NAME    | PARTITION_NAME | SUBPARTITION_NAME | LAST_ANALYZED_ROWS | LAST_ANALYZED_TIME         | INSERTS | UPDATES | DELETES | STALE_PERCENT | IS_STALE |
+---------------+---------------+----------------+-------------------+--------------------+----------------------------+---------+---------+---------+---------------+----------+
| test          | t_subpart     | NULL           | NULL              |               1000 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2023          | NULL              |                635 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2024          | NULL              |                365 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p_max          | NULL              |                  0 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2023          | p2023sp0          |                127 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2023          | p2023sp1          |                190 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2023          | p2023sp2          |                127 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2023          | p2023sp3          |                191 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2024          | p2024sp0          |                 73 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2024          | p2024sp1          |                110 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2024          | p2024sp2          |                 73 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p2024          | p2024sp3          |                109 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p_max          | p_maxsp0          |                  0 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p_max          | p_maxsp1          |                  0 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p_max          | p_maxsp2          |                  0 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
| test          | t_subpart     | p_max          | p_maxsp3          |                  0 | 2025-03-21 16:21:09.846859 |       0 |       0 |       0 |            10 | NO       |
+---------------+---------------+----------------+-------------------+--------------------+----------------------------+---------+---------+---------+---------------+----------+
16 rows in set
```