|description||
|---|---|
|keywords||
|dir-name||
|dir-name-en||
|tenant-type||

# CPU 相关参数

|             配置项             |                                                   描述                                                   |                             建议                              |
|-----------------------------|--------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| work_thread_num             | OBProxy 的工作线程数，对 CPU 占用影响比较大，默认值为 128。更改后需要重启 OBProxy                                                    | 可根据环境动态调整，OBProxy 的 CPU 使用上限为 `work_thread_num` 的值          |
| task_thread_num             | 一些后台任务的线程，如：拉取 rslist 信息，默认值为 2。更改后需要重启 OBProxy                                                        | 保持默认值                                                       |
| block_thread_num            | block 线程数，默认值为 1。更改后需要重启 OBProxy                                                                       | 保持默认值                                                       |
| grpc_thread_num             | grpc 线程数，默认值为 8。更改后需要重启 OBProxy                                                                        | 保持默认值                                                       |
| net_accept_threads          | 执行 accept 的线程数，默认值为 2。更改后需要重启 OBProxy                                                                  | 保持默认值                                                       |
| automatic_match_work_thread | 忽略指定的 `work_thread_num`，根据 CPU 数自动调整线程数，该选项为 true 时，上限为 `work_thread_num` 的值，默认值为 true。更改后需要重启 OBProxy | <ul><li><code>automatic_match_work_thread=false</code> 时，使用配置项 <code>work_thread_num</code> 的值；</li><li><code>automatic_match_work_thread=true</code> 时，使用 <code>MIN(机器 CPU，work_thread_num)</code> 的值。</li></ul>例如，配置项 <code>work_thread_num</code> 的值设定得较大。<ul><li>在混合部署时，建议 <code>automatic_match_work_thread=true</code>；</li><li>单独部署时，可以设置 <code>automatic_match_work_thread=false</code>，即 ODP 占用整台机器。</li></ul> |
| enable_compression_protocol | 关闭压缩，减少 OBProxy 对 CPU 的占用。  | 建议配置为 False  <main id="notice" type='explain'><h4>说明</h4><p>在 ODP 中，该配置项从 V4.3.4 版本开始废弃。 </p></main>                                               |

可在 `sys` 租户下，通过 OBProxy 的 2883 端口连接到 OceanBase 集群，使用 `ALTER PROXYCONFIG SET` 和 `SHOW PROXYCONFIG LIKE` 语句修改和查看上述配置项。

示例如下：

```shell
obclient> ALTER PROXYCONFIG SET automatic_match_work_thread = False;
```

```shell
obclient> SHOW PROXYCONFIG LIKE 'work_thread_num';
```
